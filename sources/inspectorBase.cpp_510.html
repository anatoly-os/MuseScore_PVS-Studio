
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>inspectorBase.cpp</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">//=============================================================================</a>
<a name="ln2">//  MuseScore</a>
<a name="ln3">//  Music Composition &amp; Notation</a>
<a name="ln4">//</a>
<a name="ln5">//  Copyright (C) 2011-2013 Werner Schweer and others</a>
<a name="ln6">//</a>
<a name="ln7">//  This program is free software; you can redistribute it and/or modify</a>
<a name="ln8">//  it under the terms of the GNU General Public License version 2</a>
<a name="ln9">//  as published by the Free Software Foundation and appearing in</a>
<a name="ln10">//  the file LICENSE.GPL</a>
<a name="ln11">//=============================================================================</a>
<a name="ln12"> </a>
<a name="ln13">#include &quot;libmscore/score.h&quot;</a>
<a name="ln14">#include &quot;libmscore/element.h&quot;</a>
<a name="ln15">#include &quot;libmscore/beam.h&quot;</a>
<a name="ln16">#include &quot;libmscore/undo.h&quot;</a>
<a name="ln17">#include &quot;musescore.h&quot;</a>
<a name="ln18">#include &quot;inspectorBase.h&quot;</a>
<a name="ln19">#include &quot;inspector.h&quot;</a>
<a name="ln20">#include &quot;icons.h&quot;</a>
<a name="ln21">#include &quot;preferences.h&quot;</a>
<a name="ln22">#include &quot;offsetSelect.h&quot;</a>
<a name="ln23">#include &quot;scaleSelect.h&quot;</a>
<a name="ln24">#include &quot;sizeSelect.h&quot;</a>
<a name="ln25">#include &quot;fontStyleSelect.h&quot;</a>
<a name="ln26">#include &quot;scoreview.h&quot;</a>
<a name="ln27">#include &quot;script/script.h&quot;</a>
<a name="ln28">#include &quot;resetButton.h&quot;</a>
<a name="ln29">#include &quot;telemetrymanager.h&quot;</a>
<a name="ln30">#include &quot;tourhandler.h&quot;</a>
<a name="ln31"> </a>
<a name="ln32">namespace Ms {</a>
<a name="ln33"> </a>
<a name="ln34">std::unique_ptr&lt;InspectorEventObserver&gt; InspectorEventObserver::i;</a>
<a name="ln35"> </a>
<a name="ln36">//---------------------------------------------------------</a>
<a name="ln37">//   InspectorBase</a>
<a name="ln38">//---------------------------------------------------------</a>
<a name="ln39"> </a>
<a name="ln40">InspectorBase::InspectorBase(QWidget* parent)</a>
<a name="ln41">   : QWidget(parent)</a>
<a name="ln42">      {</a>
<a name="ln43">      setObjectName(&quot;InspectorBase&quot;);</a>
<a name="ln44">      setAccessibleName(tr(&quot;Inspector&quot;));</a>
<a name="ln45">      inspector = static_cast&lt;Inspector*&gt;(parent);</a>
<a name="ln46">      setParent(parent);</a>
<a name="ln47">      _layout    = new QVBoxLayout(this);</a>
<a name="ln48">      _layout-&gt;setSpacing(0);</a>
<a name="ln49">      _layout-&gt;setContentsMargins(0, 10, 0, 0);</a>
<a name="ln50">      _layout-&gt;addStretch(100);</a>
<a name="ln51">      scrollPreventer = new InspectorScrollPreventer(this);</a>
<a name="ln52">      }</a>
<a name="ln53"> </a>
<a name="ln54">//---------------------------------------------------------</a>
<a name="ln55">//   getValue</a>
<a name="ln56">//    get value from gui element</a>
<a name="ln57">//---------------------------------------------------------</a>
<a name="ln58"> </a>
<a name="ln59">QVariant InspectorBase::getValue(const InspectorItem&amp; ii) const</a>
<a name="ln60">      {</a>
<a name="ln61">      QWidget* w = ii.w;</a>
<a name="ln62"> </a>
<a name="ln63">      QVariant v;</a>
<a name="ln64">      if (qobject_cast&lt;QDoubleSpinBox*&gt;(w) || qobject_cast&lt;QSpinBox*&gt;(w))</a>
<a name="ln65">            v = w-&gt;property(&quot;value&quot;);</a>
<a name="ln66">      else if (qobject_cast&lt;QFontComboBox*&gt;(w))</a>
<a name="ln67">            v = static_cast&lt;QFontComboBox*&gt;(w)-&gt;currentFont().family();</a>
<a name="ln68">      else if (qobject_cast&lt;QComboBox*&gt;(w)) {</a>
<a name="ln69">            QComboBox* cb = qobject_cast&lt;QComboBox*&gt;(w);</a>
<a name="ln70">            int val = cb-&gt;currentIndex();</a>
<a name="ln71">            if (cb-&gt;itemData(val).isValid())</a>
<a name="ln72">                  val = cb-&gt;itemData(val).toInt();</a>
<a name="ln73">            v = val;</a>
<a name="ln74">            }</a>
<a name="ln75">      else if (qobject_cast&lt;Awl::ColorLabel*&gt;(w))</a>
<a name="ln76">            v = static_cast&lt;Awl::ColorLabel*&gt;(w)-&gt;color();</a>
<a name="ln77">      else if (qobject_cast&lt;QCheckBox*&gt;(w) || qobject_cast&lt;QPushButton*&gt;(w) || qobject_cast&lt;QToolButton*&gt;(w))</a>
<a name="ln78">            v = w-&gt;property(&quot;checked&quot;);</a>
<a name="ln79">      else if (qobject_cast&lt;QLineEdit*&gt;(w))</a>
<a name="ln80">            v =  w-&gt;property(&quot;text&quot;);</a>
<a name="ln81">      else if (qobject_cast&lt;Ms::AlignSelect*&gt;(w))</a>
<a name="ln82">            v = int(static_cast&lt;Ms::AlignSelect*&gt;(w)-&gt;align());</a>
<a name="ln83">      else if (qobject_cast&lt;Ms::FontStyleSelect*&gt;(w))</a>
<a name="ln84">            v = int(static_cast&lt;Ms::FontStyleSelect*&gt;(w)-&gt;fontStyle());</a>
<a name="ln85">      else if (qobject_cast&lt;Ms::OffsetSelect*&gt;(w))</a>
<a name="ln86">            v = static_cast&lt;Ms::OffsetSelect*&gt;(w)-&gt;offset();</a>
<a name="ln87">      else if (qobject_cast&lt;Ms::ScaleSelect*&gt;(w))</a>
<a name="ln88">            v = static_cast&lt;Ms::ScaleSelect*&gt;(w)-&gt;scale();</a>
<a name="ln89">      else if (qobject_cast&lt;Ms::SizeSelect*&gt;(w))</a>
<a name="ln90">            v = static_cast&lt;Ms::SizeSelect*&gt;(w)-&gt;value();</a>
<a name="ln91">      else</a>
<a name="ln92">            qFatal(&quot;not supported widget %s&quot;, w-&gt;metaObject()-&gt;className());</a>
<a name="ln93"> </a>
<a name="ln94">      switch (propertyType(ii.t)) {</a>
<a name="ln95">            case P_TYPE::POINT_SP:</a>
<a name="ln96">                  v = v.toPointF() * inspector-&gt;element()-&gt;score()-&gt;spatium();</a>
<a name="ln97">                  break;</a>
<a name="ln98">            case P_TYPE::POINT_SP_MM: {</a>
<a name="ln99">                  Element* e = inspector-&gt;element();</a>
<a name="ln100">                  if (e-&gt;sizeIsSpatiumDependent())</a>
<a name="ln101">                        v = v.toPointF() * e-&gt;score()-&gt;spatium();</a>
<a name="ln102">                  else</a>
<a name="ln103">                        v = v.toPointF() * DPMM;</a>
<a name="ln104">                  }</a>
<a name="ln105">                  break;</a>
<a name="ln106">            case P_TYPE::SP_REAL:</a>
<a name="ln107">                  v = v.toDouble() * inspector-&gt;element()-&gt;score()-&gt;spatium();</a>
<a name="ln108">                  break;</a>
<a name="ln109">            case P_TYPE::TEMPO:</a>
<a name="ln110">                  v = v.toDouble() / 60.0;</a>
<a name="ln111">                  break;</a>
<a name="ln112">            case P_TYPE::ZERO_INT:</a>
<a name="ln113">                  v = v.toInt() - 1;</a>
<a name="ln114">                  break;</a>
<a name="ln115">            case P_TYPE::POINT_MM:</a>
<a name="ln116">                  v = v.toPointF() * DPMM;</a>
<a name="ln117">                  break;</a>
<a name="ln118">            case P_TYPE::SIZE_MM:</a>
<a name="ln119">                  v = v.toSizeF() * DPMM;</a>
<a name="ln120">                  break;</a>
<a name="ln121">            case P_TYPE::BARLINE_TYPE:</a>
<a name="ln122">                  v = QVariant::fromValue(BarLineType(v.toInt()));</a>
<a name="ln123">                  break;</a>
<a name="ln124">            case P_TYPE::DIRECTION:</a>
<a name="ln125">                  v = QVariant::fromValue&lt;Direction&gt;(Direction(v.toInt()));</a>
<a name="ln126">                  break;</a>
<a name="ln127">            case P_TYPE::INT_LIST: {</a>
<a name="ln128">                  QStringList sl = v.toString().split(&quot;,&quot;, QString::SkipEmptyParts);</a>
<a name="ln129">                  QList&lt;int&gt; il;</a>
<a name="ln130">                  for (const QString&amp; l : sl) {</a>
<a name="ln131">                        int i = l.simplified().toInt();</a>
<a name="ln132">                        il.append(i);</a>
<a name="ln133">                        }</a>
<a name="ln134">                  v = QVariant::fromValue(il);</a>
<a name="ln135">                  }</a>
<a name="ln136">                  break;</a>
<a name="ln137">            default:</a>
<a name="ln138">                  break;</a>
<a name="ln139">            }</a>
<a name="ln140">      return v;</a>
<a name="ln141">      }</a>
<a name="ln142"> </a>
<a name="ln143">//---------------------------------------------------------</a>
<a name="ln144">//   setValue</a>
<a name="ln145">//    set gui element value</a>
<a name="ln146">//---------------------------------------------------------</a>
<a name="ln147"> </a>
<a name="ln148">void InspectorBase::setValue(const InspectorItem&amp; ii, QVariant val)</a>
<a name="ln149">      {</a>
<a name="ln150">      QWidget* w = ii.w;</a>
<a name="ln151"> </a>
<a name="ln152">      Pid id  = ii.t;</a>
<a name="ln153"> </a>
<a name="ln154">      switch (propertyType(id)) {</a>
<a name="ln155">            case P_TYPE::POINT_SP:</a>
<a name="ln156">                  val = val.toPointF() / inspector-&gt;element()-&gt;score()-&gt;spatium();</a>
<a name="ln157">                  break;</a>
<a name="ln158">            case P_TYPE::POINT_SP_MM: {</a>
<a name="ln159">                  Element* e = inspector-&gt;element();</a>
<a name="ln160">                  if (e-&gt;sizeIsSpatiumDependent())</a>
<a name="ln161">                        val = val.toPointF() / e-&gt;score()-&gt;spatium();</a>
<a name="ln162">                  else</a>
<a name="ln163">                        val = val.toPointF() / DPMM;</a>
<a name="ln164">                  }</a>
<a name="ln165">                  break;</a>
<a name="ln166">            case P_TYPE::SP_REAL:</a>
<a name="ln167">                  val = val.toDouble() / inspector-&gt;element()-&gt;score()-&gt;spatium();</a>
<a name="ln168">                  break;</a>
<a name="ln169">            case P_TYPE::TEMPO:</a>
<a name="ln170">                  val = val.toDouble() * 60.0;</a>
<a name="ln171">                  break;</a>
<a name="ln172">            case P_TYPE::ZERO_INT:</a>
<a name="ln173">                  val = val.toInt() + 1;</a>
<a name="ln174">                  break;</a>
<a name="ln175">            case P_TYPE::POINT_MM:</a>
<a name="ln176">                  val = val.toPointF() / DPMM;</a>
<a name="ln177">                  break;</a>
<a name="ln178">            case P_TYPE::SIZE_MM:</a>
<a name="ln179">                  val = val.toSizeF() / DPMM;</a>
<a name="ln180">                  break;</a>
<a name="ln181">            case P_TYPE::DIRECTION:</a>
<a name="ln182">                  val = int(val.value&lt;Direction&gt;());</a>
<a name="ln183">                  break;</a>
<a name="ln184">            case P_TYPE::INT_LIST: {</a>
<a name="ln185">                  QString s;</a>
<a name="ln186">                  QList&lt;int&gt; il = val.value&lt;QList&lt;int&gt;&gt;();</a>
<a name="ln187">                  for (int i : il) {</a>
<a name="ln188">                        if (!s.isEmpty())</a>
<a name="ln189">                              s += &quot;, &quot;;</a>
<a name="ln190">                        s += QString(&quot;%1&quot;).arg(i);</a>
<a name="ln191">                        }</a>
<a name="ln192">                  val = s;</a>
<a name="ln193">                  }</a>
<a name="ln194">                  break;</a>
<a name="ln195"> </a>
<a name="ln196">            default:</a>
<a name="ln197">                  break;</a>
<a name="ln198">            }</a>
<a name="ln199">      if (qobject_cast&lt;QDoubleSpinBox*&gt;(w))</a>
<a name="ln200">            static_cast&lt;QDoubleSpinBox*&gt;(w)-&gt;setValue(val.toDouble());</a>
<a name="ln201">      else if (qobject_cast&lt;QSpinBox*&gt;(w))</a>
<a name="ln202">            static_cast&lt;QSpinBox*&gt;(w)-&gt;setValue(val.toInt());</a>
<a name="ln203">      else if (qobject_cast&lt;QFontComboBox*&gt;(w))</a>
<a name="ln204">            static_cast&lt;QFontComboBox*&gt;(w)-&gt;setCurrentFont(QFont(val.toString()));</a>
<a name="ln205">      else if (qobject_cast&lt;QComboBox*&gt;(w)) {</a>
<a name="ln206">            int ival   = val.toInt();</a>
<a name="ln207">            bool found = false;</a>
<a name="ln208">            QComboBox* cb = qobject_cast&lt;QComboBox*&gt;(w);</a>
<a name="ln209">            if (cb-&gt;itemData(0).isValid()) {</a>
<a name="ln210">                  for (int i = 0; i &lt; cb-&gt;count(); ++i) {</a>
<a name="ln211">                        if (cb-&gt;itemData(i).toInt() == ival) {</a>
<a name="ln212">                              cb-&gt;setCurrentIndex(i);</a>
<a name="ln213">                              found = true;</a>
<a name="ln214">                              break;</a>
<a name="ln215">                              }</a>
<a name="ln216">                        }</a>
<a name="ln217">                  if (!found)</a>
<a name="ln218">                        qDebug(&quot;ComboBox item not found: pid &lt;%s&gt; data &lt;%d&gt;&quot;, propertyName(id), ival);</a>
<a name="ln219">                  }</a>
<a name="ln220">            else</a>
<a name="ln221">                  cb-&gt;setCurrentIndex(ival);</a>
<a name="ln222">            }</a>
<a name="ln223">      else if (qobject_cast&lt;QCheckBox*&gt;(w))</a>
<a name="ln224">            static_cast&lt;QCheckBox*&gt;(w)-&gt;setChecked(val.toBool());</a>
<a name="ln225">      else if (qobject_cast&lt;Awl::ColorLabel*&gt;(w))</a>
<a name="ln226">            static_cast&lt;Awl::ColorLabel*&gt;(w)-&gt;setColor(val.value&lt;QColor&gt;());</a>
<a name="ln227">      else if (qobject_cast&lt;QPushButton*&gt;(w))</a>
<a name="ln228">            static_cast&lt;QPushButton*&gt;(w)-&gt;setChecked(val.toBool());</a>
<a name="ln229">      else if (qobject_cast&lt;QToolButton*&gt;(w))</a>
<a name="ln230">            static_cast&lt;QToolButton*&gt;(w)-&gt;setChecked(val.toBool());</a>
<a name="ln231">      else if (qobject_cast&lt;QLineEdit*&gt;(w))</a>
<a name="ln232">            static_cast&lt;QLineEdit*&gt;(w)-&gt;setText(val.toString());</a>
<a name="ln233">      else if (qobject_cast&lt;Ms::AlignSelect*&gt;(w))</a>
<a name="ln234">            static_cast&lt;Ms::AlignSelect*&gt;(w)-&gt;setAlign(Align(val.toInt()));</a>
<a name="ln235">      else if (qobject_cast&lt;Ms::FontStyleSelect*&gt;(w))</a>
<a name="ln236">            static_cast&lt;Ms::FontStyleSelect*&gt;(w)-&gt;setFontStyle(FontStyle(val.toInt()));</a>
<a name="ln237">      else if (qobject_cast&lt;Ms::OffsetSelect*&gt;(w))</a>
<a name="ln238">            static_cast&lt;Ms::OffsetSelect*&gt;(w)-&gt;setOffset(val.toPointF());</a>
<a name="ln239">      else if (qobject_cast&lt;Ms::ScaleSelect*&gt;(w))</a>
<a name="ln240">            static_cast&lt;Ms::ScaleSelect*&gt;(w)-&gt;setScale(val.toSizeF());</a>
<a name="ln241">      else if (qobject_cast&lt;Ms::SizeSelect*&gt;(w))</a>
<a name="ln242">            static_cast&lt;Ms::SizeSelect*&gt;(w)-&gt;setValue(val);</a>
<a name="ln243">      else</a>
<a name="ln244">            qFatal(&quot;not supported widget %s&quot;, w-&gt;metaObject()-&gt;className());</a>
<a name="ln245">      }</a>
<a name="ln246"> </a>
<a name="ln247">//---------------------------------------------------------</a>
<a name="ln248">//   effectiveElement</a>
<a name="ln249">//---------------------------------------------------------</a>
<a name="ln250"> </a>
<a name="ln251">Element* InspectorBase::effectiveElement(const InspectorItem&amp; ii) const</a>
<a name="ln252">      {</a>
<a name="ln253">      Element* e = inspector-&gt;element();</a>
<a name="ln254">      for (int i = 0; i &lt; ii.parent; ++i)</a>
<a name="ln255">            e = e-&gt;parent();</a>
<a name="ln256">      if (Element* ee = e-&gt;propertyDelegate(ii.t))</a>
<a name="ln257">            e = ee;</a>
<a name="ln258">      return e;</a>
<a name="ln259">      }</a>
<a name="ln260"> </a>
<a name="ln261">//---------------------------------------------------------</a>
<a name="ln262">//   isDefault</a>
<a name="ln263">//---------------------------------------------------------</a>
<a name="ln264"> </a>
<a name="ln265">bool InspectorBase::isDefault(const InspectorItem&amp; ii)</a>
<a name="ln266">      {</a>
<a name="ln267">      Element* e  = effectiveElement(ii);</a>
<a name="ln268">      Pid id      = ii.t;</a>
<a name="ln269">      QVariant val = e-&gt;getProperty(id);</a>
<a name="ln270">      QVariant def = e-&gt;propertyDefault(id);</a>
<a name="ln271">      return val == def;</a>
<a name="ln272">      }</a>
<a name="ln273"> </a>
<a name="ln274">//---------------------------------------------------------</a>
<a name="ln275">//   compareValues</a>
<a name="ln276">//---------------------------------------------------------</a>
<a name="ln277"> </a>
<a name="ln278">bool InspectorBase::compareValues(const InspectorItem&amp; ii, QVariant a, QVariant b)</a>
<a name="ln279">      {</a>
<a name="ln280">      Pid id  = ii.t;</a>
<a name="ln281">      P_TYPE t = propertyType(id);</a>
<a name="ln282">      if (t == P_TYPE::SIZE) {</a>
<a name="ln283">            QSizeF s1 = a.toSizeF();</a>
<a name="ln284">            QSizeF s2 = b.toSizeF();</a>
<a name="ln285">            bool c = qFuzzyCompare(s1.width(), s2.width()) &amp;&amp; qFuzzyCompare(s1.height(), s2.height());</a>
<a name="ln286">            return c;</a>
<a name="ln287">            }</a>
<a name="ln288">      return b == a;</a>
<a name="ln289">      }</a>
<a name="ln290"> </a>
<a name="ln291">//---------------------------------------------------------</a>
<a name="ln292">//   dirty</a>
<a name="ln293">//    return true if a property has changed</a>
<a name="ln294">//---------------------------------------------------------</a>
<a name="ln295"> </a>
<a name="ln296">bool InspectorBase::dirty() const</a>
<a name="ln297">      {</a>
<a name="ln298">      for (const InspectorItem&amp; ii : iList) {</a>
<a name="ln299">            Element* e = effectiveElement(ii);</a>
<a name="ln300">            if (e-&gt;getProperty(ii.t) != getValue(ii))</a>
<a name="ln301">                  return true;</a>
<a name="ln302">            }</a>
<a name="ln303">      return false;</a>
<a name="ln304">      }</a>
<a name="ln305"> </a>
<a name="ln306">//---------------------------------------------------------</a>
<a name="ln307">//   setElement</a>
<a name="ln308">//---------------------------------------------------------</a>
<a name="ln309"> </a>
<a name="ln310">void InspectorBase::setElement()</a>
<a name="ln311">      {</a>
<a name="ln312">      for (const InspectorItem&amp; ii : iList) {</a>
<a name="ln313">            Pid id    = ii.t;</a>
<a name="ln314">            Element* e = effectiveElement(ii);</a>
<a name="ln315">            QVariant val = e-&gt;getProperty(id);</a>
<a name="ln316">            if (ii.w) {</a>
<a name="ln317">                  ii.w-&gt;blockSignals(true);</a>
<a name="ln318">                  setValue(ii, val);</a>
<a name="ln319">                  ii.w-&gt;blockSignals(false);</a>
<a name="ln320">                  }</a>
<a name="ln321">            checkDifferentValues(ii);</a>
<a name="ln322">            }</a>
<a name="ln323">      postInit();</a>
<a name="ln324">      }</a>
<a name="ln325"> </a>
<a name="ln326">//---------------------------------------------------------</a>
<a name="ln327">//   checkDifferentValues</a>
<a name="ln328">//    enable/disable reset button</a>
<a name="ln329">//    enable/disable value widget for multi selection</a>
<a name="ln330">//---------------------------------------------------------</a>
<a name="ln331"> </a>
<a name="ln332">void InspectorBase::checkDifferentValues(const InspectorItem&amp; ii)</a>
<a name="ln333">      {</a>
<a name="ln334">      bool valuesAreDifferent = false;</a>
<a name="ln335">      QColor c(Ms::preferences.getColor(preferences.isThemeDark() ? PREF_UI_INSPECTOR_STYLED_TEXT_COLOR_DARK : PREF_UI_INSPECTOR_STYLED_TEXT_COLOR_LIGHT));</a>
<a name="ln336"> </a>
<a name="ln337">      if (inspector-&gt;el()-&gt;size() &gt; 1) {</a>
<a name="ln338">            Pid id      = ii.t;</a>
<a name="ln339">            QVariant val = getValue(ii);</a>
<a name="ln340"> </a>
<a name="ln341">            for (Element* e : *inspector-&gt;el()) {</a>
<a name="ln342">                  for (int k = 0; k &lt; ii.parent; ++k)</a>
<a name="ln343">                        e = e-&gt;parent();</a>
<a name="ln344">                  if (Element* ee = e-&gt;propertyDelegate(id))</a>
<a name="ln345">                        e = ee;</a>
<a name="ln346"> </a>
<a name="ln347">                  valuesAreDifferent = !compareValues(ii, e-&gt;getProperty(id), val);</a>
<a name="ln348">                  if (valuesAreDifferent)</a>
<a name="ln349">                        break;</a>
<a name="ln350">                  }</a>
<a name="ln351">            ii.w-&gt;setStyleSheet(valuesAreDifferent ? QString(&quot;* { color: %1; } QToolTip { color: palette(tooltiptext); }&quot;).arg(c.name()) : &quot;&quot;);</a>
<a name="ln352">            }</a>
<a name="ln353"> </a>
<a name="ln354">      //deal with reset if only one element, or if values are the same</a>
<a name="ln355">      bool enableReset = true;</a>
<a name="ln356">      if (!valuesAreDifferent) {</a>
<a name="ln357">            Element* e = effectiveElement(ii);</a>
<a name="ln358">            PropertyFlags styledValue = e-&gt;propertyFlags(ii.t);</a>
<a name="ln359"> </a>
<a name="ln360">            switch (styledValue) {</a>
<a name="ln361">                  case PropertyFlags::STYLED:</a>
<a name="ln362">                        ii.w-&gt;setStyleSheet(QString(&quot;* { color: %1; } QToolTip { color: palette(tooltiptext); }&quot;).arg(c.name()));</a>
<a name="ln363">                        enableReset = false;</a>
<a name="ln364">                        break;</a>
<a name="ln365">                  case PropertyFlags::UNSTYLED:</a>
<a name="ln366">                        ii.w-&gt;setStyleSheet(&quot;&quot;);</a>
<a name="ln367">                        enableReset = true;</a>
<a name="ln368">                        break;</a>
<a name="ln369">                  case PropertyFlags::NOSTYLE:</a>
<a name="ln370">                        enableReset = !isDefault(ii);</a>
<a name="ln371">                        ii.w-&gt;setStyleSheet(&quot;&quot;);</a>
<a name="ln372">                        break;</a>
<a name="ln373">                  }</a>
<a name="ln374">            }</a>
<a name="ln375">      if (ii.r)</a>
<a name="ln376">            ii.r-&gt;setEnabled(enableReset);</a>
<a name="ln377">      }</a>
<a name="ln378"> </a>
<a name="ln379">//---------------------------------------------------------</a>
<a name="ln380">//   valueChanged</a>
<a name="ln381">//---------------------------------------------------------</a>
<a name="ln382"> </a>
<a name="ln383">void InspectorBase::valueChanged(int idx, bool reset)</a>
<a name="ln384">      {</a>
<a name="ln385">      static bool recursion = false;</a>
<a name="ln386"> </a>
<a name="ln387">      if (recursion)</a>
<a name="ln388">            return;</a>
<a name="ln389">      recursion = true;</a>
<a name="ln390"> </a>
<a name="ln391">      const InspectorItem&amp; ii = iList[idx];</a>
<a name="ln392">      Pid id       = ii.t;</a>
<a name="ln393">      QVariant val2 = getValue(ii);                   // get new value from UI</a>
<a name="ln394">      Element* iElement = inspector-&gt;element();</a>
<a name="ln395">      Score* score  = iElement-&gt;score();</a>
<a name="ln396"> </a>
<a name="ln397">#ifdef MSCORE_UNSTABLE</a>
<a name="ln398">      if (ScriptRecorder* rec = mscore-&gt;getScriptRecorder())</a>
<a name="ln399">            rec-&gt;recordInspectorValueChange(iElement, ii, val2);</a>
<a name="ln400">#endif</a>
<a name="ln401">      InspectorEventObserver::instance()-&gt;event(reset ? InspectorEventObserver::PropertyReset : InspectorEventObserver::PropertyChange, ii, iElement);</a>
<a name="ln402"> </a>
<a name="ln403">      if (ii.t == Pid::AUTOPLACE)</a>
<a name="ln404">            TourHandler::startTour(&quot;autoplace-tour&quot;);</a>
<a name="ln405">      else</a>
<a name="ln406">            TourHandler::startTour(&quot;inspector-tour&quot;);</a>
<a name="ln407"> </a>
<a name="ln408">      score-&gt;startCmd();</a>
<a name="ln409">      for (Element* e : *inspector-&gt;el()) {</a>
<a name="ln410">            for (int i = 0; i &lt; ii.parent; ++i)</a>
<a name="ln411">                  e = e-&gt;parent();</a>
<a name="ln412">            if (Element* ee = e-&gt;propertyDelegate(id))</a>
<a name="ln413">                  e = ee;</a>
<a name="ln414"> </a>
<a name="ln415">            // reset sets property style UNSTYLED to STYLED</a>
<a name="ln416"> </a>
<a name="ln417">            PropertyFlags ps = e-&gt;propertyFlags(id);</a>
<a name="ln418">            if (reset &amp;&amp; ps == PropertyFlags::UNSTYLED)</a>
<a name="ln419">                  ps = PropertyFlags::STYLED;</a>
<a name="ln420">            else if (ps == PropertyFlags::STYLED)</a>
<a name="ln421">                  ps = PropertyFlags::UNSTYLED;</a>
<a name="ln422">            QVariant val1 = e-&gt;getProperty(id);</a>
<a name="ln423">            if (reset) {</a>
<a name="ln424">                  val2 = e-&gt;propertyDefault(id);</a>
<a name="ln425">                  if (!val2.isValid())</a>
<a name="ln426">                        continue;</a>
<a name="ln427">                  setValue(ii, val2);           // set UI, this may call valueChanged()</a>
<a name="ln428">                  }</a>
<a name="ln429">            e-&gt;undoChangeProperty(id, val2, ps);</a>
<a name="ln430">            }</a>
<a name="ln431">      inspector-&gt;setInspectorEdit(true);</a>
<a name="ln432">      checkDifferentValues(ii);</a>
<a name="ln433">      score-&gt;endCmd();</a>
<a name="ln434">      inspector-&gt;setInspectorEdit(false);</a>
<a name="ln435"> </a>
<a name="ln436">      if (iElement != inspector-&gt;element()) {</a>
<a name="ln437">            // Something changed in selection as a result of value change.</a>
<a name="ln438">            recursion = false;</a>
<a name="ln439">            emit elementChanged();</a>
<a name="ln440">            return;</a>
<a name="ln441">            }</a>
<a name="ln442"> </a>
<a name="ln443">      postInit();</a>
<a name="ln444"> </a>
<a name="ln445">      // a subStyle change may change several other values:</a>
<a name="ln446">      if (id == Pid::SUB_STYLE)</a>
<a name="ln447">            setElement();</a>
<a name="ln448">      recursion = false;</a>
<a name="ln449"> </a>
<a name="ln450">      ScoreView* cv = mscore-&gt;currentScoreView();</a>
<a name="ln451">      cv-&gt;updateGrips();</a>
<a name="ln452">      }</a>
<a name="ln453"> </a>
<a name="ln454">//---------------------------------------------------------</a>
<a name="ln455">//   resetClicked</a>
<a name="ln456">//---------------------------------------------------------</a>
<a name="ln457"> </a>
<a name="ln458">void InspectorBase::resetClicked(int i)</a>
<a name="ln459">      {</a>
<a name="ln460">      valueChanged(i, true);</a>
<a name="ln461">      }</a>
<a name="ln462"> </a>
<a name="ln463">//---------------------------------------------------------</a>
<a name="ln464">//   setStyleClicked</a>
<a name="ln465">//---------------------------------------------------------</a>
<a name="ln466"> </a>
<a name="ln467">void InspectorBase::setStyleClicked(int i)</a>
<a name="ln468">      {</a>
<a name="ln469">      const InspectorItem&amp; ii = iList[i];</a>
<a name="ln470">      const Pid id = ii.t;</a>
<a name="ln471">      Element* e   = inspector-&gt;element();</a>
<a name="ln472">      if (Element* delegate = e-&gt;propertyDelegate(id))</a>
<a name="ln473">            e = delegate;</a>
<a name="ln474">      Score* score = e-&gt;score();</a>
<a name="ln475"> </a>
<a name="ln476">      InspectorEventObserver::instance()-&gt;event(InspectorEventObserver::PropertySetStyle, ii, e);</a>
<a name="ln477"> </a>
<a name="ln478">      Sid sidx = e-&gt;getPropertyStyle(ii.t);</a>
<a name="ln479">      if (sidx == Sid::NOSTYLE)</a>
<a name="ln480">            return;</a>
<a name="ln481">      QVariant val = getValue(ii);</a>
<a name="ln482">      P_TYPE t = propertyType(id);</a>
<a name="ln483">      if (t == P_TYPE::SP_REAL)</a>
<a name="ln484">            val = val.toDouble() / score-&gt;spatium();</a>
<a name="ln485">      else if (t == P_TYPE::POINT_SP)</a>
<a name="ln486">            val = val.toPointF() / score-&gt;spatium();</a>
<a name="ln487">      else if (t == P_TYPE::POINT_SP_MM) {</a>
<a name="ln488">            if (e-&gt;sizeIsSpatiumDependent())</a>
<a name="ln489">                  val = val.toPointF() / score-&gt;spatium();</a>
<a name="ln490">            else</a>
<a name="ln491">                  val = val.toPointF() / DPMM;</a>
<a name="ln492">            }</a>
<a name="ln493"> </a>
<a name="ln494">      score-&gt;startCmd();</a>
<a name="ln495">      for (Element* ee : *inspector-&gt;el()) {</a>
<a name="ln496">            if (Element* delegate = ee-&gt;propertyDelegate(ii.t))</a>
<a name="ln497">                  ee = delegate;</a>
<a name="ln498">            ee-&gt;undoChangeProperty(ii.t, val, PropertyFlags::STYLED);</a>
<a name="ln499">            }</a>
<a name="ln500">      score-&gt;undo(new ChangeStyleVal(score, sidx, val));</a>
<a name="ln501">      checkDifferentValues(ii);</a>
<a name="ln502">      score-&gt;endCmd();</a>
<a name="ln503">      }</a>
<a name="ln504"> </a>
<a name="ln505">//---------------------------------------------------------</a>
<a name="ln506">//   mapSignals</a>
<a name="ln507">//    initialize inspector panel</a>
<a name="ln508">//---------------------------------------------------------</a>
<a name="ln509"> </a>
<a name="ln510">void InspectorBase::mapSignals(const std::vector&lt;InspectorItem&gt;&amp; il, const std::vector&lt;InspectorPanel&gt;&amp; pl)</a>
<a name="ln511">      {</a>
<a name="ln512">      for (auto&amp; p : pl)</a>
<a name="ln513">            pList.push_back(p);</a>
<a name="ln514">      for (auto&amp; p : pList) {</a>
<a name="ln515">            QToolButton* title = p.title;</a>
<a name="ln516">            QWidget* panel = p.panel;</a>
<a name="ln517">            if (title) {</a>
<a name="ln518">                  title-&gt;setCheckable(true);</a>
<a name="ln519">                  title-&gt;setFocusPolicy(Qt::NoFocus);</a>
<a name="ln520">                  connect(title, &amp;QToolButton::clicked, this, [title, panel] (bool visible) {</a>
<a name="ln521">                        if (panel)</a>
<a name="ln522">                              panel-&gt;setVisible(visible);</a>
<a name="ln523">                        if (title) {</a>
<a name="ln524">                              title-&gt;setChecked(visible);</a>
<a name="ln525">                              title-&gt;setArrowType(visible ? Qt::DownArrow : Qt::RightArrow);</a>
<a name="ln526">                              QString key = title-&gt;parent()-&gt;objectName();</a>
<a name="ln527">                              QSettings s;</a>
<a name="ln528">                              s.setValue(QString(&quot;inspector/%1_visible&quot;).arg(key), visible);</a>
<a name="ln529">                              }});</a>
<a name="ln530">                  title-&gt;setSizePolicy(QSizePolicy::Expanding, QSizePolicy::Fixed);</a>
<a name="ln531">                  title-&gt;setToolButtonStyle(Qt::ToolButtonTextBesideIcon);</a>
<a name="ln532">                  title-&gt;setStyleSheet(&quot;font: bold;&quot;);</a>
<a name="ln533">                  QSettings s;</a>
<a name="ln534">                  QString key = title-&gt;parent()-&gt;objectName();</a>
<a name="ln535">                  bool visible = s.value(QString(&quot;inspector/%1_visible&quot;).arg(key), true).toBool();</a>
<a name="ln536">                  title-&gt;setArrowType(visible ? Qt::DownArrow : Qt::RightArrow);</a>
<a name="ln537">                  title-&gt;setChecked(visible);</a>
<a name="ln538">                  if (panel)</a>
<a name="ln539">                        panel-&gt;setVisible(visible);</a>
<a name="ln540">                  }</a>
<a name="ln541">            }</a>
<a name="ln542">      for (auto&amp; i : il)</a>
<a name="ln543">            iList.push_back(i);</a>
<a name="ln544">      int i = 0;</a>
<a name="ln545">      for (const InspectorItem&amp; ii : iList) {</a>
<a name="ln546">            QWidget* rw = ii.r;</a>
<a name="ln547">            if (rw) {</a>
<a name="ln548">                  if (qobject_cast&lt;QToolButton*&gt;(rw)) {</a>
<a name="ln549">                        QToolButton* resetButton = qobject_cast&lt;QToolButton*&gt;(rw);</a>
<a name="ln550">                        resetButton-&gt;setIcon(*icons[int(Icons::reset_ICON)]);</a>
<a name="ln551">                        connect(resetButton, &amp;QToolButton::clicked, [=] { resetClicked(i); });</a>
<a name="ln552">                        Sid sidx = inspector-&gt;element()-&gt;getPropertyStyle(ii.t);</a>
<a name="ln553">                        // S button for fingering placement is bugged and proposed to be hidden</a>
<a name="ln554">                        // it can be brought back once the relevant design is fixed, </a>
<a name="ln555">                        // for example changing values of fingering placement to &quot;Auto, Above, Below&quot;, &quot;Auto&quot; as default</a>
<a name="ln556">                        // See https://musescore.org/en/node/288372 and https://musescore.org/en/node/297092</a>
<a name="ln557">                        if (sidx != Sid::NOSTYLE &amp;&amp; sidx != Sid::fingeringPlacement) {</a>
<a name="ln558">                              QMenu* menu = new QMenu(this);</a>
<a name="ln559">                              resetButton-&gt;setMenu(menu);</a>
<a name="ln560">                              resetButton-&gt;setPopupMode(QToolButton::MenuButtonPopup);</a>
<a name="ln561">                              QAction* a = menu-&gt;addAction(tr(&quot;Set as style&quot;));</a>
<a name="ln562">                              connect(a, &amp;QAction::triggered, [=] { setStyleClicked(i); });</a>
<a name="ln563">                              }</a>
<a name="ln564">                        }</a>
<a name="ln565">                  else {</a>
<a name="ln566">                        ResetButton* b = qobject_cast&lt;ResetButton*&gt;(rw);</a>
<a name="ln567">                        connect(b, &amp;ResetButton::resetClicked, [=] { resetClicked(i); });</a>
<a name="ln568">                        Sid sidx = inspector-&gt;element()-&gt;getPropertyStyle(ii.t);</a>
<a name="ln569">                        // Same, see comment above</a>
<a name="ln570">                        if (sidx != Sid::NOSTYLE &amp;&amp; sidx != Sid::fingeringPlacement) {</a>
<a name="ln571">                              b-&gt;enableSetStyle(true);</a>
<a name="ln572">                              connect(b, &amp;ResetButton::setStyleClicked, [=] { setStyleClicked(i); });</a>
<a name="ln573">                              }</a>
<a name="ln574">                        }</a>
<a name="ln575">                  }</a>
<a name="ln576">            QWidget* w = ii.w;</a>
<a name="ln577">            if (!w)</a>
<a name="ln578">                  continue;</a>
<a name="ln579"> </a>
<a name="ln580">            if (qobject_cast&lt;QAbstractSpinBox*&gt;(w)</a>
<a name="ln581">                || qobject_cast&lt;QComboBox*&gt;(w)) {</a>
<a name="ln582">                  w-&gt;setFocusPolicy(Qt::StrongFocus);</a>
<a name="ln583">                  w-&gt;installEventFilter(scrollPreventer);</a>
<a name="ln584">                  }</a>
<a name="ln585">            else if (qobject_cast&lt;OffsetSelect*&gt;(w)) {</a>
<a name="ln586">                  qobject_cast&lt;OffsetSelect*&gt;(w)-&gt;installScrollPreventer(scrollPreventer);</a>
<a name="ln587">                  }</a>
<a name="ln588"> </a>
<a name="ln589">            if (qobject_cast&lt;QDoubleSpinBox*&gt;(w))</a>
<a name="ln590">                  connect(qobject_cast&lt;QDoubleSpinBox*&gt;(w), QOverload&lt;double&gt;::of(&amp;QDoubleSpinBox::valueChanged), [=] { valueChanged(i); });</a>
<a name="ln591">            else if (qobject_cast&lt;QSpinBox*&gt;(w))</a>
<a name="ln592">                  connect(qobject_cast&lt;QSpinBox*&gt;(w), QOverload&lt;int&gt;::of(&amp;QSpinBox::valueChanged), [=] { valueChanged(i); });</a>
<a name="ln593">            else if (qobject_cast&lt;QFontComboBox*&gt;(w))</a>
<a name="ln594">                  connect(qobject_cast&lt;QFontComboBox*&gt;(w), QOverload&lt;const QFont&amp;&gt;::of(&amp;QFontComboBox::currentFontChanged), [=] { valueChanged(i); });</a>
<a name="ln595">            else if (qobject_cast&lt;QComboBox*&gt;(w))</a>
<a name="ln596">                  connect(qobject_cast&lt;QComboBox*&gt;(w), QOverload&lt;int&gt;::of(&amp;QComboBox::currentIndexChanged), [=] { valueChanged(i); });</a>
<a name="ln597">            else if (qobject_cast&lt;QCheckBox*&gt;(w))</a>
<a name="ln598">                  connect(qobject_cast&lt;QCheckBox*&gt;(w), QOverload&lt;bool&gt;::of(&amp;QCheckBox::toggled), [=] { valueChanged(i); });</a>
<a name="ln599">            else if (qobject_cast&lt;Awl::ColorLabel*&gt;(w))</a>
<a name="ln600">                  connect(qobject_cast&lt;Awl::ColorLabel*&gt;(w), QOverload&lt;QColor&gt;::of(&amp;Awl::ColorLabel::colorChanged), [=] { valueChanged(i); });</a>
<a name="ln601">            else if (qobject_cast&lt;QPushButton*&gt;(w))</a>
<a name="ln602">                  connect(qobject_cast&lt;QPushButton*&gt;(w), QOverload&lt;bool&gt;::of(&amp;QPushButton::toggled), [=] { valueChanged(i); });</a>
<a name="ln603">            else if (qobject_cast&lt;QToolButton*&gt;(w))</a>
<a name="ln604">                  connect(qobject_cast&lt;QToolButton*&gt;(w), QOverload&lt;bool&gt;::of(&amp;QToolButton::toggled), [=] { valueChanged(i); });</a>
<a name="ln605">            else if (qobject_cast&lt;QLineEdit*&gt;(w))</a>
<a name="ln606">                  connect(qobject_cast&lt;QLineEdit*&gt;(w), QOverload&lt;const QString&amp;&gt;::of(&amp;QLineEdit::textChanged), [=] { valueChanged(i); });</a>
<a name="ln607">            else if (qobject_cast&lt;Ms::AlignSelect*&gt;(w))</a>
<a name="ln608">                  connect(qobject_cast&lt;Ms::AlignSelect*&gt;(w), QOverload&lt;Align&gt;::of(&amp;Ms::AlignSelect::alignChanged), [=] { valueChanged(i); });</a>
<a name="ln609">            else if (qobject_cast&lt;Ms::FontStyleSelect*&gt;(w))</a>
<a name="ln610">                  connect(qobject_cast&lt;Ms::FontStyleSelect*&gt;(w), QOverload&lt;FontStyle&gt;::of(&amp;Ms::FontStyleSelect::fontStyleChanged), [=] { valueChanged(i); });</a>
<a name="ln611">            else if (qobject_cast&lt;Ms::OffsetSelect*&gt;(w))</a>
<a name="ln612">                  connect(qobject_cast&lt;Ms::OffsetSelect*&gt;(w), QOverload&lt;const QPointF&amp;&gt;::of(&amp;Ms::OffsetSelect::offsetChanged), [=] { valueChanged(i); });</a>
<a name="ln613">            else if (qobject_cast&lt;Ms::ScaleSelect*&gt;(w))</a>
<a name="ln614">                  connect(qobject_cast&lt;Ms::ScaleSelect*&gt;(w), QOverload&lt;const QSizeF&amp;&gt;::of(&amp;Ms::ScaleSelect::scaleChanged), [=] { valueChanged(i); });</a>
<a name="ln615">            else if (qobject_cast&lt;Ms::SizeSelect*&gt;(w))</a>
<a name="ln616">                  connect(qobject_cast&lt;Ms::SizeSelect*&gt;(w), QOverload&lt;const QVariant&amp;&gt;::of(&amp;Ms::SizeSelect::valueChanged), [=] { valueChanged(i); });</a>
<a name="ln617">            else</a>
<a name="ln618">                  qFatal(&quot;not supported widget %s&quot;, w-&gt;metaObject()-&gt;className());</a>
<a name="ln619">            ++i;</a>
<a name="ln620">            }</a>
<a name="ln621">      }</a>
<a name="ln622"> </a>
<a name="ln623">//---------------------------------------------------------</a>
<a name="ln624">//   valueChanged</a>
<a name="ln625">//---------------------------------------------------------</a>
<a name="ln626"> </a>
<a name="ln627">void InspectorBase::valueChanged(int idx)</a>
<a name="ln628">      {</a>
<a name="ln629">      valueChanged(idx, false);</a>
<a name="ln630">      }</a>
<a name="ln631"> </a>
<a name="ln632">//---------------------------------------------------------</a>
<a name="ln633">//   addWidget</a>
<a name="ln634">//---------------------------------------------------------</a>
<a name="ln635"> </a>
<a name="ln636">QWidget* InspectorBase::addWidget()</a>
<a name="ln637">      {</a>
<a name="ln638">      QWidget* w = new QWidget;</a>
<a name="ln639">      _layout-&gt;insertWidget(_layout-&gt;count()-1, w);</a>
<a name="ln640">      _layout-&gt;insertSpacing(_layout-&gt;count()-1, 5);</a>
<a name="ln641">      return w;</a>
<a name="ln642">      }</a>
<a name="ln643"> </a>
<a name="ln644">//---------------------------------------------------------</a>
<a name="ln645">//   setupLineStyle</a>
<a name="ln646">//---------------------------------------------------------</a>
<a name="ln647"> </a>
<a name="ln648">void InspectorBase::setupLineStyle(QComboBox* cb)</a>
<a name="ln649">      {</a>
<a name="ln650">      cb-&gt;setItemData(0, int(Qt::SolidLine));</a>
<a name="ln651">      cb-&gt;setItemData(1, int(Qt::DashLine));</a>
<a name="ln652">      cb-&gt;setItemData(2, int(Qt::DotLine));</a>
<a name="ln653">      cb-&gt;setItemData(3, int(Qt::DashDotLine));</a>
<a name="ln654">      cb-&gt;setItemData(4, int(Qt::DashDotDotLine));</a>
<a name="ln655">      cb-&gt;setItemData(5, int(Qt::CustomDashLine));</a>
<a name="ln656">      }</a>
<a name="ln657"> </a>
<a name="ln658">//---------------------------------------------------------</a>
<a name="ln659">//   resetToStyle</a>
<a name="ln660">//---------------------------------------------------------</a>
<a name="ln661"> </a>
<a name="ln662">void InspectorBase::resetToStyle()</a>
<a name="ln663">      {</a>
<a name="ln664">      Score* score = inspector-&gt;element()-&gt;score();</a>
<a name="ln665">      score-&gt;startCmd();</a>
<a name="ln666">      for (Element* e : *inspector-&gt;el()) {     // TODO: ??</a>
<a name="ln667">            TextBase* text = toTextBase(e);</a>
<a name="ln668">            // Preserve &lt;sym&gt; tags</a>
<a name="ln669">            text-&gt;undoChangeProperty(Pid::TEXT, text-&gt;plainText().toHtmlEscaped().replace(&quot;&amp;lt;sym&amp;gt;&quot;,&quot;&lt;sym&gt;&quot;).replace(&quot;&amp;lt;/sym&amp;gt;&quot;,&quot;&lt;/sym&gt;&quot;));</a>
<a name="ln670">            }</a>
<a name="ln671">      score-&gt;endCmd();</a>
<a name="ln672">      }</a>
<a name="ln673"> </a>
<a name="ln674">//---------------------------------------------------------</a>
<a name="ln675">//   eventFilter</a>
<a name="ln676">///   This blocks scrolling on a scrollable thing when not in focus.</a>
<a name="ln677">///   `watched` should be a QComboBox or QAbstractSpinBox.</a>
<a name="ln678">///   If this event filter is on any non-QWidget, it will crash.</a>
<a name="ln679">//---------------------------------------------------------</a>
<a name="ln680"> </a>
<a name="ln681">bool InspectorScrollPreventer::eventFilter(QObject* watched, QEvent* event)</a>
<a name="ln682">      {</a>
<a name="ln683">      if (event-&gt;type() != QEvent::Wheel)</a>
<a name="ln684">            return QObject::eventFilter(watched, event);</a>
<a name="ln685"> </a>
<a name="ln686">      if (!qobject_cast&lt;QWidget*&gt;(watched)-&gt;hasFocus())</a>
<a name="ln687">            return true;</a>
<a name="ln688"> </a>
<a name="ln689">      return QObject::eventFilter(watched, event);</a>
<a name="ln690">      }</a>
<a name="ln691"> </a>
<a name="ln692">//---------------------------------------------------------</a>
<a name="ln693">//   event</a>
<a name="ln694">//---------------------------------------------------------</a>
<a name="ln695"> </a>
<a name="ln696">void InspectorEventObserver::event(EventType evtType, const InspectorItem&amp; ii, const Element* e)</a>
<a name="ln697">      {</a>
<a name="ln698">#ifdef BUILD_TELEMETRY_MODULE</a>
<a name="ln699">      QString evtCategory;</a>
<a name="ln700">      switch (evtType) {</a>
<a name="ln701">            case EventType::PropertyChange:</a>
<a name="ln702">                  evtCategory = QStringLiteral(&quot;inspector-property-change&quot;);</a>
<a name="ln703">                  break;</a>
<a name="ln704">            case EventType::PropertyReset:</a>
<a name="ln705">                  evtCategory = QStringLiteral(&quot;inspector-property-reset&quot;);</a>
<a name="ln706">                  break;</a>
<a name="ln707">            case EventType::PropertySetStyle:</a>
<a name="ln708">                  evtCategory = QStringLiteral(&quot;inspector-property-set-style&quot;);</a>
<a name="ln709">                  break;</a>
<a name="ln710">            }</a>
<a name="ln711"> </a>
<a name="ln712">      const QObject* w = ii.w;</a>
<a name="ln713">      const QObject* p = w-&gt;parent();</a>
<a name="ln714">      while (p &amp;&amp; !qobject_cast&lt;const InspectorBase*&gt;(p)) {</a>
<a name="ln715">            w = p;</a>
<a name="ln716">            p = p-&gt;parent();</a>
<a name="ln717">            }</a>
<a name="ln718">      const QString inspectorName = w-&gt;objectName();</a>
<a name="ln719"> </a>
<a name="ln720">      const QString evtAction = QStringLiteral(&quot;%1/%2&quot;).arg(inspectorName).arg(propertyName(ii.t));</a>
<a name="ln721">      const QString evtLabel = e ? e-&gt;name() : &quot;null&quot;;</a>
<a name="ln722">      TelemetryManager::telemetryService()-&gt;sendEvent(evtCategory, evtAction, evtLabel);</a>
<a name="ln723">#else</a>
<a name="ln724">      Q_UNUSED(evtType);</a>
<a name="ln725">      Q_UNUSED(ii);</a>
<a name="ln726">      Q_UNUSED(e);</a>
<a name="ln727">#endif</a>
<a name="ln728">      }</a>
<a name="ln729">}</a>
<a name="ln730"> </a>

</code></pre>
<div class="balloon" rel="8"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
