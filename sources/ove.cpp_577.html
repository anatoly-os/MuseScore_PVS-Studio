
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>ove.cpp</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">//=============================================================================</a>
<a name="ln2">//  MusE Score</a>
<a name="ln3">//  Linux Music Score Editor</a>
<a name="ln4">//</a>
<a name="ln5">//  Copyright (C) 2002-2009 Werner Schweer and others</a>
<a name="ln6">//</a>
<a name="ln7">//  This program is free software; you can redistribute it and/or modify</a>
<a name="ln8">//  it under the terms of the GNU General Public License version 2.</a>
<a name="ln9">//</a>
<a name="ln10">//  This program is distributed in the hope that it will be useful,</a>
<a name="ln11">//  but WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln12">//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</a>
<a name="ln13">//  GNU General Public License for more details.</a>
<a name="ln14">//</a>
<a name="ln15">//  You should have received a copy of the GNU General Public License</a>
<a name="ln16">//  along with this program; if not, write to the Free Software</a>
<a name="ln17">//  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</a>
<a name="ln18">//=============================================================================</a>
<a name="ln19"> </a>
<a name="ln20">#include &quot;ove.h&quot;</a>
<a name="ln21"> </a>
<a name="ln22">namespace OVE {</a>
<a name="ln23"> </a>
<a name="ln24">/*template &lt;class T&gt;</a>
<a name="ln25">inline void deleteVector(QList&lt;T*&gt;&amp; vec) {</a>
<a name="ln26">   for (int i=0; i&lt;vec.size(); ++i)</a>
<a name="ln27">      delete vec[i];</a>
<a name="ln28">   }</a>
<a name="ln29">   //vec.clear();</a>
<a name="ln30">}*/</a>
<a name="ln31"> </a>
<a name="ln32">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln33">TickElement::TickElement() {</a>
<a name="ln34">      tick_ = 0;</a>
<a name="ln35">      }</a>
<a name="ln36"> </a>
<a name="ln37">void TickElement::setTick(int tick) {</a>
<a name="ln38">      tick_ = tick;</a>
<a name="ln39">      }</a>
<a name="ln40"> </a>
<a name="ln41">int TickElement::getTick(void) const {</a>
<a name="ln42">      return tick_;</a>
<a name="ln43">      }</a>
<a name="ln44"> </a>
<a name="ln45">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln46">MeasurePos::MeasurePos() {</a>
<a name="ln47">      measure_ = 0;</a>
<a name="ln48">      offset_ = 0;</a>
<a name="ln49">      }</a>
<a name="ln50"> </a>
<a name="ln51">void MeasurePos::setMeasure(int measure) {</a>
<a name="ln52">      measure_ = measure;</a>
<a name="ln53">      }</a>
<a name="ln54"> </a>
<a name="ln55">int MeasurePos::getMeasure() const {</a>
<a name="ln56">      return measure_;</a>
<a name="ln57">      }</a>
<a name="ln58"> </a>
<a name="ln59">void MeasurePos::setOffset(int offset) {</a>
<a name="ln60">      offset_ = offset;</a>
<a name="ln61">      }</a>
<a name="ln62"> </a>
<a name="ln63">int MeasurePos::getOffset() const {</a>
<a name="ln64">      return offset_;</a>
<a name="ln65">      }</a>
<a name="ln66"> </a>
<a name="ln67">MeasurePos MeasurePos::shiftMeasure(int measure) const {</a>
<a name="ln68">      MeasurePos mp;</a>
<a name="ln69">      mp.setMeasure(getMeasure() + measure);</a>
<a name="ln70">      mp.setOffset(getOffset());</a>
<a name="ln71"> </a>
<a name="ln72">      return mp;</a>
<a name="ln73">      }</a>
<a name="ln74"> </a>
<a name="ln75">MeasurePos MeasurePos::shiftOffset(int offset) const {</a>
<a name="ln76">      MeasurePos mp;</a>
<a name="ln77">      mp.setMeasure(getMeasure());</a>
<a name="ln78">      mp.setOffset(getOffset() + offset);</a>
<a name="ln79"> </a>
<a name="ln80">      return mp;</a>
<a name="ln81">      }</a>
<a name="ln82"> </a>
<a name="ln83">bool MeasurePos::operator ==(const MeasurePos&amp; mp) const {</a>
<a name="ln84">      return getMeasure() == mp.getMeasure() &amp;&amp; getOffset() == mp.getOffset();</a>
<a name="ln85">      }</a>
<a name="ln86"> </a>
<a name="ln87">bool MeasurePos::operator !=(const MeasurePos&amp; mp) const {</a>
<a name="ln88">      return !(*this == mp);</a>
<a name="ln89">      }</a>
<a name="ln90"> </a>
<a name="ln91">bool MeasurePos::operator &lt;(const MeasurePos&amp; mp) const {</a>
<a name="ln92">      if (getMeasure() != mp.getMeasure()) {</a>
<a name="ln93">            return getMeasure() &lt; mp.getMeasure();</a>
<a name="ln94">            }</a>
<a name="ln95"> </a>
<a name="ln96">      return getOffset() &lt; mp.getOffset();</a>
<a name="ln97">      }</a>
<a name="ln98"> </a>
<a name="ln99">bool MeasurePos::operator &lt;=(const MeasurePos&amp; mp) const {</a>
<a name="ln100">      if (getMeasure() != mp.getMeasure()) {</a>
<a name="ln101">            return getMeasure() &lt;= mp.getMeasure();</a>
<a name="ln102">            }</a>
<a name="ln103"> </a>
<a name="ln104">      return getOffset() &lt;= mp.getOffset();</a>
<a name="ln105">      }</a>
<a name="ln106"> </a>
<a name="ln107">bool MeasurePos::operator &gt;(const MeasurePos&amp; mp) const {</a>
<a name="ln108">      return !(*this &lt;= mp);</a>
<a name="ln109">      }</a>
<a name="ln110"> </a>
<a name="ln111">bool MeasurePos::operator &gt;=(const MeasurePos&amp; mp) const {</a>
<a name="ln112">      return !(*this &lt; mp);</a>
<a name="ln113">      }</a>
<a name="ln114"> </a>
<a name="ln115">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln116">PairElement::PairElement() {</a>
<a name="ln117">      start_ = new MeasurePos();</a>
<a name="ln118">      stop_ = new MeasurePos();</a>
<a name="ln119">      }</a>
<a name="ln120"> </a>
<a name="ln121">PairElement::~PairElement(){</a>
<a name="ln122">      delete start_;</a>
<a name="ln123">      delete stop_;</a>
<a name="ln124">      }</a>
<a name="ln125"> </a>
<a name="ln126">MeasurePos* PairElement::start() const {</a>
<a name="ln127">      return start_;</a>
<a name="ln128">      }</a>
<a name="ln129"> </a>
<a name="ln130">MeasurePos* PairElement::stop() const {</a>
<a name="ln131">      return stop_;</a>
<a name="ln132">      }</a>
<a name="ln133"> </a>
<a name="ln134">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln135">PairEnds::PairEnds() {</a>
<a name="ln136">      leftLine_ = new LineElement();</a>
<a name="ln137">      rightLine_ = new LineElement();</a>
<a name="ln138">      leftShoulder_ = new OffsetElement();</a>
<a name="ln139">      rightShoulder_ = new OffsetElement();</a>
<a name="ln140">      }</a>
<a name="ln141"> </a>
<a name="ln142">PairEnds::~PairEnds(){</a>
<a name="ln143">      delete leftLine_;</a>
<a name="ln144">      delete rightLine_;</a>
<a name="ln145">      delete leftShoulder_;</a>
<a name="ln146">      delete rightShoulder_;</a>
<a name="ln147">      }</a>
<a name="ln148"> </a>
<a name="ln149">LineElement* PairEnds::getLeftLine() const {</a>
<a name="ln150">      return leftLine_;</a>
<a name="ln151">      }</a>
<a name="ln152"> </a>
<a name="ln153">LineElement* PairEnds::getRightLine() const {</a>
<a name="ln154">      return rightLine_;</a>
<a name="ln155">      }</a>
<a name="ln156"> </a>
<a name="ln157">OffsetElement* PairEnds::getLeftShoulder() const {</a>
<a name="ln158">      return leftShoulder_;</a>
<a name="ln159">      }</a>
<a name="ln160"> </a>
<a name="ln161">OffsetElement* PairEnds::getRightShoulder() const {</a>
<a name="ln162">      return rightShoulder_;</a>
<a name="ln163">      }</a>
<a name="ln164"> </a>
<a name="ln165">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln166">LineElement::LineElement() {</a>
<a name="ln167">      line_ = 0;</a>
<a name="ln168">      }</a>
<a name="ln169"> </a>
<a name="ln170">void LineElement::setLine(int line) {</a>
<a name="ln171">      line_ = line;</a>
<a name="ln172">      }</a>
<a name="ln173"> </a>
<a name="ln174">int LineElement::getLine(void) const {</a>
<a name="ln175">      return line_;</a>
<a name="ln176">      }</a>
<a name="ln177"> </a>
<a name="ln178">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln179">OffsetElement::OffsetElement() {</a>
<a name="ln180">      xOffset_ = 0;</a>
<a name="ln181">      yOffset_ = 0;</a>
<a name="ln182">      }</a>
<a name="ln183"> </a>
<a name="ln184">void OffsetElement::setXOffset(int offset) {</a>
<a name="ln185">      xOffset_ = offset;</a>
<a name="ln186">      }</a>
<a name="ln187"> </a>
<a name="ln188">int OffsetElement::getXOffset() const {</a>
<a name="ln189">      return xOffset_;</a>
<a name="ln190">      }</a>
<a name="ln191"> </a>
<a name="ln192">void OffsetElement::setYOffset(int offset) {</a>
<a name="ln193">      yOffset_ = offset;</a>
<a name="ln194">      }</a>
<a name="ln195"> </a>
<a name="ln196">int OffsetElement::getYOffset() const {</a>
<a name="ln197">      return yOffset_;</a>
<a name="ln198">      }</a>
<a name="ln199"> </a>
<a name="ln200">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln201">LengthElement::LengthElement() {</a>
<a name="ln202">      length_ = 0;</a>
<a name="ln203">      }</a>
<a name="ln204"> </a>
<a name="ln205">void LengthElement::setLength(int length) {</a>
<a name="ln206">      length_ = length;</a>
<a name="ln207">      }</a>
<a name="ln208"> </a>
<a name="ln209">int LengthElement::getLength() const {</a>
<a name="ln210">      return length_;</a>
<a name="ln211">      }</a>
<a name="ln212"> </a>
<a name="ln213">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln214">MusicData::MusicData() {</a>
<a name="ln215">      musicDataType_ = MusicDataType::None;</a>
<a name="ln216">      show_ = true;</a>
<a name="ln217">      color_ = 0;</a>
<a name="ln218">      voice_ = 0;</a>
<a name="ln219">      }</a>
<a name="ln220"> </a>
<a name="ln221">MusicDataType MusicData::getMusicDataType() const {</a>
<a name="ln222">      return musicDataType_;</a>
<a name="ln223">      }</a>
<a name="ln224"> </a>
<a name="ln225">MusicData::XmlDataType MusicData::getXmlDataType(MusicDataType type) {</a>
<a name="ln226">      XmlDataType xmlType = XmlDataType::None;</a>
<a name="ln227"> </a>
<a name="ln228">      switch (type) {</a>
<a name="ln229">            case MusicDataType::Measure_Repeat: {</a>
<a name="ln230">                  xmlType = XmlDataType::Attributes;</a>
<a name="ln231">                  break;</a>
<a name="ln232">                  }</a>
<a name="ln233">            case MusicDataType::Beam: {</a>
<a name="ln234">                  xmlType = XmlDataType::NoteBeam;</a>
<a name="ln235">                  break;</a>
<a name="ln236">                  }</a>
<a name="ln237">            case MusicDataType::Slur:</a>
<a name="ln238">            case MusicDataType::Glissando:</a>
<a name="ln239">            case MusicDataType::Tuplet:</a>
<a name="ln240">            case MusicDataType::Tie: {</a>
<a name="ln241">                  xmlType = XmlDataType::Notations;</a>
<a name="ln242">                  break;</a>
<a name="ln243">                  }</a>
<a name="ln244">            case MusicDataType::Text:</a>
<a name="ln245">            case MusicDataType::Repeat:</a>
<a name="ln246">            case MusicDataType::Wedge:</a>
<a name="ln247">            case MusicDataType::Dynamics:</a>
<a name="ln248">            case MusicDataType::Pedal:</a>
<a name="ln249">            case MusicDataType::OctaveShift_EndPoint: {</a>
<a name="ln250">                  xmlType = XmlDataType::Direction;</a>
<a name="ln251">                  break;</a>
<a name="ln252">                  }</a>
<a name="ln253">            default: {</a>
<a name="ln254">                  xmlType = XmlDataType::None;</a>
<a name="ln255">                  break;</a>
<a name="ln256">                  }</a>
<a name="ln257">            }</a>
<a name="ln258"> </a>
<a name="ln259">      return xmlType;</a>
<a name="ln260">      }</a>
<a name="ln261"> </a>
<a name="ln262">/*bool MusicData::get_is_pair_element(MusicDataType type)</a>
<a name="ln263"> {</a>
<a name="ln264"> bool pair = false;</a>
<a name="ln265"> </a>
<a name="ln266"> switch ( type )</a>
<a name="ln267"> {</a>
<a name="ln268"> case MusicDataType::Numeric_Ending :</a>
<a name="ln269"> case MusicDataType::Measure_Repeat :</a>
<a name="ln270"> case MusicDataType::Wedge :</a>
<a name="ln271"> case MusicDataType::OctaveShift :</a>
<a name="ln272"> //case MusicDataType::OctaveShift_EndPoint :</a>
<a name="ln273"> case MusicDataType::Pedal :</a>
<a name="ln274"> case MusicDataType::Beam :</a>
<a name="ln275"> case MusicDataType::Glissando :</a>
<a name="ln276"> case MusicDataType::Slur :</a>
<a name="ln277"> case MusicDataType::Tie :</a>
<a name="ln278"> case MusicDataType::Tuplet :</a>
<a name="ln279"> {</a>
<a name="ln280"> pair = true;</a>
<a name="ln281"> break;</a>
<a name="ln282"> }</a>
<a name="ln283"> default:</a>
<a name="ln284"> break;</a>
<a name="ln285"> }</a>
<a name="ln286"> </a>
<a name="ln287"> return pair;</a>
<a name="ln288"> }*/</a>
<a name="ln289"> </a>
<a name="ln290">void MusicData::setShow(bool show) {</a>
<a name="ln291">      show_ = show;</a>
<a name="ln292">      }</a>
<a name="ln293"> </a>
<a name="ln294">bool MusicData::getShow() const {</a>
<a name="ln295">      return show_;</a>
<a name="ln296">      }</a>
<a name="ln297"> </a>
<a name="ln298">void MusicData::setColor(unsigned int color) {</a>
<a name="ln299">      color_ = color;</a>
<a name="ln300">      }</a>
<a name="ln301"> </a>
<a name="ln302">unsigned int MusicData::getColor() const {</a>
<a name="ln303">      return color_;</a>
<a name="ln304">      }</a>
<a name="ln305"> </a>
<a name="ln306">void MusicData::setVoice(unsigned int voice) {</a>
<a name="ln307">      voice_ = voice;</a>
<a name="ln308">      }</a>
<a name="ln309"> </a>
<a name="ln310">unsigned int MusicData::getVoice() const {</a>
<a name="ln311">      return voice_;</a>
<a name="ln312">      }</a>
<a name="ln313"> </a>
<a name="ln314">void MusicData::copyCommonBlock(const MusicData&amp; source) {</a>
<a name="ln315">      setTick(source.getTick());</a>
<a name="ln316">      start()-&gt;setOffset(source.start()-&gt;getOffset());</a>
<a name="ln317">      setColor(source.getColor());</a>
<a name="ln318">      }</a>
<a name="ln319"> </a>
<a name="ln320">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln321">MidiData::MidiData() {</a>
<a name="ln322">      midiType_ = MidiType::None;</a>
<a name="ln323">      }</a>
<a name="ln324"> </a>
<a name="ln325">MidiType MidiData::getMidiType() const {</a>
<a name="ln326">      return midiType_;</a>
<a name="ln327">      }</a>
<a name="ln328"> </a>
<a name="ln329">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln330">OveSong::OveSong() :</a>
<a name="ln331">      codec_(0) {</a>
<a name="ln332">      clear();</a>
<a name="ln333">      }</a>
<a name="ln334"> </a>
<a name="ln335">OveSong::~OveSong() {</a>
<a name="ln336">      clear();</a>
<a name="ln337">      }</a>
<a name="ln338"> </a>
<a name="ln339">void OveSong::setIsVersion4(bool version4){</a>
<a name="ln340">      version4_ = version4;</a>
<a name="ln341">      }</a>
<a name="ln342"> </a>
<a name="ln343">bool OveSong::getIsVersion4() const {</a>
<a name="ln344">      return version4_;</a>
<a name="ln345">      }</a>
<a name="ln346"> </a>
<a name="ln347">void OveSong::setQuarter(int tick) {</a>
<a name="ln348">      quarter_ = tick;</a>
<a name="ln349">      }</a>
<a name="ln350"> </a>
<a name="ln351">int OveSong::getQuarter(void) const {</a>
<a name="ln352">      return quarter_;</a>
<a name="ln353">      }</a>
<a name="ln354"> </a>
<a name="ln355">void OveSong::setShowPageMargin(bool show){</a>
<a name="ln356">      showPageMargin_ = show;</a>
<a name="ln357">      }</a>
<a name="ln358"> </a>
<a name="ln359">bool OveSong::getShowPageMargin() const {</a>
<a name="ln360">      return showPageMargin_;</a>
<a name="ln361">      }</a>
<a name="ln362"> </a>
<a name="ln363">void OveSong::setShowTransposeTrack(bool show) {</a>
<a name="ln364">      showTransposeTrack = show;</a>
<a name="ln365">      }</a>
<a name="ln366"> </a>
<a name="ln367">bool OveSong::getShowTransposeTrack() const {</a>
<a name="ln368">      return showTransposeTrack;</a>
<a name="ln369">      }</a>
<a name="ln370"> </a>
<a name="ln371">void OveSong::setShowLineBreak(bool show) {</a>
<a name="ln372">      showLineBreak_ = show;</a>
<a name="ln373">      }</a>
<a name="ln374"> </a>
<a name="ln375">bool OveSong::getShowLineBreak() const {</a>
<a name="ln376">      return showLineBreak_;</a>
<a name="ln377">      }</a>
<a name="ln378"> </a>
<a name="ln379">void OveSong::setShowRuler(bool show) {</a>
<a name="ln380">      showRuler_ = show;</a>
<a name="ln381">      }</a>
<a name="ln382"> </a>
<a name="ln383">bool OveSong::getShowRuler() const {</a>
<a name="ln384">      return showRuler_;</a>
<a name="ln385">      }</a>
<a name="ln386"> </a>
<a name="ln387">void OveSong::setShowColor(bool show) {</a>
<a name="ln388">      showColor_ = show;</a>
<a name="ln389">      }</a>
<a name="ln390"> </a>
<a name="ln391">bool OveSong::getShowColor() const {</a>
<a name="ln392">      return showColor_;</a>
<a name="ln393">      }</a>
<a name="ln394"> </a>
<a name="ln395">void OveSong::setPlayRepeat(bool play) {</a>
<a name="ln396">      playRepeat_ = play;</a>
<a name="ln397">      }</a>
<a name="ln398"> </a>
<a name="ln399">bool OveSong::getPlayRepeat() const {</a>
<a name="ln400">      return playRepeat_;</a>
<a name="ln401">      }</a>
<a name="ln402"> </a>
<a name="ln403">void OveSong::setPlayStyle(PlayStyle style) {</a>
<a name="ln404">      playStyle_ = style;</a>
<a name="ln405">      }</a>
<a name="ln406"> </a>
<a name="ln407">OveSong::PlayStyle OveSong::getPlayStyle() const {</a>
<a name="ln408">      return playStyle_;</a>
<a name="ln409">      }</a>
<a name="ln410"> </a>
<a name="ln411">void OveSong::addTitle(const QString&amp; str) {</a>
<a name="ln412">      titles_.push_back(str);</a>
<a name="ln413">      }</a>
<a name="ln414"> </a>
<a name="ln415">QList&lt;QString&gt; OveSong::getTitles(void) const {</a>
<a name="ln416">      return titles_;</a>
<a name="ln417">      }</a>
<a name="ln418"> </a>
<a name="ln419">void OveSong::addAnnotate(const QString&amp; str) {</a>
<a name="ln420">      annotates_.push_back(str);</a>
<a name="ln421">      }</a>
<a name="ln422"> </a>
<a name="ln423">QList&lt;QString&gt; OveSong::getAnnotates(void) const {</a>
<a name="ln424">      return annotates_;</a>
<a name="ln425">      }</a>
<a name="ln426"> </a>
<a name="ln427">void OveSong::addWriter(const QString&amp; str) {</a>
<a name="ln428">      writers_.push_back(str);</a>
<a name="ln429">      }</a>
<a name="ln430"> </a>
<a name="ln431">QList&lt;QString&gt; OveSong::getWriters(void) const {</a>
<a name="ln432">      return writers_;</a>
<a name="ln433">      }</a>
<a name="ln434"> </a>
<a name="ln435">void OveSong::addCopyright(const QString&amp; str) {</a>
<a name="ln436">      copyrights_.push_back(str);</a>
<a name="ln437">      }</a>
<a name="ln438"> </a>
<a name="ln439">QList&lt;QString&gt; OveSong::getCopyrights(void) const {</a>
<a name="ln440">      return copyrights_;</a>
<a name="ln441">      }</a>
<a name="ln442"> </a>
<a name="ln443">void OveSong::addHeader(const QString&amp; str) {</a>
<a name="ln444">      headers_.push_back(str);</a>
<a name="ln445">      }</a>
<a name="ln446"> </a>
<a name="ln447">QList&lt;QString&gt; OveSong::getHeaders(void) const {</a>
<a name="ln448">      return headers_;</a>
<a name="ln449">      }</a>
<a name="ln450"> </a>
<a name="ln451">void OveSong::addFooter(const QString&amp; str) {</a>
<a name="ln452">      footers_.push_back(str);</a>
<a name="ln453">      }</a>
<a name="ln454"> </a>
<a name="ln455">QList&lt;QString&gt; OveSong::getFooters(void) const {</a>
<a name="ln456">      return footers_;</a>
<a name="ln457">      }</a>
<a name="ln458"> </a>
<a name="ln459">void OveSong::addTrack(Track* ptr) {</a>
<a name="ln460">      tracks_.push_back(ptr);</a>
<a name="ln461">      }</a>
<a name="ln462"> </a>
<a name="ln463">int OveSong::getTrackCount(void) const {</a>
<a name="ln464">      return tracks_.size();</a>
<a name="ln465">      }</a>
<a name="ln466"> </a>
<a name="ln467">QList&lt;Track*&gt; OveSong::getTracks() const {</a>
<a name="ln468">      return tracks_;</a>
<a name="ln469">      }</a>
<a name="ln470"> </a>
<a name="ln471">void OveSong::setTrackBarCount(int count) {</a>
<a name="ln472">      trackBarCount_ = count;</a>
<a name="ln473">      }</a>
<a name="ln474"> </a>
<a name="ln475">int OveSong::getTrackBarCount() const {</a>
<a name="ln476">      return trackBarCount_;</a>
<a name="ln477">      }</a>
<a name="ln478"> </a>
<a name="ln479">Track* OveSong::getTrack(int part, int staff) const {</a>
<a name="ln480">      int trackId = partStaffToTrack(part, staff);</a>
<a name="ln481"> </a>
<a name="ln482">      if( trackId &gt;=0 &amp;&amp; trackId &lt; (int)tracks_.size() ) {</a>
<a name="ln483">            return tracks_[trackId];</a>
<a name="ln484">            }</a>
<a name="ln485"> </a>
<a name="ln486">      return 0;</a>
<a name="ln487">      }</a>
<a name="ln488"> </a>
<a name="ln489">bool OveSong::addPage(Page* page) {</a>
<a name="ln490">      pages_.push_back(page);</a>
<a name="ln491">      return true;</a>
<a name="ln492">      }</a>
<a name="ln493"> </a>
<a name="ln494">int OveSong::getPageCount() const {</a>
<a name="ln495">      return pages_.size();</a>
<a name="ln496">      }</a>
<a name="ln497"> </a>
<a name="ln498">Page* OveSong::getPage(int idx) {</a>
<a name="ln499">      if( idx&gt;=0 &amp;&amp; idx&lt;(int)pages_.size() ) {</a>
<a name="ln500">            return pages_[idx];</a>
<a name="ln501">            }</a>
<a name="ln502"> </a>
<a name="ln503">      return 0;</a>
<a name="ln504">      }</a>
<a name="ln505"> </a>
<a name="ln506">void OveSong::addLine(Line* ptr) {</a>
<a name="ln507">      lines_.push_back(ptr);</a>
<a name="ln508">      }</a>
<a name="ln509"> </a>
<a name="ln510">int OveSong::getLineCount() const {</a>
<a name="ln511">      return lines_.size();</a>
<a name="ln512">      }</a>
<a name="ln513"> </a>
<a name="ln514">Line* OveSong::getLine(int idx) const {</a>
<a name="ln515">      if( idx &gt;=0 &amp;&amp; idx&lt;(int)lines_.size() ) {</a>
<a name="ln516">            return lines_[idx];</a>
<a name="ln517">            }</a>
<a name="ln518"> </a>
<a name="ln519">      return 0;</a>
<a name="ln520">      }</a>
<a name="ln521"> </a>
<a name="ln522">void OveSong::addMeasure(Measure* ptr) {</a>
<a name="ln523">      measures_.push_back(ptr);</a>
<a name="ln524">      }</a>
<a name="ln525"> </a>
<a name="ln526">int OveSong::getMeasureCount(void) const {</a>
<a name="ln527">      return measures_.size();</a>
<a name="ln528">      }</a>
<a name="ln529"> </a>
<a name="ln530">Measure* OveSong::getMeasure(int bar) const {</a>
<a name="ln531">      if( bar &gt;= 0 &amp;&amp; bar &lt; (int)measures_.size() ) {</a>
<a name="ln532">            return measures_[bar];</a>
<a name="ln533">            }</a>
<a name="ln534"> </a>
<a name="ln535">      return 0;</a>
<a name="ln536">      }</a>
<a name="ln537"> </a>
<a name="ln538">void OveSong::addMeasureData(MeasureData* ptr) {</a>
<a name="ln539">      measureDatas_.push_back(ptr);</a>
<a name="ln540">      }</a>
<a name="ln541"> </a>
<a name="ln542">int OveSong::getMeasureDataCount(void) const {</a>
<a name="ln543">      return measureDatas_.size();</a>
<a name="ln544">      }</a>
<a name="ln545"> </a>
<a name="ln546">MeasureData* OveSong::getMeasureData(int part, int staff/*=0*/, int bar) const {</a>
<a name="ln547">      int trackId = partStaffToTrack(part, staff);</a>
<a name="ln548">      int trackBarCount = getTrackBarCount();</a>
<a name="ln549"> </a>
<a name="ln550">      if( bar &gt;= 0 &amp;&amp; bar &lt; trackBarCount ) {</a>
<a name="ln551">            int measureId = trackBarCount * trackId + bar;</a>
<a name="ln552"> </a>
<a name="ln553">            if( measureId &gt;=0 &amp;&amp; measureId &lt; (int)measureDatas_.size() ) {</a>
<a name="ln554">                  return measureDatas_[measureId];</a>
<a name="ln555">                  }</a>
<a name="ln556">            }</a>
<a name="ln557"> </a>
<a name="ln558">      return 0;</a>
<a name="ln559">      }</a>
<a name="ln560"> </a>
<a name="ln561">MeasureData* OveSong::getMeasureData(int track, int bar) const {</a>
<a name="ln562">      int id = trackBarCount_*track + bar;</a>
<a name="ln563"> </a>
<a name="ln564">      if( id &gt;=0 &amp;&amp; id &lt; (int)measureDatas_.size() ) {</a>
<a name="ln565">            return measureDatas_[id];</a>
<a name="ln566">            }</a>
<a name="ln567"> </a>
<a name="ln568">      return 0;</a>
<a name="ln569">      }</a>
<a name="ln570"> </a>
<a name="ln571">void OveSong::setPartStaffCounts(const QList&lt;int&gt;&amp; partStaffCounts) {</a>
<a name="ln572">      //partStaffCounts_.assign(partStaffCounts.begin(), partStaffCounts.end());</a>
<a name="ln573">      for(int i=0; i&lt;partStaffCounts.size(); ++i) {</a>
<a name="ln574">            partStaffCounts_.push_back(partStaffCounts[i]);</a>
<a name="ln575">            }</a>
<a name="ln576">      }</a>
<a name="ln577"> </a>
<a name="ln578">int OveSong::getPartCount() const {</a>
<a name="ln579">      return partStaffCounts_.size();</a>
<a name="ln580">      }</a>
<a name="ln581"> </a>
<a name="ln582">int OveSong::getStaffCount(int part) const {</a>
<a name="ln583">      if( part&gt;=0 &amp;&amp; part&lt;(int)partStaffCounts_.size() ) {</a>
<a name="ln584">            return partStaffCounts_[part];</a>
<a name="ln585">            }</a>
<a name="ln586"> </a>
<a name="ln587">      return 0;</a>
<a name="ln588">      }</a>
<a name="ln589"> </a>
<a name="ln590">int OveSong::getPartBarCount() const {</a>
<a name="ln591">      return measureDatas_.size() / tracks_.size();</a>
<a name="ln592">      }</a>
<a name="ln593"> </a>
<a name="ln594">QPair&lt;int, int&gt; OveSong::trackToPartStaff(int track) const {</a>
<a name="ln595">      int i;</a>
<a name="ln596">      int staffCount = 0;</a>
<a name="ln597"> </a>
<a name="ln598">      for( i=0; i&lt;partStaffCounts_.size(); ++i ) {</a>
<a name="ln599">            if( staffCount + partStaffCounts_[i] &gt; track ) {</a>
<a name="ln600">                  return qMakePair((int)i, track-staffCount);</a>
<a name="ln601">                  }</a>
<a name="ln602"> </a>
<a name="ln603">            staffCount += partStaffCounts_[i];</a>
<a name="ln604">            }</a>
<a name="ln605"> </a>
<a name="ln606">      return qMakePair((int)partStaffCounts_.size(), 0);</a>
<a name="ln607">      }</a>
<a name="ln608"> </a>
<a name="ln609">int OveSong::partStaffToTrack(int part, int staff) const {</a>
<a name="ln610">      int i;</a>
<a name="ln611">      unsigned int staffCount = 0;</a>
<a name="ln612"> </a>
<a name="ln613">      for( i=0; i&lt;partStaffCounts_.size(); ++i ) {</a>
<a name="ln614">            if( part == (int)i &amp;&amp; staff&gt;=0 &amp;&amp; staff&lt;(int)partStaffCounts_[i] ) {</a>
<a name="ln615">                  int trackId = staffCount + staff;</a>
<a name="ln616"> </a>
<a name="ln617">                  if( trackId &gt;=0 &amp;&amp; trackId &lt; (int)tracks_.size() ) {</a>
<a name="ln618">                        return trackId;</a>
<a name="ln619">                        }</a>
<a name="ln620">                  }</a>
<a name="ln621"> </a>
<a name="ln622">            staffCount += partStaffCounts_[i];</a>
<a name="ln623">            }</a>
<a name="ln624"> </a>
<a name="ln625">      return tracks_.size();</a>
<a name="ln626">      }</a>
<a name="ln627"> </a>
<a name="ln628">void OveSong::setTextCodecName(const QString&amp; codecName) {</a>
<a name="ln629">      codec_ = QTextCodec::codecForName(codecName.toLatin1());</a>
<a name="ln630">      }</a>
<a name="ln631"> </a>
<a name="ln632">QString OveSong::getCodecString(const QByteArray&amp; text) {</a>
<a name="ln633">      QString s;</a>
<a name="ln634">      if (codec_ == NULL)</a>
<a name="ln635">            s = QString(text);</a>
<a name="ln636">      else</a>
<a name="ln637">            s = codec_-&gt;toUnicode(text);</a>
<a name="ln638"> </a>
<a name="ln639">      s = s.trimmed();</a>
<a name="ln640">      return s;</a>
<a name="ln641">      }</a>
<a name="ln642"> </a>
<a name="ln643">void OveSong::clear(void)</a>
<a name="ln644">      {</a>
<a name="ln645">      version4_ = true;</a>
<a name="ln646">      quarter_ = 480;</a>
<a name="ln647">      showPageMargin_ = false;</a>
<a name="ln648">      showTransposeTrack = false;</a>
<a name="ln649">      showLineBreak_ = false;</a>
<a name="ln650">      showRuler_ = false;</a>
<a name="ln651">      showColor_ = true;</a>
<a name="ln652">      playRepeat_ = true;</a>
<a name="ln653">      playStyle_ = PlayStyle::Record;</a>
<a name="ln654"> </a>
<a name="ln655">      annotates_.clear();</a>
<a name="ln656">      copyrights_.clear();</a>
<a name="ln657">      footers_.clear();</a>
<a name="ln658">      headers_.clear();</a>
<a name="ln659">      titles_.clear();</a>
<a name="ln660">      writers_.clear();</a>
<a name="ln661"> </a>
<a name="ln662">      // deleteVector(tracks_);</a>
<a name="ln663">      for(int i=0; i&lt;tracks_.size(); ++i){</a>
<a name="ln664">            delete tracks_[i];</a>
<a name="ln665">            }</a>
<a name="ln666">      for(int i=0; i&lt;pages_.size(); ++i){</a>
<a name="ln667">            delete pages_[i];</a>
<a name="ln668">            }</a>
<a name="ln669">      for(int i=0; i&lt;lines_.size(); ++i){</a>
<a name="ln670">            delete lines_[i];</a>
<a name="ln671">            }</a>
<a name="ln672">      for(int i=0; i&lt;measures_.size(); ++i){</a>
<a name="ln673">            delete measures_[i];</a>
<a name="ln674">            }</a>
<a name="ln675">      for(int i=0; i&lt;measureDatas_.size(); ++i){</a>
<a name="ln676">            delete measureDatas_[i];</a>
<a name="ln677">            }</a>
<a name="ln678">      tracks_.clear();</a>
<a name="ln679">      pages_.clear();</a>
<a name="ln680">      lines_.clear();</a>
<a name="ln681">      measures_.clear();</a>
<a name="ln682">      measureDatas_.clear();</a>
<a name="ln683">      trackBarCount_ = 0;</a>
<a name="ln684">      partStaffCounts_.clear();</a>
<a name="ln685">      }</a>
<a name="ln686"> </a>
<a name="ln687">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln688">Voice::Voice() {</a>
<a name="ln689">      channel_ = 0;</a>
<a name="ln690">      volume_ = -1;</a>
<a name="ln691">      pitchShift_ = 0;</a>
<a name="ln692">      pan_ = 0;</a>
<a name="ln693">      patch_ = 0;</a>
<a name="ln694">      stemType_ = 0;</a>
<a name="ln695">      }</a>
<a name="ln696"> </a>
<a name="ln697">void Voice::setChannel(int channel) {</a>
<a name="ln698">      channel_ = channel;</a>
<a name="ln699">      }</a>
<a name="ln700"> </a>
<a name="ln701">int Voice::getChannel() const {</a>
<a name="ln702">      return channel_;</a>
<a name="ln703">      }</a>
<a name="ln704"> </a>
<a name="ln705">void Voice::setVolume(int volume) {</a>
<a name="ln706">      volume_ = volume;</a>
<a name="ln707">      }</a>
<a name="ln708"> </a>
<a name="ln709">int Voice::getVolume() const {</a>
<a name="ln710">      return volume_;</a>
<a name="ln711">      }</a>
<a name="ln712"> </a>
<a name="ln713">void Voice::setPitchShift(int pitchShift) {</a>
<a name="ln714">      pitchShift_ = pitchShift;</a>
<a name="ln715">      }</a>
<a name="ln716"> </a>
<a name="ln717">int Voice::getPitchShift() const {</a>
<a name="ln718">      return pitchShift_;</a>
<a name="ln719">      }</a>
<a name="ln720"> </a>
<a name="ln721">void Voice::setPan(int pan) {</a>
<a name="ln722">      pan_ = pan;</a>
<a name="ln723">      }</a>
<a name="ln724"> </a>
<a name="ln725">int Voice::getPan() const {</a>
<a name="ln726">      return pan_;</a>
<a name="ln727">      }</a>
<a name="ln728"> </a>
<a name="ln729">void Voice::setPatch(int patch) {</a>
<a name="ln730">      patch_ = patch;</a>
<a name="ln731">      }</a>
<a name="ln732"> </a>
<a name="ln733">int Voice::getPatch() const {</a>
<a name="ln734">      return patch_;</a>
<a name="ln735">      }</a>
<a name="ln736"> </a>
<a name="ln737">void Voice::setStemType(int stemType) {</a>
<a name="ln738">      stemType_ = stemType;</a>
<a name="ln739">      }</a>
<a name="ln740"> </a>
<a name="ln741">int Voice::getStemType() const {</a>
<a name="ln742">      return stemType_;</a>
<a name="ln743">      }</a>
<a name="ln744"> </a>
<a name="ln745">int Voice::getDefaultPatch() {</a>
<a name="ln746">      return -1;</a>
<a name="ln747">      }</a>
<a name="ln748"> </a>
<a name="ln749">int Voice::getDefaultVolume() {</a>
<a name="ln750">      return -1;</a>
<a name="ln751">      }</a>
<a name="ln752"> </a>
<a name="ln753">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln754">Track::Track() {</a>
<a name="ln755">      clear();</a>
<a name="ln756">      }</a>
<a name="ln757"> </a>
<a name="ln758">Track::~Track() {</a>
<a name="ln759">      clear();</a>
<a name="ln760">      }</a>
<a name="ln761"> </a>
<a name="ln762">void Track::setName(const QString&amp; str) {</a>
<a name="ln763">      name_ = str;</a>
<a name="ln764">      }</a>
<a name="ln765"> </a>
<a name="ln766">QString Track::getName(void) const {</a>
<a name="ln767">      return name_;</a>
<a name="ln768">      }</a>
<a name="ln769"> </a>
<a name="ln770">void Track::setBriefName(const QString&amp; str) {</a>
<a name="ln771">      briefName_ = str;</a>
<a name="ln772">      }</a>
<a name="ln773"> </a>
<a name="ln774">QString Track::getBriefName(void) const {</a>
<a name="ln775">      return briefName_;</a>
<a name="ln776">      }</a>
<a name="ln777"> </a>
<a name="ln778">void Track::setPatch(unsigned int patch) {</a>
<a name="ln779">      patch_ = patch;</a>
<a name="ln780">      }</a>
<a name="ln781"> </a>
<a name="ln782">unsigned int Track::getPatch() const {</a>
<a name="ln783">      return patch_;</a>
<a name="ln784">      }</a>
<a name="ln785"> </a>
<a name="ln786">void Track::setChannel(int channel) {</a>
<a name="ln787">      channel_ = channel;</a>
<a name="ln788">      }</a>
<a name="ln789"> </a>
<a name="ln790">int Track::getChannel() const {</a>
<a name="ln791">      return channel_;</a>
<a name="ln792">      }</a>
<a name="ln793"> </a>
<a name="ln794">void Track::setShowName(bool show) {</a>
<a name="ln795">      showName_ = show;</a>
<a name="ln796">      }</a>
<a name="ln797"> </a>
<a name="ln798">bool Track::getShowName() const {</a>
<a name="ln799">      return showName_;</a>
<a name="ln800">      }</a>
<a name="ln801"> </a>
<a name="ln802">void Track::setShowBriefName(bool show) {</a>
<a name="ln803">      showBriefName_ = show;</a>
<a name="ln804">      }</a>
<a name="ln805"> </a>
<a name="ln806">bool Track::getShowBriefName() const {</a>
<a name="ln807">      return showBriefName_;</a>
<a name="ln808">      }</a>
<a name="ln809"> </a>
<a name="ln810">void Track::setMute(bool mute) {</a>
<a name="ln811">      mute_ = mute;</a>
<a name="ln812">      }</a>
<a name="ln813"> </a>
<a name="ln814">bool Track::getMute() const {</a>
<a name="ln815">      return mute_;</a>
<a name="ln816">      }</a>
<a name="ln817"> </a>
<a name="ln818">void Track::setSolo(bool solo) {</a>
<a name="ln819">      solo_ = solo;</a>
<a name="ln820">      }</a>
<a name="ln821"> </a>
<a name="ln822">bool Track::getSolo() const {</a>
<a name="ln823">      return solo_;</a>
<a name="ln824">      }</a>
<a name="ln825"> </a>
<a name="ln826">void Track::setShowKeyEachLine(bool show) {</a>
<a name="ln827">      showKeyEachLine_ = show;</a>
<a name="ln828">      }</a>
<a name="ln829"> </a>
<a name="ln830">bool Track::getShowKeyEachLine() const {</a>
<a name="ln831">      return showKeyEachLine_;</a>
<a name="ln832">      }</a>
<a name="ln833"> </a>
<a name="ln834">void Track::setVoiceCount(int voices) {</a>
<a name="ln835">      voiceCount_ = voices;</a>
<a name="ln836">      }</a>
<a name="ln837"> </a>
<a name="ln838">int Track::getVoiceCount() const {</a>
<a name="ln839">      return voiceCount_;</a>
<a name="ln840">      }</a>
<a name="ln841"> </a>
<a name="ln842">void Track::addVoice(Voice* voice) {</a>
<a name="ln843">      voices_.push_back(voice);</a>
<a name="ln844">      }</a>
<a name="ln845"> </a>
<a name="ln846">QList&lt;Voice*&gt; Track::getVoices() const {</a>
<a name="ln847">      return voices_;</a>
<a name="ln848">      }</a>
<a name="ln849"> </a>
<a name="ln850">void Track::setShowTranspose(bool show) {</a>
<a name="ln851">      showTranspose_ = show;</a>
<a name="ln852">      }</a>
<a name="ln853"> </a>
<a name="ln854">bool Track::getShowTranspose() const {</a>
<a name="ln855">      return showTranspose_;</a>
<a name="ln856">      }</a>
<a name="ln857"> </a>
<a name="ln858">void Track::setTranspose(int transpose) {</a>
<a name="ln859">      transpose_ = transpose;</a>
<a name="ln860">      }</a>
<a name="ln861"> </a>
<a name="ln862">int Track::getTranspose() const {</a>
<a name="ln863">      return transpose_;</a>
<a name="ln864">      }</a>
<a name="ln865"> </a>
<a name="ln866">void Track::setNoteShift(int shift) {</a>
<a name="ln867">      noteShift_ = shift;</a>
<a name="ln868">      }</a>
<a name="ln869"> </a>
<a name="ln870">int Track::getNoteShift() const {</a>
<a name="ln871">      return noteShift_;</a>
<a name="ln872">      }</a>
<a name="ln873"> </a>
<a name="ln874">void Track::setStartClef(int clef/*in Clef*/) {</a>
<a name="ln875">      startClef_ = ClefType(clef);</a>
<a name="ln876">      }</a>
<a name="ln877"> </a>
<a name="ln878">ClefType Track::getStartClef() const {</a>
<a name="ln879">      return startClef_;</a>
<a name="ln880">      }</a>
<a name="ln881"> </a>
<a name="ln882">void Track::setTransposeClef(int clef) {</a>
<a name="ln883">      transposeClef_ = ClefType(clef);</a>
<a name="ln884">      }</a>
<a name="ln885"> </a>
<a name="ln886">ClefType Track::getTansposeClef() const {</a>
<a name="ln887">      return transposeClef_;</a>
<a name="ln888">      }</a>
<a name="ln889"> </a>
<a name="ln890">void Track::setStartKey(int key) {</a>
<a name="ln891">      startKey_ = key;</a>
<a name="ln892">      }</a>
<a name="ln893"> </a>
<a name="ln894">int Track::getStartKey() const {</a>
<a name="ln895">      return startKey_;</a>
<a name="ln896">      }</a>
<a name="ln897"> </a>
<a name="ln898">void Track::setDisplayPercent(unsigned int percent/*25~100?*/) {</a>
<a name="ln899">      displayPercent_ = percent;</a>
<a name="ln900">      }</a>
<a name="ln901"> </a>
<a name="ln902">unsigned int Track::getDisplayPercent() const {</a>
<a name="ln903">      return displayPercent_;</a>
<a name="ln904">      }</a>
<a name="ln905"> </a>
<a name="ln906">void Track::setShowLegerLine(bool show) {</a>
<a name="ln907">      showLegerLine_ = show;</a>
<a name="ln908">      }</a>
<a name="ln909"> </a>
<a name="ln910">bool Track::getShowLegerLine() const {</a>
<a name="ln911">      return showLegerLine_;</a>
<a name="ln912">      }</a>
<a name="ln913"> </a>
<a name="ln914">void Track::setShowClef(bool show) {</a>
<a name="ln915">      showClef_ = show;</a>
<a name="ln916">      }</a>
<a name="ln917"> </a>
<a name="ln918">bool Track::getShowClef() const {</a>
<a name="ln919">      return showClef_;</a>
<a name="ln920">      }</a>
<a name="ln921"> </a>
<a name="ln922">void Track::setShowTimeSignature(bool show) {</a>
<a name="ln923">      showTimeSignature_ = show;</a>
<a name="ln924">      }</a>
<a name="ln925"> </a>
<a name="ln926">bool Track::getShowTimeSignature() const {</a>
<a name="ln927">      return showTimeSignature_;</a>
<a name="ln928">      }</a>
<a name="ln929"> </a>
<a name="ln930">void Track::setShowKeySignature(bool show) {</a>
<a name="ln931">      showKeySignature_ = show;</a>
<a name="ln932">      }</a>
<a name="ln933"> </a>
<a name="ln934">bool Track::getShowKeySignature() const {</a>
<a name="ln935">      return showKeySignature_;</a>
<a name="ln936">      }</a>
<a name="ln937"> </a>
<a name="ln938">void Track::setShowBarline(bool show) {</a>
<a name="ln939">      showBarline_ = show;</a>
<a name="ln940">      }</a>
<a name="ln941"> </a>
<a name="ln942">bool Track::getShowBarline() const {</a>
<a name="ln943">      return showBarline_;</a>
<a name="ln944">      }</a>
<a name="ln945"> </a>
<a name="ln946">void Track::setFillWithRest(bool fill) {</a>
<a name="ln947">      fillWithRest_ = fill;</a>
<a name="ln948">      }</a>
<a name="ln949"> </a>
<a name="ln950">bool Track::getFillWithRest() const {</a>
<a name="ln951">      return fillWithRest_;</a>
<a name="ln952">      }</a>
<a name="ln953"> </a>
<a name="ln954">void Track::setFlatTail(bool flat) {</a>
<a name="ln955">      flatTail_ = flat;</a>
<a name="ln956">      }</a>
<a name="ln957"> </a>
<a name="ln958">bool Track::getFlatTail() const {</a>
<a name="ln959">      return flatTail_;</a>
<a name="ln960">      }</a>
<a name="ln961"> </a>
<a name="ln962">void Track::setShowClefEachLine(bool show) {</a>
<a name="ln963">      showClefEachLine_ = show;</a>
<a name="ln964">      }</a>
<a name="ln965"> </a>
<a name="ln966">bool Track::getShowClefEachLine() const {</a>
<a name="ln967">      return showClefEachLine_;</a>
<a name="ln968">      }</a>
<a name="ln969"> </a>
<a name="ln970">void Track::addDrum(const DrumNode&amp; node) {</a>
<a name="ln971">      /*DrumNode node;</a>
<a name="ln972">   node.line_ = line;</a>
<a name="ln973">   node.headType_ = headType;</a>
<a name="ln974">   node.pitch_ = pitch;</a>
<a name="ln975">   node.voice_ = voice;*/</a>
<a name="ln976">      drumKit_.push_back(node);</a>
<a name="ln977">      }</a>
<a name="ln978"> </a>
<a name="ln979">QList&lt;Track::DrumNode&gt; Track::getDrumKit() const {</a>
<a name="ln980">      return drumKit_;</a>
<a name="ln981">      }</a>
<a name="ln982"> </a>
<a name="ln983">void Track::setPart(int part) {</a>
<a name="ln984">      part_ = part;</a>
<a name="ln985">      }</a>
<a name="ln986"> </a>
<a name="ln987">int Track::getPart() const {</a>
<a name="ln988">      return part_;</a>
<a name="ln989">      }</a>
<a name="ln990"> </a>
<a name="ln991">void Track::clear(void) {</a>
<a name="ln992">      number_ = 0;</a>
<a name="ln993"> </a>
<a name="ln994">      name_ = QString();</a>
<a name="ln995"> </a>
<a name="ln996">      patch_ = 0;</a>
<a name="ln997">      channel_ = 0;</a>
<a name="ln998">      transpose_ = 0;</a>
<a name="ln999">      showTranspose_ = false;</a>
<a name="ln1000">      noteShift_ = 0;</a>
<a name="ln1001">      startClef_ = ClefType::Treble;</a>
<a name="ln1002">      transposeClef_ = ClefType::Treble;</a>
<a name="ln1003">      displayPercent_ = 100;</a>
<a name="ln1004">      startKey_ = 0;</a>
<a name="ln1005">      voiceCount_ = 8;</a>
<a name="ln1006"> </a>
<a name="ln1007">      showName_ = true;</a>
<a name="ln1008">      showBriefName_ = false;</a>
<a name="ln1009">      showKeyEachLine_ = false;</a>
<a name="ln1010">      showLegerLine_ = true;</a>
<a name="ln1011">      showClef_ = true;</a>
<a name="ln1012">      showTimeSignature_ = true;</a>
<a name="ln1013">      showKeySignature_ = true;</a>
<a name="ln1014">      showBarline_ = true;</a>
<a name="ln1015">      showClefEachLine_ = false;</a>
<a name="ln1016"> </a>
<a name="ln1017">      fillWithRest_ = true;</a>
<a name="ln1018">      flatTail_ = false;</a>
<a name="ln1019"> </a>
<a name="ln1020">      mute_ = false;</a>
<a name="ln1021">      solo_ = false;</a>
<a name="ln1022"> </a>
<a name="ln1023">      drumKit_.clear();</a>
<a name="ln1024"> </a>
<a name="ln1025">      part_ = 0;</a>
<a name="ln1026"> </a>
<a name="ln1027">      for(int i=0; i&lt;voices_.size(); ++i){</a>
<a name="ln1028">            delete voices_[i];</a>
<a name="ln1029">            }</a>
<a name="ln1030">      voices_.clear();</a>
<a name="ln1031">      }</a>
<a name="ln1032"> </a>
<a name="ln1033">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln1034">Page::Page() {</a>
<a name="ln1035">      beginLine_ = 0;</a>
<a name="ln1036">      lineCount_ = 0;</a>
<a name="ln1037"> </a>
<a name="ln1038">      lineInterval_ = 9;</a>
<a name="ln1039">      staffInterval_ = 7;</a>
<a name="ln1040">      staffInlineInterval_ = 6;</a>
<a name="ln1041"> </a>
<a name="ln1042">      lineBarCount_ = 4;</a>
<a name="ln1043">      pageLineCount_ = 5;</a>
<a name="ln1044"> </a>
<a name="ln1045">      leftMargin_ = 0xA8;</a>
<a name="ln1046">      topMargin_ = 0xA8;</a>
<a name="ln1047">      rightMargin_ = 0xA8;</a>
<a name="ln1048">      bottomMargin_ = 0xA8;</a>
<a name="ln1049"> </a>
<a name="ln1050">      pageWidth_ = 0x0B40;</a>
<a name="ln1051">      pageHeight_ = 0x0E90;</a>
<a name="ln1052">      }</a>
<a name="ln1053"> </a>
<a name="ln1054">void Page::setBeginLine(int line) {</a>
<a name="ln1055">      beginLine_ = line;</a>
<a name="ln1056">      }</a>
<a name="ln1057"> </a>
<a name="ln1058">int Page::getBeginLine() const {</a>
<a name="ln1059">      return beginLine_;</a>
<a name="ln1060">      }</a>
<a name="ln1061"> </a>
<a name="ln1062">void Page::setLineCount(int count) {</a>
<a name="ln1063">      lineCount_ = count;</a>
<a name="ln1064">      }</a>
<a name="ln1065"> </a>
<a name="ln1066">int Page::getLineCount() const {</a>
<a name="ln1067">      return lineCount_;</a>
<a name="ln1068">      }</a>
<a name="ln1069"> </a>
<a name="ln1070">void Page::setLineInterval(int interval) {</a>
<a name="ln1071">      lineInterval_ = interval;</a>
<a name="ln1072">      }</a>
<a name="ln1073"> </a>
<a name="ln1074">int Page::getLineInterval() const {</a>
<a name="ln1075">      return lineInterval_;</a>
<a name="ln1076">      }</a>
<a name="ln1077"> </a>
<a name="ln1078">void Page::setStaffInterval(int interval) {</a>
<a name="ln1079">      staffInterval_ = interval;</a>
<a name="ln1080">      }</a>
<a name="ln1081"> </a>
<a name="ln1082">int Page::getStaffInterval() const {</a>
<a name="ln1083">      return staffInterval_;</a>
<a name="ln1084">      }</a>
<a name="ln1085"> </a>
<a name="ln1086">void Page::setStaffInlineInterval(int interval) {</a>
<a name="ln1087">      staffInlineInterval_ = interval;</a>
<a name="ln1088">      }</a>
<a name="ln1089"> </a>
<a name="ln1090">int Page::getStaffInlineInterval() const {</a>
<a name="ln1091">      return staffInlineInterval_;</a>
<a name="ln1092">      }</a>
<a name="ln1093"> </a>
<a name="ln1094">void Page::setLineBarCount(int count) {</a>
<a name="ln1095">      lineBarCount_ = count;</a>
<a name="ln1096">      }</a>
<a name="ln1097"> </a>
<a name="ln1098">int Page::getLineBarCount() const {</a>
<a name="ln1099">      return lineBarCount_;</a>
<a name="ln1100">      }</a>
<a name="ln1101"> </a>
<a name="ln1102">void Page::setPageLineCount(int count) {</a>
<a name="ln1103">      pageLineCount_ = count;</a>
<a name="ln1104">      }</a>
<a name="ln1105"> </a>
<a name="ln1106">int Page::getPageLineCount() const {</a>
<a name="ln1107">      return pageLineCount_;</a>
<a name="ln1108">      }</a>
<a name="ln1109"> </a>
<a name="ln1110">void Page::setLeftMargin(int margin) {</a>
<a name="ln1111">      leftMargin_ = margin;</a>
<a name="ln1112">      }</a>
<a name="ln1113"> </a>
<a name="ln1114">int Page::getLeftMargin() const {</a>
<a name="ln1115">      return leftMargin_;</a>
<a name="ln1116">      }</a>
<a name="ln1117"> </a>
<a name="ln1118">void Page::setTopMargin(int margin) {</a>
<a name="ln1119">      topMargin_ = margin;</a>
<a name="ln1120">      }</a>
<a name="ln1121"> </a>
<a name="ln1122">int Page::getTopMargin() const {</a>
<a name="ln1123">      return topMargin_;</a>
<a name="ln1124">      }</a>
<a name="ln1125"> </a>
<a name="ln1126">void Page::setRightMargin(int margin) {</a>
<a name="ln1127">      rightMargin_ = margin;</a>
<a name="ln1128">      }</a>
<a name="ln1129"> </a>
<a name="ln1130">int Page::getRightMargin() const {</a>
<a name="ln1131">      return rightMargin_;</a>
<a name="ln1132">      }</a>
<a name="ln1133"> </a>
<a name="ln1134">void Page::setBottomMargin(int margin) {</a>
<a name="ln1135">      bottomMargin_ = margin;</a>
<a name="ln1136">      }</a>
<a name="ln1137"> </a>
<a name="ln1138">int Page::getBottomMargin() const {</a>
<a name="ln1139">      return bottomMargin_;</a>
<a name="ln1140">      }</a>
<a name="ln1141"> </a>
<a name="ln1142">void Page::setPageWidth(int width) {</a>
<a name="ln1143">      pageWidth_ = width;</a>
<a name="ln1144">      }</a>
<a name="ln1145"> </a>
<a name="ln1146">int Page::getPageWidth() const {</a>
<a name="ln1147">      return pageWidth_;</a>
<a name="ln1148">      }</a>
<a name="ln1149"> </a>
<a name="ln1150">void Page::setPageHeight(int height) {</a>
<a name="ln1151">      pageHeight_ = height;</a>
<a name="ln1152">      }</a>
<a name="ln1153"> </a>
<a name="ln1154">int Page::getPageHeight() const {</a>
<a name="ln1155">      return pageHeight_;</a>
<a name="ln1156">      }</a>
<a name="ln1157"> </a>
<a name="ln1158">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln1159">Line::Line() {</a>
<a name="ln1160">      beginBar_ = 0;</a>
<a name="ln1161">      barCount_ = 0;</a>
<a name="ln1162">      yOffset_ = 0;</a>
<a name="ln1163">      leftXOffset_ = 0;</a>
<a name="ln1164">      rightXOffset_ = 0;</a>
<a name="ln1165">      }</a>
<a name="ln1166"> </a>
<a name="ln1167">Line::~Line() {</a>
<a name="ln1168">      for(int i=0; i&lt;staffs_.size(); ++i){</a>
<a name="ln1169">            delete staffs_[i];</a>
<a name="ln1170">            }</a>
<a name="ln1171">      staffs_.clear();</a>
<a name="ln1172">      }</a>
<a name="ln1173"> </a>
<a name="ln1174">void Line::addStaff(Staff* staff) {</a>
<a name="ln1175">      staffs_.push_back(staff);</a>
<a name="ln1176">      }</a>
<a name="ln1177"> </a>
<a name="ln1178">int Line::getStaffCount() const {</a>
<a name="ln1179">      return staffs_.size();</a>
<a name="ln1180">      }</a>
<a name="ln1181"> </a>
<a name="ln1182">Staff* Line::getStaff(int idx) const {</a>
<a name="ln1183">      if (idx &gt;= 0 &amp;&amp; idx &lt; static_cast&lt;int&gt;(staffs_.size())) {</a>
<a name="ln1184">            return staffs_[idx];</a>
<a name="ln1185">            }</a>
<a name="ln1186"> </a>
<a name="ln1187">      return 0;</a>
<a name="ln1188">      }</a>
<a name="ln1189"> </a>
<a name="ln1190">void Line::setBeginBar(unsigned int bar) {</a>
<a name="ln1191">      beginBar_ = bar;</a>
<a name="ln1192">      }</a>
<a name="ln1193"> </a>
<a name="ln1194">unsigned int Line::getBeginBar() const {</a>
<a name="ln1195">      return beginBar_;</a>
<a name="ln1196">      }</a>
<a name="ln1197"> </a>
<a name="ln1198">void Line::setBarCount(unsigned int count) {</a>
<a name="ln1199">      barCount_ = count;</a>
<a name="ln1200">      }</a>
<a name="ln1201"> </a>
<a name="ln1202">unsigned int Line::getBarCount() const {</a>
<a name="ln1203">      return barCount_;</a>
<a name="ln1204">      }</a>
<a name="ln1205"> </a>
<a name="ln1206">void Line::setYOffset(int offset) {</a>
<a name="ln1207">      yOffset_ = offset;</a>
<a name="ln1208">      }</a>
<a name="ln1209"> </a>
<a name="ln1210">int Line::getYOffset() const {</a>
<a name="ln1211">      return yOffset_;</a>
<a name="ln1212">      }</a>
<a name="ln1213"> </a>
<a name="ln1214">void Line::setLeftXOffset(int offset) {</a>
<a name="ln1215">      leftXOffset_ = offset;</a>
<a name="ln1216">      }</a>
<a name="ln1217"> </a>
<a name="ln1218">int Line::getLeftXOffset() const {</a>
<a name="ln1219">      return leftXOffset_;</a>
<a name="ln1220">      }</a>
<a name="ln1221"> </a>
<a name="ln1222">void Line::setRightXOffset(int offset) {</a>
<a name="ln1223">      rightXOffset_ = offset;</a>
<a name="ln1224">      }</a>
<a name="ln1225"> </a>
<a name="ln1226">int Line::getRightXOffset() const {</a>
<a name="ln1227">      return rightXOffset_;</a>
<a name="ln1228">      }</a>
<a name="ln1229"> </a>
<a name="ln1230">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln1231">Staff::Staff() {</a>
<a name="ln1232">      clef_ = ClefType::Treble;</a>
<a name="ln1233">      key_ = 0;</a>
<a name="ln1234">      visible_ = true;</a>
<a name="ln1235">      groupType_ = GroupType::None;</a>
<a name="ln1236">      groupStaffCount_ = 0;</a>
<a name="ln1237">      }</a>
<a name="ln1238"> </a>
<a name="ln1239">void Staff::setClefType(int clef) {</a>
<a name="ln1240">      clef_ = (ClefType) clef;</a>
<a name="ln1241">      }</a>
<a name="ln1242"> </a>
<a name="ln1243">ClefType Staff::getClefType() const {</a>
<a name="ln1244">      return clef_;</a>
<a name="ln1245">      }</a>
<a name="ln1246"> </a>
<a name="ln1247">void Staff::setKeyType(int key) {</a>
<a name="ln1248">      key_ = key;</a>
<a name="ln1249">      }</a>
<a name="ln1250"> </a>
<a name="ln1251">int Staff::getKeyType() const {</a>
<a name="ln1252">      return key_;</a>
<a name="ln1253">      }</a>
<a name="ln1254"> </a>
<a name="ln1255">void Staff::setVisible(bool visible) {</a>
<a name="ln1256">      visible_ = visible;</a>
<a name="ln1257">      }</a>
<a name="ln1258"> </a>
<a name="ln1259">bool Staff::setVisible() const {</a>
<a name="ln1260">      return visible_;</a>
<a name="ln1261">      }</a>
<a name="ln1262"> </a>
<a name="ln1263">void Staff::setGroupType(GroupType type){</a>
<a name="ln1264">      groupType_ = type;</a>
<a name="ln1265">      }</a>
<a name="ln1266"> </a>
<a name="ln1267">GroupType Staff::getGroupType() const {</a>
<a name="ln1268">      return groupType_;</a>
<a name="ln1269">      }</a>
<a name="ln1270"> </a>
<a name="ln1271">void Staff::setGroupStaffCount(int count) {</a>
<a name="ln1272">      groupStaffCount_ = count;</a>
<a name="ln1273">      }</a>
<a name="ln1274"> </a>
<a name="ln1275">int Staff::getGroupStaffCount() const {</a>
<a name="ln1276">      return groupStaffCount_;</a>
<a name="ln1277">      }</a>
<a name="ln1278"> </a>
<a name="ln1279">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln1280">Note::Note() {</a>
<a name="ln1281">      rest_ = false;</a>
<a name="ln1282">      note_ = 60;</a>
<a name="ln1283">      accidental_ = AccidentalType::Normal;</a>
<a name="ln1284">      showAccidental_ = false;</a>
<a name="ln1285">      offVelocity_ = 0x40;</a>
<a name="ln1286">      onVelocity_ = 0x50;</a>
<a name="ln1287">      headType_ = NoteHeadType::Standard;</a>
<a name="ln1288">      tiePos_ = TiePos::None;</a>
<a name="ln1289">      offsetStaff_ = 0;</a>
<a name="ln1290">      show_ = true;</a>
<a name="ln1291">      offsetTick_ = 0;</a>
<a name="ln1292">      }</a>
<a name="ln1293"> </a>
<a name="ln1294">void Note::setIsRest(bool rest) {</a>
<a name="ln1295">      rest_ = rest;</a>
<a name="ln1296">      }</a>
<a name="ln1297"> </a>
<a name="ln1298">bool Note::getIsRest() const {</a>
<a name="ln1299">      return rest_;</a>
<a name="ln1300">      }</a>
<a name="ln1301"> </a>
<a name="ln1302">void Note::setNote(unsigned int note) {</a>
<a name="ln1303">      note_ = note;</a>
<a name="ln1304">      }</a>
<a name="ln1305"> </a>
<a name="ln1306">unsigned int Note::getNote() const {</a>
<a name="ln1307">      return note_;</a>
<a name="ln1308">      }</a>
<a name="ln1309"> </a>
<a name="ln1310">void Note::setAccidental(int type) {</a>
<a name="ln1311">      accidental_ = (AccidentalType) type;</a>
<a name="ln1312">      }</a>
<a name="ln1313"> </a>
<a name="ln1314">AccidentalType Note::getAccidental() const {</a>
<a name="ln1315">      return accidental_;</a>
<a name="ln1316">      }</a>
<a name="ln1317"> </a>
<a name="ln1318">void Note::setShowAccidental(bool show) {</a>
<a name="ln1319">      showAccidental_ = show;</a>
<a name="ln1320">      }</a>
<a name="ln1321"> </a>
<a name="ln1322">bool Note::getShowAccidental() const {</a>
<a name="ln1323">      return showAccidental_;</a>
<a name="ln1324">      }</a>
<a name="ln1325"> </a>
<a name="ln1326">void Note::setOnVelocity(unsigned int velocity) {</a>
<a name="ln1327">      onVelocity_ = velocity;</a>
<a name="ln1328">      }</a>
<a name="ln1329"> </a>
<a name="ln1330">unsigned int Note::getOnVelocity() const {</a>
<a name="ln1331">      return onVelocity_;</a>
<a name="ln1332">      }</a>
<a name="ln1333"> </a>
<a name="ln1334">void Note::setOffVelocity(unsigned int velocity) {</a>
<a name="ln1335">      offVelocity_ = velocity;</a>
<a name="ln1336">      }</a>
<a name="ln1337"> </a>
<a name="ln1338">unsigned int Note::getOffVelocity() const {</a>
<a name="ln1339">      return offVelocity_;</a>
<a name="ln1340">      }</a>
<a name="ln1341"> </a>
<a name="ln1342">void Note::setHeadType(int type) {</a>
<a name="ln1343">      headType_ = (NoteHeadType) type;</a>
<a name="ln1344">      }</a>
<a name="ln1345"> </a>
<a name="ln1346">NoteHeadType Note::getHeadType() const {</a>
<a name="ln1347">      return headType_;</a>
<a name="ln1348">      }</a>
<a name="ln1349"> </a>
<a name="ln1350">void Note::setTiePos(int tiePos) {</a>
<a name="ln1351">      tiePos_ = (TiePos) tiePos;</a>
<a name="ln1352">      }</a>
<a name="ln1353"> </a>
<a name="ln1354">TiePos Note::getTiePos() const {</a>
<a name="ln1355">      return tiePos_;</a>
<a name="ln1356">      }</a>
<a name="ln1357"> </a>
<a name="ln1358">void Note::setOffsetStaff(int offset) {</a>
<a name="ln1359">      offsetStaff_ = offset;</a>
<a name="ln1360">      }</a>
<a name="ln1361"> </a>
<a name="ln1362">int Note::getOffsetStaff() const {</a>
<a name="ln1363">      return offsetStaff_;</a>
<a name="ln1364">      }</a>
<a name="ln1365"> </a>
<a name="ln1366">void Note::setShow(bool show) {</a>
<a name="ln1367">      show_ = show;</a>
<a name="ln1368">      }</a>
<a name="ln1369"> </a>
<a name="ln1370">bool Note::getShow() const {</a>
<a name="ln1371">      return show_;</a>
<a name="ln1372">      }</a>
<a name="ln1373"> </a>
<a name="ln1374">void Note::setOffsetTick(int offset) {</a>
<a name="ln1375">      offsetTick_ = offset;</a>
<a name="ln1376">      }</a>
<a name="ln1377"> </a>
<a name="ln1378">int Note::getOffsetTick() const {</a>
<a name="ln1379">      return offsetTick_;</a>
<a name="ln1380">      }</a>
<a name="ln1381"> </a>
<a name="ln1382">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln1383">Articulation::Articulation() {</a>
<a name="ln1384">      type_ = ArticulationType::Marcato;</a>
<a name="ln1385">      above_ = true;</a>
<a name="ln1386"> </a>
<a name="ln1387">      changeSoundEffect_ = false;</a>
<a name="ln1388">      changeLength_ = false;</a>
<a name="ln1389">      changeVelocity_ = false;</a>
<a name="ln1390">      changeExtraLength_ = false;</a>
<a name="ln1391"> </a>
<a name="ln1392">      soundEffect_ = qMakePair(0, 0);</a>
<a name="ln1393">      lengthPercentage_ = 100;</a>
<a name="ln1394">      velocityType_ = VelocityType::Offset;</a>
<a name="ln1395">      velocityValue_ = 0;</a>
<a name="ln1396">      extraLength_ = 0;</a>
<a name="ln1397"> </a>
<a name="ln1398">      trillNoteLength_ = 60;</a>
<a name="ln1399">      trillRate_ = NoteType::Note_Sixteen;</a>
<a name="ln1400">      accelerateType_ = AccelerateType::None;</a>
<a name="ln1401">      auxiliaryFirst_ = false;</a>
<a name="ln1402">      trillInterval_ = TrillInterval::Chromatic;</a>
<a name="ln1403">      }</a>
<a name="ln1404"> </a>
<a name="ln1405">void Articulation::setArtType(int type) {</a>
<a name="ln1406">      type_ = (ArticulationType) type;</a>
<a name="ln1407">      }</a>
<a name="ln1408"> </a>
<a name="ln1409">ArticulationType Articulation::getArtType() const {</a>
<a name="ln1410">      return type_;</a>
<a name="ln1411">      }</a>
<a name="ln1412"> </a>
<a name="ln1413">void Articulation::setPlacementAbove(bool above) {</a>
<a name="ln1414">      above_ = above;</a>
<a name="ln1415">      }</a>
<a name="ln1416"> </a>
<a name="ln1417">bool Articulation::getPlacementAbove() const {</a>
<a name="ln1418">      return above_;</a>
<a name="ln1419">      }</a>
<a name="ln1420"> </a>
<a name="ln1421">bool Articulation::getChangeSoundEffect() const {</a>
<a name="ln1422">      return changeSoundEffect_;</a>
<a name="ln1423">      }</a>
<a name="ln1424"> </a>
<a name="ln1425">void Articulation::setSoundEffect(int soundFrom, int soundTo) {</a>
<a name="ln1426">      soundEffect_ = qMakePair(soundFrom, soundTo);</a>
<a name="ln1427">      changeSoundEffect_ = true;</a>
<a name="ln1428">      }</a>
<a name="ln1429"> </a>
<a name="ln1430">QPair&lt;int, int&gt; Articulation::getSoundEffect() const {</a>
<a name="ln1431">      return soundEffect_;</a>
<a name="ln1432">      }</a>
<a name="ln1433"> </a>
<a name="ln1434">bool Articulation::getChangeLength() const {</a>
<a name="ln1435">      return changeLength_;</a>
<a name="ln1436">      }</a>
<a name="ln1437"> </a>
<a name="ln1438">void Articulation::setLengthPercentage(int percentage) {</a>
<a name="ln1439">      lengthPercentage_ = percentage;</a>
<a name="ln1440">      changeLength_ = true;</a>
<a name="ln1441">      }</a>
<a name="ln1442"> </a>
<a name="ln1443">int Articulation::getLengthPercentage() const {</a>
<a name="ln1444">      return lengthPercentage_;</a>
<a name="ln1445">      }</a>
<a name="ln1446"> </a>
<a name="ln1447">bool Articulation::getChangeVelocity() const {</a>
<a name="ln1448">      return changeVelocity_;</a>
<a name="ln1449">      }</a>
<a name="ln1450"> </a>
<a name="ln1451">void Articulation::setVelocityType(VelocityType type) {</a>
<a name="ln1452">      velocityType_ = type;</a>
<a name="ln1453">      changeVelocity_ = true;</a>
<a name="ln1454">      }</a>
<a name="ln1455"> </a>
<a name="ln1456">Articulation::VelocityType Articulation::getVelocityType() const {</a>
<a name="ln1457">      return velocityType_;</a>
<a name="ln1458">      }</a>
<a name="ln1459"> </a>
<a name="ln1460">void Articulation::setVelocityValue(int value) {</a>
<a name="ln1461">      velocityValue_ = value;</a>
<a name="ln1462">      }</a>
<a name="ln1463"> </a>
<a name="ln1464">int Articulation::getVelocityValue() const {</a>
<a name="ln1465">      return velocityValue_;</a>
<a name="ln1466">      }</a>
<a name="ln1467"> </a>
<a name="ln1468">bool Articulation::getChangeExtraLength() const {</a>
<a name="ln1469">      return changeExtraLength_;</a>
<a name="ln1470">      }</a>
<a name="ln1471"> </a>
<a name="ln1472">void Articulation::setExtraLength(int length) {</a>
<a name="ln1473">      extraLength_ = length;</a>
<a name="ln1474">      changeExtraLength_ = true;</a>
<a name="ln1475">      }</a>
<a name="ln1476"> </a>
<a name="ln1477">int Articulation::getExtraLength() const {</a>
<a name="ln1478">      return extraLength_;</a>
<a name="ln1479">      }</a>
<a name="ln1480"> </a>
<a name="ln1481">void Articulation::setTrillNoteLength(int length) {</a>
<a name="ln1482">      trillNoteLength_ = length;</a>
<a name="ln1483">      }</a>
<a name="ln1484"> </a>
<a name="ln1485">int Articulation::getTrillNoteLength() const {</a>
<a name="ln1486">      return trillNoteLength_;</a>
<a name="ln1487">      }</a>
<a name="ln1488"> </a>
<a name="ln1489">void Articulation::setTrillRate(NoteType rate) {</a>
<a name="ln1490">      trillRate_ = rate;</a>
<a name="ln1491">      }</a>
<a name="ln1492"> </a>
<a name="ln1493">NoteType Articulation::getTrillRate() const {</a>
<a name="ln1494">      return trillRate_;</a>
<a name="ln1495">      }</a>
<a name="ln1496"> </a>
<a name="ln1497">void Articulation::setAccelerateType(int type) {</a>
<a name="ln1498">      accelerateType_ = (AccelerateType) type;</a>
<a name="ln1499">      }</a>
<a name="ln1500"> </a>
<a name="ln1501">Articulation::AccelerateType Articulation::getAccelerateType() const {</a>
<a name="ln1502">      return accelerateType_;</a>
<a name="ln1503">      }</a>
<a name="ln1504"> </a>
<a name="ln1505">void Articulation::setAuxiliaryFirst(bool first) {</a>
<a name="ln1506">      auxiliaryFirst_ = first;</a>
<a name="ln1507">      }</a>
<a name="ln1508"> </a>
<a name="ln1509">bool Articulation::getAuxiliaryFirst() const {</a>
<a name="ln1510">      return auxiliaryFirst_;</a>
<a name="ln1511">      }</a>
<a name="ln1512"> </a>
<a name="ln1513">void Articulation::setTrillInterval(int interval) {</a>
<a name="ln1514">      trillInterval_ = (TrillInterval) interval;</a>
<a name="ln1515">      }</a>
<a name="ln1516"> </a>
<a name="ln1517">Articulation::TrillInterval Articulation::getTrillInterval() const {</a>
<a name="ln1518">      return trillInterval_;</a>
<a name="ln1519">      }</a>
<a name="ln1520"> </a>
<a name="ln1521">bool Articulation::willAffectNotes() const {</a>
<a name="ln1522">      bool affect = false;</a>
<a name="ln1523"> </a>
<a name="ln1524">      switch (getArtType()) {</a>
<a name="ln1525">            case ArticulationType::Major_Trill:</a>
<a name="ln1526">            case ArticulationType::Minor_Trill:</a>
<a name="ln1527">            case ArticulationType::Trill_Section:</a>
<a name="ln1528">            case ArticulationType::Inverted_Short_Mordent:</a>
<a name="ln1529">            case ArticulationType::Inverted_Long_Mordent:</a>
<a name="ln1530">            case ArticulationType::Short_Mordent:</a>
<a name="ln1531">            case ArticulationType::Turn:</a>
<a name="ln1532"> </a>
<a name="ln1533">            case ArticulationType::Arpeggio:</a>
<a name="ln1534">            case ArticulationType::Tremolo_Eighth:</a>
<a name="ln1535">            case ArticulationType::Tremolo_Sixteenth:</a>
<a name="ln1536">            case ArticulationType::Tremolo_Thirty_Second:</a>
<a name="ln1537">            case ArticulationType::Tremolo_Sixty_Fourth: {</a>
<a name="ln1538">                  affect = true;</a>
<a name="ln1539">                  break;</a>
<a name="ln1540">                  }</a>
<a name="ln1541">            case ArticulationType::Finger_1:</a>
<a name="ln1542">            case ArticulationType::Finger_2:</a>
<a name="ln1543">            case ArticulationType::Finger_3:</a>
<a name="ln1544">            case ArticulationType::Finger_4:</a>
<a name="ln1545">            case ArticulationType::Finger_5:</a>
<a name="ln1546">            case ArticulationType::Flat_Accidental_For_Trill:</a>
<a name="ln1547">            case ArticulationType::Sharp_Accidental_For_Trill:</a>
<a name="ln1548">            case ArticulationType::Natural_Accidental_For_Trill:</a>
<a name="ln1549">            case ArticulationType::Marcato:</a>
<a name="ln1550">            case ArticulationType::Marcato_Dot:</a>
<a name="ln1551">            case ArticulationType::Heavy_Attack:</a>
<a name="ln1552">            case ArticulationType::SForzando:</a>
<a name="ln1553">            case ArticulationType::SForzando_Dot:</a>
<a name="ln1554">            case ArticulationType::Heavier_Attack:</a>
<a name="ln1555">            case ArticulationType::SForzando_Inverted:</a>
<a name="ln1556">            case ArticulationType::SForzando_Dot_Inverted:</a>
<a name="ln1557">            case ArticulationType::Staccatissimo:</a>
<a name="ln1558">            case ArticulationType::Staccato:</a>
<a name="ln1559">            case ArticulationType::Tenuto:</a>
<a name="ln1560">            case ArticulationType::Up_Bow:</a>
<a name="ln1561">            case ArticulationType::Down_Bow:</a>
<a name="ln1562">            case ArticulationType::Up_Bow_Inverted:</a>
<a name="ln1563">            case ArticulationType::Down_Bow_Inverted:</a>
<a name="ln1564">            case ArticulationType::Natural_Harmonic:</a>
<a name="ln1565">            case ArticulationType::Artificial_Harmonic:</a>
<a name="ln1566">            case ArticulationType::Plus_Sign:</a>
<a name="ln1567">            case ArticulationType::Fermata:</a>
<a name="ln1568">            case ArticulationType::Fermata_Inverted:</a>
<a name="ln1569">            case ArticulationType::Pedal_Down:</a>
<a name="ln1570">            case ArticulationType::Pedal_Up:</a>
<a name="ln1571">            case ArticulationType::Pause:</a>
<a name="ln1572">            case ArticulationType::Grand_Pause:</a>
<a name="ln1573">            case ArticulationType::Toe_Pedal:</a>
<a name="ln1574">            case ArticulationType::Heel_Pedal:</a>
<a name="ln1575">            case ArticulationType::Toe_To_Heel_Pedal:</a>
<a name="ln1576">            case ArticulationType::Heel_To_Toe_Pedal:</a>
<a name="ln1577">            case ArticulationType::Open_String:</a>
<a name="ln1578">            case ArticulationType::Guitar_Lift:</a>
<a name="ln1579">            case ArticulationType::Guitar_Slide_Up:</a>
<a name="ln1580">            case ArticulationType::Guitar_Rip:</a>
<a name="ln1581">            case ArticulationType::Guitar_Fall_Off:</a>
<a name="ln1582">            case ArticulationType::Guitar_Slide_Down:</a>
<a name="ln1583">            case ArticulationType::Guitar_Spill:</a>
<a name="ln1584">            case ArticulationType::Guitar_Flip:</a>
<a name="ln1585">            case ArticulationType::Guitar_Smear:</a>
<a name="ln1586">            case ArticulationType::Guitar_Bend:</a>
<a name="ln1587">            case ArticulationType::Guitar_Doit:</a>
<a name="ln1588">            case ArticulationType::Guitar_Plop:</a>
<a name="ln1589">            case ArticulationType::Guitar_Wow_Wow:</a>
<a name="ln1590">            case ArticulationType::Guitar_Thumb:</a>
<a name="ln1591">            case ArticulationType::Guitar_Index_Finger:</a>
<a name="ln1592">            case ArticulationType::Guitar_Middle_Finger:</a>
<a name="ln1593">            case ArticulationType::Guitar_Ring_Finger:</a>
<a name="ln1594">            case ArticulationType::Guitar_Pinky_Finger:</a>
<a name="ln1595">            case ArticulationType::Guitar_Tap:</a>
<a name="ln1596">            case ArticulationType::Guitar_Hammer:</a>
<a name="ln1597">            case ArticulationType::Guitar_Pluck: {</a>
<a name="ln1598">                  break;</a>
<a name="ln1599">                  }</a>
<a name="ln1600">            default:</a>
<a name="ln1601">                  break;</a>
<a name="ln1602">            }</a>
<a name="ln1603"> </a>
<a name="ln1604">      return affect;</a>
<a name="ln1605">      }</a>
<a name="ln1606"> </a>
<a name="ln1607">bool Articulation::isTrill(ArticulationType type) {</a>
<a name="ln1608">      bool isTrill = false;</a>
<a name="ln1609"> </a>
<a name="ln1610">      switch (type) {</a>
<a name="ln1611">            case ArticulationType::Major_Trill:</a>
<a name="ln1612">            case ArticulationType::Minor_Trill:</a>
<a name="ln1613">            case ArticulationType::Trill_Section: {</a>
<a name="ln1614">                  isTrill = true;</a>
<a name="ln1615">                  break;</a>
<a name="ln1616">                  }</a>
<a name="ln1617">            default:</a>
<a name="ln1618">                  break;</a>
<a name="ln1619">            }</a>
<a name="ln1620"> </a>
<a name="ln1621">      return isTrill;</a>
<a name="ln1622">      }</a>
<a name="ln1623"> </a>
<a name="ln1624">Articulation::XmlType Articulation::getXmlType() const {</a>
<a name="ln1625">      XmlType xmlType = XmlType::Unknown;</a>
<a name="ln1626"> </a>
<a name="ln1627">      switch (type_) {</a>
<a name="ln1628">            case ArticulationType::Major_Trill:</a>
<a name="ln1629">            case ArticulationType::Minor_Trill:</a>
<a name="ln1630">            case ArticulationType::Trill_Section:</a>
<a name="ln1631">            case ArticulationType::Inverted_Short_Mordent:</a>
<a name="ln1632">            case ArticulationType::Inverted_Long_Mordent:</a>
<a name="ln1633">            case ArticulationType::Short_Mordent:</a>
<a name="ln1634">            case ArticulationType::Turn:</a>
<a name="ln1635">                  // case ArticulationType::Flat_Accidental_For_Trill :</a>
<a name="ln1636">                  // case ArticulationType::Sharp_Accidental_For_Trill :</a>
<a name="ln1637">                  // case ArticulationType::Natural_Accidental_For_Trill :</a>
<a name="ln1638">            case ArticulationType::Tremolo_Eighth:</a>
<a name="ln1639">            case ArticulationType::Tremolo_Sixteenth:</a>
<a name="ln1640">            case ArticulationType::Tremolo_Thirty_Second:</a>
<a name="ln1641">            case ArticulationType::Tremolo_Sixty_Fourth: {</a>
<a name="ln1642">                  xmlType = XmlType::Ornament;</a>
<a name="ln1643">                  break;</a>
<a name="ln1644">                  }</a>
<a name="ln1645">            case ArticulationType::Marcato:</a>
<a name="ln1646">            case ArticulationType::Marcato_Dot:</a>
<a name="ln1647">            case ArticulationType::Heavy_Attack:</a>
<a name="ln1648">            case ArticulationType::SForzando:</a>
<a name="ln1649">            case ArticulationType::SForzando_Inverted:</a>
<a name="ln1650">            case ArticulationType::SForzando_Dot:</a>
<a name="ln1651">            case ArticulationType::SForzando_Dot_Inverted:</a>
<a name="ln1652">            case ArticulationType::Heavier_Attack:</a>
<a name="ln1653">            case ArticulationType::Staccatissimo:</a>
<a name="ln1654">            case ArticulationType::Staccato:</a>
<a name="ln1655">            case ArticulationType::Tenuto:</a>
<a name="ln1656">            case ArticulationType::Pause:</a>
<a name="ln1657">            case ArticulationType::Grand_Pause: {</a>
<a name="ln1658">                  xmlType = XmlType::Articulation;</a>
<a name="ln1659">                  break;</a>
<a name="ln1660">                  }</a>
<a name="ln1661">            case ArticulationType::Up_Bow:</a>
<a name="ln1662">            case ArticulationType::Down_Bow:</a>
<a name="ln1663">            case ArticulationType::Up_Bow_Inverted:</a>
<a name="ln1664">            case ArticulationType::Down_Bow_Inverted:</a>
<a name="ln1665">            case ArticulationType::Natural_Harmonic:</a>
<a name="ln1666">            case ArticulationType::Artificial_Harmonic:</a>
<a name="ln1667">            case ArticulationType::Finger_1:</a>
<a name="ln1668">            case ArticulationType::Finger_2:</a>
<a name="ln1669">            case ArticulationType::Finger_3:</a>
<a name="ln1670">            case ArticulationType::Finger_4:</a>
<a name="ln1671">            case ArticulationType::Finger_5:</a>
<a name="ln1672">            case ArticulationType::Plus_Sign: {</a>
<a name="ln1673">                  xmlType = XmlType::Technical;</a>
<a name="ln1674">                  break;</a>
<a name="ln1675">                  }</a>
<a name="ln1676">            case ArticulationType::Arpeggio: {</a>
<a name="ln1677">                  xmlType = XmlType::Arpeggiate;</a>
<a name="ln1678">                  break;</a>
<a name="ln1679">                  }</a>
<a name="ln1680">            case ArticulationType::Fermata:</a>
<a name="ln1681">            case ArticulationType::Fermata_Inverted: {</a>
<a name="ln1682">                  xmlType = XmlType::Fermata;</a>
<a name="ln1683">                  break;</a>
<a name="ln1684">                  }</a>
<a name="ln1685">            case ArticulationType::Pedal_Down:</a>
<a name="ln1686">            case ArticulationType::Pedal_Up: {</a>
<a name="ln1687">                  xmlType = XmlType::Direction;</a>
<a name="ln1688">                  break;</a>
<a name="ln1689">                  }</a>
<a name="ln1690">                  // case ArticulationType::Toe_Pedal :</a>
<a name="ln1691">                  // case ArticulationType::Heel_Pedal :</a>
<a name="ln1692">                  // case ArticulationType::Toe_To_Heel_Pedal :</a>
<a name="ln1693">                  // case ArticulationType::Heel_To_Toe_Pedal :</a>
<a name="ln1694">                  // case ArticulationType::Open_String :</a>
<a name="ln1695">            default:</a>
<a name="ln1696">                  break;</a>
<a name="ln1697">            }</a>
<a name="ln1698"> </a>
<a name="ln1699">      return xmlType;</a>
<a name="ln1700">      }</a>
<a name="ln1701"> </a>
<a name="ln1702">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln1703">NoteContainer::NoteContainer() {</a>
<a name="ln1704">      musicDataType_ = MusicDataType::Note_Container;</a>
<a name="ln1705"> </a>
<a name="ln1706">      grace_ = false;</a>
<a name="ln1707">      cue_ = false;</a>
<a name="ln1708">      rest_ = false;</a>
<a name="ln1709">      raw_ = false;</a>
<a name="ln1710">      noteType_ = NoteType::Note_Quarter;</a>
<a name="ln1711">      dot_ = 0;</a>
<a name="ln1712">      graceNoteType_ = NoteType::Note_Eight;</a>
<a name="ln1713">      stemUp_ = true;</a>
<a name="ln1714">      showStem_ = true;</a>
<a name="ln1715">      stemLength_ = 7;</a>
<a name="ln1716">      inBeam_ = false;</a>
<a name="ln1717">      tuplet_ = 0;</a>
<a name="ln1718">      space_ = 2;//div by 0</a>
<a name="ln1719">      noteShift_ = 0;</a>
<a name="ln1720">      }</a>
<a name="ln1721"> </a>
<a name="ln1722">NoteContainer::~NoteContainer(){</a>
<a name="ln1723">      for(int i=0; i&lt;notes_.size(); ++i){</a>
<a name="ln1724">            delete notes_[i];</a>
<a name="ln1725">            }</a>
<a name="ln1726">      for(int i=0; i&lt;articulations_.size(); ++i){</a>
<a name="ln1727">            delete articulations_[i];</a>
<a name="ln1728">            }</a>
<a name="ln1729">      notes_.clear();</a>
<a name="ln1730">      articulations_.clear();</a>
<a name="ln1731">      }</a>
<a name="ln1732"> </a>
<a name="ln1733">void NoteContainer::setIsGrace(bool grace) {</a>
<a name="ln1734">      grace_ = grace;</a>
<a name="ln1735">      }</a>
<a name="ln1736"> </a>
<a name="ln1737">bool NoteContainer::getIsGrace() const {</a>
<a name="ln1738">      return grace_;</a>
<a name="ln1739">      }</a>
<a name="ln1740"> </a>
<a name="ln1741">void NoteContainer::setIsCue(bool cue) {</a>
<a name="ln1742">      cue_ = cue;</a>
<a name="ln1743">      }</a>
<a name="ln1744"> </a>
<a name="ln1745">bool NoteContainer::getIsCue() const {</a>
<a name="ln1746">      return cue_;</a>
<a name="ln1747">      }</a>
<a name="ln1748"> </a>
<a name="ln1749">void NoteContainer::setIsRest(bool rest) {</a>
<a name="ln1750">      rest_ = rest;</a>
<a name="ln1751">      }</a>
<a name="ln1752"> </a>
<a name="ln1753">bool NoteContainer::getIsRest() const {</a>
<a name="ln1754">      return rest_;</a>
<a name="ln1755">      }</a>
<a name="ln1756"> </a>
<a name="ln1757">void NoteContainer::setIsRaw(bool raw) {</a>
<a name="ln1758">      raw_ = raw;</a>
<a name="ln1759">      }</a>
<a name="ln1760"> </a>
<a name="ln1761">bool NoteContainer::getIsRaw() const {</a>
<a name="ln1762">      return raw_;</a>
<a name="ln1763">      }</a>
<a name="ln1764"> </a>
<a name="ln1765">void NoteContainer::setNoteType(NoteType type) {</a>
<a name="ln1766">      noteType_ = NoteType::Note_Quarter;</a>
<a name="ln1767"> </a>
<a name="ln1768">      switch (type) {</a>
<a name="ln1769">            case NoteType::Note_DoubleWhole:</a>
<a name="ln1770">            case NoteType::Note_Whole:</a>
<a name="ln1771">            case NoteType::Note_Half:</a>
<a name="ln1772">            case NoteType::Note_Quarter:</a>
<a name="ln1773">            case NoteType::Note_Eight:</a>
<a name="ln1774">            case NoteType::Note_Sixteen:</a>
<a name="ln1775">            case NoteType::Note_32:</a>
<a name="ln1776">            case NoteType::Note_64:</a>
<a name="ln1777">            case NoteType::Note_128:</a>
<a name="ln1778">            case NoteType::Note_256: {</a>
<a name="ln1779">                  noteType_ = type;</a>
<a name="ln1780">                  break;</a>
<a name="ln1781">                  }</a>
<a name="ln1782">            default: {</a>
<a name="ln1783">                  break;</a>
<a name="ln1784">                  }</a>
<a name="ln1785">            }</a>
<a name="ln1786">      }</a>
<a name="ln1787"> </a>
<a name="ln1788">NoteType NoteContainer::getNoteType() const {</a>
<a name="ln1789">      return noteType_;</a>
<a name="ln1790">      }</a>
<a name="ln1791"> </a>
<a name="ln1792">void NoteContainer::setDot(int dot) {</a>
<a name="ln1793">      dot_ = dot;</a>
<a name="ln1794">      }</a>
<a name="ln1795"> </a>
<a name="ln1796">int NoteContainer::getDot() const {</a>
<a name="ln1797">      return dot_;</a>
<a name="ln1798">      }</a>
<a name="ln1799"> </a>
<a name="ln1800">void NoteContainer::setGraceNoteType(NoteType type) {</a>
<a name="ln1801">      graceNoteType_ = type;</a>
<a name="ln1802">      }</a>
<a name="ln1803"> </a>
<a name="ln1804">NoteType NoteContainer::getGraceNoteType() const {</a>
<a name="ln1805">      return graceNoteType_;</a>
<a name="ln1806">      }</a>
<a name="ln1807"> </a>
<a name="ln1808">void NoteContainer::setInBeam(bool in) {</a>
<a name="ln1809">      inBeam_ = in;</a>
<a name="ln1810">      }</a>
<a name="ln1811"> </a>
<a name="ln1812">bool NoteContainer::getInBeam() const {</a>
<a name="ln1813">      return inBeam_;</a>
<a name="ln1814">      }</a>
<a name="ln1815"> </a>
<a name="ln1816">void NoteContainer::setStemUp(bool up) {</a>
<a name="ln1817">      stemUp_ = up;</a>
<a name="ln1818">      }</a>
<a name="ln1819"> </a>
<a name="ln1820">bool NoteContainer::getStemUp(void) const {</a>
<a name="ln1821">      return stemUp_;</a>
<a name="ln1822">      }</a>
<a name="ln1823"> </a>
<a name="ln1824">void NoteContainer::setShowStem(bool show) {</a>
<a name="ln1825">      showStem_ = show;</a>
<a name="ln1826">      }</a>
<a name="ln1827"> </a>
<a name="ln1828">bool NoteContainer::getShowStem() const {</a>
<a name="ln1829">      return showStem_;</a>
<a name="ln1830">      }</a>
<a name="ln1831"> </a>
<a name="ln1832">void NoteContainer::setStemLength(int line) {</a>
<a name="ln1833">      stemLength_ = line;</a>
<a name="ln1834">      }</a>
<a name="ln1835"> </a>
<a name="ln1836">int NoteContainer::getStemLength() const {</a>
<a name="ln1837">      return stemLength_;</a>
<a name="ln1838">      }</a>
<a name="ln1839"> </a>
<a name="ln1840">void NoteContainer::setTuplet(int tuplet) {</a>
<a name="ln1841">      tuplet_ = tuplet;</a>
<a name="ln1842">      }</a>
<a name="ln1843"> </a>
<a name="ln1844">int NoteContainer::getTuplet() const {</a>
<a name="ln1845">      return tuplet_;</a>
<a name="ln1846">      }</a>
<a name="ln1847"> </a>
<a name="ln1848">void NoteContainer::setSpace(int space) {</a>
<a name="ln1849">      space_ = space;</a>
<a name="ln1850">      }</a>
<a name="ln1851"> </a>
<a name="ln1852">int NoteContainer::getSpace() const {</a>
<a name="ln1853">      return space_;</a>
<a name="ln1854">      }</a>
<a name="ln1855"> </a>
<a name="ln1856">void NoteContainer::addNoteRest(Note* note) {</a>
<a name="ln1857">      notes_.push_back(note);</a>
<a name="ln1858">      }</a>
<a name="ln1859"> </a>
<a name="ln1860">QList&lt;Note*&gt; NoteContainer::getNotesRests() const {</a>
<a name="ln1861">      return notes_;</a>
<a name="ln1862">      }</a>
<a name="ln1863"> </a>
<a name="ln1864">void NoteContainer::addArticulation(Articulation* art) {</a>
<a name="ln1865">      articulations_.push_back(art);</a>
<a name="ln1866">      }</a>
<a name="ln1867"> </a>
<a name="ln1868">QList&lt;Articulation*&gt; NoteContainer::getArticulations() const {</a>
<a name="ln1869">      return articulations_;</a>
<a name="ln1870">      }</a>
<a name="ln1871"> </a>
<a name="ln1872">void NoteContainer::setNoteShift(int octave) {</a>
<a name="ln1873">      noteShift_ = octave;</a>
<a name="ln1874">      }</a>
<a name="ln1875"> </a>
<a name="ln1876">int NoteContainer::getNoteShift() const {</a>
<a name="ln1877">      return noteShift_;</a>
<a name="ln1878">      }</a>
<a name="ln1879"> </a>
<a name="ln1880">int NoteContainer::getOffsetStaff() const {</a>
<a name="ln1881">      if(getIsRest())</a>
<a name="ln1882">            return 0;</a>
<a name="ln1883"> </a>
<a name="ln1884">      int staffMove = 0;</a>
<a name="ln1885">      QList&lt;OVE::Note*&gt; notes = getNotesRests();</a>
<a name="ln1886">      for (int i = 0; i &lt; notes.size(); ++i) {</a>
<a name="ln1887">            OVE::Note* notePtr = notes[i];</a>
<a name="ln1888">            staffMove = notePtr-&gt;getOffsetStaff();</a>
<a name="ln1889">            }</a>
<a name="ln1890"> </a>
<a name="ln1891">      return staffMove;</a>
<a name="ln1892">      }</a>
<a name="ln1893"> </a>
<a name="ln1894">int NoteContainer::getDuration() const {</a>
<a name="ln1895">      int duration = static_cast&lt;int&gt;(NoteDuration::D_4);</a>
<a name="ln1896"> </a>
<a name="ln1897">      switch (noteType_) {</a>
<a name="ln1898">            case NoteType::Note_DoubleWhole: {</a>
<a name="ln1899">                  duration = static_cast&lt;int&gt;(NoteDuration::D_Double_Whole);</a>
<a name="ln1900">                  break;</a>
<a name="ln1901">                  }</a>
<a name="ln1902">            case NoteType::Note_Whole: {</a>
<a name="ln1903">                  duration = static_cast&lt;int&gt;(NoteDuration::D_Whole);</a>
<a name="ln1904">                  break;</a>
<a name="ln1905">                  }</a>
<a name="ln1906">            case NoteType::Note_Half: {</a>
<a name="ln1907">                  duration = static_cast&lt;int&gt;(NoteDuration::D_2);</a>
<a name="ln1908">                  break;</a>
<a name="ln1909">                  }</a>
<a name="ln1910">            case NoteType::Note_Quarter: {</a>
<a name="ln1911">                  duration = static_cast&lt;int&gt;(NoteDuration::D_4);</a>
<a name="ln1912">                  break;</a>
<a name="ln1913">                  }</a>
<a name="ln1914">            case NoteType::Note_Eight: {</a>
<a name="ln1915">                  duration = static_cast&lt;int&gt;(NoteDuration::D_8);</a>
<a name="ln1916">                  break;</a>
<a name="ln1917">                  }</a>
<a name="ln1918">            case NoteType::Note_Sixteen: {</a>
<a name="ln1919">                  duration = static_cast&lt;int&gt;(NoteDuration::D_16);</a>
<a name="ln1920">                  break;</a>
<a name="ln1921">                  }</a>
<a name="ln1922">            case NoteType::Note_32: {</a>
<a name="ln1923">                  duration = static_cast&lt;int&gt;(NoteDuration::D_32);</a>
<a name="ln1924">                  break;</a>
<a name="ln1925">                  }</a>
<a name="ln1926">            case NoteType::Note_64: {</a>
<a name="ln1927">                  duration = static_cast&lt;int&gt;(NoteDuration::D_64);</a>
<a name="ln1928">                  break;</a>
<a name="ln1929">                  }</a>
<a name="ln1930">            case NoteType::Note_128: {</a>
<a name="ln1931">                  duration = static_cast&lt;int&gt;(NoteDuration::D_128);</a>
<a name="ln1932">                  break;</a>
<a name="ln1933">                  }</a>
<a name="ln1934">            case NoteType::Note_256: {</a>
<a name="ln1935">                  duration = static_cast&lt;int&gt;(NoteDuration::D_256);</a>
<a name="ln1936">                  break;</a>
<a name="ln1937">                  }</a>
<a name="ln1938">            default:</a>
<a name="ln1939">                  break;</a>
<a name="ln1940">            }</a>
<a name="ln1941"> </a>
<a name="ln1942">      int dotLength = duration;</a>
<a name="ln1943"> </a>
<a name="ln1944">      for (int i = 0; i &lt; dot_; ++i) {</a>
<a name="ln1945">            dotLength /= 2;</a>
<a name="ln1946">            }</a>
<a name="ln1947"> </a>
<a name="ln1948">      dotLength = duration - dotLength;</a>
<a name="ln1949"> </a>
<a name="ln1950">      duration += dotLength;</a>
<a name="ln1951"> </a>
<a name="ln1952">      return duration;</a>
<a name="ln1953">      }</a>
<a name="ln1954"> </a>
<a name="ln1955">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln1956">Beam::Beam() {</a>
<a name="ln1957">      musicDataType_ = MusicDataType::Beam;</a>
<a name="ln1958">      grace_ = false;</a>
<a name="ln1959">      }</a>
<a name="ln1960"> </a>
<a name="ln1961">void Beam::setIsGrace(bool grace) {</a>
<a name="ln1962">      grace_ = grace;</a>
<a name="ln1963">      }</a>
<a name="ln1964"> </a>
<a name="ln1965">bool Beam::getIsGrace() const {</a>
<a name="ln1966">      return grace_;</a>
<a name="ln1967">      }</a>
<a name="ln1968"> </a>
<a name="ln1969">void Beam::addLine(const MeasurePos&amp; startMp, const MeasurePos&amp; endMp) {</a>
<a name="ln1970">      lines_.push_back(qMakePair(startMp, endMp));</a>
<a name="ln1971">      }</a>
<a name="ln1972"> </a>
<a name="ln1973">const QList&lt;QPair&lt;MeasurePos, MeasurePos&gt; &gt; Beam::getLines() const {</a>
<a name="ln1974">      return lines_;</a>
<a name="ln1975">      }</a>
<a name="ln1976"> </a>
<a name="ln1977">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln1978">Tie::Tie() {</a>
<a name="ln1979">      musicDataType_ = MusicDataType::Tie;</a>
<a name="ln1980"> </a>
<a name="ln1981">      showOnTop_ = true;</a>
<a name="ln1982">      note_ = 72;</a>
<a name="ln1983">      height_ = 24;</a>
<a name="ln1984">      }</a>
<a name="ln1985"> </a>
<a name="ln1986">void Tie::setShowOnTop(bool top) {</a>
<a name="ln1987">      showOnTop_ = top;</a>
<a name="ln1988">      }</a>
<a name="ln1989"> </a>
<a name="ln1990">bool Tie::getShowOnTop() const {</a>
<a name="ln1991">      return showOnTop_;</a>
<a name="ln1992">      }</a>
<a name="ln1993"> </a>
<a name="ln1994">void Tie::setNote(int note) {</a>
<a name="ln1995">      note_ = note;</a>
<a name="ln1996">      }</a>
<a name="ln1997"> </a>
<a name="ln1998">int Tie::getNote() const {</a>
<a name="ln1999">      return note_;</a>
<a name="ln2000">      }</a>
<a name="ln2001"> </a>
<a name="ln2002">void Tie::setHeight(int height) {</a>
<a name="ln2003">      height_ = height;</a>
<a name="ln2004">      }</a>
<a name="ln2005"> </a>
<a name="ln2006">int Tie::getHeight() const {</a>
<a name="ln2007">      return height_;</a>
<a name="ln2008">      }</a>
<a name="ln2009"> </a>
<a name="ln2010">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2011">Glissando::Glissando() {</a>
<a name="ln2012">      musicDataType_ = MusicDataType::Glissando;</a>
<a name="ln2013"> </a>
<a name="ln2014">      straight_ = true;</a>
<a name="ln2015">      text_ = &quot;gliss.&quot;;</a>
<a name="ln2016">      lineThick_ = 8;</a>
<a name="ln2017">      }</a>
<a name="ln2018"> </a>
<a name="ln2019">void Glissando::setStraightWavy(bool straight) {</a>
<a name="ln2020">      straight_ = straight;</a>
<a name="ln2021">      }</a>
<a name="ln2022"> </a>
<a name="ln2023">bool Glissando::getStraightWavy() const {</a>
<a name="ln2024">      return straight_;</a>
<a name="ln2025">      }</a>
<a name="ln2026"> </a>
<a name="ln2027">void Glissando::setText(const QString&amp; text) {</a>
<a name="ln2028">      text_ = text;</a>
<a name="ln2029">      }</a>
<a name="ln2030"> </a>
<a name="ln2031">QString Glissando::getText() const {</a>
<a name="ln2032">      return text_;</a>
<a name="ln2033">      }</a>
<a name="ln2034"> </a>
<a name="ln2035">void Glissando::setLineThick(int thick) {</a>
<a name="ln2036">      lineThick_ = thick;</a>
<a name="ln2037">      }</a>
<a name="ln2038"> </a>
<a name="ln2039">int Glissando::getLineThick() const {</a>
<a name="ln2040">      return lineThick_;</a>
<a name="ln2041">      }</a>
<a name="ln2042"> </a>
<a name="ln2043">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2044">Decorator::Decorator() :</a>
<a name="ln2045">      decoratorType_(Type::Articulation),</a>
<a name="ln2046">      artType_(ArticulationType::Marcato) {</a>
<a name="ln2047">      musicDataType_ = MusicDataType::Decorator;</a>
<a name="ln2048">      }</a>
<a name="ln2049"> </a>
<a name="ln2050">void Decorator::setDecoratorType(Type type) {</a>
<a name="ln2051">      decoratorType_ = type;</a>
<a name="ln2052">      }</a>
<a name="ln2053"> </a>
<a name="ln2054">Decorator::Type Decorator::getDecoratorType() const {</a>
<a name="ln2055">      return decoratorType_;</a>
<a name="ln2056">      }</a>
<a name="ln2057"> </a>
<a name="ln2058">void Decorator::setArticulationType(ArticulationType type) {</a>
<a name="ln2059">      artType_ = type;</a>
<a name="ln2060">      }</a>
<a name="ln2061"> </a>
<a name="ln2062">ArticulationType Decorator::getArticulationType() const {</a>
<a name="ln2063">      return artType_;</a>
<a name="ln2064">      }</a>
<a name="ln2065"> </a>
<a name="ln2066">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2067">MeasureRepeat::MeasureRepeat() {</a>
<a name="ln2068">      musicDataType_ = MusicDataType::Measure_Repeat;</a>
<a name="ln2069">      singleRepeat_ = true;</a>
<a name="ln2070">      }</a>
<a name="ln2071"> </a>
<a name="ln2072">void MeasureRepeat::setSingleRepeat(bool single) {</a>
<a name="ln2073">      singleRepeat_ = single;</a>
<a name="ln2074"> </a>
<a name="ln2075">      start()-&gt;setMeasure(0);</a>
<a name="ln2076">      start()-&gt;setOffset(0);</a>
<a name="ln2077">      stop()-&gt;setMeasure(single ? 1 : 2);</a>
<a name="ln2078">      stop()-&gt;setOffset(0);</a>
<a name="ln2079">      }</a>
<a name="ln2080"> </a>
<a name="ln2081">bool MeasureRepeat::getSingleRepeat() const {</a>
<a name="ln2082">      return singleRepeat_;</a>
<a name="ln2083">      }</a>
<a name="ln2084"> </a>
<a name="ln2085">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2086">Tuplet::Tuplet() :</a>
<a name="ln2087">      tuplet_(3), space_(2), height_(0), noteType_(NoteType::Note_Quarter){</a>
<a name="ln2088">      musicDataType_ = MusicDataType::Tuplet;</a>
<a name="ln2089">      mark_ = new OffsetElement();</a>
<a name="ln2090">      }</a>
<a name="ln2091"> </a>
<a name="ln2092">Tuplet::~Tuplet(){</a>
<a name="ln2093">      delete mark_;</a>
<a name="ln2094">      }</a>
<a name="ln2095"> </a>
<a name="ln2096">void Tuplet::setTuplet(int tuplet) {</a>
<a name="ln2097">      tuplet_ = tuplet;</a>
<a name="ln2098">      }</a>
<a name="ln2099"> </a>
<a name="ln2100">int Tuplet::getTuplet() const {</a>
<a name="ln2101">      return tuplet_;</a>
<a name="ln2102">      }</a>
<a name="ln2103"> </a>
<a name="ln2104">void Tuplet::setSpace(int space) {</a>
<a name="ln2105">      space_ = space;</a>
<a name="ln2106">      }</a>
<a name="ln2107"> </a>
<a name="ln2108">int Tuplet::getSpace() const {</a>
<a name="ln2109">      return space_;</a>
<a name="ln2110">      }</a>
<a name="ln2111"> </a>
<a name="ln2112">OffsetElement* Tuplet::getMarkHandle() const {</a>
<a name="ln2113">      return mark_;</a>
<a name="ln2114">      }</a>
<a name="ln2115"> </a>
<a name="ln2116">void Tuplet::setHeight(int height) {</a>
<a name="ln2117">      height_ = height;</a>
<a name="ln2118">      }</a>
<a name="ln2119"> </a>
<a name="ln2120">int Tuplet::getHeight() const {</a>
<a name="ln2121">      return height_;</a>
<a name="ln2122">      }</a>
<a name="ln2123"> </a>
<a name="ln2124">void Tuplet::setNoteType(NoteType type) {</a>
<a name="ln2125">      noteType_ = type;</a>
<a name="ln2126">      }</a>
<a name="ln2127"> </a>
<a name="ln2128">NoteType Tuplet::getNoteType() const {</a>
<a name="ln2129">      return noteType_;</a>
<a name="ln2130">      }</a>
<a name="ln2131"> </a>
<a name="ln2132">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2133">Harmony::Harmony() {</a>
<a name="ln2134">      musicDataType_ = MusicDataType::Harmony;</a>
<a name="ln2135"> </a>
<a name="ln2136">      harmonyType_ = &quot;&quot;;</a>
<a name="ln2137">      root_ = 0;</a>
<a name="ln2138">      bass_ = -1; //0xff</a>
<a name="ln2139">      alterRoot_ = 0;</a>
<a name="ln2140">      alterBass_ = 0;</a>
<a name="ln2141">      bassOnBottom_ = false;</a>
<a name="ln2142">      angle_ = 0;</a>
<a name="ln2143">      }</a>
<a name="ln2144"> </a>
<a name="ln2145">void Harmony::setHarmonyType(QString type) {</a>
<a name="ln2146">      harmonyType_ = type;</a>
<a name="ln2147">      }</a>
<a name="ln2148"> </a>
<a name="ln2149">QString Harmony::getHarmonyType() const {</a>
<a name="ln2150">      return harmonyType_;</a>
<a name="ln2151">      }</a>
<a name="ln2152"> </a>
<a name="ln2153">void Harmony::setRoot(int root) {</a>
<a name="ln2154">      root_ = root;</a>
<a name="ln2155">      }</a>
<a name="ln2156"> </a>
<a name="ln2157">int Harmony::getRoot() const {</a>
<a name="ln2158">      return root_;</a>
<a name="ln2159">      }</a>
<a name="ln2160"> </a>
<a name="ln2161">void Harmony::setAlterRoot(int val) {</a>
<a name="ln2162">      alterRoot_ = val;</a>
<a name="ln2163">      }</a>
<a name="ln2164"> </a>
<a name="ln2165">int Harmony::getAlterRoot() const {</a>
<a name="ln2166">      return alterRoot_;</a>
<a name="ln2167">      }</a>
<a name="ln2168"> </a>
<a name="ln2169">void Harmony::setBass(int bass) {</a>
<a name="ln2170">      bass_ = bass;</a>
<a name="ln2171">      }</a>
<a name="ln2172"> </a>
<a name="ln2173">int Harmony::getBass() const {</a>
<a name="ln2174">      return bass_;</a>
<a name="ln2175">      }</a>
<a name="ln2176"> </a>
<a name="ln2177">void Harmony::setAlterBass(int val) {</a>
<a name="ln2178">      alterBass_ = val;</a>
<a name="ln2179">      }</a>
<a name="ln2180"> </a>
<a name="ln2181">int Harmony::getAlterBass() const {</a>
<a name="ln2182">      return alterBass_;</a>
<a name="ln2183">      }</a>
<a name="ln2184"> </a>
<a name="ln2185">void Harmony::setBassOnBottom(bool on) {</a>
<a name="ln2186">      bassOnBottom_ = on;</a>
<a name="ln2187">      }</a>
<a name="ln2188"> </a>
<a name="ln2189">bool Harmony::getBassOnBottom() const {</a>
<a name="ln2190">      return bassOnBottom_;</a>
<a name="ln2191">      }</a>
<a name="ln2192"> </a>
<a name="ln2193">void Harmony::setAngle(int angle) {</a>
<a name="ln2194">      angle_ = angle;</a>
<a name="ln2195">      }</a>
<a name="ln2196"> </a>
<a name="ln2197">int Harmony::getAngle() const {</a>
<a name="ln2198">      return angle_;</a>
<a name="ln2199">      }</a>
<a name="ln2200"> </a>
<a name="ln2201">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2202">Clef::Clef() {</a>
<a name="ln2203">      musicDataType_ = MusicDataType::Clef;</a>
<a name="ln2204"> </a>
<a name="ln2205">      clefType_ = ClefType::Treble;</a>
<a name="ln2206">      }</a>
<a name="ln2207"> </a>
<a name="ln2208">void Clef::setClefType(int type) {</a>
<a name="ln2209">      clefType_ = (ClefType) type;</a>
<a name="ln2210">      }</a>
<a name="ln2211"> </a>
<a name="ln2212">ClefType Clef::getClefType() const {</a>
<a name="ln2213">      return clefType_;</a>
<a name="ln2214">      }</a>
<a name="ln2215"> </a>
<a name="ln2216">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2217">Lyric::Lyric() {</a>
<a name="ln2218">      musicDataType_ = MusicDataType::Lyric;</a>
<a name="ln2219"> </a>
<a name="ln2220">      lyric_ = QString();</a>
<a name="ln2221">      verse_ = 0;</a>
<a name="ln2222">      }</a>
<a name="ln2223"> </a>
<a name="ln2224">void Lyric::setLyric(const QString&amp; lyricText) {</a>
<a name="ln2225">      lyric_ = lyricText;</a>
<a name="ln2226">      }</a>
<a name="ln2227"> </a>
<a name="ln2228">QString Lyric::getLyric() const {</a>
<a name="ln2229">      return lyric_;</a>
<a name="ln2230">      }</a>
<a name="ln2231"> </a>
<a name="ln2232">void Lyric::setVerse(int verse) {</a>
<a name="ln2233">      verse_ = verse;</a>
<a name="ln2234">      }</a>
<a name="ln2235"> </a>
<a name="ln2236">int Lyric::getVerse() const {</a>
<a name="ln2237">      return verse_;</a>
<a name="ln2238">      }</a>
<a name="ln2239"> </a>
<a name="ln2240">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2241">Slur::Slur() {</a>
<a name="ln2242">      musicDataType_ = MusicDataType::Slur;</a>
<a name="ln2243"> </a>
<a name="ln2244">      containerCount_ = 1;</a>
<a name="ln2245">      showOnTop_ = true;</a>
<a name="ln2246">      noteTimePercent_ = 100;</a>
<a name="ln2247"> </a>
<a name="ln2248">      handle_2_ = new OffsetElement();</a>
<a name="ln2249">      handle_3_ = new OffsetElement();</a>
<a name="ln2250">      }</a>
<a name="ln2251"> </a>
<a name="ln2252">Slur::~Slur() {</a>
<a name="ln2253">      delete handle_2_;</a>
<a name="ln2254">      delete handle_3_;</a>
<a name="ln2255">      }</a>
<a name="ln2256"> </a>
<a name="ln2257">void Slur::setContainerCount(int count) {</a>
<a name="ln2258">      containerCount_ = count;</a>
<a name="ln2259">      }</a>
<a name="ln2260"> </a>
<a name="ln2261">int Slur::getContainerCount() const {</a>
<a name="ln2262">      return containerCount_;</a>
<a name="ln2263">      }</a>
<a name="ln2264"> </a>
<a name="ln2265">void Slur::setShowOnTop(bool top) {</a>
<a name="ln2266">      showOnTop_ = top;</a>
<a name="ln2267">      }</a>
<a name="ln2268"> </a>
<a name="ln2269">bool Slur::getShowOnTop() const {</a>
<a name="ln2270">      return showOnTop_;</a>
<a name="ln2271">      }</a>
<a name="ln2272"> </a>
<a name="ln2273">OffsetElement* Slur::getHandle2() const {</a>
<a name="ln2274">      return handle_2_;</a>
<a name="ln2275">      }</a>
<a name="ln2276"> </a>
<a name="ln2277">OffsetElement* Slur::getHandle3() const {</a>
<a name="ln2278">      return handle_3_;</a>
<a name="ln2279">      }</a>
<a name="ln2280"> </a>
<a name="ln2281">void Slur::setNoteTimePercent(int percent) {</a>
<a name="ln2282">      noteTimePercent_ = percent;</a>
<a name="ln2283">      }</a>
<a name="ln2284"> </a>
<a name="ln2285">int Slur::getNoteTimePercent() const {</a>
<a name="ln2286">      return noteTimePercent_;</a>
<a name="ln2287">      }</a>
<a name="ln2288"> </a>
<a name="ln2289">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2290">Dynamics::Dynamics() {</a>
<a name="ln2291">      musicDataType_ = MusicDataType::Dynamics;</a>
<a name="ln2292"> </a>
<a name="ln2293">      dynamicsType_ = DynamicsType::PPPP;</a>
<a name="ln2294">      playback_ = true;</a>
<a name="ln2295">      velocity_ = 30;</a>
<a name="ln2296">      }</a>
<a name="ln2297"> </a>
<a name="ln2298">void Dynamics::setDynamicsType(int type) {</a>
<a name="ln2299">      dynamicsType_ = DynamicsType(type);</a>
<a name="ln2300">      }</a>
<a name="ln2301"> </a>
<a name="ln2302">DynamicsType Dynamics::getDynamicsType() const {</a>
<a name="ln2303">      return dynamicsType_;</a>
<a name="ln2304">      }</a>
<a name="ln2305"> </a>
<a name="ln2306">void Dynamics::setIsPlayback(bool play) {</a>
<a name="ln2307">      playback_ = play;</a>
<a name="ln2308">      }</a>
<a name="ln2309"> </a>
<a name="ln2310">bool Dynamics::getIsPlayback() const {</a>
<a name="ln2311">      return playback_;</a>
<a name="ln2312">      }</a>
<a name="ln2313"> </a>
<a name="ln2314">void Dynamics::setVelocity(int vel) {</a>
<a name="ln2315">      velocity_ = vel;</a>
<a name="ln2316">      }</a>
<a name="ln2317"> </a>
<a name="ln2318">int Dynamics::getVelocity() const {</a>
<a name="ln2319">      return velocity_;</a>
<a name="ln2320">      }</a>
<a name="ln2321"> </a>
<a name="ln2322">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2323">WedgeEndPoint::WedgeEndPoint() {</a>
<a name="ln2324">      musicDataType_ = MusicDataType::Wedge_EndPoint;</a>
<a name="ln2325"> </a>
<a name="ln2326">      wedgeType_ = WedgeType::Cres;</a>
<a name="ln2327">      height_ = 24;</a>
<a name="ln2328">      wedgeStart_ = true;</a>
<a name="ln2329">      }</a>
<a name="ln2330"> </a>
<a name="ln2331">void WedgeEndPoint::setWedgeType(WedgeType type) {</a>
<a name="ln2332">      wedgeType_ = type;</a>
<a name="ln2333">      }</a>
<a name="ln2334"> </a>
<a name="ln2335">WedgeType WedgeEndPoint::getWedgeType() const {</a>
<a name="ln2336">      return wedgeType_;</a>
<a name="ln2337">      }</a>
<a name="ln2338"> </a>
<a name="ln2339">void WedgeEndPoint::setHeight(int height) {</a>
<a name="ln2340">      height_ = height;</a>
<a name="ln2341">      }</a>
<a name="ln2342"> </a>
<a name="ln2343">int WedgeEndPoint::getHeight() const {</a>
<a name="ln2344">      return height_;</a>
<a name="ln2345">      }</a>
<a name="ln2346"> </a>
<a name="ln2347">void WedgeEndPoint::setWedgeStart(bool wedgeStart) {</a>
<a name="ln2348">      wedgeStart_ = wedgeStart;</a>
<a name="ln2349">      }</a>
<a name="ln2350"> </a>
<a name="ln2351">bool WedgeEndPoint::getWedgeStart() const {</a>
<a name="ln2352">      return wedgeStart_;</a>
<a name="ln2353">      }</a>
<a name="ln2354"> </a>
<a name="ln2355">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2356">Wedge::Wedge() {</a>
<a name="ln2357">      musicDataType_ = MusicDataType::Wedge;</a>
<a name="ln2358"> </a>
<a name="ln2359">      wedgeType_ = WedgeType::Cres;</a>
<a name="ln2360">      height_ = 24;</a>
<a name="ln2361">      }</a>
<a name="ln2362"> </a>
<a name="ln2363">void Wedge::setWedgeType(WedgeType type) {</a>
<a name="ln2364">      wedgeType_ = type;</a>
<a name="ln2365">      }</a>
<a name="ln2366"> </a>
<a name="ln2367">WedgeType Wedge::getWedgeType() const {</a>
<a name="ln2368">      return wedgeType_;</a>
<a name="ln2369">      }</a>
<a name="ln2370"> </a>
<a name="ln2371">void Wedge::setHeight(int height) {</a>
<a name="ln2372">      height_ = height;</a>
<a name="ln2373">      }</a>
<a name="ln2374"> </a>
<a name="ln2375">int Wedge::getHeight() const {</a>
<a name="ln2376">      return height_;</a>
<a name="ln2377">      }</a>
<a name="ln2378"> </a>
<a name="ln2379">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2380">Pedal::Pedal() {</a>
<a name="ln2381">      musicDataType_ = MusicDataType::Pedal;</a>
<a name="ln2382"> </a>
<a name="ln2383">      half_ = false;</a>
<a name="ln2384">      playback_ = false;</a>
<a name="ln2385">      playOffset_ = 0;</a>
<a name="ln2386"> </a>
<a name="ln2387">      pedalHandle_ = new OffsetElement();</a>
<a name="ln2388">      }</a>
<a name="ln2389"> </a>
<a name="ln2390">Pedal::~Pedal() {</a>
<a name="ln2391">      delete pedalHandle_;</a>
<a name="ln2392">      }</a>
<a name="ln2393"> </a>
<a name="ln2394">void Pedal::setHalf(bool half) {</a>
<a name="ln2395">      half_ = half;</a>
<a name="ln2396">      }</a>
<a name="ln2397"> </a>
<a name="ln2398">bool Pedal::getHalf() const {</a>
<a name="ln2399">      return half_;</a>
<a name="ln2400">      }</a>
<a name="ln2401"> </a>
<a name="ln2402">OffsetElement* Pedal::getPedalHandle() const {</a>
<a name="ln2403">      return pedalHandle_;</a>
<a name="ln2404">      }</a>
<a name="ln2405"> </a>
<a name="ln2406">void Pedal::setIsPlayback(bool playback) {</a>
<a name="ln2407">      playback_ = playback;</a>
<a name="ln2408">      }</a>
<a name="ln2409"> </a>
<a name="ln2410">bool Pedal::getIsPlayback() const {</a>
<a name="ln2411">      return playback_;</a>
<a name="ln2412">      }</a>
<a name="ln2413"> </a>
<a name="ln2414">void Pedal::setPlayOffset(int offset) {</a>
<a name="ln2415">      playOffset_ = offset;</a>
<a name="ln2416">      }</a>
<a name="ln2417"> </a>
<a name="ln2418">int Pedal::getPlayOffset() const {</a>
<a name="ln2419">      return playOffset_;</a>
<a name="ln2420">      }</a>
<a name="ln2421"> </a>
<a name="ln2422">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2423">KuoHao::KuoHao() {</a>
<a name="ln2424">      musicDataType_ = MusicDataType::KuoHao;</a>
<a name="ln2425"> </a>
<a name="ln2426">      kuohaoType_ = KuoHaoType::Parentheses;</a>
<a name="ln2427">      height_ = 0;</a>
<a name="ln2428">      }</a>
<a name="ln2429"> </a>
<a name="ln2430">void KuoHao::setHeight(int height) {</a>
<a name="ln2431">      height_ = height;</a>
<a name="ln2432">      }</a>
<a name="ln2433"> </a>
<a name="ln2434">int KuoHao::getHeight() const {</a>
<a name="ln2435">      return height_;</a>
<a name="ln2436">      }</a>
<a name="ln2437"> </a>
<a name="ln2438">void KuoHao::setKuohaoType(int type) {</a>
<a name="ln2439">      kuohaoType_ = (KuoHaoType) type;</a>
<a name="ln2440">      }</a>
<a name="ln2441"> </a>
<a name="ln2442">KuoHaoType KuoHao::getKuohaoType() const {</a>
<a name="ln2443">      return kuohaoType_;</a>
<a name="ln2444">      }</a>
<a name="ln2445"> </a>
<a name="ln2446">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2447">Expressions::Expressions() {</a>
<a name="ln2448">      musicDataType_ = MusicDataType::Expressions;</a>
<a name="ln2449"> </a>
<a name="ln2450">      text_ = QString();</a>
<a name="ln2451">      }</a>
<a name="ln2452"> </a>
<a name="ln2453">void Expressions::setText(const QString&amp; str) {</a>
<a name="ln2454">      text_ = str;</a>
<a name="ln2455">      }</a>
<a name="ln2456"> </a>
<a name="ln2457">QString Expressions::getText() const {</a>
<a name="ln2458">      return text_;</a>
<a name="ln2459">      }</a>
<a name="ln2460"> </a>
<a name="ln2461">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2462">HarpPedal::HarpPedal() :</a>
<a name="ln2463">      showType_(0),</a>
<a name="ln2464">      showCharFlag_(0) {</a>
<a name="ln2465">      musicDataType_ = MusicDataType::Harp_Pedal;</a>
<a name="ln2466">      }</a>
<a name="ln2467"> </a>
<a name="ln2468">void HarpPedal::setShowType(int type) {</a>
<a name="ln2469">      showType_ = type;</a>
<a name="ln2470">      }</a>
<a name="ln2471"> </a>
<a name="ln2472">int HarpPedal::getShowType() const {</a>
<a name="ln2473">      return showType_;</a>
<a name="ln2474">      }</a>
<a name="ln2475"> </a>
<a name="ln2476">void HarpPedal::setShowCharFlag(int flag) {</a>
<a name="ln2477">      showCharFlag_ = flag;</a>
<a name="ln2478">      }</a>
<a name="ln2479"> </a>
<a name="ln2480">int HarpPedal::getShowCharFlag() const {</a>
<a name="ln2481">      return showCharFlag_;</a>
<a name="ln2482">      }</a>
<a name="ln2483"> </a>
<a name="ln2484">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2485">OctaveShift::OctaveShift() :</a>
<a name="ln2486">      octaveShiftType_(OctaveShiftType::OS_8),</a>
<a name="ln2487">      octaveShiftPosition_(OctaveShiftPosition::Start),</a>
<a name="ln2488">      endTick_(0) {</a>
<a name="ln2489">      musicDataType_ = MusicDataType::OctaveShift;</a>
<a name="ln2490">      }</a>
<a name="ln2491"> </a>
<a name="ln2492">void OctaveShift::setOctaveShiftType(OctaveShiftType type) {</a>
<a name="ln2493">      octaveShiftType_ = type;</a>
<a name="ln2494">      }</a>
<a name="ln2495"> </a>
<a name="ln2496">OctaveShiftType OctaveShift::getOctaveShiftType() const {</a>
<a name="ln2497">      return octaveShiftType_;</a>
<a name="ln2498">      }</a>
<a name="ln2499"> </a>
<a name="ln2500">int OctaveShift::getNoteShift() const {</a>
<a name="ln2501">      int shift = 12;</a>
<a name="ln2502"> </a>
<a name="ln2503">      switch (getOctaveShiftType()) {</a>
<a name="ln2504">            case OctaveShiftType::OS_8: {</a>
<a name="ln2505">                  shift = 12;</a>
<a name="ln2506">                  break;</a>
<a name="ln2507">                  }</a>
<a name="ln2508">            case OctaveShiftType::OS_Minus_8: {</a>
<a name="ln2509">                  shift = -12;</a>
<a name="ln2510">                  break;</a>
<a name="ln2511">                  }</a>
<a name="ln2512">            case OctaveShiftType::OS_15: {</a>
<a name="ln2513">                  shift = 24;</a>
<a name="ln2514">                  break;</a>
<a name="ln2515">                  }</a>
<a name="ln2516">            case OctaveShiftType::OS_Minus_15: {</a>
<a name="ln2517">                  shift = -24;</a>
<a name="ln2518">                  break;</a>
<a name="ln2519">                  }</a>
<a name="ln2520">            default:</a>
<a name="ln2521">                  break;</a>
<a name="ln2522">            }</a>
<a name="ln2523"> </a>
<a name="ln2524">      return shift;</a>
<a name="ln2525">      }</a>
<a name="ln2526"> </a>
<a name="ln2527">void OctaveShift::setEndTick(int tick) {</a>
<a name="ln2528">      endTick_ = tick;</a>
<a name="ln2529">      }</a>
<a name="ln2530"> </a>
<a name="ln2531">int OctaveShift::getEndTick() const {</a>
<a name="ln2532">      return endTick_;</a>
<a name="ln2533">      }</a>
<a name="ln2534"> </a>
<a name="ln2535">void OctaveShift::setOctaveShiftPosition(OctaveShiftPosition position) {</a>
<a name="ln2536">      octaveShiftPosition_ = position;</a>
<a name="ln2537">      }</a>
<a name="ln2538"> </a>
<a name="ln2539">OctaveShiftPosition OctaveShift::getOctaveShiftPosition() const {</a>
<a name="ln2540">      return octaveShiftPosition_;</a>
<a name="ln2541">      }</a>
<a name="ln2542"> </a>
<a name="ln2543">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2544">OctaveShiftEndPoint::OctaveShiftEndPoint() {</a>
<a name="ln2545">      musicDataType_ = MusicDataType::OctaveShift_EndPoint;</a>
<a name="ln2546"> </a>
<a name="ln2547">      octaveShiftType_ = OctaveShiftType::OS_8;</a>
<a name="ln2548">      octaveShiftPosition_ = OctaveShiftPosition::Start;</a>
<a name="ln2549">      endTick_ = 0;</a>
<a name="ln2550">      }</a>
<a name="ln2551"> </a>
<a name="ln2552">void OctaveShiftEndPoint::setOctaveShiftType(OctaveShiftType type) {</a>
<a name="ln2553">      octaveShiftType_ = type;</a>
<a name="ln2554">      }</a>
<a name="ln2555"> </a>
<a name="ln2556">OctaveShiftType OctaveShiftEndPoint::getOctaveShiftType() const {</a>
<a name="ln2557">      return octaveShiftType_;</a>
<a name="ln2558">      }</a>
<a name="ln2559"> </a>
<a name="ln2560">void OctaveShiftEndPoint::setOctaveShiftPosition(OctaveShiftPosition position) {</a>
<a name="ln2561">      octaveShiftPosition_ = position;</a>
<a name="ln2562">      }</a>
<a name="ln2563"> </a>
<a name="ln2564">OctaveShiftPosition OctaveShiftEndPoint::getOctaveShiftPosition() const {</a>
<a name="ln2565">      return octaveShiftPosition_;</a>
<a name="ln2566">      }</a>
<a name="ln2567"> </a>
<a name="ln2568">void OctaveShiftEndPoint::setEndTick(int tick) {</a>
<a name="ln2569">      endTick_ = tick;</a>
<a name="ln2570">      }</a>
<a name="ln2571"> </a>
<a name="ln2572">int OctaveShiftEndPoint::getEndTick() const {</a>
<a name="ln2573">      return endTick_;</a>
<a name="ln2574">      }</a>
<a name="ln2575"> </a>
<a name="ln2576">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2577">MultiMeasureRest::MultiMeasureRest() {</a>
<a name="ln2578">      musicDataType_ = MusicDataType::Multi_Measure_Rest;</a>
<a name="ln2579">      measureCount_ = 0;</a>
<a name="ln2580">      }</a>
<a name="ln2581"> </a>
<a name="ln2582">void MultiMeasureRest::setMeasureCount(int count) {</a>
<a name="ln2583">      measureCount_ = count;</a>
<a name="ln2584">      }</a>
<a name="ln2585"> </a>
<a name="ln2586">int MultiMeasureRest::getMeasureCount() const {</a>
<a name="ln2587">      return measureCount_;</a>
<a name="ln2588">      }</a>
<a name="ln2589"> </a>
<a name="ln2590">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2591">Tempo::Tempo() {</a>
<a name="ln2592">      musicDataType_ = MusicDataType::Tempo;</a>
<a name="ln2593"> </a>
<a name="ln2594">      leftNoteType_ = 3;</a>
<a name="ln2595">      showMark_ = false;</a>
<a name="ln2596">      showText_ = false;</a>
<a name="ln2597">      showParenthesis_ = false;</a>
<a name="ln2598">      typeTempo_ = 96;</a>
<a name="ln2599">      leftText_ = QString();</a>
<a name="ln2600">      rightText_ = QString();</a>
<a name="ln2601">      swingEighth_ = false;</a>
<a name="ln2602">      rightNoteType_ = 3;</a>
<a name="ln2603">      leftNoteDot_ = false;</a>
<a name="ln2604">      rightNoteDot_ = false;</a>
<a name="ln2605">      rightSideType_ = 0;</a>
<a name="ln2606">      }</a>
<a name="ln2607"> </a>
<a name="ln2608">void Tempo::setLeftNoteType(int type) {</a>
<a name="ln2609">      leftNoteType_ = type;</a>
<a name="ln2610">      }</a>
<a name="ln2611"> </a>
<a name="ln2612">NoteType Tempo::getLeftNoteType() const {</a>
<a name="ln2613">      return (NoteType) leftNoteType_;</a>
<a name="ln2614">      }</a>
<a name="ln2615"> </a>
<a name="ln2616">void Tempo::setShowMark(bool show) {</a>
<a name="ln2617">      showMark_ = show;</a>
<a name="ln2618">      }</a>
<a name="ln2619"> </a>
<a name="ln2620">bool Tempo::getShowMark() const {</a>
<a name="ln2621">      return showMark_;</a>
<a name="ln2622">      }</a>
<a name="ln2623"> </a>
<a name="ln2624">void Tempo::setShowBeforeText(bool show) {</a>
<a name="ln2625">      showText_ = show;</a>
<a name="ln2626">      }</a>
<a name="ln2627"> </a>
<a name="ln2628">bool Tempo::getShowBeforeText() const {</a>
<a name="ln2629">      return showText_;</a>
<a name="ln2630">      }</a>
<a name="ln2631"> </a>
<a name="ln2632">void Tempo::setShowParenthesis(bool show) {</a>
<a name="ln2633">      showParenthesis_ = show;</a>
<a name="ln2634">      }</a>
<a name="ln2635"> </a>
<a name="ln2636">bool Tempo::getShowParenthesis() const {</a>
<a name="ln2637">      return showParenthesis_;</a>
<a name="ln2638">      }</a>
<a name="ln2639"> </a>
<a name="ln2640">void Tempo::setTypeTempo(double tempo) {</a>
<a name="ln2641">      typeTempo_ = tempo;</a>
<a name="ln2642">      }</a>
<a name="ln2643"> </a>
<a name="ln2644">double Tempo::getTypeTempo() const {</a>
<a name="ln2645">      return typeTempo_;</a>
<a name="ln2646">      }</a>
<a name="ln2647"> </a>
<a name="ln2648">double Tempo::getQuarterTempo() const {</a>
<a name="ln2649">      double factor = pow(2.0, int(NoteType::Note_Quarter) - int(getLeftNoteType()));</a>
<a name="ln2650">      if (getLeftNoteDot())</a>
<a name="ln2651">            factor *= 3.0/2.0;</a>
<a name="ln2652">      double tempo = getTypeTempo() * factor;</a>
<a name="ln2653"> </a>
<a name="ln2654">      return tempo;</a>
<a name="ln2655">      }</a>
<a name="ln2656"> </a>
<a name="ln2657">void Tempo::setLeftText(const QString&amp; str) {</a>
<a name="ln2658">      leftText_ = str;</a>
<a name="ln2659">      }</a>
<a name="ln2660"> </a>
<a name="ln2661">QString Tempo::getLeftText() const {</a>
<a name="ln2662">      return leftText_;</a>
<a name="ln2663">      }</a>
<a name="ln2664"> </a>
<a name="ln2665">void Tempo::setRightText(const QString&amp; str) {</a>
<a name="ln2666">      rightText_ = str;</a>
<a name="ln2667">      }</a>
<a name="ln2668"> </a>
<a name="ln2669">QString Tempo::getRightText() const {</a>
<a name="ln2670">      return rightText_;</a>
<a name="ln2671">      }</a>
<a name="ln2672"> </a>
<a name="ln2673">void Tempo::setSwingEighth(bool swing) {</a>
<a name="ln2674">      swingEighth_ = swing;</a>
<a name="ln2675">      }</a>
<a name="ln2676"> </a>
<a name="ln2677">bool Tempo::getSwingEighth() const {</a>
<a name="ln2678">      return swingEighth_;</a>
<a name="ln2679">      }</a>
<a name="ln2680"> </a>
<a name="ln2681">void Tempo::setRightNoteType(int type) {</a>
<a name="ln2682">      rightNoteType_ = type;</a>
<a name="ln2683">      }</a>
<a name="ln2684"> </a>
<a name="ln2685">NoteType Tempo::getRightNoteType() const {</a>
<a name="ln2686">      return (NoteType) rightNoteType_;</a>
<a name="ln2687">      }</a>
<a name="ln2688"> </a>
<a name="ln2689">void Tempo::setLeftNoteDot(bool showDot) {</a>
<a name="ln2690">      leftNoteDot_ = showDot;</a>
<a name="ln2691">      }</a>
<a name="ln2692"> </a>
<a name="ln2693">bool Tempo::getLeftNoteDot() const {</a>
<a name="ln2694">      return leftNoteDot_;</a>
<a name="ln2695">      }</a>
<a name="ln2696"> </a>
<a name="ln2697">void Tempo::setRightNoteDot(bool showDot) {</a>
<a name="ln2698">      rightNoteDot_ = showDot;</a>
<a name="ln2699">      }</a>
<a name="ln2700"> </a>
<a name="ln2701">bool Tempo::getRightNoteDot() const {</a>
<a name="ln2702">      return rightNoteDot_;</a>
<a name="ln2703">      }</a>
<a name="ln2704"> </a>
<a name="ln2705">void Tempo::setRightSideType(int type) {</a>
<a name="ln2706">      rightSideType_ = type;</a>
<a name="ln2707">      }</a>
<a name="ln2708"> </a>
<a name="ln2709">int Tempo::getRightSideType() const {</a>
<a name="ln2710">      return rightSideType_;</a>
<a name="ln2711">      }</a>
<a name="ln2712"> </a>
<a name="ln2713">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2714">Text::Text() {</a>
<a name="ln2715">      musicDataType_ = MusicDataType::Text;</a>
<a name="ln2716"> </a>
<a name="ln2717">      textType_ = Type::Rehearsal;</a>
<a name="ln2718">      horiMargin_ = 8;</a>
<a name="ln2719">      vertMargin_ = 8;</a>
<a name="ln2720">      lineThick_ = 4;</a>
<a name="ln2721">      text_ = QString();</a>
<a name="ln2722">      width_ = 0;</a>
<a name="ln2723">      height_ = 0;</a>
<a name="ln2724">      }</a>
<a name="ln2725"> </a>
<a name="ln2726">void Text::setTextType(Type type) {</a>
<a name="ln2727">      textType_ = type;</a>
<a name="ln2728">      }</a>
<a name="ln2729"> </a>
<a name="ln2730">Text::Type Text::getTextType() const {</a>
<a name="ln2731">      return textType_;</a>
<a name="ln2732">      }</a>
<a name="ln2733"> </a>
<a name="ln2734">void Text::setHorizontalMargin(int margin) {</a>
<a name="ln2735">      horiMargin_ = margin;</a>
<a name="ln2736">      }</a>
<a name="ln2737"> </a>
<a name="ln2738">int Text::getHorizontalMargin() const {</a>
<a name="ln2739">      return horiMargin_;</a>
<a name="ln2740">      }</a>
<a name="ln2741"> </a>
<a name="ln2742">void Text::setVerticalMargin(int margin) {</a>
<a name="ln2743">      vertMargin_ = margin;</a>
<a name="ln2744">      }</a>
<a name="ln2745"> </a>
<a name="ln2746">int Text::getVerticalMargin() const {</a>
<a name="ln2747">      return vertMargin_;</a>
<a name="ln2748">      }</a>
<a name="ln2749"> </a>
<a name="ln2750">void Text::setLineThick(int thick) {</a>
<a name="ln2751">      lineThick_ = thick;</a>
<a name="ln2752">      }</a>
<a name="ln2753"> </a>
<a name="ln2754">int Text::getLineThick() const {</a>
<a name="ln2755">      return lineThick_;</a>
<a name="ln2756">      }</a>
<a name="ln2757"> </a>
<a name="ln2758">void Text::setText(const QString&amp; text) {</a>
<a name="ln2759">      text_ = text;</a>
<a name="ln2760">      }</a>
<a name="ln2761"> </a>
<a name="ln2762">QString Text::getText() const {</a>
<a name="ln2763">      return text_;</a>
<a name="ln2764">      }</a>
<a name="ln2765"> </a>
<a name="ln2766">void Text::setWidth(int width) {</a>
<a name="ln2767">      width_ = width;</a>
<a name="ln2768">      }</a>
<a name="ln2769"> </a>
<a name="ln2770">int Text::getWidth() const {</a>
<a name="ln2771">      return width_;</a>
<a name="ln2772">      }</a>
<a name="ln2773"> </a>
<a name="ln2774">void Text::setHeight(int height) {</a>
<a name="ln2775">      height_ = height;</a>
<a name="ln2776">      }</a>
<a name="ln2777"> </a>
<a name="ln2778">int Text::getHeight() const {</a>
<a name="ln2779">      return height_;</a>
<a name="ln2780">      }</a>
<a name="ln2781"> </a>
<a name="ln2782">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2783">TimeSignature::TimeSignature() {</a>
<a name="ln2784">      numerator_ = 4;</a>
<a name="ln2785">      denominator_ = 4;</a>
<a name="ln2786">      isSymbol_ = false;</a>
<a name="ln2787">      beatLength_ = 480;</a>
<a name="ln2788">      barLength_ = 1920;</a>
<a name="ln2789">      barLengthUnits_ = 0x400;</a>
<a name="ln2790">      replaceFont_ = false;</a>
<a name="ln2791">      showBeatGroup_ = false;</a>
<a name="ln2792"> </a>
<a name="ln2793">      groupNumerator1_ = 0;</a>
<a name="ln2794">      groupNumerator2_ = 0;</a>
<a name="ln2795">      groupNumerator3_ = 0;</a>
<a name="ln2796">      groupDenominator1_ = 4;</a>
<a name="ln2797">      groupDenominator2_ = 4;</a>
<a name="ln2798">      groupDenominator3_ = 4;</a>
<a name="ln2799"> </a>
<a name="ln2800">      beamGroup1_ = 4;</a>
<a name="ln2801">      beamGroup2_ = 0;</a>
<a name="ln2802">      beamGroup3_ = 0;</a>
<a name="ln2803">      beamGroup4_ = 0;</a>
<a name="ln2804"> </a>
<a name="ln2805">      beamCount16th_ = 4;</a>
<a name="ln2806">      beamCount32th_ = 1;</a>
<a name="ln2807">      }</a>
<a name="ln2808"> </a>
<a name="ln2809">void TimeSignature::setNumerator(int numerator) {</a>
<a name="ln2810">      numerator_ = numerator;</a>
<a name="ln2811">      }</a>
<a name="ln2812"> </a>
<a name="ln2813">int TimeSignature::getNumerator() const {</a>
<a name="ln2814">      return numerator_;</a>
<a name="ln2815">      }</a>
<a name="ln2816"> </a>
<a name="ln2817">void TimeSignature::setDenominator(int denominator) {</a>
<a name="ln2818">      denominator_ = denominator;</a>
<a name="ln2819">      }</a>
<a name="ln2820"> </a>
<a name="ln2821">int TimeSignature::getDenominator() const {</a>
<a name="ln2822">      return denominator_;</a>
<a name="ln2823">      }</a>
<a name="ln2824"> </a>
<a name="ln2825">void TimeSignature::setIsSymbol(bool symbol) {</a>
<a name="ln2826">      isSymbol_ = symbol;</a>
<a name="ln2827">      }</a>
<a name="ln2828"> </a>
<a name="ln2829">bool TimeSignature::getIsSymbol() const {</a>
<a name="ln2830">      if (numerator_ == 2 &amp;&amp; denominator_ == 2) {</a>
<a name="ln2831">            return true;</a>
<a name="ln2832">            }</a>
<a name="ln2833"> </a>
<a name="ln2834">      return isSymbol_;</a>
<a name="ln2835">      }</a>
<a name="ln2836"> </a>
<a name="ln2837">void TimeSignature::setBeatLength(int length) {</a>
<a name="ln2838">      beatLength_ = length;</a>
<a name="ln2839">      }</a>
<a name="ln2840"> </a>
<a name="ln2841">int TimeSignature::getBeatLength() const {</a>
<a name="ln2842">      return beatLength_;</a>
<a name="ln2843">      }</a>
<a name="ln2844"> </a>
<a name="ln2845">void TimeSignature::setBarLength(int length) {</a>
<a name="ln2846">      barLength_ = length;</a>
<a name="ln2847">      }</a>
<a name="ln2848"> </a>
<a name="ln2849">int TimeSignature::getBarLength() const {</a>
<a name="ln2850">      return barLength_;</a>
<a name="ln2851">      }</a>
<a name="ln2852"> </a>
<a name="ln2853">void TimeSignature::addBeat(int startUnit, int lengthUnit, int startTick) {</a>
<a name="ln2854">      BeatNode node;</a>
<a name="ln2855">      node.startUnit_ = startUnit;</a>
<a name="ln2856">      node.lengthUnit_ = lengthUnit;</a>
<a name="ln2857">      node.startTick_ = startTick;</a>
<a name="ln2858">      beats_.push_back(node);</a>
<a name="ln2859">      }</a>
<a name="ln2860"> </a>
<a name="ln2861">void TimeSignature::endAddBeat() {</a>
<a name="ln2862">      int i;</a>
<a name="ln2863">      barLengthUnits_ = 0;</a>
<a name="ln2864"> </a>
<a name="ln2865">      for (i = 0; i &lt; beats_.size(); ++i) {</a>
<a name="ln2866">            barLengthUnits_ += beats_[i].lengthUnit_;</a>
<a name="ln2867">            }</a>
<a name="ln2868">      }</a>
<a name="ln2869"> </a>
<a name="ln2870">int TimeSignature::getUnits() const {</a>
<a name="ln2871">      return barLengthUnits_;</a>
<a name="ln2872">      }</a>
<a name="ln2873"> </a>
<a name="ln2874">void TimeSignature::setReplaceFont(bool replace) {</a>
<a name="ln2875">      replaceFont_ = replace;</a>
<a name="ln2876">      }</a>
<a name="ln2877"> </a>
<a name="ln2878">bool TimeSignature::getReplaceFont() const {</a>
<a name="ln2879">      return replaceFont_;</a>
<a name="ln2880">      }</a>
<a name="ln2881"> </a>
<a name="ln2882">void TimeSignature::setShowBeatGroup(bool show) {</a>
<a name="ln2883">      showBeatGroup_ = show;</a>
<a name="ln2884">      }</a>
<a name="ln2885"> </a>
<a name="ln2886">bool TimeSignature::getShowBeatGroup() const {</a>
<a name="ln2887">      return showBeatGroup_;</a>
<a name="ln2888">      }</a>
<a name="ln2889"> </a>
<a name="ln2890">void TimeSignature::setGroupNumerator1(int numerator) {</a>
<a name="ln2891">      groupNumerator1_ = numerator;</a>
<a name="ln2892">      }</a>
<a name="ln2893"> </a>
<a name="ln2894">void TimeSignature::setGroupNumerator2(int numerator) {</a>
<a name="ln2895">      groupNumerator2_ = numerator;</a>
<a name="ln2896">      }</a>
<a name="ln2897"> </a>
<a name="ln2898">void TimeSignature::setGroupNumerator3(int numerator) {</a>
<a name="ln2899">      groupNumerator3_ = numerator;</a>
<a name="ln2900">      }</a>
<a name="ln2901"> </a>
<a name="ln2902">void TimeSignature::setGroupDenominator1(int denominator) {</a>
<a name="ln2903">      groupDenominator1_ = denominator;</a>
<a name="ln2904">      }</a>
<a name="ln2905"> </a>
<a name="ln2906">void TimeSignature::setGroupDenominator2(int denominator) {</a>
<a name="ln2907">      groupDenominator2_ = denominator;</a>
<a name="ln2908">      }</a>
<a name="ln2909"> </a>
<a name="ln2910">void TimeSignature::setGroupDenominator3(int denominator) {</a>
<a name="ln2911">      groupDenominator3_ = denominator;</a>
<a name="ln2912">      }</a>
<a name="ln2913"> </a>
<a name="ln2914">void TimeSignature::setBeamGroup1(int count) {</a>
<a name="ln2915">      beamGroup1_ = count;</a>
<a name="ln2916">      }</a>
<a name="ln2917"> </a>
<a name="ln2918">void TimeSignature::setBeamGroup2(int count) {</a>
<a name="ln2919">      beamGroup2_ = count;</a>
<a name="ln2920">      }</a>
<a name="ln2921"> </a>
<a name="ln2922">void TimeSignature::setBeamGroup3(int count) {</a>
<a name="ln2923">      beamGroup3_ = count;</a>
<a name="ln2924">      }</a>
<a name="ln2925"> </a>
<a name="ln2926">void TimeSignature::setBeamGroup4(int count) {</a>
<a name="ln2927">      beamGroup4_ = count;</a>
<a name="ln2928">      }</a>
<a name="ln2929"> </a>
<a name="ln2930">void TimeSignature::set16thBeamCount(int count) {</a>
<a name="ln2931">      beamCount16th_ = count;</a>
<a name="ln2932">      }</a>
<a name="ln2933"> </a>
<a name="ln2934">void TimeSignature::set32thBeamCount(int count) {</a>
<a name="ln2935">      beamCount32th_ = count;</a>
<a name="ln2936">      }</a>
<a name="ln2937"> </a>
<a name="ln2938">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2939">Key::Key() {</a>
<a name="ln2940">      key_ = 0;</a>
<a name="ln2941">      set_ = false;</a>
<a name="ln2942">      previousKey_ = 0;</a>
<a name="ln2943">      symbolCount_ = 0;</a>
<a name="ln2944">      }</a>
<a name="ln2945"> </a>
<a name="ln2946">void Key::setKey(int key) {</a>
<a name="ln2947">      key_ = key;</a>
<a name="ln2948">      set_ = true;</a>
<a name="ln2949">      }</a>
<a name="ln2950"> </a>
<a name="ln2951">int Key::getKey() const {</a>
<a name="ln2952">      return key_;</a>
<a name="ln2953">      }</a>
<a name="ln2954"> </a>
<a name="ln2955">bool Key::getSetKey() const {</a>
<a name="ln2956">      return set_;</a>
<a name="ln2957">      }</a>
<a name="ln2958"> </a>
<a name="ln2959">void Key::setPreviousKey(int key) {</a>
<a name="ln2960">      previousKey_ = key;</a>
<a name="ln2961">      }</a>
<a name="ln2962"> </a>
<a name="ln2963">int Key::getPreviousKey() const {</a>
<a name="ln2964">      return previousKey_;</a>
<a name="ln2965">      }</a>
<a name="ln2966"> </a>
<a name="ln2967">void Key::setSymbolCount(int count) {</a>
<a name="ln2968">      symbolCount_ = count;</a>
<a name="ln2969">      }</a>
<a name="ln2970"> </a>
<a name="ln2971">int Key::getSymbolCount() const {</a>
<a name="ln2972">      return symbolCount_;</a>
<a name="ln2973">      }</a>
<a name="ln2974"> </a>
<a name="ln2975">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2976">RepeatSymbol::RepeatSymbol() :</a>
<a name="ln2977">      text_(&quot;#1&quot;), repeatType_(RepeatType::Segno) {</a>
<a name="ln2978">      musicDataType_ = MusicDataType::Repeat;</a>
<a name="ln2979">      }</a>
<a name="ln2980"> </a>
<a name="ln2981">void RepeatSymbol::setText(const QString&amp; text) {</a>
<a name="ln2982">      text_ = text;</a>
<a name="ln2983">      }</a>
<a name="ln2984"> </a>
<a name="ln2985">QString RepeatSymbol::getText() const {</a>
<a name="ln2986">      return text_;</a>
<a name="ln2987">      }</a>
<a name="ln2988"> </a>
<a name="ln2989">void RepeatSymbol::setRepeatType(int repeatType) {</a>
<a name="ln2990">      repeatType_ = (RepeatType) repeatType;</a>
<a name="ln2991">      }</a>
<a name="ln2992"> </a>
<a name="ln2993">RepeatType RepeatSymbol::getRepeatType() const {</a>
<a name="ln2994">      return repeatType_;</a>
<a name="ln2995">      }</a>
<a name="ln2996"> </a>
<a name="ln2997">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln2998">NumericEnding::NumericEnding() {</a>
<a name="ln2999">      musicDataType_ = MusicDataType::Numeric_Ending;</a>
<a name="ln3000"> </a>
<a name="ln3001">      height_ = 0;</a>
<a name="ln3002">      text_ = QString();</a>
<a name="ln3003">      numericHandle_ = new OffsetElement();</a>
<a name="ln3004">      }</a>
<a name="ln3005"> </a>
<a name="ln3006">NumericEnding::~NumericEnding() {</a>
<a name="ln3007">      delete numericHandle_;</a>
<a name="ln3008">      }</a>
<a name="ln3009"> </a>
<a name="ln3010">OffsetElement* NumericEnding::getNumericHandle() const {</a>
<a name="ln3011">      return numericHandle_;</a>
<a name="ln3012">      }</a>
<a name="ln3013"> </a>
<a name="ln3014">void NumericEnding::setHeight(int height) {</a>
<a name="ln3015">      height_ = height;</a>
<a name="ln3016">      }</a>
<a name="ln3017"> </a>
<a name="ln3018">int NumericEnding::getHeight() const {</a>
<a name="ln3019">      return height_;</a>
<a name="ln3020">      }</a>
<a name="ln3021"> </a>
<a name="ln3022">void NumericEnding::setText(const QString&amp; text) {</a>
<a name="ln3023">      text_ = text;</a>
<a name="ln3024">      }</a>
<a name="ln3025"> </a>
<a name="ln3026">QString NumericEnding::getText() const {</a>
<a name="ln3027">      return text_;</a>
<a name="ln3028">      }</a>
<a name="ln3029"> </a>
<a name="ln3030">QList&lt;int&gt; NumericEnding::getNumbers() const {</a>
<a name="ln3031">      int i;</a>
<a name="ln3032">      QStringList strs = text_.split(&quot;,&quot;, QString::SkipEmptyParts);</a>
<a name="ln3033">      QList&lt;int&gt; endings;</a>
<a name="ln3034"> </a>
<a name="ln3035">      for (i = 0; i &lt; strs.size(); ++i) {</a>
<a name="ln3036">            bool ok;</a>
<a name="ln3037">            int num = strs[i].toInt(&amp;ok);</a>
<a name="ln3038">            endings.push_back(num);</a>
<a name="ln3039">            }</a>
<a name="ln3040"> </a>
<a name="ln3041">      return endings;</a>
<a name="ln3042">      }</a>
<a name="ln3043"> </a>
<a name="ln3044">int NumericEnding::getJumpCount() const {</a>
<a name="ln3045">      QList&lt;int&gt; numbers = getNumbers();</a>
<a name="ln3046">      int count = 0;</a>
<a name="ln3047"> </a>
<a name="ln3048">      for (int i = 0; i &lt; numbers.size(); ++i) {</a>
<a name="ln3049">            if ((int)i + 1 != numbers[i]) {</a>
<a name="ln3050">                  break;</a>
<a name="ln3051">                  }</a>
<a name="ln3052"> </a>
<a name="ln3053">            count = i + 1;</a>
<a name="ln3054">            }</a>
<a name="ln3055"> </a>
<a name="ln3056">      return count;</a>
<a name="ln3057">      }</a>
<a name="ln3058"> </a>
<a name="ln3059">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3060">BarNumber::BarNumber() {</a>
<a name="ln3061">      index_ = 0;</a>
<a name="ln3062">      showOnParagraphStart_ = false;</a>
<a name="ln3063">      align_ = 0;</a>
<a name="ln3064">      showFlag_ = 1; // staff</a>
<a name="ln3065">      barRange_ = 1; // can't be 0</a>
<a name="ln3066">      prefix_ = QString();</a>
<a name="ln3067">      }</a>
<a name="ln3068"> </a>
<a name="ln3069">void BarNumber::setIndex(int index) {</a>
<a name="ln3070">      index_ = index;</a>
<a name="ln3071">      }</a>
<a name="ln3072"> </a>
<a name="ln3073">int BarNumber::getIndex() const {</a>
<a name="ln3074">      return index_;</a>
<a name="ln3075">      }</a>
<a name="ln3076"> </a>
<a name="ln3077">void BarNumber::setShowOnParagraphStart(bool show) {</a>
<a name="ln3078">      showOnParagraphStart_ = show;</a>
<a name="ln3079">      }</a>
<a name="ln3080"> </a>
<a name="ln3081">bool BarNumber::getShowOnParagraphStart() const {</a>
<a name="ln3082">      return showOnParagraphStart_;</a>
<a name="ln3083">      }</a>
<a name="ln3084"> </a>
<a name="ln3085">void BarNumber::setAlign(int align)// 0:left, 1:center, 2:right</a>
<a name="ln3086">      {</a>
<a name="ln3087">      align_ = align;</a>
<a name="ln3088">      }</a>
<a name="ln3089"> </a>
<a name="ln3090">int BarNumber::getAlign() const {</a>
<a name="ln3091">      return align_;</a>
<a name="ln3092">      }</a>
<a name="ln3093"> </a>
<a name="ln3094">void BarNumber::setShowFlag(int flag) {</a>
<a name="ln3095">      showFlag_ = flag;</a>
<a name="ln3096">      }</a>
<a name="ln3097"> </a>
<a name="ln3098">int BarNumber::getShowFlag() const {</a>
<a name="ln3099">      return showFlag_;</a>
<a name="ln3100">      }</a>
<a name="ln3101"> </a>
<a name="ln3102">void BarNumber::setShowEveryBarCount(int count) {</a>
<a name="ln3103">      barRange_ = count;</a>
<a name="ln3104">      }</a>
<a name="ln3105"> </a>
<a name="ln3106">int BarNumber::getShowEveryBarCount() const {</a>
<a name="ln3107">      return barRange_;</a>
<a name="ln3108">      }</a>
<a name="ln3109"> </a>
<a name="ln3110">void BarNumber::setPrefix(const QString&amp; str) {</a>
<a name="ln3111">      prefix_ = str;</a>
<a name="ln3112">      }</a>
<a name="ln3113"> </a>
<a name="ln3114">QString BarNumber::getPrefix() const {</a>
<a name="ln3115">      return prefix_;</a>
<a name="ln3116">      }</a>
<a name="ln3117"> </a>
<a name="ln3118">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3119">MidiController::MidiController() {</a>
<a name="ln3120">      midiType_ = MidiType::Controller;</a>
<a name="ln3121">      controller_ = 64; // pedal</a>
<a name="ln3122">      value_ = 0;</a>
<a name="ln3123">      }</a>
<a name="ln3124"> </a>
<a name="ln3125">void MidiController::setController(int number) {</a>
<a name="ln3126">      controller_ = number;</a>
<a name="ln3127">      }</a>
<a name="ln3128"> </a>
<a name="ln3129">int MidiController::getController() const {</a>
<a name="ln3130">      return controller_;</a>
<a name="ln3131">      }</a>
<a name="ln3132"> </a>
<a name="ln3133">void MidiController::setValue(int value) {</a>
<a name="ln3134">      value_ = value;</a>
<a name="ln3135">      }</a>
<a name="ln3136"> </a>
<a name="ln3137">int MidiController::getValue() const {</a>
<a name="ln3138">      return value_;</a>
<a name="ln3139">      }</a>
<a name="ln3140"> </a>
<a name="ln3141">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3142">MidiProgramChange::MidiProgramChange() {</a>
<a name="ln3143">      midiType_ = MidiType::Program_Change;</a>
<a name="ln3144">      patch_ = 0; // grand piano</a>
<a name="ln3145">      }</a>
<a name="ln3146"> </a>
<a name="ln3147">void MidiProgramChange::setPatch(int patch) {</a>
<a name="ln3148">      patch_ = patch;</a>
<a name="ln3149">      }</a>
<a name="ln3150"> </a>
<a name="ln3151">int MidiProgramChange::getPatch() const {</a>
<a name="ln3152">      return patch_;</a>
<a name="ln3153">      }</a>
<a name="ln3154"> </a>
<a name="ln3155">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3156">MidiChannelPressure::MidiChannelPressure() :</a>
<a name="ln3157">      pressure_(0) {</a>
<a name="ln3158">      midiType_ = MidiType::Channel_Pressure;</a>
<a name="ln3159">      }</a>
<a name="ln3160"> </a>
<a name="ln3161">void MidiChannelPressure::setPressure(int pressure) {</a>
<a name="ln3162">      pressure_ = pressure;</a>
<a name="ln3163">      }</a>
<a name="ln3164"> </a>
<a name="ln3165">int MidiChannelPressure::getPressure() const {</a>
<a name="ln3166">      return pressure_;</a>
<a name="ln3167">      }</a>
<a name="ln3168"> </a>
<a name="ln3169">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3170">MidiPitchWheel::MidiPitchWheel() {</a>
<a name="ln3171">      midiType_ = MidiType::Pitch_Wheel;</a>
<a name="ln3172">      value_ = 0;</a>
<a name="ln3173">      }</a>
<a name="ln3174"> </a>
<a name="ln3175">void MidiPitchWheel::setValue(int value) {</a>
<a name="ln3176">      value_ = value;</a>
<a name="ln3177">      }</a>
<a name="ln3178"> </a>
<a name="ln3179">int MidiPitchWheel::getValue() const {</a>
<a name="ln3180">      return value_;</a>
<a name="ln3181">      }</a>
<a name="ln3182"> </a>
<a name="ln3183">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3184">Measure::Measure(int index) {</a>
<a name="ln3185">      barNumber_ = new BarNumber();</a>
<a name="ln3186">      barNumber_-&gt;setIndex(index);</a>
<a name="ln3187">      time_ = new TimeSignature();</a>
<a name="ln3188"> </a>
<a name="ln3189">      clear();</a>
<a name="ln3190">      }</a>
<a name="ln3191"> </a>
<a name="ln3192">Measure::~Measure(){</a>
<a name="ln3193">      clear();</a>
<a name="ln3194"> </a>
<a name="ln3195">      delete barNumber_;</a>
<a name="ln3196">      delete time_;</a>
<a name="ln3197">      }</a>
<a name="ln3198"> </a>
<a name="ln3199">BarNumber* Measure::getBarNumber() const {</a>
<a name="ln3200">      return barNumber_;</a>
<a name="ln3201">      }</a>
<a name="ln3202"> </a>
<a name="ln3203">TimeSignature* Measure::getTime() const {</a>
<a name="ln3204">      return time_;</a>
<a name="ln3205">      }</a>
<a name="ln3206"> </a>
<a name="ln3207">void Measure::setLeftBarline(int barline) {</a>
<a name="ln3208">      leftBarline_ = (BarLineType) barline;</a>
<a name="ln3209">      }</a>
<a name="ln3210"> </a>
<a name="ln3211">BarLineType Measure::getLeftBarline() const {</a>
<a name="ln3212">      return leftBarline_;</a>
<a name="ln3213">      }</a>
<a name="ln3214"> </a>
<a name="ln3215">void Measure::setRightBarline(int barline) {</a>
<a name="ln3216">      rightBarline_ = (BarLineType) barline;</a>
<a name="ln3217">      }</a>
<a name="ln3218"> </a>
<a name="ln3219">BarLineType Measure::getRightBarline() const {</a>
<a name="ln3220">      return rightBarline_;</a>
<a name="ln3221">      }</a>
<a name="ln3222"> </a>
<a name="ln3223">void Measure::setBackwardRepeatCount(int repeatCount) {</a>
<a name="ln3224">      repeatCount_ = repeatCount;</a>
<a name="ln3225">      }</a>
<a name="ln3226"> </a>
<a name="ln3227">int Measure::getBackwardRepeatCount() const {</a>
<a name="ln3228">      return repeatCount_;</a>
<a name="ln3229">      }</a>
<a name="ln3230"> </a>
<a name="ln3231">void Measure::setTypeTempo(double tempo) {</a>
<a name="ln3232">      typeTempo_ = tempo;</a>
<a name="ln3233">      }</a>
<a name="ln3234"> </a>
<a name="ln3235">double Measure::getTypeTempo() const {</a>
<a name="ln3236">      return typeTempo_;</a>
<a name="ln3237">      }</a>
<a name="ln3238"> </a>
<a name="ln3239">void Measure::setIsPickup(bool pickup) {</a>
<a name="ln3240">      pickup_ = pickup;</a>
<a name="ln3241">      }</a>
<a name="ln3242"> </a>
<a name="ln3243">bool Measure::getIsPickup() const {</a>
<a name="ln3244">      return pickup_;</a>
<a name="ln3245">      }</a>
<a name="ln3246"> </a>
<a name="ln3247">void Measure::setIsMultiMeasureRest(bool rest) {</a>
<a name="ln3248">      multiMeasureRest_ = rest;</a>
<a name="ln3249">      }</a>
<a name="ln3250"> </a>
<a name="ln3251">bool Measure::getIsMultiMeasureRest() const {</a>
<a name="ln3252">      return multiMeasureRest_;</a>
<a name="ln3253">      }</a>
<a name="ln3254"> </a>
<a name="ln3255">void Measure::setMultiMeasureRestCount(int count) {</a>
<a name="ln3256">      multiMeasureRestCount_ = count;</a>
<a name="ln3257">      }</a>
<a name="ln3258"> </a>
<a name="ln3259">int Measure::getMultiMeasureRestCount() const {</a>
<a name="ln3260">      return multiMeasureRestCount_;</a>
<a name="ln3261">      }</a>
<a name="ln3262"> </a>
<a name="ln3263">void Measure::clear() {</a>
<a name="ln3264">      leftBarline_ = BarLineType::Default;</a>
<a name="ln3265">      rightBarline_ = BarLineType::Default;</a>
<a name="ln3266">      repeatCount_ = 1;</a>
<a name="ln3267">      typeTempo_ = 96.00;</a>
<a name="ln3268">      setLength(0x780); //time = 4/4</a>
<a name="ln3269">      pickup_ = false;</a>
<a name="ln3270">      multiMeasureRest_ = false;</a>
<a name="ln3271">      multiMeasureRestCount_ = 0;</a>
<a name="ln3272">      }</a>
<a name="ln3273"> </a>
<a name="ln3274">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3275">MeasureData::MeasureData() {</a>
<a name="ln3276">      key_ = new Key();</a>
<a name="ln3277">      clef_ = new Clef();</a>
<a name="ln3278">      }</a>
<a name="ln3279"> </a>
<a name="ln3280">MeasureData::~MeasureData(){</a>
<a name="ln3281">      int i;</a>
<a name="ln3282">      for(i=0; i&lt;musicDatas_.size(); ++i){</a>
<a name="ln3283">            delete musicDatas_[i];</a>
<a name="ln3284">            }</a>
<a name="ln3285">      musicDatas_.clear();</a>
<a name="ln3286"> </a>
<a name="ln3287">      // noteContainers_ also in musicDatas_, no need to destroy</a>
<a name="ln3288">      noteContainers_.clear();</a>
<a name="ln3289"> </a>
<a name="ln3290">      // only delete at element start</a>
<a name="ln3291">      for(i=0; i&lt;crossMeasureElements_.size(); ++i){</a>
<a name="ln3292">            if(crossMeasureElements_[i].second){</a>
<a name="ln3293">                  delete crossMeasureElements_[i].first;</a>
<a name="ln3294">                  }</a>
<a name="ln3295">            }</a>
<a name="ln3296">      crossMeasureElements_.clear();</a>
<a name="ln3297"> </a>
<a name="ln3298">      for(i=0; i&lt;midiDatas_.size(); ++i){</a>
<a name="ln3299">            delete midiDatas_[i];</a>
<a name="ln3300">            }</a>
<a name="ln3301">      midiDatas_.clear();</a>
<a name="ln3302"> </a>
<a name="ln3303">      delete key_;</a>
<a name="ln3304">      delete clef_;</a>
<a name="ln3305">      }</a>
<a name="ln3306"> </a>
<a name="ln3307">Key* MeasureData::getKey() const {</a>
<a name="ln3308">      return key_;</a>
<a name="ln3309">      }</a>
<a name="ln3310"> </a>
<a name="ln3311">Clef* MeasureData::getClef() const {</a>
<a name="ln3312">      return clef_;</a>
<a name="ln3313">      }</a>
<a name="ln3314"> </a>
<a name="ln3315">void MeasureData::addNoteContainer(NoteContainer* ptr) {</a>
<a name="ln3316">      noteContainers_.push_back(ptr);</a>
<a name="ln3317">      }</a>
<a name="ln3318"> </a>
<a name="ln3319">QList&lt;NoteContainer*&gt; MeasureData::getNoteContainers() const {</a>
<a name="ln3320">      return noteContainers_;</a>
<a name="ln3321">      }</a>
<a name="ln3322"> </a>
<a name="ln3323">void MeasureData::addMusicData(MusicData* ptr) {</a>
<a name="ln3324">      musicDatas_.push_back(ptr);</a>
<a name="ln3325">      }</a>
<a name="ln3326"> </a>
<a name="ln3327">QList&lt;MusicData*&gt; MeasureData::getMusicDatas(MusicDataType type) {</a>
<a name="ln3328">      int i;</a>
<a name="ln3329">      QList&lt;MusicData*&gt; notations;</a>
<a name="ln3330"> </a>
<a name="ln3331">      for (i = 0; i &lt; musicDatas_.size(); ++i) {</a>
<a name="ln3332">            if (type == MusicDataType::None || musicDatas_[i]-&gt;getMusicDataType() == type) {</a>
<a name="ln3333">                  notations.push_back(musicDatas_[i]);</a>
<a name="ln3334">                  }</a>
<a name="ln3335">            }</a>
<a name="ln3336"> </a>
<a name="ln3337">      return notations;</a>
<a name="ln3338">      }</a>
<a name="ln3339"> </a>
<a name="ln3340">void MeasureData::addCrossMeasureElement(MusicData* ptr, bool start) {</a>
<a name="ln3341">      crossMeasureElements_.push_back(qMakePair(ptr, start));</a>
<a name="ln3342">      }</a>
<a name="ln3343"> </a>
<a name="ln3344">QList&lt;MusicData*&gt; MeasureData::getCrossMeasureElements(</a>
<a name="ln3345">            MusicDataType type, PairType pairType)</a>
<a name="ln3346">      {</a>
<a name="ln3347">      int i;</a>
<a name="ln3348">      QList&lt;MusicData*&gt; pairs;</a>
<a name="ln3349"> </a>
<a name="ln3350">      for (i = 0; i &lt; crossMeasureElements_.size(); ++i) {</a>
<a name="ln3351">            if ((type == MusicDataType::None || crossMeasureElements_[i].first-&gt;getMusicDataType() == type)</a>
<a name="ln3352">                &amp;&amp; (pairType == PairType::All || ((crossMeasureElements_[i].second &amp;&amp; pairType == PairType::Start)</a>
<a name="ln3353">                                                 || (!crossMeasureElements_[i].second &amp;&amp; pairType == PairType::Stop)))) {</a>
<a name="ln3354">                  pairs.push_back(crossMeasureElements_[i].first);</a>
<a name="ln3355">                  }</a>
<a name="ln3356">            }</a>
<a name="ln3357"> </a>
<a name="ln3358">      return pairs;</a>
<a name="ln3359">      }</a>
<a name="ln3360"> </a>
<a name="ln3361">void MeasureData::addMidiData(MidiData* ptr) {</a>
<a name="ln3362">      midiDatas_.push_back(ptr);</a>
<a name="ln3363">      }</a>
<a name="ln3364"> </a>
<a name="ln3365">QList&lt;MidiData*&gt; MeasureData::getMidiDatas(MidiType type) {</a>
<a name="ln3366">      int i;</a>
<a name="ln3367">      QList&lt;MidiData*&gt; datas;</a>
<a name="ln3368"> </a>
<a name="ln3369">      for (i = 0; i &lt; midiDatas_.size(); ++i) {</a>
<a name="ln3370">            if (type == MidiType::None || midiDatas_[i]-&gt;getMidiType() == type) {</a>
<a name="ln3371">                  datas.push_back(midiDatas_[i]);</a>
<a name="ln3372">                  }</a>
<a name="ln3373">            }</a>
<a name="ln3374"> </a>
<a name="ln3375">      return datas;</a>
<a name="ln3376">      }</a>
<a name="ln3377"> </a>
<a name="ln3378">//////////////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3379">//////////////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3380">StreamHandle::StreamHandle() :</a>
<a name="ln3381">      size_(0), curPos_(0), point_(NULL) {</a>
<a name="ln3382">      }</a>
<a name="ln3383"> </a>
<a name="ln3384">StreamHandle::StreamHandle(unsigned char* p, int size) :</a>
<a name="ln3385">      size_(size), curPos_(0), point_(p) {</a>
<a name="ln3386">      }</a>
<a name="ln3387"> </a>
<a name="ln3388">StreamHandle::~StreamHandle() {</a>
<a name="ln3389">      point_ = NULL;</a>
<a name="ln3390">      }</a>
<a name="ln3391"> </a>
<a name="ln3392">bool StreamHandle::read(char* buff, int size) {</a>
<a name="ln3393">      if (point_ != NULL &amp;&amp; curPos_ + size &lt;= size_) {</a>
<a name="ln3394">            memcpy(buff, point_ + curPos_, size);</a>
<a name="ln3395">            curPos_ += size;</a>
<a name="ln3396"> </a>
<a name="ln3397">            return true;</a>
<a name="ln3398">            }</a>
<a name="ln3399"> </a>
<a name="ln3400">      return false;</a>
<a name="ln3401">      }</a>
<a name="ln3402"> </a>
<a name="ln3403">bool StreamHandle::write(char* /*buff*/, int /*size*/) {</a>
<a name="ln3404">      return true;</a>
<a name="ln3405">      }</a>
<a name="ln3406"> </a>
<a name="ln3407">// Block.cpp</a>
<a name="ln3408">///////////////////////////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3409">Block::Block() {</a>
<a name="ln3410">      doResize(0);</a>
<a name="ln3411">      }</a>
<a name="ln3412"> </a>
<a name="ln3413">Block::Block(unsigned int count) {</a>
<a name="ln3414">      doResize(count);</a>
<a name="ln3415">      }</a>
<a name="ln3416"> </a>
<a name="ln3417">void Block::resize(unsigned int count) {</a>
<a name="ln3418">      doResize(count);</a>
<a name="ln3419">      }</a>
<a name="ln3420"> </a>
<a name="ln3421">void Block::doResize(unsigned int count) {</a>
<a name="ln3422">      data_.clear();</a>
<a name="ln3423">      for(unsigned int i=0; i&lt;count; ++i) {</a>
<a name="ln3424">            data_.push_back('\0');</a>
<a name="ln3425">            }</a>
<a name="ln3426">      //data_.resize(count);</a>
<a name="ln3427">      }</a>
<a name="ln3428"> </a>
<a name="ln3429">const unsigned char* Block::data() const {</a>
<a name="ln3430">      //return const_cast&lt;unsigned char*&gt;(&amp;data_.front());</a>
<a name="ln3431">      return &amp;data_.front();</a>
<a name="ln3432">      }</a>
<a name="ln3433"> </a>
<a name="ln3434">unsigned char* Block::data() {</a>
<a name="ln3435">      return &amp;data_.front();</a>
<a name="ln3436">      }</a>
<a name="ln3437"> </a>
<a name="ln3438">int Block::size() const {</a>
<a name="ln3439">      return data_.size();</a>
<a name="ln3440">      }</a>
<a name="ln3441"> </a>
<a name="ln3442">bool Block::toBoolean() const {</a>
<a name="ln3443">      if (data() == NULL) {</a>
<a name="ln3444">            return false;</a>
<a name="ln3445">            }</a>
<a name="ln3446"> </a>
<a name="ln3447">      return size() == 1 &amp;&amp; data()[0] == 0x01;</a>
<a name="ln3448">      }</a>
<a name="ln3449"> </a>
<a name="ln3450">unsigned int Block::toUnsignedInt() const {</a>
<a name="ln3451">      if (data() == NULL) {</a>
<a name="ln3452">            return 0;</a>
<a name="ln3453">            }</a>
<a name="ln3454"> </a>
<a name="ln3455">      int num = 0;</a>
<a name="ln3456"> </a>
<a name="ln3457">      for (int i = 0; i &lt; (int)sizeof(int) &amp;&amp; i &lt; size(); ++i) {</a>
<a name="ln3458">            num = (num &lt;&lt; 8) + *(data() + i);</a>
<a name="ln3459">            }</a>
<a name="ln3460"> </a>
<a name="ln3461">      return num;</a>
<a name="ln3462">      }</a>
<a name="ln3463"> </a>
<a name="ln3464">int Block::toInt() const {</a>
<a name="ln3465">      if (data() == NULL) {</a>
<a name="ln3466">            return 0;</a>
<a name="ln3467">            }</a>
<a name="ln3468"> </a>
<a name="ln3469">      int i;</a>
<a name="ln3470">      int num = 0;</a>
<a name="ln3471"> </a>
<a name="ln3472">      for (i = 0; i &lt; (int)sizeof(int) &amp;&amp; i &lt; size(); ++i) {</a>
<a name="ln3473">            num = (num &lt;&lt; 8) + static_cast&lt;int&gt;(*(data()) + i);</a>
<a name="ln3474">            }</a>
<a name="ln3475"> </a>
<a name="ln3476">      std::size_t minSize = sizeof(int);</a>
<a name="ln3477">      if (size() &lt; (int)minSize) {</a>
<a name="ln3478">            minSize = size();</a>
<a name="ln3479">            }</a>
<a name="ln3480"> </a>
<a name="ln3481">      if ((*(data()) &amp; 0x80) == 0x80) {</a>
<a name="ln3482">            int maxNum = static_cast&lt;int&gt;(pow(2.0, static_cast&lt;int&gt;(minSize) * 8));</a>
<a name="ln3483">            num -= maxNum;</a>
<a name="ln3484">            //num *= -1;</a>
<a name="ln3485">            }</a>
<a name="ln3486"> </a>
<a name="ln3487">      return num;</a>
<a name="ln3488">      }</a>
<a name="ln3489"> </a>
<a name="ln3490">QByteArray Block::toStrByteArray() const {</a>
<a name="ln3491">      if (data() == NULL) {</a>
<a name="ln3492">            return QByteArray();</a>
<a name="ln3493">            }</a>
<a name="ln3494"> </a>
<a name="ln3495">      QByteArray arr((char*) data(), size());</a>
<a name="ln3496"> </a>
<a name="ln3497">      return arr;</a>
<a name="ln3498">      }</a>
<a name="ln3499"> </a>
<a name="ln3500">QByteArray Block::fixedSizeBufferToStrByteArray() const {</a>
<a name="ln3501">      QByteArray str;</a>
<a name="ln3502"> </a>
<a name="ln3503">      for (int i = 0; i &lt; size(); ++i) {</a>
<a name="ln3504">            if (*(data() + i) == '\0') {</a>
<a name="ln3505">                  break;</a>
<a name="ln3506">                  }</a>
<a name="ln3507"> </a>
<a name="ln3508">            str += (char) *(data() + i);</a>
<a name="ln3509">            }</a>
<a name="ln3510"> </a>
<a name="ln3511">      return str;</a>
<a name="ln3512">      }</a>
<a name="ln3513"> </a>
<a name="ln3514">bool Block::operator ==(const Block&amp; block) const {</a>
<a name="ln3515">      if (size() != block.size()) {</a>
<a name="ln3516">            return false;</a>
<a name="ln3517">            }</a>
<a name="ln3518"> </a>
<a name="ln3519">      for (int i = 0; i &lt; size() &amp;&amp; i &lt; block.size(); ++i) {</a>
<a name="ln3520">            if (*(data() + i) != *(block.data() + i)) {</a>
<a name="ln3521">                  return false;</a>
<a name="ln3522">                  }</a>
<a name="ln3523">            }</a>
<a name="ln3524"> </a>
<a name="ln3525">      return true;</a>
<a name="ln3526">      }</a>
<a name="ln3527"> </a>
<a name="ln3528">bool Block::operator !=(const Block&amp; block) const {</a>
<a name="ln3529">      return !(*this == block);</a>
<a name="ln3530">      }</a>
<a name="ln3531"> </a>
<a name="ln3532">///////////////////////////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3533">FixedBlock::FixedBlock() :</a>
<a name="ln3534">      Block() {</a>
<a name="ln3535">      }</a>
<a name="ln3536"> </a>
<a name="ln3537">FixedBlock::FixedBlock(unsigned int count) :</a>
<a name="ln3538">      Block(count) {</a>
<a name="ln3539">      }</a>
<a name="ln3540"> </a>
<a name="ln3541">void FixedBlock::resize(unsigned int /*count*/) {</a>
<a name="ln3542">      // Block::resize(size);</a>
<a name="ln3543">      }</a>
<a name="ln3544"> </a>
<a name="ln3545">///////////////////////////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3546">SizeBlock::SizeBlock() :</a>
<a name="ln3547">      FixedBlock(4) {</a>
<a name="ln3548">      }</a>
<a name="ln3549"> </a>
<a name="ln3550">unsigned int SizeBlock::toSize() const {</a>
<a name="ln3551">      unsigned int i;</a>
<a name="ln3552">      unsigned int num(0);</a>
<a name="ln3553">      const unsigned int SIZE = 4;</a>
<a name="ln3554"> </a>
<a name="ln3555">      for (i = 0; i &lt; SIZE; ++i) {</a>
<a name="ln3556">            num = (num &lt;&lt; 8) + *(data() + i);</a>
<a name="ln3557">            }</a>
<a name="ln3558"> </a>
<a name="ln3559">      return num;</a>
<a name="ln3560">      }</a>
<a name="ln3561"> </a>
<a name="ln3562">/*void SizeBlock::fromUnsignedInt(unsigned int count)</a>
<a name="ln3563"> {</a>
<a name="ln3564"> unsigned_int_to_char_buffer(count, data());</a>
<a name="ln3565"> }*/</a>
<a name="ln3566"> </a>
<a name="ln3567">///////////////////////////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3568">NameBlock::NameBlock() :</a>
<a name="ln3569">      FixedBlock(4) {</a>
<a name="ln3570">      }</a>
<a name="ln3571"> </a>
<a name="ln3572">/*void NameBlock::setValue(const char* const name)</a>
<a name="ln3573"> {</a>
<a name="ln3574"> unsigned int i;</a>
<a name="ln3575"> </a>
<a name="ln3576"> for( i=0; i&lt;size() &amp;&amp; *(name+i)!='\0'; ++i )</a>
<a name="ln3577"> {</a>
<a name="ln3578"> *(data()+i) = *(name+i);</a>
<a name="ln3579"> }</a>
<a name="ln3580"> }*/</a>
<a name="ln3581"> </a>
<a name="ln3582">bool NameBlock::isEqual(const QString&amp; name) const {</a>
<a name="ln3583">      int nsize = name.size();</a>
<a name="ln3584"> </a>
<a name="ln3585">      if (nsize != size()) {</a>
<a name="ln3586">            return false;</a>
<a name="ln3587">            }</a>
<a name="ln3588"> </a>
<a name="ln3589">      for (int i = 0; i &lt; size() &amp;&amp; nsize; ++i) {</a>
<a name="ln3590">            if (data()[i] != name[i]) {</a>
<a name="ln3591">                  return false;</a>
<a name="ln3592">                  }</a>
<a name="ln3593">            }</a>
<a name="ln3594"> </a>
<a name="ln3595">      return true;</a>
<a name="ln3596">      }</a>
<a name="ln3597"> </a>
<a name="ln3598">///////////////////////////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3599">CountBlock::CountBlock() :</a>
<a name="ln3600">      FixedBlock(2) {</a>
<a name="ln3601">      }</a>
<a name="ln3602"> </a>
<a name="ln3603">/*void CountBlock::setValue(unsigned short count)</a>
<a name="ln3604"> {</a>
<a name="ln3605"> unsigned int i;</a>
<a name="ln3606"> unsigned int SIZE = sizeof(unsigned short);</a>
<a name="ln3607"> </a>
<a name="ln3608"> for( i=0; i&lt;SIZE; ++i )</a>
<a name="ln3609"> {</a>
<a name="ln3610"> data()[SIZE-1-i] = count % 256;</a>
<a name="ln3611"> count /= 256;</a>
<a name="ln3612"> }</a>
<a name="ln3613"> }*/</a>
<a name="ln3614"> </a>
<a name="ln3615">unsigned short CountBlock::toCount() const {</a>
<a name="ln3616">      unsigned short num = 0;</a>
<a name="ln3617"> </a>
<a name="ln3618">      for (int i = 0; i &lt; size() &amp;&amp; i &lt; (int)sizeof(unsigned short); ++i) {</a>
<a name="ln3619">            num = (num &lt;&lt; 8) + *(data() + i);</a>
<a name="ln3620">            }</a>
<a name="ln3621"> </a>
<a name="ln3622">      return num;</a>
<a name="ln3623">      }</a>
<a name="ln3624"> </a>
<a name="ln3625">// Chunk.cpp</a>
<a name="ln3626">const QString Chunk::TrackName   = &quot;TRAK&quot;;</a>
<a name="ln3627">const QString Chunk::PageName    = &quot;PAGE&quot;;</a>
<a name="ln3628">const QString Chunk::LineName    = &quot;LINE&quot;;</a>
<a name="ln3629">const QString Chunk::StaffName   = &quot;STAF&quot;;</a>
<a name="ln3630">const QString Chunk::MeasureName = &quot;MEAS&quot;;</a>
<a name="ln3631">const QString Chunk::ConductName = &quot;COND&quot;;</a>
<a name="ln3632">const QString Chunk::BdatName    = &quot;BDAT&quot;;</a>
<a name="ln3633"> </a>
<a name="ln3634">Chunk::Chunk() {</a>
<a name="ln3635">      }</a>
<a name="ln3636"> </a>
<a name="ln3637">NameBlock Chunk::getName() const {</a>
<a name="ln3638">      return nameBlock_;</a>
<a name="ln3639">      }</a>
<a name="ln3640"> </a>
<a name="ln3641">////////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3642">const unsigned int SizeChunk::version3TrackSize = 0x13a;</a>
<a name="ln3643"> </a>
<a name="ln3644">SizeChunk::SizeChunk() :</a>
<a name="ln3645">      Chunk() {</a>
<a name="ln3646">      sizeBlock_ = new SizeBlock();</a>
<a name="ln3647">      dataBlock_ = new Block();</a>
<a name="ln3648">      }</a>
<a name="ln3649"> </a>
<a name="ln3650">SizeChunk::~SizeChunk() {</a>
<a name="ln3651">      delete sizeBlock_;</a>
<a name="ln3652">      delete dataBlock_;</a>
<a name="ln3653">      }</a>
<a name="ln3654"> </a>
<a name="ln3655">SizeBlock* SizeChunk::getSizeBlock() const {</a>
<a name="ln3656">      return sizeBlock_;</a>
<a name="ln3657">      }</a>
<a name="ln3658"> </a>
<a name="ln3659">Block* SizeChunk::getDataBlock() const {</a>
<a name="ln3660">      return dataBlock_;</a>
<a name="ln3661">      }</a>
<a name="ln3662"> </a>
<a name="ln3663">/////////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3664">GroupChunk::GroupChunk() : Chunk() {</a>
<a name="ln3665">      childCount_ = new CountBlock();</a>
<a name="ln3666">      }</a>
<a name="ln3667"> </a>
<a name="ln3668">GroupChunk::~GroupChunk() {</a>
<a name="ln3669">      delete childCount_;</a>
<a name="ln3670">      }</a>
<a name="ln3671"> </a>
<a name="ln3672">CountBlock* GroupChunk::getCountBlock() const {</a>
<a name="ln3673">      return childCount_;</a>
<a name="ln3674">      }</a>
<a name="ln3675"> </a>
<a name="ln3676">// ChunkParse.cpp</a>
<a name="ln3677">unsigned int getHighNibble(unsigned int byte) {</a>
<a name="ln3678">      return byte / 16;</a>
<a name="ln3679">      }</a>
<a name="ln3680"> </a>
<a name="ln3681">unsigned int getLowNibble(unsigned int byte) {</a>
<a name="ln3682">      return byte % 16;</a>
<a name="ln3683">      }</a>
<a name="ln3684"> </a>
<a name="ln3685">int oveKeyToKey(int oveKey) {</a>
<a name="ln3686">      int key = 0;</a>
<a name="ln3687"> </a>
<a name="ln3688">      if( oveKey == 0 ) {</a>
<a name="ln3689">            key = 0;</a>
<a name="ln3690">            }</a>
<a name="ln3691">      else if( oveKey &gt; 7 ) {</a>
<a name="ln3692">            key = oveKey - 7;</a>
<a name="ln3693">            }</a>
<a name="ln3694">      else if( oveKey &lt;= 7 ) {</a>
<a name="ln3695">            key = oveKey * (-1);</a>
<a name="ln3696">            }</a>
<a name="ln3697"> </a>
<a name="ln3698">      return key;</a>
<a name="ln3699">      }</a>
<a name="ln3700"> </a>
<a name="ln3701">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3702">BasicParse::BasicParse(OveSong* ove) :</a>
<a name="ln3703">      ove_(ove), handle_(NULL), notify_(NULL) {</a>
<a name="ln3704">      }</a>
<a name="ln3705"> </a>
<a name="ln3706">BasicParse::BasicParse() :</a>
<a name="ln3707">      ove_(NULL), handle_(NULL), notify_(NULL) {</a>
<a name="ln3708">      }</a>
<a name="ln3709"> </a>
<a name="ln3710">BasicParse::~BasicParse() {</a>
<a name="ln3711">      ove_ = NULL;</a>
<a name="ln3712">      handle_ = NULL;</a>
<a name="ln3713">      notify_ = NULL;</a>
<a name="ln3714">      }</a>
<a name="ln3715"> </a>
<a name="ln3716">void BasicParse::setNotify(IOveNotify* notify) {</a>
<a name="ln3717">      notify_ = notify;</a>
<a name="ln3718">      }</a>
<a name="ln3719"> </a>
<a name="ln3720">bool BasicParse::parse() {</a>
<a name="ln3721">      return false;</a>
<a name="ln3722">      }</a>
<a name="ln3723"> </a>
<a name="ln3724">bool BasicParse::readBuffer(Block&amp; placeHolder, int size) {</a>
<a name="ln3725">      if (handle_ == NULL) {</a>
<a name="ln3726">            return false;</a>
<a name="ln3727">            }</a>
<a name="ln3728">      if (placeHolder.size() != size) {</a>
<a name="ln3729">            placeHolder.resize(size);</a>
<a name="ln3730">            }</a>
<a name="ln3731"> </a>
<a name="ln3732">      if (size &gt; 0) {</a>
<a name="ln3733">            return handle_-&gt;read((char*) placeHolder.data(), placeHolder.size());</a>
<a name="ln3734">            }</a>
<a name="ln3735"> </a>
<a name="ln3736">      return true;</a>
<a name="ln3737">      }</a>
<a name="ln3738"> </a>
<a name="ln3739">bool BasicParse::jump(int offset) {</a>
<a name="ln3740">      if (handle_ == NULL || offset &lt; 0) {</a>
<a name="ln3741">            return false;</a>
<a name="ln3742">            }</a>
<a name="ln3743"> </a>
<a name="ln3744">      if (offset &gt; 0) {</a>
<a name="ln3745">            Block placeHolder(offset);</a>
<a name="ln3746">            return handle_-&gt;read((char*) placeHolder.data(), placeHolder.size());</a>
<a name="ln3747">            }</a>
<a name="ln3748"> </a>
<a name="ln3749">      return true;</a>
<a name="ln3750">      }</a>
<a name="ln3751"> </a>
<a name="ln3752">void BasicParse::messageOut(const QString&amp; str) {</a>
<a name="ln3753">      if (notify_ != NULL) {</a>
<a name="ln3754">            notify_-&gt;loadInfo(str);</a>
<a name="ln3755">            }</a>
<a name="ln3756">      }</a>
<a name="ln3757"> </a>
<a name="ln3758">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3759">OvscParse::OvscParse(OveSong* ove) :</a>
<a name="ln3760">      BasicParse(ove), chunk_(NULL) {</a>
<a name="ln3761">      }</a>
<a name="ln3762"> </a>
<a name="ln3763">OvscParse::~OvscParse() {</a>
<a name="ln3764">      chunk_ = NULL;</a>
<a name="ln3765">      }</a>
<a name="ln3766"> </a>
<a name="ln3767">void OvscParse::setOvsc(SizeChunk* chunk) {</a>
<a name="ln3768">      chunk_ = chunk;</a>
<a name="ln3769">      }</a>
<a name="ln3770"> </a>
<a name="ln3771">bool OvscParse::parse() {</a>
<a name="ln3772">      Block* dataBlock = chunk_-&gt;getDataBlock();</a>
<a name="ln3773">      unsigned int blockSize = chunk_-&gt;getSizeBlock()-&gt;toSize();</a>
<a name="ln3774">      StreamHandle handle(dataBlock-&gt;data(), blockSize);</a>
<a name="ln3775">      Block placeHolder;</a>
<a name="ln3776"> </a>
<a name="ln3777">      handle_ = &amp;handle;</a>
<a name="ln3778"> </a>
<a name="ln3779">      // version</a>
<a name="ln3780">      if (!readBuffer(placeHolder, 1)) { return false; }</a>
<a name="ln3781">      bool version4 = placeHolder.toUnsignedInt() == 4;</a>
<a name="ln3782">      ove_-&gt;setIsVersion4(version4);</a>
<a name="ln3783"> </a>
<a name="ln3784">      QString str = QString(&quot;This file is created by Overture &quot;) + (version4 ? &quot;4&quot; : &quot;3&quot;) + &quot;\n&quot;;</a>
<a name="ln3785">      messageOut(str);</a>
<a name="ln3786"> </a>
<a name="ln3787">      if( !jump(6) ) { return false; }</a>
<a name="ln3788"> </a>
<a name="ln3789">      // show page margin</a>
<a name="ln3790">      if (!readBuffer(placeHolder, 1)) { return false; }</a>
<a name="ln3791">      ove_-&gt;setShowPageMargin(placeHolder.toBoolean());</a>
<a name="ln3792"> </a>
<a name="ln3793">      if( !jump(1) ) { return false; }</a>
<a name="ln3794"> </a>
<a name="ln3795">      // transpose track</a>
<a name="ln3796">      if (!readBuffer(placeHolder, 1)) { return false; }</a>
<a name="ln3797">      ove_-&gt;setShowTransposeTrack(placeHolder.toBoolean());</a>
<a name="ln3798"> </a>
<a name="ln3799">      // play repeat</a>
<a name="ln3800">      if (!readBuffer(placeHolder, 1)) { return false; }</a>
<a name="ln3801">      ove_-&gt;setPlayRepeat(placeHolder.toBoolean());</a>
<a name="ln3802"> </a>
<a name="ln3803">      // play style</a>
<a name="ln3804">      if (!readBuffer(placeHolder, 1)) { return false; }</a>
<a name="ln3805">      OveSong::PlayStyle style = OveSong::PlayStyle::Record;</a>
<a name="ln3806">      if(placeHolder.toUnsignedInt() == 1){</a>
<a name="ln3807">            style = OveSong::PlayStyle::Swing;</a>
<a name="ln3808">            }</a>
<a name="ln3809">      else if(placeHolder.toUnsignedInt() == 2){</a>
<a name="ln3810">            style = OveSong::PlayStyle::Notation;</a>
<a name="ln3811">            }</a>
<a name="ln3812">      ove_-&gt;setPlayStyle(style);</a>
<a name="ln3813"> </a>
<a name="ln3814">      // show line break</a>
<a name="ln3815">      if (!readBuffer(placeHolder, 1)) { return false; }</a>
<a name="ln3816">      ove_-&gt;setShowLineBreak(placeHolder.toBoolean());</a>
<a name="ln3817"> </a>
<a name="ln3818">      // show ruler</a>
<a name="ln3819">      if (!readBuffer(placeHolder, 1)) { return false; }</a>
<a name="ln3820">      ove_-&gt;setShowRuler(placeHolder.toBoolean());</a>
<a name="ln3821"> </a>
<a name="ln3822">      // show color</a>
<a name="ln3823">      if (!readBuffer(placeHolder, 1)) { return false; }</a>
<a name="ln3824">      ove_-&gt;setShowColor(placeHolder.toBoolean());</a>
<a name="ln3825"> </a>
<a name="ln3826">      return true;</a>
<a name="ln3827">      }</a>
<a name="ln3828"> </a>
<a name="ln3829">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln3830">TrackParse::TrackParse(OveSong* ove)</a>
<a name="ln3831">      :BasicParse(ove) {</a>
<a name="ln3832">      }</a>
<a name="ln3833"> </a>
<a name="ln3834">TrackParse::~TrackParse() {</a>
<a name="ln3835">      }</a>
<a name="ln3836"> </a>
<a name="ln3837">void TrackParse::setTrack(SizeChunk* chunk) {</a>
<a name="ln3838">      chunk_ = chunk;</a>
<a name="ln3839">      }</a>
<a name="ln3840"> </a>
<a name="ln3841">bool TrackParse::parse() {</a>
<a name="ln3842">      Block* dataBlock = chunk_-&gt;getDataBlock();</a>
<a name="ln3843">      unsigned int blockSize = ove_-&gt;getIsVersion4() ? chunk_-&gt;getSizeBlock()-&gt;toSize() : SizeChunk::version3TrackSize;</a>
<a name="ln3844">      StreamHandle handle(dataBlock-&gt;data(), blockSize);</a>
<a name="ln3845">      Block placeHolder;</a>
<a name="ln3846"> </a>
<a name="ln3847">      handle_ = &amp;handle;</a>
<a name="ln3848"> </a>
<a name="ln3849">      Track* oveTrack = new Track();</a>
<a name="ln3850">      ove_-&gt;addTrack(oveTrack);</a>
<a name="ln3851"> </a>
<a name="ln3852">      // 2 32bytes long track name buffer</a>
<a name="ln3853">      if( !readBuffer(placeHolder, 32) ) { return false; }</a>
<a name="ln3854">      oveTrack-&gt;setName(ove_-&gt;getCodecString(placeHolder.fixedSizeBufferToStrByteArray()));</a>
<a name="ln3855"> </a>
<a name="ln3856">      if( !readBuffer(placeHolder, 32) ) { return false; }</a>
<a name="ln3857">      oveTrack-&gt;setBriefName(ove_-&gt;getCodecString(placeHolder.fixedSizeBufferToStrByteArray()));</a>
<a name="ln3858"> </a>
<a name="ln3859">      if( !jump(8) ) { return false; } //0x fffa0012 fffa0012</a>
<a name="ln3860">      if( !jump(1) ) { return false; }</a>
<a name="ln3861"> </a>
<a name="ln3862">      // patch</a>
<a name="ln3863">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3864">      unsigned int thisByte = placeHolder.toInt();</a>
<a name="ln3865">      oveTrack-&gt;setPatch(thisByte&amp;0x7f);</a>
<a name="ln3866"> </a>
<a name="ln3867">      // show name</a>
<a name="ln3868">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3869">      oveTrack-&gt;setShowName(placeHolder.toBoolean());</a>
<a name="ln3870"> </a>
<a name="ln3871">      // show brief name</a>
<a name="ln3872">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3873">      oveTrack-&gt;setShowBriefName(placeHolder.toBoolean());</a>
<a name="ln3874"> </a>
<a name="ln3875">      if( !jump(1) ) { return false; }</a>
<a name="ln3876"> </a>
<a name="ln3877">      // show transpose</a>
<a name="ln3878">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3879">      oveTrack-&gt;setShowTranspose(placeHolder.toBoolean());</a>
<a name="ln3880"> </a>
<a name="ln3881">      if( !jump(1) ) { return false; }</a>
<a name="ln3882"> </a>
<a name="ln3883">      // mute</a>
<a name="ln3884">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3885">      oveTrack-&gt;setMute(placeHolder.toBoolean());</a>
<a name="ln3886"> </a>
<a name="ln3887">      // solo</a>
<a name="ln3888">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3889">      oveTrack-&gt;setSolo(placeHolder.toBoolean());</a>
<a name="ln3890"> </a>
<a name="ln3891">      if( !jump(1) ) { return false; }</a>
<a name="ln3892"> </a>
<a name="ln3893">      // show key each line</a>
<a name="ln3894">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3895">      oveTrack-&gt;setShowKeyEachLine(placeHolder.toBoolean());</a>
<a name="ln3896"> </a>
<a name="ln3897">      // voice count</a>
<a name="ln3898">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3899">      oveTrack-&gt;setVoiceCount(placeHolder.toUnsignedInt());</a>
<a name="ln3900"> </a>
<a name="ln3901">      if( !jump(3) ) { return false; }</a>
<a name="ln3902"> </a>
<a name="ln3903">      // transpose value [-127, 127]</a>
<a name="ln3904">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3905">      oveTrack-&gt;setTranspose(placeHolder.toInt());</a>
<a name="ln3906"> </a>
<a name="ln3907">      if( !jump(2) ) { return false; }</a>
<a name="ln3908"> </a>
<a name="ln3909">      // start clef</a>
<a name="ln3910">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3911">      oveTrack-&gt;setStartClef(placeHolder.toUnsignedInt());</a>
<a name="ln3912"> </a>
<a name="ln3913">      // transpose celf</a>
<a name="ln3914">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3915">      oveTrack-&gt;setTransposeClef(placeHolder.toUnsignedInt());</a>
<a name="ln3916"> </a>
<a name="ln3917">      // start key</a>
<a name="ln3918">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3919">      oveTrack-&gt;setStartKey(placeHolder.toUnsignedInt());</a>
<a name="ln3920"> </a>
<a name="ln3921">      // display percent</a>
<a name="ln3922">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3923">      oveTrack-&gt;setDisplayPercent(placeHolder.toUnsignedInt());</a>
<a name="ln3924"> </a>
<a name="ln3925">      // show leger line</a>
<a name="ln3926">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3927">      oveTrack-&gt;setShowLegerLine(placeHolder.toBoolean());</a>
<a name="ln3928"> </a>
<a name="ln3929">      // show clef</a>
<a name="ln3930">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3931">      oveTrack-&gt;setShowClef(placeHolder.toBoolean());</a>
<a name="ln3932"> </a>
<a name="ln3933">      // show time signature</a>
<a name="ln3934">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3935">      oveTrack-&gt;setShowTimeSignature(placeHolder.toBoolean());</a>
<a name="ln3936"> </a>
<a name="ln3937">      // show key signature</a>
<a name="ln3938">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3939">      oveTrack-&gt;setShowKeySignature(placeHolder.toBoolean());</a>
<a name="ln3940"> </a>
<a name="ln3941">      // show barline</a>
<a name="ln3942">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3943">      oveTrack-&gt;setShowBarline(placeHolder.toBoolean());</a>
<a name="ln3944"> </a>
<a name="ln3945">      // fill with rest</a>
<a name="ln3946">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3947">      oveTrack-&gt;setFillWithRest(placeHolder.toBoolean());</a>
<a name="ln3948"> </a>
<a name="ln3949">      // flat tail</a>
<a name="ln3950">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3951">      oveTrack-&gt;setFlatTail(placeHolder.toBoolean());</a>
<a name="ln3952"> </a>
<a name="ln3953">      // show clef each line</a>
<a name="ln3954">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3955">      oveTrack-&gt;setShowClefEachLine(placeHolder.toBoolean());</a>
<a name="ln3956"> </a>
<a name="ln3957">      if( !jump(12) ) { return false; }</a>
<a name="ln3958"> </a>
<a name="ln3959">      // 8 voices</a>
<a name="ln3960">      int i;</a>
<a name="ln3961">      QList&lt;Voice*&gt; voices;</a>
<a name="ln3962">      for( i=0; i&lt;8; ++i ) {</a>
<a name="ln3963">            Voice* voicePtr = new Voice();</a>
<a name="ln3964"> </a>
<a name="ln3965">            if( !jump(5) ) { return false; }</a>
<a name="ln3966"> </a>
<a name="ln3967">            // channel</a>
<a name="ln3968">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3969">            voicePtr-&gt;setChannel(placeHolder.toUnsignedInt());</a>
<a name="ln3970"> </a>
<a name="ln3971">            // volume</a>
<a name="ln3972">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3973">            voicePtr-&gt;setVolume(placeHolder.toInt());</a>
<a name="ln3974"> </a>
<a name="ln3975">            // pitch shift</a>
<a name="ln3976">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3977">            voicePtr-&gt;setPitchShift(placeHolder.toInt());</a>
<a name="ln3978"> </a>
<a name="ln3979">            // pan</a>
<a name="ln3980">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3981">            voicePtr-&gt;setPan(placeHolder.toInt());</a>
<a name="ln3982"> </a>
<a name="ln3983">            if( !jump(6) ) { return false; }</a>
<a name="ln3984"> </a>
<a name="ln3985">            // patch</a>
<a name="ln3986">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3987">            voicePtr-&gt;setPatch(placeHolder.toInt());</a>
<a name="ln3988"> </a>
<a name="ln3989">            voices.push_back(voicePtr);</a>
<a name="ln3990">            }</a>
<a name="ln3991"> </a>
<a name="ln3992">      // stem type</a>
<a name="ln3993">      for( i=0; i&lt;8; ++i ) {</a>
<a name="ln3994">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln3995">            voices[i]-&gt;setStemType(placeHolder.toUnsignedInt());</a>
<a name="ln3996"> </a>
<a name="ln3997">            oveTrack-&gt;addVoice(voices[i]);</a>
<a name="ln3998">            }</a>
<a name="ln3999"> </a>
<a name="ln4000">      // percussion define</a>
<a name="ln4001">      QList&lt;Track::DrumNode&gt; nodes;</a>
<a name="ln4002">      for(i=0; i&lt;16; ++i) {</a>
<a name="ln4003">            nodes.push_back(Track::DrumNode());</a>
<a name="ln4004">            }</a>
<a name="ln4005"> </a>
<a name="ln4006">      // line</a>
<a name="ln4007">      for( i=0; i&lt;16; ++i ) {</a>
<a name="ln4008">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4009">            nodes[i].line_ = placeHolder.toInt();</a>
<a name="ln4010">            }</a>
<a name="ln4011"> </a>
<a name="ln4012">      // head type</a>
<a name="ln4013">      for( i=0; i&lt;16; ++i ) {</a>
<a name="ln4014">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4015">            nodes[i].headType_ = placeHolder.toUnsignedInt();</a>
<a name="ln4016">            }</a>
<a name="ln4017"> </a>
<a name="ln4018">      // pitch</a>
<a name="ln4019">      for( i=0; i&lt;16; ++i ) {</a>
<a name="ln4020">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4021">            nodes[i].pitch_ = placeHolder.toUnsignedInt();</a>
<a name="ln4022">            }</a>
<a name="ln4023"> </a>
<a name="ln4024">      // voice</a>
<a name="ln4025">      for( i=0; i&lt;16; ++i ) {</a>
<a name="ln4026">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4027">            nodes[i].voice_ = placeHolder.toUnsignedInt();</a>
<a name="ln4028">            }</a>
<a name="ln4029"> </a>
<a name="ln4030">      for( i=0; i&lt;nodes.size(); ++i ) {</a>
<a name="ln4031">            oveTrack-&gt;addDrum(nodes[i]);</a>
<a name="ln4032">            }</a>
<a name="ln4033"> </a>
<a name="ln4034">      /* if( !Jump(17) ) { return false; }</a>
<a name="ln4035"> </a>
<a name="ln4036">   // voice 0 channel</a>
<a name="ln4037">   if( !ReadBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4038">   oveTrack-&gt;setChannel(placeHolder.toUnsignedInt());</a>
<a name="ln4039"> </a>
<a name="ln4040">   // to be continued. if anything important...*/</a>
<a name="ln4041"> </a>
<a name="ln4042">      return true;</a>
<a name="ln4043">      }</a>
<a name="ln4044"> </a>
<a name="ln4045">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln4046">GroupParse::GroupParse(OveSong* ove)</a>
<a name="ln4047">      :BasicParse(ove) {</a>
<a name="ln4048">      }</a>
<a name="ln4049"> </a>
<a name="ln4050">GroupParse::~GroupParse(){</a>
<a name="ln4051">      sizeChunks_.clear();</a>
<a name="ln4052">      }</a>
<a name="ln4053"> </a>
<a name="ln4054">void GroupParse::addSizeChunk(SizeChunk* sizeChunk) {</a>
<a name="ln4055">      sizeChunks_.push_back(sizeChunk);</a>
<a name="ln4056">      }</a>
<a name="ln4057"> </a>
<a name="ln4058">bool GroupParse::parse() {</a>
<a name="ln4059">      return false;</a>
<a name="ln4060">      }</a>
<a name="ln4061"> </a>
<a name="ln4062">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln4063">PageGroupParse::PageGroupParse(OveSong* ove)</a>
<a name="ln4064">      :BasicParse(ove) {</a>
<a name="ln4065">      }</a>
<a name="ln4066"> </a>
<a name="ln4067">PageGroupParse::~PageGroupParse(){</a>
<a name="ln4068">      pageChunks_.clear();</a>
<a name="ln4069">      }</a>
<a name="ln4070"> </a>
<a name="ln4071">void PageGroupParse::addPage(SizeChunk* chunk) {</a>
<a name="ln4072">      pageChunks_.push_back(chunk);</a>
<a name="ln4073">      }</a>
<a name="ln4074"> </a>
<a name="ln4075">bool PageGroupParse::parse() {</a>
<a name="ln4076">      if( pageChunks_.isEmpty() ) {</a>
<a name="ln4077">            return false;</a>
<a name="ln4078">            }</a>
<a name="ln4079"> </a>
<a name="ln4080">      int i;</a>
<a name="ln4081">      for( i=0; i&lt;pageChunks_.size(); ++i ) {</a>
<a name="ln4082">            Page* page = new Page();</a>
<a name="ln4083">            ove_-&gt;addPage(page);</a>
<a name="ln4084"> </a>
<a name="ln4085">            if( !parsePage(pageChunks_[i], page) ) { return false; }</a>
<a name="ln4086">            }</a>
<a name="ln4087"> </a>
<a name="ln4088">      return true;</a>
<a name="ln4089">      }</a>
<a name="ln4090"> </a>
<a name="ln4091">bool PageGroupParse::parsePage(SizeChunk* chunk, Page* page) {</a>
<a name="ln4092">      Block placeHolder(2);</a>
<a name="ln4093">      StreamHandle handle(chunk-&gt;getDataBlock()-&gt;data(), chunk-&gt;getSizeBlock()-&gt;toSize());</a>
<a name="ln4094"> </a>
<a name="ln4095">      handle_ = &amp;handle;</a>
<a name="ln4096"> </a>
<a name="ln4097">      // begin line</a>
<a name="ln4098">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4099">      page-&gt;setBeginLine(placeHolder.toUnsignedInt());</a>
<a name="ln4100"> </a>
<a name="ln4101">      // line count</a>
<a name="ln4102">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4103">      page-&gt;setLineCount(placeHolder.toUnsignedInt());</a>
<a name="ln4104"> </a>
<a name="ln4105">      if( !jump(4) ) { return false; }</a>
<a name="ln4106"> </a>
<a name="ln4107">      // staff interval</a>
<a name="ln4108">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4109">      page-&gt;setStaffInterval(placeHolder.toUnsignedInt());</a>
<a name="ln4110"> </a>
<a name="ln4111">      // line interval</a>
<a name="ln4112">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4113">      page-&gt;setLineInterval(placeHolder.toUnsignedInt());</a>
<a name="ln4114"> </a>
<a name="ln4115">      // staff inline interval</a>
<a name="ln4116">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4117">      page-&gt;setStaffInlineInterval(placeHolder.toUnsignedInt());</a>
<a name="ln4118"> </a>
<a name="ln4119">      // line bar count</a>
<a name="ln4120">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4121">      page-&gt;setLineBarCount(placeHolder.toUnsignedInt());</a>
<a name="ln4122"> </a>
<a name="ln4123">      // page line count</a>
<a name="ln4124">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4125">      page-&gt;setPageLineCount(placeHolder.toUnsignedInt());</a>
<a name="ln4126"> </a>
<a name="ln4127">      // left margin</a>
<a name="ln4128">      if( !readBuffer(placeHolder, 4) ) { return false; }</a>
<a name="ln4129">      page-&gt;setLeftMargin(placeHolder.toUnsignedInt());</a>
<a name="ln4130"> </a>
<a name="ln4131">      // top margin</a>
<a name="ln4132">      if( !readBuffer(placeHolder, 4) ) { return false; }</a>
<a name="ln4133">      page-&gt;setTopMargin(placeHolder.toUnsignedInt());</a>
<a name="ln4134"> </a>
<a name="ln4135">      // right margin</a>
<a name="ln4136">      if( !readBuffer(placeHolder, 4) ) { return false; }</a>
<a name="ln4137">      page-&gt;setRightMargin(placeHolder.toUnsignedInt());</a>
<a name="ln4138"> </a>
<a name="ln4139">      // bottom margin</a>
<a name="ln4140">      if( !readBuffer(placeHolder, 4) ) { return false; }</a>
<a name="ln4141">      page-&gt;setBottomMargin(placeHolder.toUnsignedInt());</a>
<a name="ln4142"> </a>
<a name="ln4143">      // page width</a>
<a name="ln4144">      if( !readBuffer(placeHolder, 4) ) { return false; }</a>
<a name="ln4145">      page-&gt;setPageWidth(placeHolder.toUnsignedInt());</a>
<a name="ln4146"> </a>
<a name="ln4147">      // page height</a>
<a name="ln4148">      if( !readBuffer(placeHolder, 4) ) { return false; }</a>
<a name="ln4149">      page-&gt;setPageHeight(placeHolder.toUnsignedInt());</a>
<a name="ln4150"> </a>
<a name="ln4151">      handle_ = NULL;</a>
<a name="ln4152"> </a>
<a name="ln4153">      return true;</a>
<a name="ln4154">      }</a>
<a name="ln4155"> </a>
<a name="ln4156">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln4157">StaffCountGetter::StaffCountGetter(OveSong* ove)</a>
<a name="ln4158">      :BasicParse(ove) {</a>
<a name="ln4159">      }</a>
<a name="ln4160"> </a>
<a name="ln4161">unsigned int StaffCountGetter::getStaffCount(SizeChunk* chunk) {</a>
<a name="ln4162">      StreamHandle handle(chunk-&gt;getDataBlock()-&gt;data(), chunk-&gt;getSizeBlock()-&gt;toSize());</a>
<a name="ln4163">      Block placeHolder;</a>
<a name="ln4164"> </a>
<a name="ln4165">      handle_ = &amp;handle;</a>
<a name="ln4166"> </a>
<a name="ln4167">      if( !jump(6) ) { return false; }</a>
<a name="ln4168"> </a>
<a name="ln4169">      // staff count</a>
<a name="ln4170">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4171">      return placeHolder.toUnsignedInt();</a>
<a name="ln4172">      }</a>
<a name="ln4173"> </a>
<a name="ln4174">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln4175">LineGroupParse::LineGroupParse(OveSong* ove) :</a>
<a name="ln4176">      BasicParse(ove), chunk_(NULL) {</a>
<a name="ln4177">      }</a>
<a name="ln4178"> </a>
<a name="ln4179">LineGroupParse::~LineGroupParse(){</a>
<a name="ln4180">      chunk_ = NULL;</a>
<a name="ln4181">      lineChunks_.clear();</a>
<a name="ln4182">      staffChunks_.clear();</a>
<a name="ln4183">      }</a>
<a name="ln4184"> </a>
<a name="ln4185">void LineGroupParse::setLineGroup(GroupChunk* chunk) {</a>
<a name="ln4186">      chunk_ = chunk;</a>
<a name="ln4187">      }</a>
<a name="ln4188"> </a>
<a name="ln4189">void LineGroupParse::addLine(SizeChunk* chunk) {</a>
<a name="ln4190">      lineChunks_.push_back(chunk);</a>
<a name="ln4191">      }</a>
<a name="ln4192"> </a>
<a name="ln4193">void LineGroupParse::addStaff(SizeChunk* chunk) {</a>
<a name="ln4194">      staffChunks_.push_back(chunk);</a>
<a name="ln4195">      }</a>
<a name="ln4196"> </a>
<a name="ln4197">bool LineGroupParse::parse() {</a>
<a name="ln4198">      if( lineChunks_.isEmpty() || staffChunks_.size() % lineChunks_.size() != 0 ) { return false; }</a>
<a name="ln4199"> </a>
<a name="ln4200">      int i;</a>
<a name="ln4201">      unsigned int j;</a>
<a name="ln4202">      unsigned int lineStaffCount = staffChunks_.size() / lineChunks_.size();</a>
<a name="ln4203"> </a>
<a name="ln4204">      for( i=0; i&lt;lineChunks_.size(); ++i ) {</a>
<a name="ln4205">            Line* linePtr = new Line();</a>
<a name="ln4206"> </a>
<a name="ln4207">            ove_-&gt;addLine(linePtr);</a>
<a name="ln4208"> </a>
<a name="ln4209">            if( !parseLine(lineChunks_[i], linePtr) ) { return false; }</a>
<a name="ln4210"> </a>
<a name="ln4211">            for( j=lineStaffCount*i; j&lt;lineStaffCount*(i+1); ++j ) {</a>
<a name="ln4212">                  Staff* staffPtr = new Staff();</a>
<a name="ln4213"> </a>
<a name="ln4214">                  linePtr-&gt;addStaff(staffPtr);</a>
<a name="ln4215"> </a>
<a name="ln4216">                  if( !parseStaff(staffChunks_[j], staffPtr) ) { return false; }</a>
<a name="ln4217">                  }</a>
<a name="ln4218">            }</a>
<a name="ln4219"> </a>
<a name="ln4220">      return true;</a>
<a name="ln4221">      }</a>
<a name="ln4222"> </a>
<a name="ln4223">bool LineGroupParse::parseLine(SizeChunk* chunk, Line* line) {</a>
<a name="ln4224">      Block placeHolder;</a>
<a name="ln4225"> </a>
<a name="ln4226">      StreamHandle handle(chunk-&gt;getDataBlock()-&gt;data(), chunk-&gt;getSizeBlock()-&gt;toSize());</a>
<a name="ln4227"> </a>
<a name="ln4228">      handle_ = &amp;handle;</a>
<a name="ln4229"> </a>
<a name="ln4230">      if( !jump(2) ) { return false; }</a>
<a name="ln4231"> </a>
<a name="ln4232">      // begin bar</a>
<a name="ln4233">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4234">      line-&gt;setBeginBar(placeHolder.toUnsignedInt());</a>
<a name="ln4235"> </a>
<a name="ln4236">      // bar count</a>
<a name="ln4237">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4238">      line-&gt;setBarCount(placeHolder.toUnsignedInt());</a>
<a name="ln4239"> </a>
<a name="ln4240">      if( !jump(6) ) { return false; }</a>
<a name="ln4241"> </a>
<a name="ln4242">      // y offset</a>
<a name="ln4243">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4244">      line-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln4245"> </a>
<a name="ln4246">      // left x offset</a>
<a name="ln4247">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4248">      line-&gt;setLeftXOffset(placeHolder.toInt());</a>
<a name="ln4249"> </a>
<a name="ln4250">      // right x offset</a>
<a name="ln4251">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4252">      line-&gt;setRightXOffset(placeHolder.toInt());</a>
<a name="ln4253"> </a>
<a name="ln4254">      if( !jump(4) ) { return false; }</a>
<a name="ln4255"> </a>
<a name="ln4256">      handle_ = NULL;</a>
<a name="ln4257"> </a>
<a name="ln4258">      return true;</a>
<a name="ln4259">      }</a>
<a name="ln4260"> </a>
<a name="ln4261">bool LineGroupParse::parseStaff(SizeChunk* chunk, Staff* staff) {</a>
<a name="ln4262">      Block placeHolder;</a>
<a name="ln4263"> </a>
<a name="ln4264">      StreamHandle handle(chunk-&gt;getDataBlock()-&gt;data(), chunk-&gt;getSizeBlock()-&gt;toSize());</a>
<a name="ln4265"> </a>
<a name="ln4266">      handle_ = &amp;handle;</a>
<a name="ln4267"> </a>
<a name="ln4268">      if( !jump(7) ) { return false; }</a>
<a name="ln4269"> </a>
<a name="ln4270">      // clef</a>
<a name="ln4271">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4272">      staff-&gt;setClefType(placeHolder.toUnsignedInt());</a>
<a name="ln4273"> </a>
<a name="ln4274">      // key</a>
<a name="ln4275">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4276">      staff-&gt;setKeyType(oveKeyToKey(placeHolder.toUnsignedInt()));</a>
<a name="ln4277"> </a>
<a name="ln4278">      if( !jump(2) ) { return false; }</a>
<a name="ln4279"> </a>
<a name="ln4280">      // visible</a>
<a name="ln4281">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4282">      staff-&gt;setVisible(placeHolder.toBoolean());</a>
<a name="ln4283"> </a>
<a name="ln4284">      if( !jump(12) ) { return false; }</a>
<a name="ln4285"> </a>
<a name="ln4286">      // y offset</a>
<a name="ln4287">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4288">      staff-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln4289"> </a>
<a name="ln4290">      int jumpAmount = ove_-&gt;getIsVersion4() ? 26 : 18;</a>
<a name="ln4291">      if( !jump(jumpAmount) ) { return false; }</a>
<a name="ln4292"> </a>
<a name="ln4293">      // group type</a>
<a name="ln4294">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4295">      GroupType groupType = GroupType::None;</a>
<a name="ln4296">      if(placeHolder.toUnsignedInt() == 1) {</a>
<a name="ln4297">            groupType = GroupType::Brace;</a>
<a name="ln4298">            } else if(placeHolder.toUnsignedInt() == 2) {</a>
<a name="ln4299">            groupType = GroupType::Bracket;</a>
<a name="ln4300">            }</a>
<a name="ln4301">      staff-&gt;setGroupType(groupType);</a>
<a name="ln4302"> </a>
<a name="ln4303">      // group staff count</a>
<a name="ln4304">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4305">      staff-&gt;setGroupStaffCount(placeHolder.toUnsignedInt());</a>
<a name="ln4306"> </a>
<a name="ln4307">      handle_ = NULL;</a>
<a name="ln4308"> </a>
<a name="ln4309">      return true;</a>
<a name="ln4310">      }</a>
<a name="ln4311"> </a>
<a name="ln4312">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln4313">BarsParse::BarsParse(OveSong* ove) :</a>
<a name="ln4314">      BasicParse(ove) {</a>
<a name="ln4315">      }</a>
<a name="ln4316"> </a>
<a name="ln4317">BarsParse::~BarsParse(){</a>
<a name="ln4318">      measureChunks_.clear();</a>
<a name="ln4319">      conductChunks_.clear();</a>
<a name="ln4320">      bdatChunks_.clear();</a>
<a name="ln4321">      }</a>
<a name="ln4322"> </a>
<a name="ln4323">void BarsParse::addMeasure(SizeChunk* chunk) {</a>
<a name="ln4324">      measureChunks_.push_back(chunk);</a>
<a name="ln4325">      }</a>
<a name="ln4326"> </a>
<a name="ln4327">void BarsParse::addConduct(SizeChunk* chunk) {</a>
<a name="ln4328">      conductChunks_.push_back(chunk);</a>
<a name="ln4329">      }</a>
<a name="ln4330"> </a>
<a name="ln4331">void BarsParse::addBdat(SizeChunk* chunk) {</a>
<a name="ln4332">      bdatChunks_.push_back(chunk);</a>
<a name="ln4333">      }</a>
<a name="ln4334"> </a>
<a name="ln4335">bool BarsParse::parse() {</a>
<a name="ln4336">      int i;</a>
<a name="ln4337">      int trackMeasureCount = ove_-&gt;getTrackBarCount();</a>
<a name="ln4338">      int trackCount = ove_-&gt;getTrackCount();</a>
<a name="ln4339">      int measureDataCount = trackCount * measureChunks_.size();</a>
<a name="ln4340">      QList&lt;Measure*&gt; measures;</a>
<a name="ln4341">      QList&lt;MeasureData*&gt; measureDatas;</a>
<a name="ln4342"> </a>
<a name="ln4343">      if (measureChunks_.isEmpty() ||</a>
<a name="ln4344">          measureChunks_.size() != conductChunks_.size() ||</a>
<a name="ln4345">          bdatChunks_.size() != measureDataCount) {</a>
<a name="ln4346">            return false;</a>
<a name="ln4347">            }</a>
<a name="ln4348"> </a>
<a name="ln4349">      // add to ove</a>
<a name="ln4350">      for ( i = 0; i &lt; measureChunks_.size(); ++i ) {</a>
<a name="ln4351">            Measure* measure = new Measure(i);</a>
<a name="ln4352"> </a>
<a name="ln4353">            measures.push_back(measure);</a>
<a name="ln4354">            ove_-&gt;addMeasure(measure);</a>
<a name="ln4355">            }</a>
<a name="ln4356"> </a>
<a name="ln4357">      for ( i = 0; i &lt; measureDataCount; ++i ) {</a>
<a name="ln4358">            MeasureData* oveMeasureData = new MeasureData();</a>
<a name="ln4359"> </a>
<a name="ln4360">            measureDatas.push_back(oveMeasureData);</a>
<a name="ln4361">            ove_-&gt;addMeasureData(oveMeasureData);</a>
<a name="ln4362">            }</a>
<a name="ln4363"> </a>
<a name="ln4364">      for ( i = 0; i &lt; measureChunks_.size(); ++i ) {</a>
<a name="ln4365">            Measure* measure = measures[i];</a>
<a name="ln4366"> </a>
<a name="ln4367">            // MEAS</a>
<a name="ln4368">            if( !parseMeas(measure, measureChunks_[i]) ) {</a>
<a name="ln4369">                  QString ss = QString(&quot;failed in parse MEAS %1\n&quot;).arg(i);</a>
<a name="ln4370">                  messageOut(ss);</a>
<a name="ln4371"> </a>
<a name="ln4372">                  return false;</a>
<a name="ln4373">                  }</a>
<a name="ln4374">            }</a>
<a name="ln4375"> </a>
<a name="ln4376">      for ( i = 0; i &lt; conductChunks_.size(); ++i ) {</a>
<a name="ln4377">            // COND</a>
<a name="ln4378">            if( !parseCond(measures[i], measureDatas[i], conductChunks_[i]) ) {</a>
<a name="ln4379">                  QString ss = QString(&quot;failed in parse COND %1\n&quot;).arg(i);</a>
<a name="ln4380">                  messageOut(ss);</a>
<a name="ln4381"> </a>
<a name="ln4382">                  return false;</a>
<a name="ln4383">                  }</a>
<a name="ln4384">            }</a>
<a name="ln4385"> </a>
<a name="ln4386">      for ( i = 0; i &lt; bdatChunks_.size(); ++i ) {</a>
<a name="ln4387">            int measId = i % trackMeasureCount;</a>
<a name="ln4388"> </a>
<a name="ln4389">            // BDAT</a>
<a name="ln4390">            if( !parseBdat(measures[measId], measureDatas[i], bdatChunks_[i]) ) {</a>
<a name="ln4391">                  QString ss = QString(&quot;failed in parse BDAT %1\n&quot;).arg(i);</a>
<a name="ln4392">                  messageOut(ss);</a>
<a name="ln4393"> </a>
<a name="ln4394">                  return false;</a>
<a name="ln4395">                  }</a>
<a name="ln4396"> </a>
<a name="ln4397">            if( notify_ != NULL ) {</a>
<a name="ln4398">                  int measureID = i % trackMeasureCount;</a>
<a name="ln4399">                  int trackID = i / trackMeasureCount;</a>
<a name="ln4400"> </a>
<a name="ln4401">                  //msg.msg_ = OVE_IMPORT_POS;</a>
<a name="ln4402">                  //msg.param1_ = (measureID&lt;&lt;16) + trackMeasureCount;</a>
<a name="ln4403">                  //msg.param2_ = (trackID&lt;&lt;16) + trackCount;</a>
<a name="ln4404"> </a>
<a name="ln4405">                  notify_-&gt;loadPosition(measureID, trackMeasureCount, trackID, trackCount);</a>
<a name="ln4406">                  }</a>
<a name="ln4407">            }</a>
<a name="ln4408"> </a>
<a name="ln4409">      return true;</a>
<a name="ln4410">      }</a>
<a name="ln4411"> </a>
<a name="ln4412">bool BarsParse::parseMeas(Measure* measure, SizeChunk* chunk) {</a>
<a name="ln4413">      Block placeHolder;</a>
<a name="ln4414"> </a>
<a name="ln4415">      StreamHandle measureHandle(chunk-&gt;getDataBlock()-&gt;data(), chunk-&gt;getSizeBlock()-&gt;toSize());</a>
<a name="ln4416"> </a>
<a name="ln4417">      handle_ = &amp;measureHandle;</a>
<a name="ln4418"> </a>
<a name="ln4419">      if( !jump(2) ) { return false; }</a>
<a name="ln4420"> </a>
<a name="ln4421">      // multi-measure rest</a>
<a name="ln4422">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4423">      measure-&gt;setIsMultiMeasureRest(placeHolder.toBoolean());</a>
<a name="ln4424"> </a>
<a name="ln4425">      // pickup</a>
<a name="ln4426">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4427">      measure-&gt;setIsPickup(placeHolder.toBoolean());</a>
<a name="ln4428"> </a>
<a name="ln4429">      if( !jump(4) ) { return false; }</a>
<a name="ln4430"> </a>
<a name="ln4431">      // left barline</a>
<a name="ln4432">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4433">      measure-&gt;setLeftBarline(placeHolder.toUnsignedInt());</a>
<a name="ln4434"> </a>
<a name="ln4435">      // right barline</a>
<a name="ln4436">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4437">      measure-&gt;setRightBarline(placeHolder.toUnsignedInt());</a>
<a name="ln4438"> </a>
<a name="ln4439">      // tempo</a>
<a name="ln4440">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4441">      double tempo = ((double)placeHolder.toUnsignedInt());</a>
<a name="ln4442">      if( ove_-&gt;getIsVersion4() ) {</a>
<a name="ln4443">            tempo /= 100.0;</a>
<a name="ln4444">            }</a>
<a name="ln4445">      measure-&gt;setTypeTempo(tempo);</a>
<a name="ln4446"> </a>
<a name="ln4447">      // bar length(tick)</a>
<a name="ln4448">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4449">      measure-&gt;setLength(placeHolder.toUnsignedInt());</a>
<a name="ln4450"> </a>
<a name="ln4451">      if( !jump(6) ) { return false; }</a>
<a name="ln4452"> </a>
<a name="ln4453">      // bar number offset</a>
<a name="ln4454">      if( !parseOffsetElement(measure-&gt;getBarNumber()) ) { return false; }</a>
<a name="ln4455"> </a>
<a name="ln4456">      if( !jump(2) ) { return false; }</a>
<a name="ln4457"> </a>
<a name="ln4458">      // multi-measure rest count</a>
<a name="ln4459">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4460">      measure-&gt;setMultiMeasureRestCount(placeHolder.toUnsignedInt());</a>
<a name="ln4461"> </a>
<a name="ln4462">      handle_ = NULL;</a>
<a name="ln4463"> </a>
<a name="ln4464">      return true;</a>
<a name="ln4465">      }</a>
<a name="ln4466"> </a>
<a name="ln4467">bool BarsParse::parseCond(Measure* measure, MeasureData* measureData, SizeChunk* chunk) {</a>
<a name="ln4468">      Block placeHolder;</a>
<a name="ln4469"> </a>
<a name="ln4470">      StreamHandle handle(chunk-&gt;getDataBlock()-&gt;data(), chunk-&gt;getSizeBlock()-&gt;toSize());</a>
<a name="ln4471"> </a>
<a name="ln4472">      handle_ = &amp;handle;</a>
<a name="ln4473"> </a>
<a name="ln4474">      // item count</a>
<a name="ln4475">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4476">      unsigned int cnt = placeHolder.toUnsignedInt();</a>
<a name="ln4477"> </a>
<a name="ln4478">      if( !parseTimeSignature(measure, 36) ) { return false; }</a>
<a name="ln4479"> </a>
<a name="ln4480">      for( unsigned int i=0; i&lt;cnt; ++i ) {</a>
<a name="ln4481">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4482">            unsigned int twoByte = placeHolder.toUnsignedInt();</a>
<a name="ln4483">            unsigned int oldBlockSize = twoByte - 11;</a>
<a name="ln4484">            unsigned int newBlockSize = twoByte - 7;</a>
<a name="ln4485"> </a>
<a name="ln4486">            // type id</a>
<a name="ln4487">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4488">            unsigned int thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln4489">            CondType type;</a>
<a name="ln4490"> </a>
<a name="ln4491">            if( !getCondElementType(thisByte, type) ) { return false; }</a>
<a name="ln4492"> </a>
<a name="ln4493">            switch (type) {</a>
<a name="ln4494">                  case CondType::Bar_Number: {</a>
<a name="ln4495">                        if (!parseBarNumber(measure, twoByte - 1)) {</a>
<a name="ln4496">                              return false;</a>
<a name="ln4497">                              }</a>
<a name="ln4498">                        break;</a>
<a name="ln4499">                        }</a>
<a name="ln4500">                  case CondType::Repeat: {</a>
<a name="ln4501">                        if (!parseRepeatSymbol(measureData, oldBlockSize)) {</a>
<a name="ln4502">                              return false;</a>
<a name="ln4503">                              }</a>
<a name="ln4504">                        break;</a>
<a name="ln4505">                        }</a>
<a name="ln4506">                  case CondType::Numeric_Ending: {</a>
<a name="ln4507">                        if (!parseNumericEndings(measureData, oldBlockSize)) {</a>
<a name="ln4508">                              return false;</a>
<a name="ln4509">                              }</a>
<a name="ln4510">                        break;</a>
<a name="ln4511">                        }</a>
<a name="ln4512">                  case CondType::Decorator: {</a>
<a name="ln4513">                        if (!parseDecorators(measureData, newBlockSize)) {</a>
<a name="ln4514">                              return false;</a>
<a name="ln4515">                              }</a>
<a name="ln4516">                        break;</a>
<a name="ln4517">                        }</a>
<a name="ln4518">                  case CondType::Tempo: {</a>
<a name="ln4519">                        if (!parseTempo(measureData, newBlockSize)) {</a>
<a name="ln4520">                              return false;</a>
<a name="ln4521">                              }</a>
<a name="ln4522">                        break;</a>
<a name="ln4523">                        }</a>
<a name="ln4524">                  case CondType::Text: {</a>
<a name="ln4525">                        if (!parseText(measureData, newBlockSize)) {</a>
<a name="ln4526">                              return false;</a>
<a name="ln4527">                              }</a>
<a name="ln4528">                        break;</a>
<a name="ln4529">                        }</a>
<a name="ln4530">                  case CondType::Expression: {</a>
<a name="ln4531">                        if (!parseExpressions(measureData, newBlockSize)) {</a>
<a name="ln4532">                              return false;</a>
<a name="ln4533">                              }</a>
<a name="ln4534">                        break;</a>
<a name="ln4535">                        }</a>
<a name="ln4536">                  case CondType::Time_Parameters: {</a>
<a name="ln4537">                        if (!parseTimeSignatureParameters(measure, newBlockSize)) {</a>
<a name="ln4538">                              return false;</a>
<a name="ln4539">                              }</a>
<a name="ln4540">                        break;</a>
<a name="ln4541">                        }</a>
<a name="ln4542">                  case CondType::Barline_Parameters: {</a>
<a name="ln4543">                        if (!parseBarlineParameters(measure, newBlockSize)) {</a>
<a name="ln4544">                              return false;</a>
<a name="ln4545">                              }</a>
<a name="ln4546">                        break;</a>
<a name="ln4547">                        }</a>
<a name="ln4548">                  default: {</a>
<a name="ln4549">                        if (!jump(newBlockSize)) {</a>
<a name="ln4550">                              return false;</a>
<a name="ln4551">                              }</a>
<a name="ln4552">                        break;</a>
<a name="ln4553">                        }</a>
<a name="ln4554">                  }</a>
<a name="ln4555">            }</a>
<a name="ln4556"> </a>
<a name="ln4557">      handle_ = NULL;</a>
<a name="ln4558"> </a>
<a name="ln4559">      return true;</a>
<a name="ln4560">      }</a>
<a name="ln4561"> </a>
<a name="ln4562">bool BarsParse::parseTimeSignature(Measure* measure, int /*length*/) {</a>
<a name="ln4563">      Block placeHolder;</a>
<a name="ln4564"> </a>
<a name="ln4565">      TimeSignature* timeSignature = measure-&gt;getTime();</a>
<a name="ln4566"> </a>
<a name="ln4567">      // numerator</a>
<a name="ln4568">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4569">      timeSignature-&gt;setNumerator(placeHolder.toUnsignedInt());</a>
<a name="ln4570"> </a>
<a name="ln4571">      // denominator</a>
<a name="ln4572">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4573">      timeSignature-&gt;setDenominator(placeHolder.toUnsignedInt());</a>
<a name="ln4574"> </a>
<a name="ln4575">      if( !jump(2) ) { return false; }</a>
<a name="ln4576"> </a>
<a name="ln4577">      // beat length</a>
<a name="ln4578">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4579">      timeSignature-&gt;setBeatLength(placeHolder.toUnsignedInt());</a>
<a name="ln4580"> </a>
<a name="ln4581">      // bar length</a>
<a name="ln4582">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4583">      timeSignature-&gt;setBarLength(placeHolder.toUnsignedInt());</a>
<a name="ln4584"> </a>
<a name="ln4585">      if( !jump(4) ) { return false; }</a>
<a name="ln4586"> </a>
<a name="ln4587">      // is symbol</a>
<a name="ln4588">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4589">      timeSignature-&gt;setIsSymbol(placeHolder.toBoolean());</a>
<a name="ln4590"> </a>
<a name="ln4591">      if( !jump(1) ) { return false; }</a>
<a name="ln4592"> </a>
<a name="ln4593">      // replace font</a>
<a name="ln4594">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4595">      timeSignature-&gt;setReplaceFont(placeHolder.toBoolean());</a>
<a name="ln4596"> </a>
<a name="ln4597">      // color</a>
<a name="ln4598">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4599">      timeSignature-&gt;setColor(placeHolder.toUnsignedInt());</a>
<a name="ln4600"> </a>
<a name="ln4601">      // show</a>
<a name="ln4602">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4603">      timeSignature-&gt;setShow(placeHolder.toBoolean());</a>
<a name="ln4604"> </a>
<a name="ln4605">      // show beat group</a>
<a name="ln4606">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4607">      timeSignature-&gt;setShowBeatGroup(placeHolder.toBoolean());</a>
<a name="ln4608"> </a>
<a name="ln4609">      if( !jump(6) ) { return false; }</a>
<a name="ln4610"> </a>
<a name="ln4611">      // numerator 1, 2, 3</a>
<a name="ln4612">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4613">      timeSignature-&gt;setGroupNumerator1(placeHolder.toUnsignedInt());</a>
<a name="ln4614">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4615">      timeSignature-&gt;setGroupNumerator2(placeHolder.toUnsignedInt());</a>
<a name="ln4616">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4617">      timeSignature-&gt;setGroupNumerator3(placeHolder.toUnsignedInt());</a>
<a name="ln4618"> </a>
<a name="ln4619">      // denominator</a>
<a name="ln4620">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4621">      timeSignature-&gt;setGroupDenominator1(placeHolder.toUnsignedInt());</a>
<a name="ln4622">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4623">      timeSignature-&gt;setGroupDenominator2(placeHolder.toUnsignedInt());</a>
<a name="ln4624">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4625">      timeSignature-&gt;setGroupDenominator3(placeHolder.toUnsignedInt());</a>
<a name="ln4626"> </a>
<a name="ln4627">      // beam group 1~4</a>
<a name="ln4628">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4629">      timeSignature-&gt;setBeamGroup1(placeHolder.toUnsignedInt());</a>
<a name="ln4630">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4631">      timeSignature-&gt;setBeamGroup2(placeHolder.toUnsignedInt());</a>
<a name="ln4632">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4633">      timeSignature-&gt;setBeamGroup3(placeHolder.toUnsignedInt());</a>
<a name="ln4634">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4635">      timeSignature-&gt;setBeamGroup4(placeHolder.toUnsignedInt());</a>
<a name="ln4636"> </a>
<a name="ln4637">      // beam 16th</a>
<a name="ln4638">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4639">      timeSignature-&gt;set16thBeamCount(placeHolder.toUnsignedInt());</a>
<a name="ln4640"> </a>
<a name="ln4641">      // beam 32th</a>
<a name="ln4642">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4643">      timeSignature-&gt;set32thBeamCount(placeHolder.toUnsignedInt());</a>
<a name="ln4644"> </a>
<a name="ln4645">      return true;</a>
<a name="ln4646">      }</a>
<a name="ln4647"> </a>
<a name="ln4648">bool BarsParse::parseTimeSignatureParameters(Measure* measure, int length) {</a>
<a name="ln4649">      Block placeHolder;</a>
<a name="ln4650">      TimeSignature* ts = measure-&gt;getTime();</a>
<a name="ln4651"> </a>
<a name="ln4652">      int cursor = ove_-&gt;getIsVersion4() ? 10 : 8;</a>
<a name="ln4653">      if( !jump(cursor) ) { return false; }</a>
<a name="ln4654"> </a>
<a name="ln4655">      // numerator</a>
<a name="ln4656">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4657">      unsigned int numerator = placeHolder.toUnsignedInt();</a>
<a name="ln4658"> </a>
<a name="ln4659">      cursor = ove_-&gt;getIsVersion4() ? 11 : 9;</a>
<a name="ln4660">      if( ( length - cursor ) % 8 != 0 || (length - cursor) / 8 != (int)numerator ) {</a>
<a name="ln4661">            return false;</a>
<a name="ln4662">            }</a>
<a name="ln4663"> </a>
<a name="ln4664">      for( unsigned int i =0; i&lt;numerator; ++i ) {</a>
<a name="ln4665">            // beat start unit</a>
<a name="ln4666">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4667">            int beatStart = placeHolder.toUnsignedInt();</a>
<a name="ln4668"> </a>
<a name="ln4669">            // beat length unit</a>
<a name="ln4670">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4671">            int beatLength = placeHolder.toUnsignedInt();</a>
<a name="ln4672"> </a>
<a name="ln4673">            if( !jump(2) ) { return false; }</a>
<a name="ln4674"> </a>
<a name="ln4675">            // beat start tick</a>
<a name="ln4676">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4677">            int beatStartTick = placeHolder.toUnsignedInt();</a>
<a name="ln4678"> </a>
<a name="ln4679">            ts-&gt;addBeat(beatStart, beatLength, beatStartTick);</a>
<a name="ln4680">            }</a>
<a name="ln4681"> </a>
<a name="ln4682">      ts-&gt;endAddBeat();</a>
<a name="ln4683"> </a>
<a name="ln4684">      return true;</a>
<a name="ln4685">      }</a>
<a name="ln4686"> </a>
<a name="ln4687">bool BarsParse::parseBarlineParameters(Measure* measure, int /*length*/) {</a>
<a name="ln4688">      Block placeHolder;</a>
<a name="ln4689"> </a>
<a name="ln4690">      int cursor = ove_-&gt;getIsVersion4() ? 12 : 10;</a>
<a name="ln4691">      if( !jump(cursor) ) { return false; }</a>
<a name="ln4692"> </a>
<a name="ln4693">      // repeat count</a>
<a name="ln4694">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4695">      int repeatCount = placeHolder.toUnsignedInt();</a>
<a name="ln4696"> </a>
<a name="ln4697">      measure-&gt;setBackwardRepeatCount(repeatCount);</a>
<a name="ln4698"> </a>
<a name="ln4699">      if( !jump(6) ) { return false; }</a>
<a name="ln4700"> </a>
<a name="ln4701">      return true;</a>
<a name="ln4702">      }</a>
<a name="ln4703"> </a>
<a name="ln4704">bool BarsParse::parseNumericEndings(MeasureData* measureData, int /*length*/) {</a>
<a name="ln4705">      Block placeHolder;</a>
<a name="ln4706"> </a>
<a name="ln4707">      NumericEnding* numeric = new NumericEnding();</a>
<a name="ln4708">      measureData-&gt;addCrossMeasureElement(numeric, true);</a>
<a name="ln4709"> </a>
<a name="ln4710">      if( !jump(3) ) { return false; }</a>
<a name="ln4711"> </a>
<a name="ln4712">      // common</a>
<a name="ln4713">      if( !parseCommonBlock(numeric) ) { return false; }</a>
<a name="ln4714"> </a>
<a name="ln4715">      if( !jump(6) ) { return false; }</a>
<a name="ln4716"> </a>
<a name="ln4717">      // measure count</a>
<a name="ln4718">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4719">      //int offsetMeasure = placeHolder.toUnsignedInt() - 1;</a>
<a name="ln4720">      int offsetMeasure = placeHolder.toUnsignedInt();</a>
<a name="ln4721">      numeric-&gt;stop()-&gt;setMeasure(offsetMeasure);</a>
<a name="ln4722"> </a>
<a name="ln4723">      if( !jump(2) ) { return false; }</a>
<a name="ln4724"> </a>
<a name="ln4725">      // left x offset</a>
<a name="ln4726">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4727">      numeric-&gt;getLeftShoulder()-&gt;setXOffset(placeHolder.toInt());</a>
<a name="ln4728"> </a>
<a name="ln4729">      // height</a>
<a name="ln4730">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4731">      numeric-&gt;setHeight(placeHolder.toUnsignedInt());</a>
<a name="ln4732"> </a>
<a name="ln4733">      // left x offset</a>
<a name="ln4734">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4735">      numeric-&gt;getRightShoulder()-&gt;setXOffset(placeHolder.toInt());</a>
<a name="ln4736"> </a>
<a name="ln4737">      if( !jump(2) ) { return false; }</a>
<a name="ln4738"> </a>
<a name="ln4739">      // y offset</a>
<a name="ln4740">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4741">      numeric-&gt;getLeftShoulder()-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln4742">      numeric-&gt;getRightShoulder()-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln4743"> </a>
<a name="ln4744">      // number offset</a>
<a name="ln4745">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4746">      numeric-&gt;getNumericHandle()-&gt;setXOffset(placeHolder.toInt());</a>
<a name="ln4747">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4748">      numeric-&gt;getNumericHandle()-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln4749"> </a>
<a name="ln4750">      if( !jump(6) ) { return false; }</a>
<a name="ln4751"> </a>
<a name="ln4752">      // text size</a>
<a name="ln4753">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4754">      unsigned int size = placeHolder.toUnsignedInt();</a>
<a name="ln4755"> </a>
<a name="ln4756">      // text : size maybe a huge value</a>
<a name="ln4757">      if( !readBuffer(placeHolder, size) ) { return false; }</a>
<a name="ln4758">      numeric-&gt;setText(ove_-&gt;getCodecString(placeHolder.fixedSizeBufferToStrByteArray()));</a>
<a name="ln4759"> </a>
<a name="ln4760">      // fix for wedding march.ove</a>
<a name="ln4761">      if( size % 2 == 0 ) {</a>
<a name="ln4762">            if( !jump(1) ) { return false; }</a>
<a name="ln4763">            }</a>
<a name="ln4764"> </a>
<a name="ln4765">      return true;</a>
<a name="ln4766">      }</a>
<a name="ln4767"> </a>
<a name="ln4768">bool BarsParse::parseTempo(MeasureData* measureData, int /*length*/) {</a>
<a name="ln4769">      Block placeHolder;</a>
<a name="ln4770">      unsigned int thisByte;</a>
<a name="ln4771"> </a>
<a name="ln4772">      Tempo* tempo = new Tempo();</a>
<a name="ln4773">      measureData-&gt;addMusicData(tempo);</a>
<a name="ln4774">      if( !jump(3) )</a>
<a name="ln4775">            return false;</a>
<a name="ln4776">      // common</a>
<a name="ln4777">      if( !parseCommonBlock(tempo) )</a>
<a name="ln4778">            return false;</a>
<a name="ln4779">      if( !readBuffer(placeHolder, 1) )</a>
<a name="ln4780">            return false;</a>
<a name="ln4781">      thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln4782">      // show tempo</a>
<a name="ln4783">      tempo-&gt;setShowMark( (getHighNibble(thisByte) &amp; 0x4) == 0x4 );</a>
<a name="ln4784">      // show before text</a>
<a name="ln4785">      tempo-&gt;setShowBeforeText( (getHighNibble(thisByte) &amp; 0x8 ) == 0x8 ) ;</a>
<a name="ln4786">      // show parenthesis</a>
<a name="ln4787">      tempo-&gt;setShowParenthesis( (getHighNibble(thisByte) &amp; 0x1 ) == 0x1 );</a>
<a name="ln4788">      // left note type</a>
<a name="ln4789">      tempo-&gt;setLeftNoteType( getLowNibble(thisByte) );</a>
<a name="ln4790">      // left note dot</a>
<a name="ln4791">      tempo-&gt;setLeftNoteDot((getHighNibble(thisByte) &amp; 0x2 ) == 0x2 );</a>
<a name="ln4792">      if( !jump(1) )  // dimension of the note symbol</a>
<a name="ln4793">            return false;</a>
<a name="ln4794">      if( ove_-&gt;getIsVersion4() ) {</a>
<a name="ln4795">            if( !jump(2) )</a>
<a name="ln4796">                  return false;</a>
<a name="ln4797">            // tempo</a>
<a name="ln4798">            if( !readBuffer(placeHolder, 2) )</a>
<a name="ln4799">                  return false;</a>
<a name="ln4800">            tempo-&gt;setTypeTempo(((double)placeHolder.toUnsignedInt())/100.0);</a>
<a name="ln4801">            }</a>
<a name="ln4802">      else {</a>
<a name="ln4803">            // tempo</a>
<a name="ln4804">            if( !readBuffer(placeHolder, 2) )</a>
<a name="ln4805">                  return false;</a>
<a name="ln4806">            tempo-&gt;setTypeTempo((double)placeHolder.toUnsignedInt());</a>
<a name="ln4807">            if( !jump(2) )</a>
<a name="ln4808">                  return false;</a>
<a name="ln4809">            }</a>
<a name="ln4810">      // offset</a>
<a name="ln4811">      if( !parseOffsetElement(tempo) )</a>
<a name="ln4812">            return false;</a>
<a name="ln4813">      if( !jump(16) )</a>
<a name="ln4814">            return false;</a>
<a name="ln4815">      // 31 bytes left text</a>
<a name="ln4816">      if( !readBuffer(placeHolder, 31) )</a>
<a name="ln4817">            return false;</a>
<a name="ln4818">      tempo-&gt;setLeftText(ove_-&gt;getCodecString(placeHolder.fixedSizeBufferToStrByteArray()));</a>
<a name="ln4819"> </a>
<a name="ln4820">      if( !readBuffer(placeHolder, 1) )</a>
<a name="ln4821">            return false;</a>
<a name="ln4822">      thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln4823">      // swing eighth</a>
<a name="ln4824">      tempo-&gt;setSwingEighth((getHighNibble(thisByte) &amp; 0x4 ) == 0x4 );</a>
<a name="ln4825">      // right note dot</a>
<a name="ln4826">      tempo-&gt;setRightNoteDot((getHighNibble(thisByte) &amp; 0x1 ) == 0x1 );</a>
<a name="ln4827">      // compatibility with v3 files ?</a>
<a name="ln4828">      tempo-&gt;setRightSideType(static_cast&lt;int&gt;(getHighNibble(thisByte) &amp; 0x2));</a>
<a name="ln4829">      // right note type</a>
<a name="ln4830">      tempo-&gt;setRightNoteType(getLowNibble(thisByte));</a>
<a name="ln4831">      // right text</a>
<a name="ln4832">      if( ove_-&gt;getIsVersion4() ) {</a>
<a name="ln4833">            if( !readBuffer(placeHolder, 31) )</a>
<a name="ln4834">                  return false;</a>
<a name="ln4835">            tempo-&gt;setRightText(ove_-&gt;getCodecString(placeHolder.fixedSizeBufferToStrByteArray()));</a>
<a name="ln4836">            if( !readBuffer(placeHolder, 1) )</a>
<a name="ln4837">                  return false;</a>
<a name="ln4838">            // 00 -&gt; float      03 -&gt; integer(floor)     01 -&gt; notetype    02 -&gt; text</a>
<a name="ln4839">            tempo-&gt;setRightSideType(placeHolder.toInt());</a>
<a name="ln4840">            }</a>
<a name="ln4841"> </a>
<a name="ln4842">      return true;</a>
<a name="ln4843">      }</a>
<a name="ln4844"> </a>
<a name="ln4845">bool BarsParse::parseBarNumber(Measure* measure, int /*length*/) {</a>
<a name="ln4846">      Block placeHolder;</a>
<a name="ln4847"> </a>
<a name="ln4848">      BarNumber* barNumber = measure-&gt;getBarNumber();</a>
<a name="ln4849"> </a>
<a name="ln4850">      if( !jump(2) ) { return false; }</a>
<a name="ln4851"> </a>
<a name="ln4852">      // show on paragraph start</a>
<a name="ln4853">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4854">      barNumber-&gt;setShowOnParagraphStart(getLowNibble(placeHolder.toUnsignedInt())==8);</a>
<a name="ln4855"> </a>
<a name="ln4856">      unsigned int blankSize = ove_-&gt;getIsVersion4() ? 9 : 7;</a>
<a name="ln4857">      if( !jump(blankSize) ) { return false; }</a>
<a name="ln4858"> </a>
<a name="ln4859">      // text align</a>
<a name="ln4860">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4861">      barNumber-&gt;setAlign(placeHolder.toUnsignedInt());</a>
<a name="ln4862"> </a>
<a name="ln4863">      if( !jump(4) ) { return false; }</a>
<a name="ln4864"> </a>
<a name="ln4865">      // show flag</a>
<a name="ln4866">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4867">      barNumber-&gt;setShowFlag(placeHolder.toUnsignedInt());</a>
<a name="ln4868"> </a>
<a name="ln4869">      if( !jump(10) ) { return false; }</a>
<a name="ln4870"> </a>
<a name="ln4871">      // bar range</a>
<a name="ln4872">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4873">      barNumber-&gt;setShowEveryBarCount(placeHolder.toUnsignedInt());</a>
<a name="ln4874"> </a>
<a name="ln4875">      // prefix</a>
<a name="ln4876">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4877">      barNumber-&gt;setPrefix(ove_-&gt;getCodecString(placeHolder.fixedSizeBufferToStrByteArray()));</a>
<a name="ln4878"> </a>
<a name="ln4879">      if( !jump(18) ) { return false; }</a>
<a name="ln4880"> </a>
<a name="ln4881">      return true;</a>
<a name="ln4882">      }</a>
<a name="ln4883"> </a>
<a name="ln4884">bool BarsParse::parseText(MeasureData* measureData, int length) {</a>
<a name="ln4885">      Block placeHolder;</a>
<a name="ln4886"> </a>
<a name="ln4887">      Text* text = new Text();</a>
<a name="ln4888">      measureData-&gt;addMusicData(text);</a>
<a name="ln4889"> </a>
<a name="ln4890">      if( !jump(3) ) { return false; }</a>
<a name="ln4891"> </a>
<a name="ln4892">      // common</a>
<a name="ln4893">      if( !parseCommonBlock(text) ) { return false; }</a>
<a name="ln4894"> </a>
<a name="ln4895">      // type</a>
<a name="ln4896">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4897">      unsigned int thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln4898">      bool includeLineBreak = ( (getHighNibble(thisByte)&amp;0x2) != 0x2 );</a>
<a name="ln4899">      unsigned int id = getLowNibble(thisByte);</a>
<a name="ln4900">      Text::Type textType = Text::Type::Rehearsal;</a>
<a name="ln4901"> </a>
<a name="ln4902">      if (id == 0) {</a>
<a name="ln4903">            textType = Text::Type::MeasureText;</a>
<a name="ln4904">            } else if (id == 1) {</a>
<a name="ln4905">            textType = Text::Type::SystemText;</a>
<a name="ln4906">            } else // id ==2</a>
<a name="ln4907">            {</a>
<a name="ln4908">            textType = Text::Type::Rehearsal;</a>
<a name="ln4909">            }</a>
<a name="ln4910"> </a>
<a name="ln4911">      text-&gt;setTextType(textType);</a>
<a name="ln4912"> </a>
<a name="ln4913">      if( !jump(1) ) { return false; }</a>
<a name="ln4914"> </a>
<a name="ln4915">      // x offset</a>
<a name="ln4916">      if( !readBuffer(placeHolder, 4) ) { return false; }</a>
<a name="ln4917">      text-&gt;setXOffset(placeHolder.toInt());</a>
<a name="ln4918"> </a>
<a name="ln4919">      // y offset</a>
<a name="ln4920">      if( !readBuffer(placeHolder, 4) ) { return false; }</a>
<a name="ln4921">      text-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln4922"> </a>
<a name="ln4923">      // width</a>
<a name="ln4924">      if( !readBuffer(placeHolder, 4) ) { return false; }</a>
<a name="ln4925">      text-&gt;setWidth(placeHolder.toUnsignedInt());</a>
<a name="ln4926"> </a>
<a name="ln4927">      // height</a>
<a name="ln4928">      if( !readBuffer(placeHolder, 4) ) { return false; }</a>
<a name="ln4929">      text-&gt;setHeight(placeHolder.toUnsignedInt());</a>
<a name="ln4930"> </a>
<a name="ln4931">      if( !jump(7) ) { return false; }</a>
<a name="ln4932"> </a>
<a name="ln4933">      // horizontal margin</a>
<a name="ln4934">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4935">      text-&gt;setHorizontalMargin(placeHolder.toUnsignedInt());</a>
<a name="ln4936"> </a>
<a name="ln4937">      if( !jump(1) ) { return false; }</a>
<a name="ln4938"> </a>
<a name="ln4939">      // vertical margin</a>
<a name="ln4940">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4941">      text-&gt;setVerticalMargin(placeHolder.toUnsignedInt());</a>
<a name="ln4942"> </a>
<a name="ln4943">      if( !jump(1) ) { return false; }</a>
<a name="ln4944"> </a>
<a name="ln4945">      // line thick</a>
<a name="ln4946">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln4947">      text-&gt;setLineThick(placeHolder.toUnsignedInt());</a>
<a name="ln4948"> </a>
<a name="ln4949">      if( !jump(2) ) { return false; }</a>
<a name="ln4950"> </a>
<a name="ln4951">      // text size</a>
<a name="ln4952">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4953">      unsigned int size = placeHolder.toUnsignedInt();</a>
<a name="ln4954"> </a>
<a name="ln4955">      // text string, maybe huge</a>
<a name="ln4956">      if( !readBuffer(placeHolder, size) ) { return false; }</a>
<a name="ln4957">      text-&gt;setText(ove_-&gt;getCodecString(placeHolder.fixedSizeBufferToStrByteArray()));</a>
<a name="ln4958"> </a>
<a name="ln4959">      if( !includeLineBreak ) {</a>
<a name="ln4960">            if( !jump(6) ) { return false; }</a>
<a name="ln4961">            } else {</a>
<a name="ln4962">            unsigned int cursor = ove_-&gt;getIsVersion4() ? 43 : 41;</a>
<a name="ln4963">            cursor += size;</a>
<a name="ln4964"> </a>
<a name="ln4965">            // multi lines of text</a>
<a name="ln4966">            for( unsigned int i=0; i&lt;2; ++i ) {</a>
<a name="ln4967">                  if( (int)cursor &lt; length ) {</a>
<a name="ln4968">                        // line parameters count</a>
<a name="ln4969">                        if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln4970">                        unsigned int lineCount = placeHolder.toUnsignedInt();</a>
<a name="ln4971"> </a>
<a name="ln4972">                        if( i==0 &amp;&amp; int(cursor + 2 + 8*lineCount) &gt; length ) {</a>
<a name="ln4973">                              return false;</a>
<a name="ln4974">                              }</a>
<a name="ln4975"> </a>
<a name="ln4976">                        if( i==1 &amp;&amp; int(cursor + 2 + 8*lineCount) != length ) {</a>
<a name="ln4977">                              return false;</a>
<a name="ln4978">                              }</a>
<a name="ln4979"> </a>
<a name="ln4980">                        if( !jump(8*lineCount) ) { return false; }</a>
<a name="ln4981"> </a>
<a name="ln4982">                        cursor += 2 + 8*lineCount;</a>
<a name="ln4983">                        }</a>
<a name="ln4984">                  }</a>
<a name="ln4985">            }</a>
<a name="ln4986"> </a>
<a name="ln4987">      return true;</a>
<a name="ln4988">      }</a>
<a name="ln4989"> </a>
<a name="ln4990">bool BarsParse::parseRepeatSymbol(MeasureData* measureData, int /*length*/) {</a>
<a name="ln4991">      Block placeHolder;</a>
<a name="ln4992"> </a>
<a name="ln4993">      RepeatSymbol* repeat = new RepeatSymbol();</a>
<a name="ln4994">      measureData-&gt;addMusicData(repeat);</a>
<a name="ln4995"> </a>
<a name="ln4996">      if( !jump(3) ) { return false; }</a>
<a name="ln4997"> </a>
<a name="ln4998">      // common</a>
<a name="ln4999">      if( !parseCommonBlock(repeat) ) { return false; }</a>
<a name="ln5000"> </a>
<a name="ln5001">      // RepeatType</a>
<a name="ln5002">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5003">      repeat-&gt;setRepeatType(placeHolder.toUnsignedInt());</a>
<a name="ln5004"> </a>
<a name="ln5005">      if( !jump(13) ) { return false; }</a>
<a name="ln5006"> </a>
<a name="ln5007">      // offset</a>
<a name="ln5008">      if( !parseOffsetElement(repeat) ) { return false; }</a>
<a name="ln5009"> </a>
<a name="ln5010">      if( !jump(15) ) { return false; }</a>
<a name="ln5011"> </a>
<a name="ln5012">      // size</a>
<a name="ln5013">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5014">      unsigned int size = placeHolder.toUnsignedInt();</a>
<a name="ln5015"> </a>
<a name="ln5016">      // text, maybe huge</a>
<a name="ln5017">      if( !readBuffer(placeHolder, size) ) { return false; }</a>
<a name="ln5018">      repeat-&gt;setText(ove_-&gt;getCodecString(placeHolder.fixedSizeBufferToStrByteArray()));</a>
<a name="ln5019"> </a>
<a name="ln5020">      // last 0</a>
<a name="ln5021">      if( size % 2 == 0 ) {</a>
<a name="ln5022">            if( !jump(1) ) { return false; }</a>
<a name="ln5023">            }</a>
<a name="ln5024"> </a>
<a name="ln5025">      return true;</a>
<a name="ln5026">      }</a>
<a name="ln5027"> </a>
<a name="ln5028">bool BarsParse::parseBdat(Measure* /*measure*/, MeasureData* measureData, SizeChunk* chunk) {</a>
<a name="ln5029">      Block placeHolder;</a>
<a name="ln5030">      StreamHandle handle(chunk-&gt;getDataBlock()-&gt;data(), chunk-&gt;getSizeBlock()-&gt;toSize());</a>
<a name="ln5031"> </a>
<a name="ln5032">      handle_ = &amp;handle;</a>
<a name="ln5033"> </a>
<a name="ln5034">      // parse here</a>
<a name="ln5035">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5036">      unsigned int cnt = placeHolder.toUnsignedInt();</a>
<a name="ln5037"> </a>
<a name="ln5038">      for( unsigned int i=0; i&lt;cnt; ++i ) {</a>
<a name="ln5039">            // 0x0028 or 0x0016 or 0x002C</a>
<a name="ln5040">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5041">            unsigned int count = placeHolder.toUnsignedInt() - 7;</a>
<a name="ln5042"> </a>
<a name="ln5043">            // type id</a>
<a name="ln5044">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5045">            unsigned int thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln5046">            BdatType type;</a>
<a name="ln5047"> </a>
<a name="ln5048">            if( !getBdatElementType(thisByte, type) ) { return false; }</a>
<a name="ln5049"> </a>
<a name="ln5050">            switch( type ) {</a>
<a name="ln5051">                  case BdatType::Raw_Note :</a>
<a name="ln5052">                  case BdatType::Rest :</a>
<a name="ln5053">                  case BdatType::Note : {</a>
<a name="ln5054">                        if( !parseNoteRest(measureData, count, type) ) { return false; }</a>
<a name="ln5055">                        break;</a>
<a name="ln5056">                        }</a>
<a name="ln5057">                  case BdatType::Beam : {</a>
<a name="ln5058">                        if( !parseBeam(measureData, count) ) { return false; }</a>
<a name="ln5059">                        break;</a>
<a name="ln5060">                        }</a>
<a name="ln5061">                  case BdatType::Harmony : {</a>
<a name="ln5062">                        if( !parseHarmony(measureData, count) ) { return false; }</a>
<a name="ln5063">                        break;</a>
<a name="ln5064">                        }</a>
<a name="ln5065">                  case BdatType::Clef : {</a>
<a name="ln5066">                        if( !parseClef(measureData, count) ) { return false; }</a>
<a name="ln5067">                        break;</a>
<a name="ln5068">                        }</a>
<a name="ln5069">                  case BdatType::Dynamics : {</a>
<a name="ln5070">                        if( !parseDynamics(measureData, count) ) { return false; }</a>
<a name="ln5071">                        break;</a>
<a name="ln5072">                        }</a>
<a name="ln5073">                  case BdatType::Wedge : {</a>
<a name="ln5074">                        if( !parseWedge(measureData, count) ) { return false; }</a>
<a name="ln5075">                        break;</a>
<a name="ln5076">                        }</a>
<a name="ln5077">                  case BdatType::Glissando : {</a>
<a name="ln5078">                        if( !parseGlissando(measureData, count) ) { return false; }</a>
<a name="ln5079">                        break;</a>
<a name="ln5080">                        }</a>
<a name="ln5081">                  case BdatType::Decorator : {</a>
<a name="ln5082">                        if( !parseDecorators(measureData, count) ) { return false; }</a>
<a name="ln5083">                        break;</a>
<a name="ln5084">                        }</a>
<a name="ln5085">                  case BdatType::Key : {</a>
<a name="ln5086">                        if( !parseKey(measureData, count) ) { return false; }</a>
<a name="ln5087">                        break;</a>
<a name="ln5088">                        }</a>
<a name="ln5089">                  case BdatType::Lyric : {</a>
<a name="ln5090">                        if( !parseLyric(measureData, count) ) { return false; }</a>
<a name="ln5091">                        break;</a>
<a name="ln5092">                        }</a>
<a name="ln5093">                  case BdatType::Octave_Shift: {</a>
<a name="ln5094">                        if( !parseOctaveShift(measureData, count) ) { return false; }</a>
<a name="ln5095">                        break;</a>
<a name="ln5096">                        }</a>
<a name="ln5097">                  case BdatType::Slur : {</a>
<a name="ln5098">                        if( !parseSlur(measureData, count) ) { return false; }</a>
<a name="ln5099">                        break;</a>
<a name="ln5100">                        }</a>
<a name="ln5101">                  case BdatType::Text : {</a>
<a name="ln5102">                        if( !parseText(measureData, count) ) { return false; }</a>
<a name="ln5103">                        break;</a>
<a name="ln5104">                        }</a>
<a name="ln5105">                  case BdatType::Tie : {</a>
<a name="ln5106">                        if( !parseTie(measureData, count) ) { return false; }</a>
<a name="ln5107">                        break;</a>
<a name="ln5108">                        }</a>
<a name="ln5109">                  case BdatType::Tuplet : {</a>
<a name="ln5110">                        if( !parseTuplet(measureData, count) ) { return false; }</a>
<a name="ln5111">                        break;</a>
<a name="ln5112">                        }</a>
<a name="ln5113">                  case BdatType::Guitar_Bend :</a>
<a name="ln5114">                  case BdatType::Guitar_Barre : {</a>
<a name="ln5115">                        if( !parseSizeBlock(count) ) { return false; }</a>
<a name="ln5116">                        break;</a>
<a name="ln5117">                        }</a>
<a name="ln5118">                  case BdatType::Pedal: {</a>
<a name="ln5119">                        if( !parsePedal(measureData, count) ) { return false; }</a>
<a name="ln5120">                        break;</a>
<a name="ln5121">                        }</a>
<a name="ln5122">                  case BdatType::KuoHao: {</a>
<a name="ln5123">                        if( !parseKuohao(measureData, count) ) { return false; }</a>
<a name="ln5124">                        break;</a>
<a name="ln5125">                        }</a>
<a name="ln5126">                  case BdatType::Expressions: {</a>
<a name="ln5127">                        if( !parseExpressions(measureData, count) ) { return false; }</a>
<a name="ln5128">                        break;</a>
<a name="ln5129">                        }</a>
<a name="ln5130">                  case BdatType::Harp_Pedal: {</a>
<a name="ln5131">                        if( !parseHarpPedal(measureData, count) ) { return false; }</a>
<a name="ln5132">                        break;</a>
<a name="ln5133">                        }</a>
<a name="ln5134">                  case BdatType::Multi_Measure_Rest: {</a>
<a name="ln5135">                        if( !parseMultiMeasureRest(measureData, count) ) { return false; }</a>
<a name="ln5136">                        break;</a>
<a name="ln5137">                        }</a>
<a name="ln5138">                  case BdatType::Harmony_GuitarFrame: {</a>
<a name="ln5139">                        if( !parseHarmonyGuitarFrame(measureData, count) ) { return false; }</a>
<a name="ln5140">                        break;</a>
<a name="ln5141">                        }</a>
<a name="ln5142">                  case BdatType::Graphics_40:</a>
<a name="ln5143">                  case BdatType::Graphics_RoundRect:</a>
<a name="ln5144">                  case BdatType::Graphics_Rect:</a>
<a name="ln5145">                  case BdatType::Graphics_Round:</a>
<a name="ln5146">                  case BdatType::Graphics_Line:</a>
<a name="ln5147">                  case BdatType::Graphics_Curve:</a>
<a name="ln5148">                  case BdatType::Graphics_WedgeSymbol: {</a>
<a name="ln5149">                        if( !parseSizeBlock(count) ) { return false; }</a>
<a name="ln5150">                        break;</a>
<a name="ln5151">                        }</a>
<a name="ln5152">                  case BdatType::Midi_Controller : {</a>
<a name="ln5153">                        if( !parseMidiController(measureData, count) ) { return false; }</a>
<a name="ln5154">                        break;</a>
<a name="ln5155">                        }</a>
<a name="ln5156">                  case BdatType::Midi_Program_Change : {</a>
<a name="ln5157">                        if( !parseMidiProgramChange(measureData, count) ) { return false; }</a>
<a name="ln5158">                        break;</a>
<a name="ln5159">                        }</a>
<a name="ln5160">                  case BdatType::Midi_Channel_Pressure : {</a>
<a name="ln5161">                        if( !parseMidiChannelPressure(measureData, count) ) { return false; }</a>
<a name="ln5162">                        break;</a>
<a name="ln5163">                        }</a>
<a name="ln5164">                  case BdatType::Midi_Pitch_Wheel : {</a>
<a name="ln5165">                        if( !parseMidiPitchWheel(measureData, count) ) { return false; }</a>
<a name="ln5166">                        break;</a>
<a name="ln5167">                        }</a>
<a name="ln5168">                  default: {</a>
<a name="ln5169">                        if( !jump(count) ) { return false; }</a>
<a name="ln5170">                        break;</a>
<a name="ln5171">                        }</a>
<a name="ln5172">                  }</a>
<a name="ln5173"> </a>
<a name="ln5174">            // if i==count-1 then is bar end place holder</a>
<a name="ln5175">            }</a>
<a name="ln5176"> </a>
<a name="ln5177">      handle_ = NULL;</a>
<a name="ln5178"> </a>
<a name="ln5179">      return true;</a>
<a name="ln5180">      }</a>
<a name="ln5181"> </a>
<a name="ln5182">int getInt(int byte, int bits) {</a>
<a name="ln5183">      int num = 0;</a>
<a name="ln5184"> </a>
<a name="ln5185">      if( bits &gt; 0 ) {</a>
<a name="ln5186">            int factor = int(pow(2.0, bits-1));</a>
<a name="ln5187">            num = (byte % (factor*2));</a>
<a name="ln5188"> </a>
<a name="ln5189">            if ( (byte &amp; factor) == factor ) {</a>
<a name="ln5190">                  num -= factor*2;</a>
<a name="ln5191">                  }</a>
<a name="ln5192">            }</a>
<a name="ln5193"> </a>
<a name="ln5194">      return num;</a>
<a name="ln5195">      }</a>
<a name="ln5196"> </a>
<a name="ln5197">bool BarsParse::parseNoteRest(MeasureData* measureData, int length, BdatType type) {</a>
<a name="ln5198">      NoteContainer* container = new NoteContainer();</a>
<a name="ln5199">      Block placeHolder;</a>
<a name="ln5200">      unsigned int thisByte;</a>
<a name="ln5201"> </a>
<a name="ln5202">      measureData-&gt;addNoteContainer(container);</a>
<a name="ln5203">      measureData-&gt;addMusicData(container);</a>
<a name="ln5204"> </a>
<a name="ln5205">      // note|rest &amp; grace</a>
<a name="ln5206">      container-&gt;setIsRest(type==BdatType::Rest);</a>
<a name="ln5207">      container-&gt;setIsRaw(type==BdatType::Raw_Note);</a>
<a name="ln5208"> </a>
<a name="ln5209">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5210">      thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln5211">      container-&gt;setIsGrace( thisByte == 0x3C00 );</a>
<a name="ln5212">      container-&gt;setIsCue( thisByte == 0x4B40 || thisByte == 0x3240 );</a>
<a name="ln5213"> </a>
<a name="ln5214">      // show / hide</a>
<a name="ln5215">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5216">      thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln5217">      container-&gt;setShow(getLowNibble(thisByte)!=0x8);</a>
<a name="ln5218"> </a>
<a name="ln5219">      // voice</a>
<a name="ln5220">      container-&gt;setVoice(getLowNibble(thisByte)&amp;0x7);</a>
<a name="ln5221"> </a>
<a name="ln5222">      // common</a>
<a name="ln5223">      if( !parseCommonBlock(container) ) { return false; }</a>
<a name="ln5224"> </a>
<a name="ln5225">      // tuplet</a>
<a name="ln5226">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5227">      container-&gt;setTuplet(placeHolder.toUnsignedInt());</a>
<a name="ln5228"> </a>
<a name="ln5229">      // space</a>
<a name="ln5230">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5231">      container-&gt;setSpace(placeHolder.toUnsignedInt());</a>
<a name="ln5232"> </a>
<a name="ln5233">      // in beam</a>
<a name="ln5234">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5235">      thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln5236">      bool inBeam = ( getHighNibble(thisByte) &amp; 0x1 ) == 0x1;</a>
<a name="ln5237">      container-&gt;setInBeam(inBeam);</a>
<a name="ln5238"> </a>
<a name="ln5239">      // grace NoteType</a>
<a name="ln5240">      container-&gt;setGraceNoteType((NoteType)getHighNibble(thisByte));</a>
<a name="ln5241"> </a>
<a name="ln5242">      // dot</a>
<a name="ln5243">      container-&gt;setDot(getLowNibble(thisByte)&amp;0x03);</a>
<a name="ln5244"> </a>
<a name="ln5245">      // NoteType</a>
<a name="ln5246">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5247">      thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln5248">      container-&gt;setNoteType((NoteType)getLowNibble(thisByte));</a>
<a name="ln5249"> </a>
<a name="ln5250">      int cursor = 0;</a>
<a name="ln5251"> </a>
<a name="ln5252">      if( type == BdatType::Rest ) {</a>
<a name="ln5253">            Note* restPtr = new Note();</a>
<a name="ln5254">            container-&gt;addNoteRest(restPtr);</a>
<a name="ln5255">            restPtr-&gt;setIsRest(true);</a>
<a name="ln5256"> </a>
<a name="ln5257">            // line</a>
<a name="ln5258">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5259">            restPtr-&gt;setLine(placeHolder.toInt());</a>
<a name="ln5260"> </a>
<a name="ln5261">            if( !jump(1) ) { return false; }</a>
<a name="ln5262"> </a>
<a name="ln5263">            cursor = ove_-&gt;getIsVersion4() ? 16 : 14;</a>
<a name="ln5264">            } else // type == Bdat_Note || type == Bdat_Raw_Note</a>
<a name="ln5265">            {</a>
<a name="ln5266">            // stem up 0x80, stem down 0x00</a>
<a name="ln5267">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5268">            thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln5269">            container-&gt;setStemUp((getHighNibble(thisByte)&amp;0x8)==0x8);</a>
<a name="ln5270"> </a>
<a name="ln5271">            // stem length</a>
<a name="ln5272">            int stemOffset = thisByte%0x80;</a>
<a name="ln5273">            container-&gt;setStemLength(getInt(stemOffset, 7)+7/*3.5 line span*/);</a>
<a name="ln5274"> </a>
<a name="ln5275">            // show stem 0x00, hide stem 0x40</a>
<a name="ln5276">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5277">            bool hideStem = getHighNibble(thisByte)==0x4;</a>
<a name="ln5278">            container-&gt;setShowStem(!hideStem);</a>
<a name="ln5279"> </a>
<a name="ln5280">            if( !jump(1) ) { return false; }</a>
<a name="ln5281"> </a>
<a name="ln5282">            // note count</a>
<a name="ln5283">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5284">            unsigned int noteCount = placeHolder.toUnsignedInt();</a>
<a name="ln5285">            unsigned int i;</a>
<a name="ln5286"> </a>
<a name="ln5287">            // each note 16 bytes</a>
<a name="ln5288">            for( i=0; i&lt;noteCount; ++i ) {</a>
<a name="ln5289">                  Note* notePtr = new Note();</a>
<a name="ln5290">                  notePtr-&gt;setIsRest(false);</a>
<a name="ln5291"> </a>
<a name="ln5292">                  container-&gt;addNoteRest(notePtr);</a>
<a name="ln5293"> </a>
<a name="ln5294">                  // note show / hide</a>
<a name="ln5295">                  if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5296">                  thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln5297">                  notePtr-&gt;setShow((thisByte&amp;0x80) != 0x80);</a>
<a name="ln5298"> </a>
<a name="ln5299">                  // notehead type</a>
<a name="ln5300">                  notePtr-&gt;setHeadType(thisByte&amp;0x7f);</a>
<a name="ln5301"> </a>
<a name="ln5302">                  // tie pos</a>
<a name="ln5303">                  if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5304">                  thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln5305">                  notePtr-&gt;setTiePos(getHighNibble(thisByte));</a>
<a name="ln5306"> </a>
<a name="ln5307">                  // offset staff, in {-1, 0, 1}</a>
<a name="ln5308">                  if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5309">                  thisByte = getLowNibble(placeHolder.toUnsignedInt());</a>
<a name="ln5310">                  int offsetStaff = 0;</a>
<a name="ln5311">                  if( thisByte == 1 ) { offsetStaff = 1; }</a>
<a name="ln5312">                  if( thisByte == 7 ) { offsetStaff = -1; }</a>
<a name="ln5313">                  notePtr-&gt;setOffsetStaff(offsetStaff);</a>
<a name="ln5314"> </a>
<a name="ln5315">                  // accidental</a>
<a name="ln5316">                  if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5317">                  thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln5318">                  notePtr-&gt;setAccidental(getLowNibble(thisByte));</a>
<a name="ln5319">                  // accidental 0: influenced by key, 4: influenced by previous accidental in measure</a>
<a name="ln5320">                  //bool notShow = ( getHighNibble(thisByte) == 0 ) || ( getHighNibble(thisByte) == 4 );</a>
<a name="ln5321">                  bool notShow = !(getHighNibble(thisByte)&amp;0x1);</a>
<a name="ln5322">                  notePtr-&gt;setShowAccidental(!notShow);</a>
<a name="ln5323"> </a>
<a name="ln5324">                  if( !jump(1) ) { return false; }</a>
<a name="ln5325"> </a>
<a name="ln5326">                  // line</a>
<a name="ln5327">                  if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5328">                  notePtr-&gt;setLine(placeHolder.toInt());</a>
<a name="ln5329"> </a>
<a name="ln5330">                  if( !jump(1) ) { return false; }</a>
<a name="ln5331"> </a>
<a name="ln5332">                  // note</a>
<a name="ln5333">                  if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5334">                  unsigned int note = placeHolder.toUnsignedInt();</a>
<a name="ln5335">                  notePtr-&gt;setNote(note);</a>
<a name="ln5336"> </a>
<a name="ln5337">                  // note on velocity</a>
<a name="ln5338">                  if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5339">                  unsigned int onVelocity = placeHolder.toUnsignedInt();</a>
<a name="ln5340">                  notePtr-&gt;setOnVelocity(onVelocity);</a>
<a name="ln5341"> </a>
<a name="ln5342">                  // note off velocity</a>
<a name="ln5343">                  if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5344">                  unsigned int offVelocity = placeHolder.toUnsignedInt();</a>
<a name="ln5345">                  notePtr-&gt;setOffVelocity(offVelocity);</a>
<a name="ln5346"> </a>
<a name="ln5347">                  if( !jump(2) ) { return false; }</a>
<a name="ln5348"> </a>
<a name="ln5349">                  // length (tick)</a>
<a name="ln5350">                  if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5351">                  container-&gt;setLength(placeHolder.toUnsignedInt());</a>
<a name="ln5352"> </a>
<a name="ln5353">                  // offset tick</a>
<a name="ln5354">                  if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5355">                  notePtr-&gt;setOffsetTick(placeHolder.toInt());</a>
<a name="ln5356">                  }</a>
<a name="ln5357"> </a>
<a name="ln5358">            cursor = ove_-&gt;getIsVersion4() ? 18 : 16;</a>
<a name="ln5359">            cursor += noteCount * 16/*note size*/;</a>
<a name="ln5360">            }</a>
<a name="ln5361"> </a>
<a name="ln5362">      // articulation</a>
<a name="ln5363">      while ( cursor &lt; length + 1/* 0x70 || 0x80 || 0x90 */ ) {</a>
<a name="ln5364">            Articulation* art = new Articulation();</a>
<a name="ln5365">            container-&gt;addArticulation(art);</a>
<a name="ln5366"> </a>
<a name="ln5367">            // block size</a>
<a name="ln5368">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5369">            int blockSize = placeHolder.toUnsignedInt();</a>
<a name="ln5370"> </a>
<a name="ln5371">            // articulation type</a>
<a name="ln5372">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5373">            art-&gt;setArtType(placeHolder.toUnsignedInt());</a>
<a name="ln5374"> </a>
<a name="ln5375">            // placement</a>
<a name="ln5376">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5377">            art-&gt;setPlacementAbove(placeHolder.toUnsignedInt()!=0x00); //0x00:below, 0x30:above</a>
<a name="ln5378"> </a>
<a name="ln5379">            // offset</a>
<a name="ln5380">            if( !parseOffsetElement(art) ) { return false; }</a>
<a name="ln5381"> </a>
<a name="ln5382">            if( !ove_-&gt;getIsVersion4() ) {</a>
<a name="ln5383">                  if( blockSize - 8 &gt; 0 ) {</a>
<a name="ln5384">                        if( !jump(blockSize-8) ) { return false; }</a>
<a name="ln5385">                        }</a>
<a name="ln5386">                  } else {</a>
<a name="ln5387">                  // setting</a>
<a name="ln5388">                  if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5389">                  thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln5390">                  const bool changeSoundEffect = ( ( thisByte &amp; 0x1 ) == 0x1 );</a>
<a name="ln5391">                  const bool changeLength = ( ( thisByte &amp; 0x2 ) == 0x2 );</a>
<a name="ln5392">                  const bool changeVelocity = ( ( thisByte &amp; 0x4 ) == 0x4 );</a>
<a name="ln5393">                  //const bool changeExtraLength = ( ( thisByte &amp; 0x20 ) == 0x20 );</a>
<a name="ln5394"> </a>
<a name="ln5395">                  if( !jump(8) ) { return false; }</a>
<a name="ln5396"> </a>
<a name="ln5397">                  // velocity type</a>
<a name="ln5398">                  if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5399">                  thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln5400">                  if( changeVelocity ) {</a>
<a name="ln5401">                        art-&gt;setVelocityType((Articulation::VelocityType)thisByte);</a>
<a name="ln5402">                        }</a>
<a name="ln5403"> </a>
<a name="ln5404">                  if( !jump(14) ) { return false; }</a>
<a name="ln5405"> </a>
<a name="ln5406">                  // sound effect</a>
<a name="ln5407">                  if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5408">                  int from = placeHolder.toInt();</a>
<a name="ln5409">                  if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5410">                  int to = placeHolder.toInt();</a>
<a name="ln5411">                  if( changeSoundEffect ) {</a>
<a name="ln5412">                        art-&gt;setSoundEffect(from, to);</a>
<a name="ln5413">                        }</a>
<a name="ln5414"> </a>
<a name="ln5415">                  if( !jump(1) ) { return false; }</a>
<a name="ln5416"> </a>
<a name="ln5417">                  // length percentage</a>
<a name="ln5418">                  if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5419">                  if( changeLength ) {</a>
<a name="ln5420">                        art-&gt;setLengthPercentage(placeHolder.toUnsignedInt());</a>
<a name="ln5421">                        }</a>
<a name="ln5422"> </a>
<a name="ln5423">                  // velocity</a>
<a name="ln5424">                  if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5425">                  if( changeVelocity ) {</a>
<a name="ln5426">                        art-&gt;setVelocityValue(placeHolder.toInt());</a>
<a name="ln5427">                        }</a>
<a name="ln5428"> </a>
<a name="ln5429">                  if( Articulation::isTrill(art-&gt;getArtType()) ) {</a>
<a name="ln5430">                        if( !jump(8) ) { return false; }</a>
<a name="ln5431"> </a>
<a name="ln5432">                        // trill note length</a>
<a name="ln5433">                        if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5434">                        art-&gt;setTrillNoteLength(placeHolder.toUnsignedInt());</a>
<a name="ln5435"> </a>
<a name="ln5436">                        // trill rate</a>
<a name="ln5437">                        if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5438">                        thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln5439">                        NoteType trillNoteType = NoteType::Note_Sixteen;</a>
<a name="ln5440">                        switch ( getHighNibble(thisByte) ) {</a>
<a name="ln5441">                              case 0:</a>
<a name="ln5442">                                    trillNoteType = NoteType::Note_None;</a>
<a name="ln5443">                                    break;</a>
<a name="ln5444">                              case 1:</a>
<a name="ln5445">                                    trillNoteType = NoteType::Note_Sixteen;</a>
<a name="ln5446">                                    break;</a>
<a name="ln5447">                              case 2:</a>
<a name="ln5448">                                    trillNoteType = NoteType::Note_32;</a>
<a name="ln5449">                                    break;</a>
<a name="ln5450">                              case 3:</a>
<a name="ln5451">                                    trillNoteType = NoteType::Note_64;</a>
<a name="ln5452">                                    break;</a>
<a name="ln5453">                              case 4:</a>
<a name="ln5454">                                    trillNoteType = NoteType::Note_128;</a>
<a name="ln5455">                                    break;</a>
<a name="ln5456">                              default:</a>
<a name="ln5457">                                    break;</a>
<a name="ln5458">                              }</a>
<a name="ln5459">                        art-&gt;setTrillRate(trillNoteType);</a>
<a name="ln5460"> </a>
<a name="ln5461">                        // accelerate type</a>
<a name="ln5462">                        art-&gt;setAccelerateType(thisByte&amp;0xf);</a>
<a name="ln5463"> </a>
<a name="ln5464">                        if( !jump(1) ) { return false; }</a>
<a name="ln5465"> </a>
<a name="ln5466">                        // auxiliary first</a>
<a name="ln5467">                        if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5468">                        art-&gt;setAuxiliaryFirst(placeHolder.toBoolean());</a>
<a name="ln5469"> </a>
<a name="ln5470">                        if( !jump(1) ) { return false; }</a>
<a name="ln5471"> </a>
<a name="ln5472">                        // trill interval</a>
<a name="ln5473">                        if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5474">                        art-&gt;setTrillInterval(placeHolder.toUnsignedInt());</a>
<a name="ln5475">                        } else {</a>
<a name="ln5476">                        if( blockSize &gt; 40 ) {</a>
<a name="ln5477">                              if( !jump( blockSize - 40 ) ) { return false; }</a>
<a name="ln5478">                              }</a>
<a name="ln5479">                        }</a>
<a name="ln5480">                  }</a>
<a name="ln5481"> </a>
<a name="ln5482">            cursor += blockSize;</a>
<a name="ln5483">            }</a>
<a name="ln5484"> </a>
<a name="ln5485">      return true;</a>
<a name="ln5486">      }</a>
<a name="ln5487"> </a>
<a name="ln5488">int tupletToSpace(int tuplet) {</a>
<a name="ln5489">      int a(1);</a>
<a name="ln5490"> </a>
<a name="ln5491">      while( a*2 &lt; tuplet ) {</a>
<a name="ln5492">            a *= 2;</a>
<a name="ln5493">            }</a>
<a name="ln5494"> </a>
<a name="ln5495">      return a;</a>
<a name="ln5496">      }</a>
<a name="ln5497"> </a>
<a name="ln5498">bool BarsParse::parseBeam(MeasureData* measureData, int length) {</a>
<a name="ln5499">      int i;</a>
<a name="ln5500">      Block placeHolder;</a>
<a name="ln5501"> </a>
<a name="ln5502">      Beam* beam = new Beam();</a>
<a name="ln5503">      measureData-&gt;addCrossMeasureElement(beam, true);</a>
<a name="ln5504"> </a>
<a name="ln5505">      // maybe create tuplet, for &lt; quarter &amp; tool 3(</a>
<a name="ln5506">      bool createTuplet = false;</a>
<a name="ln5507">      int maxEndUnit = 0;</a>
<a name="ln5508">      Tuplet* tuplet = new Tuplet();</a>
<a name="ln5509"> </a>
<a name="ln5510">      // is grace</a>
<a name="ln5511">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5512">      beam-&gt;setIsGrace(placeHolder.toBoolean());</a>
<a name="ln5513"> </a>
<a name="ln5514">      if( !jump(1) ) { return false; }</a>
<a name="ln5515"> </a>
<a name="ln5516">      // voice</a>
<a name="ln5517">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5518">      beam-&gt;setVoice(getLowNibble(placeHolder.toUnsignedInt())&amp;0x7);</a>
<a name="ln5519"> </a>
<a name="ln5520">      // common</a>
<a name="ln5521">      if( !parseCommonBlock(beam) ) { return false; }</a>
<a name="ln5522"> </a>
<a name="ln5523">      if( !jump(2) ) { return false; }</a>
<a name="ln5524"> </a>
<a name="ln5525">      // beam count</a>
<a name="ln5526">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5527">      int beamCount = placeHolder.toUnsignedInt();</a>
<a name="ln5528"> </a>
<a name="ln5529">      if( !jump(1) ) { return false; }</a>
<a name="ln5530"> </a>
<a name="ln5531">      // left line</a>
<a name="ln5532">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5533">      beam-&gt;getLeftLine()-&gt;setLine(placeHolder.toInt());</a>
<a name="ln5534"> </a>
<a name="ln5535">      // right line</a>
<a name="ln5536">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5537">      beam-&gt;getRightLine()-&gt;setLine(placeHolder.toInt());</a>
<a name="ln5538"> </a>
<a name="ln5539">      if( ove_-&gt;getIsVersion4() ) {</a>
<a name="ln5540">            if( !jump(8) ) { return false; }</a>
<a name="ln5541">            }</a>
<a name="ln5542"> </a>
<a name="ln5543">      int currentCursor = ove_-&gt;getIsVersion4() ? 23 : 13;</a>
<a name="ln5544">      int count = (length - currentCursor)/16;</a>
<a name="ln5545"> </a>
<a name="ln5546">      if( count != beamCount ) { return false; }</a>
<a name="ln5547"> </a>
<a name="ln5548">      for( i=0; i&lt;count; ++i ) {</a>
<a name="ln5549">            if( !jump(1) ) { return false; }</a>
<a name="ln5550"> </a>
<a name="ln5551">            // tuplet</a>
<a name="ln5552">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5553">            int tupletCount = placeHolder.toUnsignedInt();</a>
<a name="ln5554">            if( tupletCount &gt; 0 ) {</a>
<a name="ln5555">                  createTuplet = true;</a>
<a name="ln5556">                  tuplet-&gt;setTuplet(tupletCount);</a>
<a name="ln5557">                  tuplet-&gt;setSpace(tupletToSpace(tupletCount));</a>
<a name="ln5558">                  }</a>
<a name="ln5559"> </a>
<a name="ln5560">            // start / stop measure</a>
<a name="ln5561">            // line i start end position</a>
<a name="ln5562">            MeasurePos startMp;</a>
<a name="ln5563">            MeasurePos stopMp;</a>
<a name="ln5564"> </a>
<a name="ln5565">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5566">            startMp.setMeasure(placeHolder.toUnsignedInt());</a>
<a name="ln5567">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5568">            stopMp.setMeasure(placeHolder.toUnsignedInt());</a>
<a name="ln5569"> </a>
<a name="ln5570">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5571">            startMp.setOffset(placeHolder.toInt());</a>
<a name="ln5572">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5573">            stopMp.setOffset(placeHolder.toInt());</a>
<a name="ln5574"> </a>
<a name="ln5575">            beam-&gt;addLine(startMp, stopMp);</a>
<a name="ln5576"> </a>
<a name="ln5577">            if( stopMp.getOffset() &gt; maxEndUnit ) {</a>
<a name="ln5578">                  maxEndUnit = stopMp.getOffset();</a>
<a name="ln5579">                  }</a>
<a name="ln5580"> </a>
<a name="ln5581">            if( i == 0 ) {</a>
<a name="ln5582">                  if( !jump(4) ) { return false; }</a>
<a name="ln5583"> </a>
<a name="ln5584">                  // left offset up+4, down-4</a>
<a name="ln5585">                  if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5586">                  beam-&gt;getLeftShoulder()-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln5587"> </a>
<a name="ln5588">                  // right offset up+4, down-4</a>
<a name="ln5589">                  if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5590">                  beam-&gt;getRightShoulder()-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln5591">                  } else {</a>
<a name="ln5592">                  if( !jump(8) ) { return false; }</a>
<a name="ln5593">                  }</a>
<a name="ln5594">            }</a>
<a name="ln5595"> </a>
<a name="ln5596">      const QList&lt;QPair&lt;MeasurePos, MeasurePos&gt; &gt; lines = beam-&gt;getLines();</a>
<a name="ln5597">      MeasurePos offsetMp;</a>
<a name="ln5598"> </a>
<a name="ln5599">      for( i=0; i&lt;lines.size(); ++i ) {</a>
<a name="ln5600">            if( lines[i].second &gt; offsetMp ) {</a>
<a name="ln5601">                  offsetMp = lines[i].second;</a>
<a name="ln5602">                  }</a>
<a name="ln5603">            }</a>
<a name="ln5604"> </a>
<a name="ln5605">      beam-&gt;stop()-&gt;setMeasure(offsetMp.getMeasure());</a>
<a name="ln5606">      beam-&gt;stop()-&gt;setOffset(offsetMp.getOffset());</a>
<a name="ln5607"> </a>
<a name="ln5608">      // a case that Tuplet block don't exist, and hide inside beam</a>
<a name="ln5609">      if( createTuplet ) {</a>
<a name="ln5610">            tuplet-&gt;copyCommonBlock(*beam);</a>
<a name="ln5611">            tuplet-&gt;getLeftLine()-&gt;setLine(beam-&gt;getLeftLine()-&gt;getLine());</a>
<a name="ln5612">            tuplet-&gt;getRightLine()-&gt;setLine(beam-&gt;getRightLine()-&gt;getLine());</a>
<a name="ln5613">            tuplet-&gt;stop()-&gt;setMeasure(beam-&gt;stop()-&gt;getMeasure());</a>
<a name="ln5614">            tuplet-&gt;stop()-&gt;setOffset(maxEndUnit);</a>
<a name="ln5615"> </a>
<a name="ln5616">            measureData-&gt;addCrossMeasureElement(tuplet, true);</a>
<a name="ln5617">            } else {</a>
<a name="ln5618">            delete tuplet;</a>
<a name="ln5619">            }</a>
<a name="ln5620"> </a>
<a name="ln5621">      return true;</a>
<a name="ln5622">      }</a>
<a name="ln5623"> </a>
<a name="ln5624">bool BarsParse::parseTie(MeasureData* measureData, int /*length*/) {</a>
<a name="ln5625">      Block placeHolder;</a>
<a name="ln5626"> </a>
<a name="ln5627">      Tie* tie = new Tie();</a>
<a name="ln5628">      measureData-&gt;addCrossMeasureElement(tie, true);</a>
<a name="ln5629"> </a>
<a name="ln5630">      if( !jump(3) ) { return false; }</a>
<a name="ln5631"> </a>
<a name="ln5632">      // start common</a>
<a name="ln5633">      if( !parseCommonBlock(tie) ) { return false; }</a>
<a name="ln5634"> </a>
<a name="ln5635">      if( !jump(1) ) { return false; }</a>
<a name="ln5636"> </a>
<a name="ln5637">      // note</a>
<a name="ln5638">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5639">      tie-&gt;setNote(placeHolder.toUnsignedInt());</a>
<a name="ln5640"> </a>
<a name="ln5641">      // pair lines</a>
<a name="ln5642">      if( !parsePairLinesBlock(tie) ) { return false; }</a>
<a name="ln5643"> </a>
<a name="ln5644">      // offset common</a>
<a name="ln5645">      if( !parseOffsetCommonBlock(tie) ) { return false; }</a>
<a name="ln5646"> </a>
<a name="ln5647">      // left shoulder offset</a>
<a name="ln5648">      if( !parseOffsetElement(tie-&gt;getLeftShoulder()) ) { return false; }</a>
<a name="ln5649"> </a>
<a name="ln5650">      // right shoulder offset</a>
<a name="ln5651">      if( !parseOffsetElement(tie-&gt;getRightShoulder()) ) { return false; }</a>
<a name="ln5652"> </a>
<a name="ln5653">      // height</a>
<a name="ln5654">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5655">      tie-&gt;setHeight(placeHolder.toUnsignedInt());</a>
<a name="ln5656"> </a>
<a name="ln5657">      return true;</a>
<a name="ln5658">      }</a>
<a name="ln5659"> </a>
<a name="ln5660">bool BarsParse::parseTuplet(MeasureData* measureData, int /*length*/) {</a>
<a name="ln5661">      Block placeHolder;</a>
<a name="ln5662"> </a>
<a name="ln5663">      Tuplet* tuplet = new Tuplet();</a>
<a name="ln5664">      measureData-&gt;addCrossMeasureElement(tuplet, true);</a>
<a name="ln5665"> </a>
<a name="ln5666">      if( !jump(3) ) { return false; }</a>
<a name="ln5667"> </a>
<a name="ln5668">      // common</a>
<a name="ln5669">      if( !parseCommonBlock(tuplet) ) { return false; }</a>
<a name="ln5670"> </a>
<a name="ln5671">      if( !jump(2) ) { return false; }</a>
<a name="ln5672"> </a>
<a name="ln5673">      // pair lines</a>
<a name="ln5674">      if( !parsePairLinesBlock(tuplet) ) { return false; }</a>
<a name="ln5675"> </a>
<a name="ln5676">      // offset common</a>
<a name="ln5677">      if( !parseOffsetCommonBlock(tuplet) ) { return false; }</a>
<a name="ln5678"> </a>
<a name="ln5679">      // left shoulder offset</a>
<a name="ln5680">      if( !parseOffsetElement(tuplet-&gt;getLeftShoulder()) ) { return false; }</a>
<a name="ln5681"> </a>
<a name="ln5682">      // right shoulder offset</a>
<a name="ln5683">      if( !parseOffsetElement(tuplet-&gt;getRightShoulder()) ) { return false; }</a>
<a name="ln5684"> </a>
<a name="ln5685">      if( !jump(2) ) { return false; }</a>
<a name="ln5686"> </a>
<a name="ln5687">      // height</a>
<a name="ln5688">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5689">      tuplet-&gt;setHeight(placeHolder.toUnsignedInt());</a>
<a name="ln5690"> </a>
<a name="ln5691">      // tuplet</a>
<a name="ln5692">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5693">      tuplet-&gt;setTuplet(placeHolder.toUnsignedInt());</a>
<a name="ln5694"> </a>
<a name="ln5695">      // space</a>
<a name="ln5696">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5697">      tuplet-&gt;setSpace(placeHolder.toUnsignedInt());</a>
<a name="ln5698"> </a>
<a name="ln5699">      // mark offset</a>
<a name="ln5700">      if( !parseOffsetElement(tuplet-&gt;getMarkHandle()) ) { return false; }</a>
<a name="ln5701"> </a>
<a name="ln5702">      return true;</a>
<a name="ln5703">      }</a>
<a name="ln5704"> </a>
<a name="ln5705">QString binaryToHarmonyType(int bin) {</a>
<a name="ln5706">      QString type = &quot;&quot;;</a>
<a name="ln5707">      switch (bin) {</a>
<a name="ln5708">            case 0x0005: { type = &quot;add9(no3)&quot;;        break; }</a>
<a name="ln5709">            case 0x0009: { type = &quot;min(no5)&quot;;         break; }</a>
<a name="ln5710">            case 0x0011: { type = &quot;(no5)&quot;;            break; }</a>
<a name="ln5711">            case 0x0021: { type = &quot;sus(no5)&quot;;         break; }</a>
<a name="ln5712">            case 0x0025: { type = &quot;24&quot;;               break; }</a>
<a name="ln5713">            case 0x0029: { type = &quot;min4(no5)&quot;;        break; }</a>
<a name="ln5714">            case 0x0049: { type = &quot;dim&quot;;              break; }</a>
<a name="ln5715">            case 0x0051: { type = &quot;(b5)&quot;;             break; }</a>
<a name="ln5716">            case 0x0055: { type = &quot;2#4(no5)&quot;;         break; }</a>
<a name="ln5717">            case 0x0081: { type = &quot;(no3)&quot;;            break; }</a>
<a name="ln5718">            case 0x0085: { type = &quot;2&quot;;                break; }</a>
<a name="ln5719">            case 0x0089: { type = &quot;min&quot;;              break; }</a>
<a name="ln5720">            case 0x008D: { type = &quot;min(add9)&quot;;        break; }</a>
<a name="ln5721">            case 0x0091: { type = &quot;&quot;;                 break; }</a>
<a name="ln5722">            case 0x0093: { type = &quot;addb9&quot;;            break; }</a>
<a name="ln5723">            case 0x0095: { type = &quot;add9&quot;;             break; }</a>
<a name="ln5724">            case 0x00A1: { type = &quot;sus4&quot;;             break; }</a>
<a name="ln5725">            case 0x00A5: { type = &quot;sus(add9)&quot;;        break; }</a>
<a name="ln5726">            case 0x00A9: { type = &quot;min4&quot;;             break; }</a>
<a name="ln5727">            case 0x00D5: { type = &quot;2#4&quot;;              break; }</a>
<a name="ln5728">            case 0x0111: { type = &quot;aug&quot;;              break; }</a>
<a name="ln5729">            case 0x0115: { type = &quot;aug(add9)&quot;;        break; }</a>
<a name="ln5730">            case 0x0151: { type = &quot;(b5b6)&quot;;           break; }</a>
<a name="ln5731">            case 0x0155: { type = &quot;+add9#11&quot;;         break; }</a>
<a name="ln5732">            case 0x0189: { type = &quot;minb6&quot;;            break; }</a>
<a name="ln5733">            case 0x018D: { type = &quot;min2b6&quot;;           break; }</a>
<a name="ln5734">            case 0x0191: { type = &quot;(b6)&quot;;             break; }</a>
<a name="ln5735">            case 0x0199: { type = &quot;(add9)b6&quot;;         break; }</a>
<a name="ln5736">            case 0x0205: { type = &quot;26&quot;;               break; }</a>
<a name="ln5737">            case 0x020D: { type = &quot;min69&quot;;            break; }</a>
<a name="ln5738">            case 0x0211: { type = &quot;6&quot;;                break; }</a>
<a name="ln5739">            case 0x0215: { type = &quot;69&quot;;               break; }</a>
<a name="ln5740">            case 0x022D: { type = &quot;min69 11&quot;;         break; }</a>
<a name="ln5741">            case 0x0249: { type = &quot;dim7&quot;;             break; }</a>
<a name="ln5742">            case 0x0251: { type = &quot;6#11&quot;;             break; }</a>
<a name="ln5743">            case 0x0255: { type = &quot;13#11&quot;;            break; }</a>
<a name="ln5744">            case 0x0281: { type = &quot;6(no3)&quot;;           break; }</a>
<a name="ln5745">            case 0x0285: { type = &quot;69(no3)&quot;;          break; }</a>
<a name="ln5746">            case 0x0289: { type = &quot;min6&quot;;             break; }</a>
<a name="ln5747">            case 0x028D: { type = &quot;min69&quot;;            break; }</a>
<a name="ln5748">            case 0x0291: { type = &quot;6&quot;;                break; }</a>
<a name="ln5749">            case 0x0293: { type = &quot;6b9&quot;;              break; }</a>
<a name="ln5750">            case 0x0295: { type = &quot;69&quot;;               break; }</a>
<a name="ln5751">            case 0x02AD: { type = &quot;min69 11&quot;;         break; }</a>
<a name="ln5752">            case 0x02C5: { type = &quot;69#11(no3)&quot;;       break; }</a>
<a name="ln5753">            case 0x02D5: { type = &quot;69#11&quot;;            break; }</a>
<a name="ln5754">            case 0x040D: { type = &quot;min9(no5)&quot;;        break; }</a>
<a name="ln5755">            case 0x0411: { type = &quot;7(no5)&quot;;           break; }</a>
<a name="ln5756">            case 0x0413: { type = &quot;7b9&quot;;              break; }</a>
<a name="ln5757">            case 0x0415: { type = &quot;9&quot;;                break; }</a>
<a name="ln5758">            case 0x0419: { type = &quot;7#9&quot;;              break; }</a>
<a name="ln5759">            case 0x041B: { type = &quot;7b9#9&quot;;            break; }</a>
<a name="ln5760">            case 0x0421: { type = &quot;sus7&quot;;             break; }</a>
<a name="ln5761">            case 0x0429: { type = &quot;min11&quot;;            break; }</a>
<a name="ln5762">            case 0x042D: { type = &quot;min11&quot;;            break; }</a>
<a name="ln5763">            case 0x0445: { type = &quot;9b5(no3)&quot;;         break; }</a>
<a name="ln5764">            case 0x0449: { type = &quot;min7b5&quot;;           break; }</a>
<a name="ln5765">            case 0x044D: { type = &quot;min9b5&quot;;           break; }</a>
<a name="ln5766">            case 0x0451: { type = &quot;7b5&quot;;              break; }</a>
<a name="ln5767">            case 0x0453: { type = &quot;7b9b5&quot;;            break; }</a>
<a name="ln5768">            case 0x0455: { type = &quot;9b5&quot;;              break; }</a>
<a name="ln5769">            case 0x045B: { type = &quot;7b5b9#9&quot;;          break; }</a>
<a name="ln5770">            case 0x0461: { type = &quot;sus7b5&quot;;           break; }</a>
<a name="ln5771">            case 0x0465: { type = &quot;sus9b5&quot;;           break; }</a>
<a name="ln5772">            case 0x0469: { type = &quot;min11b5&quot;;          break; }</a>
<a name="ln5773">            case 0x046D: { type = &quot;min11b5&quot;;          break; }</a>
<a name="ln5774">            case 0x0481: { type = &quot;7(no3)&quot;;           break; }</a>
<a name="ln5775">            case 0x0489: { type = &quot;min7&quot;;             break; }</a>
<a name="ln5776">            case 0x048D: { type = &quot;min9&quot;;             break; }</a>
<a name="ln5777">            case 0x0491: { type = &quot;7&quot;;                break; }</a>
<a name="ln5778">            case 0x0493: { type = &quot;7b9&quot;;              break; }</a>
<a name="ln5779">            case 0x0495: { type = &quot;9&quot;;                break; }</a>
<a name="ln5780">            case 0x0499: { type = &quot;7#9&quot;;              break; }</a>
<a name="ln5781">            case 0x049B: { type = &quot;7b9#9&quot;;            break; }</a>
<a name="ln5782">            case 0x04A1: { type = &quot;sus7&quot;;             break; }</a>
<a name="ln5783">            case 0x04A5: { type = &quot;sus9&quot;;             break; }</a>
<a name="ln5784">            case 0x04A9: { type = &quot;min11&quot;;            break; }</a>
<a name="ln5785">            case 0x04AD: { type = &quot;min11&quot;;            break; }</a>
<a name="ln5786">            case 0x04B5: { type = &quot;11&quot;;               break; }</a>
<a name="ln5787">            case 0x04D5: { type = &quot;9#11&quot;;             break; }</a>
<a name="ln5788">            case 0x0509: { type = &quot;min7#5&quot;;           break; }</a>
<a name="ln5789">            case 0x0511: { type = &quot;aug7&quot;;             break; }</a>
<a name="ln5790">            case 0x0513: { type = &quot;7#5b9&quot;;            break; }</a>
<a name="ln5791">            case 0x0515: { type = &quot;aug9&quot;;             break; }</a>
<a name="ln5792">            case 0x0519: { type = &quot;7#5#9&quot;;            break; }</a>
<a name="ln5793">            case 0x0529: { type = &quot;min11b13&quot;;         break; }</a>
<a name="ln5794">            case 0x0533: { type = &quot;11b9#5&quot;;           break; }</a>
<a name="ln5795">            case 0x0551: { type = &quot;aug7#11&quot;;          break; }</a>
<a name="ln5796">            case 0x0553: { type = &quot;7b5b9b13&quot;;         break; }</a>
<a name="ln5797">            case 0x0555: { type = &quot;aug9#11&quot;;          break; }</a>
<a name="ln5798">            case 0x0559: { type = &quot;aug7#9#11&quot;;        break; }</a>
<a name="ln5799">            case 0x0609: { type = &quot;min13&quot;;            break; }</a>
<a name="ln5800">            case 0x0611: { type = &quot;13&quot;;               break; }</a>
<a name="ln5801">            case 0x0613: { type = &quot;13b9&quot;;             break; }</a>
<a name="ln5802">            case 0x0615: { type = &quot;13&quot;;               break; }</a>
<a name="ln5803">            case 0x0619: { type = &quot;13#9&quot;;             break; }</a>
<a name="ln5804">            case 0x061B: { type = &quot;13b9#9&quot;;           break; }</a>
<a name="ln5805">            case 0x0621: { type = &quot;sus13&quot;;            break; }</a>
<a name="ln5806">            case 0x062D: { type = &quot;min13(11)&quot;;        break; }</a>
<a name="ln5807">            case 0x0633: { type = &quot;13b9add4&quot;;         break; }</a>
<a name="ln5808">            case 0x0635: { type = &quot;13&quot;;               break; }</a>
<a name="ln5809">            case 0x0645: { type = &quot;13#11(no3)&quot;;       break; }</a>
<a name="ln5810">            case 0x0651: { type = &quot;13b5&quot;;             break; }</a>
<a name="ln5811">            case 0x0653: { type = &quot;13b9#11&quot;;          break; }</a>
<a name="ln5812">            case 0x0655: { type = &quot;13#11&quot;;            break; }</a>
<a name="ln5813">            case 0x0659: { type = &quot;13#9b5&quot;;           break; }</a>
<a name="ln5814">            case 0x065B: { type = &quot;13b5b9#9&quot;;         break; }</a>
<a name="ln5815">            case 0x0685: { type = &quot;13(no3)&quot;;          break; }</a>
<a name="ln5816">            case 0x068D: { type = &quot;min13&quot;;            break; }</a>
<a name="ln5817">            case 0x0691: { type = &quot;13&quot;;               break; }</a>
<a name="ln5818">            case 0x0693: { type = &quot;13b9&quot;;             break; }</a>
<a name="ln5819">            case 0x0695: { type = &quot;13&quot;;               break; }</a>
<a name="ln5820">            case 0x0699: { type = &quot;13#9&quot;;             break; }</a>
<a name="ln5821">            case 0x06A5: { type = &quot;sus13&quot;;            break; }</a>
<a name="ln5822">            case 0x06AD: { type = &quot;min13(11)&quot;;        break; }</a>
<a name="ln5823">            case 0x06B5: { type = &quot;13&quot;;               break; }</a>
<a name="ln5824">            case 0x06D5: { type = &quot;13#11&quot;;            break; }</a>
<a name="ln5825">            case 0x0813: { type = &quot;maj7b9&quot;;           break; }</a>
<a name="ln5826">            case 0x0851: { type = &quot;maj7#11&quot;;          break; }</a>
<a name="ln5827">            case 0x0855: { type = &quot;maj9#11&quot;;          break; }</a>
<a name="ln5828">            case 0x0881: { type = &quot;maj7(no3)&quot;;        break; }</a>
<a name="ln5829">            case 0x0889: { type = &quot;min(\u266e7)&quot;;     break; }   // &quot;min(&lt;sym&gt;accidentalNatural&lt;/sym&gt;7)&quot;</a>
<a name="ln5830">            case 0x088D: { type = &quot;min9(\u266e7)&quot;;    break; }   // &quot;min9(&lt;sym&gt;accidentalNatural&lt;/sym&gt;7)&quot;</a>
<a name="ln5831">            case 0x0891: { type = &quot;maj7&quot;;             break; }</a>
<a name="ln5832">            case 0x0895: { type = &quot;maj9&quot;;             break; }</a>
<a name="ln5833">            case 0x08C9: { type = &quot;dim7(add maj 7)&quot;;  break; }</a>
<a name="ln5834">            case 0x08D1: { type = &quot;maj7#11&quot;;          break; }</a>
<a name="ln5835">            case 0x08D5: { type = &quot;maj9#11&quot;;          break; }</a>
<a name="ln5836">            case 0x0911: { type = &quot;maj7#5&quot;;           break; }</a>
<a name="ln5837">            case 0x0991: { type = &quot;maj7#5&quot;;           break; }</a>
<a name="ln5838">            case 0x0995: { type = &quot;maj9#5&quot;;            break; }</a>
<a name="ln5839">            case 0x0A0D: { type = &quot;min69(\u266e7)&quot;;   break; }   // &quot;min69(&lt;sym&gt;accidentalNatural&lt;/sym&gt;7)&quot;</a>
<a name="ln5840">            case 0x0A11: { type = &quot;maj13&quot;;            break; }</a>
<a name="ln5841">            case 0x0A15: { type = &quot;maj13&quot;;            break; }</a>
<a name="ln5842">            case 0x0A51: { type = &quot;maj13#11&quot;;         break; }</a>
<a name="ln5843">            case 0x0A55: { type = &quot;maj13#11&quot;;         break; }</a>
<a name="ln5844">            case 0x0A85: { type = &quot;maj13(no3)&quot;;       break; }</a>
<a name="ln5845">            case 0x0A89: { type = &quot;min13(\u266e7)&quot;;   break; }   // &quot;min13(&lt;sym&gt;accidentalNatural&lt;/sym&gt;7)&quot;</a>
<a name="ln5846">            case 0x0A8D: { type = &quot;min69(\u266e7)&quot;;   break; }   // &quot;min69(&lt;sym&gt;accidentalNatural&lt;/sym&gt;7)&quot;</a>
<a name="ln5847">            case 0x0A91: { type = &quot;maj13&quot;;            break; }</a>
<a name="ln5848">            case 0x0A95: { type = &quot;maj13&quot;;            break; }</a>
<a name="ln5849">            case 0x0AAD: { type = &quot;min13(\u266e7)&quot;;   break; }   // &quot;min13(&lt;sym&gt;accidentalNatural&lt;/sym&gt;7)&quot;</a>
<a name="ln5850">            case 0x0AD5: { type = &quot;maj13#11&quot;;         break; }</a>
<a name="ln5851">            case 0x0B45: { type = &quot;maj13#5#11(no4)&quot;;  break; }</a>
<a name="ln5852">            default: {</a>
<a name="ln5853">                  qDebug(&quot;Unrecognized harmony type: %04X&quot;,bin);</a>
<a name="ln5854">                  type = &quot;&quot;;</a>
<a name="ln5855">                  break;</a>
<a name="ln5856">                  }</a>
<a name="ln5857">            }</a>
<a name="ln5858">      return type;</a>
<a name="ln5859">      }</a>
<a name="ln5860"> </a>
<a name="ln5861">bool BarsParse::parseHarmony(MeasureData* measureData, int /*length*/) {</a>
<a name="ln5862">      Block placeHolder;</a>
<a name="ln5863"> </a>
<a name="ln5864">      Harmony* harmony = new Harmony();</a>
<a name="ln5865">      measureData-&gt;addMusicData(harmony);</a>
<a name="ln5866"> </a>
<a name="ln5867">      if( !jump(3) ) { return false; }</a>
<a name="ln5868"> </a>
<a name="ln5869">      // common</a>
<a name="ln5870">      if( !parseCommonBlock(harmony) ) { return false; }</a>
<a name="ln5871"> </a>
<a name="ln5872">      // bass on bottom</a>
<a name="ln5873">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5874">      harmony-&gt;setBassOnBottom((getHighNibble(placeHolder.toUnsignedInt()) &amp; 0x4));</a>
<a name="ln5875"> </a>
<a name="ln5876">      // root alteration</a>
<a name="ln5877">      switch (placeHolder.toUnsignedInt() &amp; 0x18) {</a>
<a name="ln5878">            case 0: {</a>
<a name="ln5879">                  harmony-&gt;setAlterRoot(0); // natural</a>
<a name="ln5880">                  break;</a>
<a name="ln5881">                  }</a>
<a name="ln5882">            case 16: {</a>
<a name="ln5883">                  harmony-&gt;setAlterRoot(-1); // flat</a>
<a name="ln5884">                  break;</a>
<a name="ln5885">                  }</a>
<a name="ln5886">            case 8: {</a>
<a name="ln5887">                  harmony-&gt;setAlterRoot(1); // sharp</a>
<a name="ln5888">                  break;</a>
<a name="ln5889">                  }</a>
<a name="ln5890">            default: {</a>
<a name="ln5891">                  harmony-&gt;setAlterRoot(0);</a>
<a name="ln5892">                  break;</a>
<a name="ln5893">                  }</a>
<a name="ln5894">            }</a>
<a name="ln5895"> </a>
<a name="ln5896">      // bass alteration</a>
<a name="ln5897">      switch (placeHolder.toUnsignedInt() &amp; 0x3) {</a>
<a name="ln5898">            case 0: {</a>
<a name="ln5899">                  harmony-&gt;setAlterBass(0); // natural</a>
<a name="ln5900">                  break;</a>
<a name="ln5901">                  }</a>
<a name="ln5902">            case 2: {</a>
<a name="ln5903">                  harmony-&gt;setAlterBass(-1); // flat</a>
<a name="ln5904">                  break;</a>
<a name="ln5905">                  }</a>
<a name="ln5906">            case 1: {</a>
<a name="ln5907">                  harmony-&gt;setAlterBass(1); // sharp</a>
<a name="ln5908">                  break;</a>
<a name="ln5909">                  }</a>
<a name="ln5910">            default: {</a>
<a name="ln5911">                  harmony-&gt;setAlterBass(0);</a>
<a name="ln5912">                  break;</a>
<a name="ln5913">                  }</a>
<a name="ln5914">            }</a>
<a name="ln5915"> </a>
<a name="ln5916">      // show bass</a>
<a name="ln5917">      bool useBass = placeHolder.toUnsignedInt() &amp; 0x80;</a>
<a name="ln5918"> </a>
<a name="ln5919">      if( !jump(1) ) { return false; }</a>
<a name="ln5920"> </a>
<a name="ln5921">      // y offset</a>
<a name="ln5922">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5923">      harmony-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln5924"> </a>
<a name="ln5925">      // harmony type</a>
<a name="ln5926">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5927">      harmony-&gt;setHarmonyType(binaryToHarmonyType(placeHolder.toUnsignedInt()));</a>
<a name="ln5928"> </a>
<a name="ln5929">      // root</a>
<a name="ln5930">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5931">      harmony-&gt;setRoot(placeHolder.toInt());</a>
<a name="ln5932"> </a>
<a name="ln5933">      // bass</a>
<a name="ln5934">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5935">      if (useBass)</a>
<a name="ln5936">            harmony-&gt;setBass(placeHolder.toInt());</a>
<a name="ln5937"> </a>
<a name="ln5938">      // angle</a>
<a name="ln5939">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5940">      harmony-&gt;setAngle(placeHolder.toInt());</a>
<a name="ln5941"> </a>
<a name="ln5942">      if( ove_-&gt;getIsVersion4() ) {</a>
<a name="ln5943">            // length (tick)</a>
<a name="ln5944">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln5945">            harmony-&gt;setLength(placeHolder.toUnsignedInt());</a>
<a name="ln5946"> </a>
<a name="ln5947">            if( !jump(4) ) { return false; }</a>
<a name="ln5948">            }</a>
<a name="ln5949"> </a>
<a name="ln5950">      return true;</a>
<a name="ln5951">      }</a>
<a name="ln5952"> </a>
<a name="ln5953">bool BarsParse::parseClef(MeasureData* measureData, int /*length*/) {</a>
<a name="ln5954">      Block placeHolder;</a>
<a name="ln5955"> </a>
<a name="ln5956">      Clef* clef = new Clef();</a>
<a name="ln5957">      measureData-&gt;addMusicData(clef);</a>
<a name="ln5958"> </a>
<a name="ln5959">      if( !jump(3) ) { return false; }</a>
<a name="ln5960"> </a>
<a name="ln5961">      // common</a>
<a name="ln5962">      if( !parseCommonBlock(clef) ) { return false; }</a>
<a name="ln5963"> </a>
<a name="ln5964">      // clef type</a>
<a name="ln5965">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5966">      clef-&gt;setClefType(placeHolder.toUnsignedInt());</a>
<a name="ln5967"> </a>
<a name="ln5968">      // line</a>
<a name="ln5969">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5970">      clef-&gt;setLine(placeHolder.toInt());</a>
<a name="ln5971"> </a>
<a name="ln5972">      if( !jump(2) ) { return false; }</a>
<a name="ln5973"> </a>
<a name="ln5974">      return true;</a>
<a name="ln5975">      }</a>
<a name="ln5976"> </a>
<a name="ln5977">bool BarsParse::parseLyric(MeasureData* measureData, int length) {</a>
<a name="ln5978">      Block placeHolder;</a>
<a name="ln5979"> </a>
<a name="ln5980">      Lyric* lyric = new Lyric();</a>
<a name="ln5981">      measureData-&gt;addMusicData(lyric);</a>
<a name="ln5982"> </a>
<a name="ln5983">      if( !jump(3) ) { return false; }</a>
<a name="ln5984"> </a>
<a name="ln5985">      // common</a>
<a name="ln5986">      if( !parseCommonBlock(lyric) ) { return false; }</a>
<a name="ln5987"> </a>
<a name="ln5988">      if( !jump(2) ) { return false; }</a>
<a name="ln5989"> </a>
<a name="ln5990">      // offset</a>
<a name="ln5991">      if( !parseOffsetElement(lyric) ) { return false; }</a>
<a name="ln5992"> </a>
<a name="ln5993">      if( !jump(7) ) { return false; }</a>
<a name="ln5994"> </a>
<a name="ln5995">      // verse</a>
<a name="ln5996">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln5997">      lyric-&gt;setVerse(placeHolder.toUnsignedInt());</a>
<a name="ln5998"> </a>
<a name="ln5999">      if( ove_-&gt;getIsVersion4() ) {</a>
<a name="ln6000">            if( !jump(6) ) { return false; }</a>
<a name="ln6001"> </a>
<a name="ln6002">            // lyric</a>
<a name="ln6003">            if( length &gt; 29 ) {</a>
<a name="ln6004">                  if( !readBuffer(placeHolder, length-29) ) { return false; }</a>
<a name="ln6005">                  lyric-&gt;setLyric(ove_-&gt;getCodecString(placeHolder.fixedSizeBufferToStrByteArray()));</a>
<a name="ln6006">                  }</a>
<a name="ln6007">            }</a>
<a name="ln6008"> </a>
<a name="ln6009">      return true;</a>
<a name="ln6010">      }</a>
<a name="ln6011"> </a>
<a name="ln6012">bool BarsParse::parseSlur(MeasureData* measureData, int /*length*/) {</a>
<a name="ln6013">      Block placeHolder;</a>
<a name="ln6014"> </a>
<a name="ln6015">      Slur* slur = new Slur();</a>
<a name="ln6016">      measureData-&gt;addCrossMeasureElement(slur, true);</a>
<a name="ln6017"> </a>
<a name="ln6018">      if( !jump(2) ) { return false; }</a>
<a name="ln6019"> </a>
<a name="ln6020">      // voice</a>
<a name="ln6021">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6022">      slur-&gt;setVoice(getLowNibble(placeHolder.toUnsignedInt())&amp;0x7);</a>
<a name="ln6023"> </a>
<a name="ln6024">      // common</a>
<a name="ln6025">      if( !parseCommonBlock(slur) ) { return false; }</a>
<a name="ln6026"> </a>
<a name="ln6027">      // show on top</a>
<a name="ln6028">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6029">      slur-&gt;setShowOnTop(getHighNibble(placeHolder.toUnsignedInt())==0x8);</a>
<a name="ln6030"> </a>
<a name="ln6031">      if( !jump(1) ) { return false; }</a>
<a name="ln6032"> </a>
<a name="ln6033">      // pair lines</a>
<a name="ln6034">      if( !parsePairLinesBlock(slur) ) { return false; }</a>
<a name="ln6035"> </a>
<a name="ln6036">      // offset common</a>
<a name="ln6037">      if( !parseOffsetCommonBlock(slur) ) { return false; }</a>
<a name="ln6038"> </a>
<a name="ln6039">      // handle 1</a>
<a name="ln6040">      if( !parseOffsetElement(slur-&gt;getLeftShoulder()) ) { return false; }</a>
<a name="ln6041"> </a>
<a name="ln6042">      // handle 4</a>
<a name="ln6043">      if( !parseOffsetElement(slur-&gt;getRightShoulder()) ) { return false; }</a>
<a name="ln6044"> </a>
<a name="ln6045">      // handle 2</a>
<a name="ln6046">      if( !parseOffsetElement(slur-&gt;getHandle2()) ) { return false; }</a>
<a name="ln6047"> </a>
<a name="ln6048">      // handle 3</a>
<a name="ln6049">      if( !parseOffsetElement(slur-&gt;getHandle3()) ) { return false; }</a>
<a name="ln6050"> </a>
<a name="ln6051">      if( ove_-&gt;getIsVersion4() ) {</a>
<a name="ln6052">            if( !jump(3) ) { return false; }</a>
<a name="ln6053"> </a>
<a name="ln6054">            // note time percent</a>
<a name="ln6055">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6056">            slur-&gt;setNoteTimePercent(placeHolder.toUnsignedInt());</a>
<a name="ln6057"> </a>
<a name="ln6058">            if( !jump(36) ) { return false; }</a>
<a name="ln6059">            }</a>
<a name="ln6060"> </a>
<a name="ln6061">      return true;</a>
<a name="ln6062">      }</a>
<a name="ln6063"> </a>
<a name="ln6064">bool BarsParse::parseGlissando(MeasureData* measureData, int /*length*/) {</a>
<a name="ln6065">      Block placeHolder;</a>
<a name="ln6066"> </a>
<a name="ln6067">      Glissando* glissando = new Glissando();</a>
<a name="ln6068">      measureData-&gt;addCrossMeasureElement(glissando, true);</a>
<a name="ln6069"> </a>
<a name="ln6070">      if( !jump(3) ) { return false; }</a>
<a name="ln6071"> </a>
<a name="ln6072">      // common</a>
<a name="ln6073">      if( !parseCommonBlock(glissando) ) { return false; }</a>
<a name="ln6074"> </a>
<a name="ln6075">      // straight or wavy</a>
<a name="ln6076">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6077">      unsigned int thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln6078">      glissando-&gt;setStraightWavy(getHighNibble(thisByte)==4);</a>
<a name="ln6079"> </a>
<a name="ln6080">      if( !jump(1) ) { return false; }</a>
<a name="ln6081"> </a>
<a name="ln6082">      // pair lines</a>
<a name="ln6083">      if( !parsePairLinesBlock(glissando) ) { return false; }</a>
<a name="ln6084"> </a>
<a name="ln6085">      // offset common</a>
<a name="ln6086">      if( !parseOffsetCommonBlock(glissando) ) { return false; }</a>
<a name="ln6087"> </a>
<a name="ln6088">      // left shoulder</a>
<a name="ln6089">      if( !parseOffsetElement(glissando-&gt;getLeftShoulder()) ) { return false; }</a>
<a name="ln6090"> </a>
<a name="ln6091">      // right shoulder</a>
<a name="ln6092">      if( !parseOffsetElement(glissando-&gt;getRightShoulder()) ) { return false; }</a>
<a name="ln6093"> </a>
<a name="ln6094">      if( ove_-&gt;getIsVersion4() ) {</a>
<a name="ln6095">            if( !jump(1) ) { return false; }</a>
<a name="ln6096"> </a>
<a name="ln6097">            // line thick</a>
<a name="ln6098">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6099">            glissando-&gt;setLineThick(placeHolder.toUnsignedInt());</a>
<a name="ln6100"> </a>
<a name="ln6101">            if( !jump(12) ) { return false; }</a>
<a name="ln6102"> </a>
<a name="ln6103">            // text 32 bytes</a>
<a name="ln6104">            if( !readBuffer(placeHolder, 32) ) { return false; }</a>
<a name="ln6105">            glissando-&gt;setText(ove_-&gt;getCodecString(placeHolder.fixedSizeBufferToStrByteArray()));</a>
<a name="ln6106"> </a>
<a name="ln6107">            if( !jump(6) ) { return false; }</a>
<a name="ln6108">            }</a>
<a name="ln6109"> </a>
<a name="ln6110">      return true;</a>
<a name="ln6111">      }</a>
<a name="ln6112"> </a>
<a name="ln6113">bool getDecoratorType(</a>
<a name="ln6114">            unsigned int thisByte,</a>
<a name="ln6115">            bool&amp; measureRepeat,</a>
<a name="ln6116">            Decorator::Type&amp; decoratorType,</a>
<a name="ln6117">            bool&amp; singleRepeat,</a>
<a name="ln6118">            ArticulationType&amp; artType) {</a>
<a name="ln6119">      measureRepeat = false;</a>
<a name="ln6120">      decoratorType = Decorator::Type::Articulation;</a>
<a name="ln6121">      singleRepeat = true;</a>
<a name="ln6122">      artType = ArticulationType::None;</a>
<a name="ln6123"> </a>
<a name="ln6124">      switch (thisByte) {</a>
<a name="ln6125">            case 0x00: {</a>
<a name="ln6126">                  decoratorType = Decorator::Type::Dotted_Barline;</a>
<a name="ln6127">                  break;</a>
<a name="ln6128">                  }</a>
<a name="ln6129">            case 0x30: {</a>
<a name="ln6130">                  artType = ArticulationType::Open_String;</a>
<a name="ln6131">                  break;</a>
<a name="ln6132">                  }</a>
<a name="ln6133">            case 0x31: {</a>
<a name="ln6134">                  artType = ArticulationType::Finger_1;</a>
<a name="ln6135">                  break;</a>
<a name="ln6136">                  }</a>
<a name="ln6137">            case 0x32: {</a>
<a name="ln6138">                  artType = ArticulationType::Finger_2;</a>
<a name="ln6139">                  break;</a>
<a name="ln6140">                  }</a>
<a name="ln6141">            case 0x33: {</a>
<a name="ln6142">                  artType = ArticulationType::Finger_3;</a>
<a name="ln6143">                  break;</a>
<a name="ln6144">                  }</a>
<a name="ln6145">            case 0x34: {</a>
<a name="ln6146">                  artType = ArticulationType::Finger_4;</a>
<a name="ln6147">                  break;</a>
<a name="ln6148">                  }</a>
<a name="ln6149">            case 0x35: {</a>
<a name="ln6150">                  artType = ArticulationType::Finger_5;</a>
<a name="ln6151">                  break;</a>
<a name="ln6152">                  }</a>
<a name="ln6153">            case 0x6B: {</a>
<a name="ln6154">                  artType = ArticulationType::Flat_Accidental_For_Trill;</a>
<a name="ln6155">                  break;</a>
<a name="ln6156">                  }</a>
<a name="ln6157">            case 0x6C: {</a>
<a name="ln6158">                  artType = ArticulationType::Sharp_Accidental_For_Trill;</a>
<a name="ln6159">                  break;</a>
<a name="ln6160">                  }</a>
<a name="ln6161">            case 0x6D: {</a>
<a name="ln6162">                  artType = ArticulationType::Natural_Accidental_For_Trill;</a>
<a name="ln6163">                  break;</a>
<a name="ln6164">                  }</a>
<a name="ln6165">            case 0x8d: {</a>
<a name="ln6166">                  measureRepeat = true;</a>
<a name="ln6167">                  singleRepeat = true;</a>
<a name="ln6168">                  break;</a>
<a name="ln6169">                  }</a>
<a name="ln6170">            case 0x8e: {</a>
<a name="ln6171">                  measureRepeat = true;</a>
<a name="ln6172">                  singleRepeat = false;</a>
<a name="ln6173">                  break;</a>
<a name="ln6174">                  }</a>
<a name="ln6175">            case 0xA0: {</a>
<a name="ln6176">                  artType = ArticulationType::Minor_Trill;</a>
<a name="ln6177">                  break;</a>
<a name="ln6178">                  }</a>
<a name="ln6179">            case 0xA1: {</a>
<a name="ln6180">                  artType = ArticulationType::Major_Trill;</a>
<a name="ln6181">                  break;</a>
<a name="ln6182">                  }</a>
<a name="ln6183">            case 0xA2: {</a>
<a name="ln6184">                  artType = ArticulationType::Trill_Section;</a>
<a name="ln6185">                  break;</a>
<a name="ln6186">                  }</a>
<a name="ln6187">            case 0xA6: {</a>
<a name="ln6188">                  artType = ArticulationType::Turn;</a>
<a name="ln6189">                  break;</a>
<a name="ln6190">                  }</a>
<a name="ln6191">            case 0xA8: {</a>
<a name="ln6192">                  artType = ArticulationType::Tremolo_Eighth;</a>
<a name="ln6193">                  break;</a>
<a name="ln6194">                  }</a>
<a name="ln6195">            case 0xA9: {</a>
<a name="ln6196">                  artType = ArticulationType::Tremolo_Sixteenth;</a>
<a name="ln6197">                  break;</a>
<a name="ln6198">                  }</a>
<a name="ln6199">            case 0xAA: {</a>
<a name="ln6200">                  artType = ArticulationType::Tremolo_Thirty_Second;</a>
<a name="ln6201">                  break;</a>
<a name="ln6202">                  }</a>
<a name="ln6203">            case 0xAB: {</a>
<a name="ln6204">                  artType = ArticulationType::Tremolo_Sixty_Fourth;</a>
<a name="ln6205">                  break;</a>
<a name="ln6206">                  }</a>
<a name="ln6207">            case 0xB2: {</a>
<a name="ln6208">                  artType = ArticulationType::Fermata;</a>
<a name="ln6209">                  break;</a>
<a name="ln6210">                  }</a>
<a name="ln6211">            case 0xB3: {</a>
<a name="ln6212">                  artType = ArticulationType::Fermata_Inverted;</a>
<a name="ln6213">                  break;</a>
<a name="ln6214">                  }</a>
<a name="ln6215">            case 0xB9: {</a>
<a name="ln6216">                  artType = ArticulationType::Pause;</a>
<a name="ln6217">                  break;</a>
<a name="ln6218">                  }</a>
<a name="ln6219">            case 0xBA: {</a>
<a name="ln6220">                  artType = ArticulationType::Grand_Pause;</a>
<a name="ln6221">                  break;</a>
<a name="ln6222">                  }</a>
<a name="ln6223">            case 0xC0: {</a>
<a name="ln6224">                  artType = ArticulationType::Marcato;</a>
<a name="ln6225">                  break;</a>
<a name="ln6226">                  }</a>
<a name="ln6227">            case 0xC1: {</a>
<a name="ln6228">                  artType = ArticulationType::Marcato_Dot;</a>
<a name="ln6229">                  break;</a>
<a name="ln6230">                  }</a>
<a name="ln6231">            case 0xC2: {</a>
<a name="ln6232">                  artType = ArticulationType::SForzando;</a>
<a name="ln6233">                  break;</a>
<a name="ln6234">                  }</a>
<a name="ln6235">            case 0xC3: {</a>
<a name="ln6236">                  artType = ArticulationType::SForzando_Dot;</a>
<a name="ln6237">                  break;</a>
<a name="ln6238">                  }</a>
<a name="ln6239">            case 0xC4: {</a>
<a name="ln6240">                  artType = ArticulationType::SForzando_Inverted;</a>
<a name="ln6241">                  break;</a>
<a name="ln6242">                  }</a>
<a name="ln6243">            case 0xC5: {</a>
<a name="ln6244">                  artType = ArticulationType::SForzando_Dot_Inverted;</a>
<a name="ln6245">                  break;</a>
<a name="ln6246">                  }</a>
<a name="ln6247">            case 0xC6: {</a>
<a name="ln6248">                  artType = ArticulationType::Staccatissimo;</a>
<a name="ln6249">                  break;</a>
<a name="ln6250">                  }</a>
<a name="ln6251">            case 0xC7: {</a>
<a name="ln6252">                  artType = ArticulationType::Staccato;</a>
<a name="ln6253">                  break;</a>
<a name="ln6254">                  }</a>
<a name="ln6255">            case 0xC8: {</a>
<a name="ln6256">                  artType = ArticulationType::Tenuto;</a>
<a name="ln6257">                  break;</a>
<a name="ln6258">                  }</a>
<a name="ln6259">            case 0xC9: {</a>
<a name="ln6260">                  artType = ArticulationType::Natural_Harmonic;</a>
<a name="ln6261">                  break;</a>
<a name="ln6262">                  }</a>
<a name="ln6263">            case 0xCA: {</a>
<a name="ln6264">                  artType = ArticulationType::Artificial_Harmonic;</a>
<a name="ln6265">                  break;</a>
<a name="ln6266">                  }</a>
<a name="ln6267">            case 0xCB: {</a>
<a name="ln6268">                  artType = ArticulationType::Plus_Sign;</a>
<a name="ln6269">                  break;</a>
<a name="ln6270">                  }</a>
<a name="ln6271">            case 0xCC: {</a>
<a name="ln6272">                  artType = ArticulationType::Up_Bow;</a>
<a name="ln6273">                  break;</a>
<a name="ln6274">                  }</a>
<a name="ln6275">            case 0xCD: {</a>
<a name="ln6276">                  artType = ArticulationType::Down_Bow;</a>
<a name="ln6277">                  break;</a>
<a name="ln6278">                  }</a>
<a name="ln6279">            case 0xCE: {</a>
<a name="ln6280">                  artType = ArticulationType::Up_Bow_Inverted;</a>
<a name="ln6281">                  break;</a>
<a name="ln6282">                  }</a>
<a name="ln6283">            case 0xCF: {</a>
<a name="ln6284">                  artType = ArticulationType::Down_Bow_Inverted;</a>
<a name="ln6285">                  break;</a>
<a name="ln6286">                  }</a>
<a name="ln6287">            case 0xD0: {</a>
<a name="ln6288">                  artType = ArticulationType::Pedal_Down;</a>
<a name="ln6289">                  break;</a>
<a name="ln6290">                  }</a>
<a name="ln6291">            case 0xD1: {</a>
<a name="ln6292">                  artType = ArticulationType::Pedal_Up;</a>
<a name="ln6293">                  break;</a>
<a name="ln6294">                  }</a>
<a name="ln6295">            case 0xD6: {</a>
<a name="ln6296">                  artType = ArticulationType::Heavy_Attack;</a>
<a name="ln6297">                  break;</a>
<a name="ln6298">                  }</a>
<a name="ln6299">            case 0xD7: {</a>
<a name="ln6300">                  artType = ArticulationType::Heavier_Attack;</a>
<a name="ln6301">                  break;</a>
<a name="ln6302">                  }</a>
<a name="ln6303">            default:</a>
<a name="ln6304">                  return false;</a>
<a name="ln6305">                  break;</a>
<a name="ln6306">            }</a>
<a name="ln6307"> </a>
<a name="ln6308">      return true;</a>
<a name="ln6309">      }</a>
<a name="ln6310"> </a>
<a name="ln6311">bool BarsParse::parseDecorators(MeasureData* measureData, int length) {</a>
<a name="ln6312">      Block placeHolder;</a>
<a name="ln6313">      MusicData* musicData = new MusicData();</a>
<a name="ln6314"> </a>
<a name="ln6315">      if( !jump(3) ) { return false; }</a>
<a name="ln6316"> </a>
<a name="ln6317">      // common</a>
<a name="ln6318">      if( !parseCommonBlock(musicData) ) { return false; }</a>
<a name="ln6319"> </a>
<a name="ln6320">      if( !jump(2) ) { return false; }</a>
<a name="ln6321"> </a>
<a name="ln6322">      // y offset</a>
<a name="ln6323">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6324">      musicData-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln6325"> </a>
<a name="ln6326">      if( !jump(2) ) { return false; }</a>
<a name="ln6327"> </a>
<a name="ln6328">      // measure repeat | piano pedal | dotted barline | articulation</a>
<a name="ln6329">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6330">      unsigned int thisByte = placeHolder.toUnsignedInt();</a>
<a name="ln6331"> </a>
<a name="ln6332">      Decorator::Type decoratorType;</a>
<a name="ln6333">      bool isMeasureRepeat;</a>
<a name="ln6334">      bool isSingleRepeat = true;</a>
<a name="ln6335">      ArticulationType artType = ArticulationType::None;</a>
<a name="ln6336"> </a>
<a name="ln6337">      getDecoratorType(thisByte, isMeasureRepeat, decoratorType, isSingleRepeat, artType);</a>
<a name="ln6338"> </a>
<a name="ln6339">      if( isMeasureRepeat ) {</a>
<a name="ln6340">            MeasureRepeat* measureRepeat = new MeasureRepeat();</a>
<a name="ln6341">            measureData-&gt;addCrossMeasureElement(measureRepeat, true);</a>
<a name="ln6342"> </a>
<a name="ln6343">            measureRepeat-&gt;copyCommonBlock(*musicData);</a>
<a name="ln6344">            measureRepeat-&gt;setYOffset(musicData-&gt;getYOffset());</a>
<a name="ln6345"> </a>
<a name="ln6346">            measureRepeat-&gt;setSingleRepeat(isSingleRepeat);</a>
<a name="ln6347">            } else {</a>
<a name="ln6348">            Decorator* decorator = new Decorator();</a>
<a name="ln6349">            measureData-&gt;addMusicData(decorator);</a>
<a name="ln6350"> </a>
<a name="ln6351">            decorator-&gt;copyCommonBlock(*musicData);</a>
<a name="ln6352">            decorator-&gt;setYOffset(musicData-&gt;getYOffset());</a>
<a name="ln6353"> </a>
<a name="ln6354">            decorator-&gt;setDecoratorType(decoratorType);</a>
<a name="ln6355">            decorator-&gt;setArticulationType(artType);</a>
<a name="ln6356">            }</a>
<a name="ln6357"> </a>
<a name="ln6358">      int cursor = ove_-&gt;getIsVersion4() ? 16 : 14;</a>
<a name="ln6359">      if( !jump(length-cursor) ) { return false; }</a>
<a name="ln6360"> </a>
<a name="ln6361">      return true;</a>
<a name="ln6362">      }</a>
<a name="ln6363"> </a>
<a name="ln6364">bool BarsParse::parseWedge(MeasureData* measureData, int length) {</a>
<a name="ln6365">      Block placeHolder;</a>
<a name="ln6366">      Wedge* wedge = new Wedge();</a>
<a name="ln6367"> </a>
<a name="ln6368">      if( !jump(3) ) { return false; }</a>
<a name="ln6369"> </a>
<a name="ln6370">      // common</a>
<a name="ln6371">      if( !parseCommonBlock(wedge) ) { return false; }</a>
<a name="ln6372"> </a>
<a name="ln6373">      // wedge type</a>
<a name="ln6374">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6375">      WedgeType wedgeType = WedgeType::Cres_Line;</a>
<a name="ln6376">      bool wedgeOrExpression = true;</a>
<a name="ln6377">      unsigned int highHalfByte = getHighNibble(placeHolder.toUnsignedInt());</a>
<a name="ln6378">      unsigned int lowHalfByte = getLowNibble(placeHolder.toUnsignedInt());</a>
<a name="ln6379"> </a>
<a name="ln6380">      switch (highHalfByte) {</a>
<a name="ln6381">            case 0x0: {</a>
<a name="ln6382">                  wedgeType = WedgeType::Cres_Line;</a>
<a name="ln6383">                  wedgeOrExpression = true;</a>
<a name="ln6384">                  break;</a>
<a name="ln6385">                  }</a>
<a name="ln6386">            case 0x4: {</a>
<a name="ln6387">                  wedgeType = WedgeType::Decresc_Line;</a>
<a name="ln6388">                  wedgeOrExpression = true;</a>
<a name="ln6389">                  break;</a>
<a name="ln6390">                  }</a>
<a name="ln6391">            case 0x6: {</a>
<a name="ln6392">                  wedgeType = WedgeType::Decresc;</a>
<a name="ln6393">                  wedgeOrExpression = false;</a>
<a name="ln6394">                  break;</a>
<a name="ln6395">                  }</a>
<a name="ln6396">            case 0x2: {</a>
<a name="ln6397">                  wedgeType = WedgeType::Cres;</a>
<a name="ln6398">                  wedgeOrExpression = false;</a>
<a name="ln6399">                  break;</a>
<a name="ln6400">                  }</a>
<a name="ln6401">            default:</a>
<a name="ln6402">                  break;</a>
<a name="ln6403">            }</a>
<a name="ln6404"> </a>
<a name="ln6405">      // 0xb | 0x8(ove3) , else 3, 0(ove3)</a>
<a name="ln6406">      if( (lowHalfByte &amp; 0x8) == 0x8 ) {</a>
<a name="ln6407">            wedgeType = WedgeType::Double_Line;</a>
<a name="ln6408">            wedgeOrExpression = true;</a>
<a name="ln6409">            }</a>
<a name="ln6410"> </a>
<a name="ln6411">      if( !jump(1) ) { return false; }</a>
<a name="ln6412"> </a>
<a name="ln6413">      // y offset</a>
<a name="ln6414">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6415">      wedge-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln6416"> </a>
<a name="ln6417">      // wedge</a>
<a name="ln6418">      if( wedgeOrExpression ) {</a>
<a name="ln6419">            measureData-&gt;addCrossMeasureElement(wedge, true);</a>
<a name="ln6420">            wedge-&gt;setWedgeType(wedgeType);</a>
<a name="ln6421"> </a>
<a name="ln6422">            if( !jump(2) ) { return false; }</a>
<a name="ln6423"> </a>
<a name="ln6424">            // height</a>
<a name="ln6425">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6426">            wedge-&gt;setHeight(placeHolder.toUnsignedInt());</a>
<a name="ln6427"> </a>
<a name="ln6428">            // offset common</a>
<a name="ln6429">            if( !parseOffsetCommonBlock(wedge) ) { return false; }</a>
<a name="ln6430"> </a>
<a name="ln6431">            int cursor = ove_-&gt;getIsVersion4() ? 21 : 19;</a>
<a name="ln6432">            if( !jump(length-cursor) ) { return false; }</a>
<a name="ln6433">            }</a>
<a name="ln6434">      // expression : cresc, decresc</a>
<a name="ln6435">      else {</a>
<a name="ln6436">            Expressions* express = new Expressions();</a>
<a name="ln6437">            measureData-&gt;addMusicData(express);</a>
<a name="ln6438"> </a>
<a name="ln6439">            express-&gt;copyCommonBlock(*wedge);</a>
<a name="ln6440">            express-&gt;setYOffset(wedge-&gt;getYOffset());</a>
<a name="ln6441"> </a>
<a name="ln6442">            if( !jump(4) ) { return false; }</a>
<a name="ln6443"> </a>
<a name="ln6444">            // offset common</a>
<a name="ln6445">            if( !parseOffsetCommonBlock(express) ) { return false; }</a>
<a name="ln6446"> </a>
<a name="ln6447">            if( ove_-&gt;getIsVersion4() ) {</a>
<a name="ln6448">                  if( !jump(18) ) { return false; }</a>
<a name="ln6449"> </a>
<a name="ln6450">                  // words</a>
<a name="ln6451">                  if( length &gt; 39 ) {</a>
<a name="ln6452">                        if( !readBuffer(placeHolder, length-39) ) { return false; }</a>
<a name="ln6453">                        express-&gt;setText(ove_-&gt;getCodecString(placeHolder.fixedSizeBufferToStrByteArray()));</a>
<a name="ln6454">                        }</a>
<a name="ln6455">                  } else {</a>
<a name="ln6456">                  QString str = wedgeType==WedgeType::Cres ? &quot;cresc&quot; : &quot;decresc&quot;;</a>
<a name="ln6457">                  express-&gt;setText(str);</a>
<a name="ln6458"> </a>
<a name="ln6459">                  if( !jump(8) ) { return false; }</a>
<a name="ln6460">                  }</a>
<a name="ln6461">            }</a>
<a name="ln6462"> </a>
<a name="ln6463">      return true;</a>
<a name="ln6464">      }</a>
<a name="ln6465"> </a>
<a name="ln6466">bool BarsParse::parseDynamics(MeasureData* measureData, int /*length*/) {</a>
<a name="ln6467">      Block placeHolder;</a>
<a name="ln6468"> </a>
<a name="ln6469">      Dynamics* dynamics = new Dynamics();</a>
<a name="ln6470">      measureData-&gt;addMusicData(dynamics);</a>
<a name="ln6471"> </a>
<a name="ln6472">      if( !jump(1) ) { return false; }</a>
<a name="ln6473"> </a>
<a name="ln6474">      // is playback</a>
<a name="ln6475">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6476">      dynamics-&gt;setIsPlayback(getHighNibble(placeHolder.toUnsignedInt())!=0x4);</a>
<a name="ln6477"> </a>
<a name="ln6478">      if( !jump(1) ) { return false; }</a>
<a name="ln6479"> </a>
<a name="ln6480">      // common</a>
<a name="ln6481">      if( !parseCommonBlock(dynamics) ) { return false; }</a>
<a name="ln6482"> </a>
<a name="ln6483">      // y offset</a>
<a name="ln6484">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6485">      dynamics-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln6486"> </a>
<a name="ln6487">      // dynamics type</a>
<a name="ln6488">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6489">      dynamics-&gt;setDynamicsType(getLowNibble(placeHolder.toUnsignedInt()));</a>
<a name="ln6490"> </a>
<a name="ln6491">      // velocity</a>
<a name="ln6492">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6493">      dynamics-&gt;setVelocity(placeHolder.toUnsignedInt());</a>
<a name="ln6494"> </a>
<a name="ln6495">      int cursor = ove_-&gt;getIsVersion4() ? 4 : 2;</a>
<a name="ln6496"> </a>
<a name="ln6497">      if( !jump(cursor) ) { return false; }</a>
<a name="ln6498"> </a>
<a name="ln6499">      return true;</a>
<a name="ln6500">      }</a>
<a name="ln6501"> </a>
<a name="ln6502">bool BarsParse::parseKey(MeasureData* measureData, int /*length*/) {</a>
<a name="ln6503">      Block placeHolder;</a>
<a name="ln6504">      Key* key = measureData-&gt;getKey();</a>
<a name="ln6505">      int cursor = ove_-&gt;getIsVersion4() ? 9 : 7;</a>
<a name="ln6506"> </a>
<a name="ln6507">      if( !jump(cursor) ) { return false; }</a>
<a name="ln6508"> </a>
<a name="ln6509">      // key</a>
<a name="ln6510">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6511">      key-&gt;setKey(oveKeyToKey(placeHolder.toUnsignedInt()));</a>
<a name="ln6512"> </a>
<a name="ln6513">      // previous key</a>
<a name="ln6514">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6515">      key-&gt;setPreviousKey(oveKeyToKey(placeHolder.toUnsignedInt()));</a>
<a name="ln6516"> </a>
<a name="ln6517">      if( !jump(3) ) { return false; }</a>
<a name="ln6518"> </a>
<a name="ln6519">      // symbol count</a>
<a name="ln6520">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6521">      key-&gt;setSymbolCount(placeHolder.toUnsignedInt());</a>
<a name="ln6522"> </a>
<a name="ln6523">      if( !jump(4) ) { return false; }</a>
<a name="ln6524"> </a>
<a name="ln6525">      return true;</a>
<a name="ln6526">      }</a>
<a name="ln6527"> </a>
<a name="ln6528">bool BarsParse::parsePedal(MeasureData* measureData, int length) {</a>
<a name="ln6529">      Block placeHolder;</a>
<a name="ln6530"> </a>
<a name="ln6531">      Pedal* pedal = new Pedal();</a>
<a name="ln6532">      //measureData-&gt;addMusicData(pedal); //can't remember why</a>
<a name="ln6533">      measureData-&gt;addCrossMeasureElement(pedal, true);</a>
<a name="ln6534"> </a>
<a name="ln6535">      if( !jump(1) ) { return false; }</a>
<a name="ln6536"> </a>
<a name="ln6537">      // is playback</a>
<a name="ln6538">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6539">      pedal-&gt;setIsPlayback(getHighNibble(placeHolder.toUnsignedInt())!=4);</a>
<a name="ln6540"> </a>
<a name="ln6541">      if( !jump(1) ) { return false; }</a>
<a name="ln6542"> </a>
<a name="ln6543">      // common</a>
<a name="ln6544">      if( !parseCommonBlock(pedal) ) { return false; }</a>
<a name="ln6545"> </a>
<a name="ln6546">      if( !jump(2) ) { return false; }</a>
<a name="ln6547"> </a>
<a name="ln6548">      // pair lines</a>
<a name="ln6549">      if( !parsePairLinesBlock(pedal) ) { return false; }</a>
<a name="ln6550"> </a>
<a name="ln6551">      // offset common</a>
<a name="ln6552">      if( !parseOffsetCommonBlock(pedal) ) { return false; }</a>
<a name="ln6553"> </a>
<a name="ln6554">      // left shoulder</a>
<a name="ln6555">      if( !parseOffsetElement(pedal-&gt;getLeftShoulder()) ) { return false; }</a>
<a name="ln6556"> </a>
<a name="ln6557">      // right shoulder</a>
<a name="ln6558">      if( !parseOffsetElement(pedal-&gt;getRightShoulder()) ) { return false; }</a>
<a name="ln6559"> </a>
<a name="ln6560">      int cursor = ove_-&gt;getIsVersion4() ? 0x45 : 0x23;</a>
<a name="ln6561">      int blankCount = ove_-&gt;getIsVersion4() ? 42 : 10;</a>
<a name="ln6562"> </a>
<a name="ln6563">      pedal-&gt;setHalf( length &gt; cursor );</a>
<a name="ln6564"> </a>
<a name="ln6565">      if( !jump(blankCount) ) { return false; }</a>
<a name="ln6566"> </a>
<a name="ln6567">      if( length &gt; cursor ) {</a>
<a name="ln6568">            if( !jump(2) ) { return false; }</a>
<a name="ln6569"> </a>
<a name="ln6570">            // handle x offset</a>
<a name="ln6571">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6572">            pedal-&gt;getPedalHandle()-&gt;setXOffset(placeHolder.toInt());</a>
<a name="ln6573"> </a>
<a name="ln6574">            if( !jump(6) ) { return false; }</a>
<a name="ln6575">            }</a>
<a name="ln6576"> </a>
<a name="ln6577">      return true;</a>
<a name="ln6578">      }</a>
<a name="ln6579"> </a>
<a name="ln6580">bool BarsParse::parseKuohao(MeasureData* measureData, int /*length*/) {</a>
<a name="ln6581">      Block placeHolder;</a>
<a name="ln6582"> </a>
<a name="ln6583">      KuoHao* kuoHao = new KuoHao();</a>
<a name="ln6584">      measureData-&gt;addMusicData(kuoHao);</a>
<a name="ln6585"> </a>
<a name="ln6586">      if( !jump(3) ) { return false; }</a>
<a name="ln6587"> </a>
<a name="ln6588">      // common</a>
<a name="ln6589">      if( !parseCommonBlock(kuoHao) ) { return false; }</a>
<a name="ln6590"> </a>
<a name="ln6591">      if( !jump(2) ) { return false; }</a>
<a name="ln6592"> </a>
<a name="ln6593">      // pair lines</a>
<a name="ln6594">      if( !parsePairLinesBlock(kuoHao) ) { return false; }</a>
<a name="ln6595"> </a>
<a name="ln6596">      if( !jump(4) ) { return false; }</a>
<a name="ln6597"> </a>
<a name="ln6598">      // left shoulder</a>
<a name="ln6599">      if( !parseOffsetElement(kuoHao-&gt;getLeftShoulder()) ) { return false; }</a>
<a name="ln6600"> </a>
<a name="ln6601">      // right shoulder</a>
<a name="ln6602">      if( !parseOffsetElement(kuoHao-&gt;getRightShoulder()) ) { return false; }</a>
<a name="ln6603"> </a>
<a name="ln6604">      // kuohao type</a>
<a name="ln6605">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6606">      kuoHao-&gt;setKuohaoType(placeHolder.toUnsignedInt());</a>
<a name="ln6607"> </a>
<a name="ln6608">      // height</a>
<a name="ln6609">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6610">      kuoHao-&gt;setHeight(placeHolder.toUnsignedInt());</a>
<a name="ln6611"> </a>
<a name="ln6612">      int jumpAmount = ove_-&gt;getIsVersion4() ? 40 : 8;</a>
<a name="ln6613">      if( !jump(jumpAmount) ) { return false; }</a>
<a name="ln6614"> </a>
<a name="ln6615">      return true;</a>
<a name="ln6616">      }</a>
<a name="ln6617"> </a>
<a name="ln6618">bool BarsParse::parseExpressions(MeasureData* measureData, int length) {</a>
<a name="ln6619">      Block placeHolder;</a>
<a name="ln6620"> </a>
<a name="ln6621">      Expressions* expressions = new Expressions();</a>
<a name="ln6622">      measureData-&gt;addMusicData(expressions);</a>
<a name="ln6623"> </a>
<a name="ln6624">      if( !jump(3) ) { return false; }</a>
<a name="ln6625"> </a>
<a name="ln6626">      // common00</a>
<a name="ln6627">      if( !parseCommonBlock(expressions) ) { return false; }</a>
<a name="ln6628"> </a>
<a name="ln6629">      if( !jump(2) ) { return false; }</a>
<a name="ln6630"> </a>
<a name="ln6631">      // y offset</a>
<a name="ln6632">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6633">      expressions-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln6634"> </a>
<a name="ln6635">      // range bar offset</a>
<a name="ln6636">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6637">      //int barOffset = placeHolder.toUnsignedInt();</a>
<a name="ln6638"> </a>
<a name="ln6639">      if( !jump(10) ) { return false; }</a>
<a name="ln6640"> </a>
<a name="ln6641">      // tempo 1</a>
<a name="ln6642">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6643">      //double tempo1 = ((double)placeHolder.toUnsignedInt()) / 100.0;</a>
<a name="ln6644"> </a>
<a name="ln6645">      // tempo 2</a>
<a name="ln6646">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6647">      //double tempo2 = ((double)placeHolder.toUnsignedInt()) / 100.0;</a>
<a name="ln6648"> </a>
<a name="ln6649">      if( !jump(6) ) { return false; }</a>
<a name="ln6650"> </a>
<a name="ln6651">      // text</a>
<a name="ln6652">      int cursor = ove_-&gt;getIsVersion4() ? 35 : 33;</a>
<a name="ln6653">      if( length &gt; cursor ) {</a>
<a name="ln6654">            if( !readBuffer(placeHolder, length-cursor) ) { return false; }</a>
<a name="ln6655">            expressions-&gt;setText(ove_-&gt;getCodecString(placeHolder.fixedSizeBufferToStrByteArray()));</a>
<a name="ln6656">            }</a>
<a name="ln6657"> </a>
<a name="ln6658">      return true;</a>
<a name="ln6659">      }</a>
<a name="ln6660"> </a>
<a name="ln6661">bool BarsParse::parseHarpPedal(MeasureData* measureData, int /*length*/) {</a>
<a name="ln6662">      Block placeHolder;</a>
<a name="ln6663"> </a>
<a name="ln6664">      HarpPedal* harpPedal = new HarpPedal();</a>
<a name="ln6665">      measureData-&gt;addMusicData(harpPedal);</a>
<a name="ln6666"> </a>
<a name="ln6667">      if( !jump(3) ) { return false; }</a>
<a name="ln6668"> </a>
<a name="ln6669">      // common</a>
<a name="ln6670">      if( !parseCommonBlock(harpPedal) ) { return false; }</a>
<a name="ln6671"> </a>
<a name="ln6672">      if( !jump(2) ) { return false; }</a>
<a name="ln6673"> </a>
<a name="ln6674">      // y offset</a>
<a name="ln6675">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6676">      harpPedal-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln6677"> </a>
<a name="ln6678">      // show type</a>
<a name="ln6679">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6680">      harpPedal-&gt;setShowType(placeHolder.toUnsignedInt());</a>
<a name="ln6681"> </a>
<a name="ln6682">      // show char flag</a>
<a name="ln6683">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6684">      harpPedal-&gt;setShowCharFlag(placeHolder.toUnsignedInt());</a>
<a name="ln6685"> </a>
<a name="ln6686">      if( !jump(8) ) { return false; }</a>
<a name="ln6687"> </a>
<a name="ln6688">      return true;</a>
<a name="ln6689">      }</a>
<a name="ln6690"> </a>
<a name="ln6691">bool BarsParse::parseMultiMeasureRest(MeasureData* measureData, int /*length*/) {</a>
<a name="ln6692">      Block placeHolder(2);</a>
<a name="ln6693">      MultiMeasureRest* measureRest = new MultiMeasureRest();</a>
<a name="ln6694">      measureData-&gt;addMusicData(measureRest);</a>
<a name="ln6695"> </a>
<a name="ln6696">      if( !jump(3) ) { return false; }</a>
<a name="ln6697"> </a>
<a name="ln6698">      // common</a>
<a name="ln6699">      if( !parseCommonBlock(measureRest) ) { return false; }</a>
<a name="ln6700"> </a>
<a name="ln6701">      if( !jump(6) ) { return false; }</a>
<a name="ln6702"> </a>
<a name="ln6703">      return true;</a>
<a name="ln6704">      }</a>
<a name="ln6705"> </a>
<a name="ln6706">bool BarsParse::parseHarmonyGuitarFrame(MeasureData* measureData, int length) {</a>
<a name="ln6707">      Block placeHolder;</a>
<a name="ln6708"> </a>
<a name="ln6709">      Harmony* harmony = new Harmony();</a>
<a name="ln6710">      measureData-&gt;addMusicData(harmony);</a>
<a name="ln6711"> </a>
<a name="ln6712">      if( !jump(3) ) { return false; }</a>
<a name="ln6713"> </a>
<a name="ln6714">      // common</a>
<a name="ln6715">      if( !parseCommonBlock(harmony) ) { return false; }</a>
<a name="ln6716"> </a>
<a name="ln6717">      // root</a>
<a name="ln6718">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6719">      harmony-&gt;setRoot(placeHolder.toUnsignedInt());</a>
<a name="ln6720"> </a>
<a name="ln6721">      // type</a>
<a name="ln6722">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6723">      //harmony-&gt;setHarmonyType((HarmonyType)placeHolder.toUnsignedInt()); // TODO</a>
<a name="ln6724"> </a>
<a name="ln6725">      // bass</a>
<a name="ln6726">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6727">      harmony-&gt;setBass(placeHolder.toUnsignedInt());</a>
<a name="ln6728"> </a>
<a name="ln6729">      int jumpAmount = ove_-&gt;getIsVersion4() ? length - 12 : length - 10;</a>
<a name="ln6730">      if( !jump(jumpAmount) ) { return false; }</a>
<a name="ln6731"> </a>
<a name="ln6732">      return true;</a>
<a name="ln6733">      }</a>
<a name="ln6734"> </a>
<a name="ln6735">void extractOctave(unsigned int Bits, OctaveShiftType&amp; octaveShiftType, QList&lt;OctaveShiftPosition&gt;&amp; positions) {</a>
<a name="ln6736">      octaveShiftType = OctaveShiftType::OS_8;</a>
<a name="ln6737">      positions.clear();</a>
<a name="ln6738"> </a>
<a name="ln6739">      switch (Bits) {</a>
<a name="ln6740">            case 0x0: {</a>
<a name="ln6741">                  octaveShiftType = OctaveShiftType::OS_8;</a>
<a name="ln6742">                  positions.push_back(OctaveShiftPosition::Continue);</a>
<a name="ln6743">                  break;</a>
<a name="ln6744">                  }</a>
<a name="ln6745">            case 0x1: {</a>
<a name="ln6746">                  octaveShiftType = OctaveShiftType::OS_Minus_8;</a>
<a name="ln6747">                  positions.push_back(OctaveShiftPosition::Continue);</a>
<a name="ln6748">                  break;</a>
<a name="ln6749">                  }</a>
<a name="ln6750">            case 0x2: {</a>
<a name="ln6751">                  octaveShiftType = OctaveShiftType::OS_15;</a>
<a name="ln6752">                  positions.push_back(OctaveShiftPosition::Continue);</a>
<a name="ln6753">                  break;</a>
<a name="ln6754">                  }</a>
<a name="ln6755">            case 0x3: {</a>
<a name="ln6756">                  octaveShiftType = OctaveShiftType::OS_Minus_15;</a>
<a name="ln6757">                  positions.push_back(OctaveShiftPosition::Continue);</a>
<a name="ln6758">                  break;</a>
<a name="ln6759">                  }</a>
<a name="ln6760">            case 0x4: {</a>
<a name="ln6761">                  octaveShiftType = OctaveShiftType::OS_8;</a>
<a name="ln6762">                  positions.push_back(OctaveShiftPosition::Stop);</a>
<a name="ln6763">                  break;</a>
<a name="ln6764">                  }</a>
<a name="ln6765">            case 0x5: {</a>
<a name="ln6766">                  octaveShiftType = OctaveShiftType::OS_Minus_8;</a>
<a name="ln6767">                  positions.push_back(OctaveShiftPosition::Stop);</a>
<a name="ln6768">                  break;</a>
<a name="ln6769">                  }</a>
<a name="ln6770">            case 0x6: {</a>
<a name="ln6771">                  octaveShiftType = OctaveShiftType::OS_15;</a>
<a name="ln6772">                  positions.push_back(OctaveShiftPosition::Stop);</a>
<a name="ln6773">                  break;</a>
<a name="ln6774">                  }</a>
<a name="ln6775">            case 0x7: {</a>
<a name="ln6776">                  octaveShiftType = OctaveShiftType::OS_Minus_15;</a>
<a name="ln6777">                  positions.push_back(OctaveShiftPosition::Stop);</a>
<a name="ln6778">                  break;</a>
<a name="ln6779">                  }</a>
<a name="ln6780">            case 0x8: {</a>
<a name="ln6781">                  octaveShiftType = OctaveShiftType::OS_8;</a>
<a name="ln6782">                  positions.push_back(OctaveShiftPosition::Start);</a>
<a name="ln6783">                  break;</a>
<a name="ln6784">                  }</a>
<a name="ln6785">            case 0x9: {</a>
<a name="ln6786">                  octaveShiftType = OctaveShiftType::OS_Minus_8;</a>
<a name="ln6787">                  positions.push_back(OctaveShiftPosition::Start);</a>
<a name="ln6788">                  break;</a>
<a name="ln6789">                  }</a>
<a name="ln6790">            case 0xA: {</a>
<a name="ln6791">                  octaveShiftType = OctaveShiftType::OS_15;</a>
<a name="ln6792">                  positions.push_back(OctaveShiftPosition::Start);</a>
<a name="ln6793">                  break;</a>
<a name="ln6794">                  }</a>
<a name="ln6795">            case 0xB: {</a>
<a name="ln6796">                  octaveShiftType = OctaveShiftType::OS_Minus_15;</a>
<a name="ln6797">                  positions.push_back(OctaveShiftPosition::Start);</a>
<a name="ln6798">                  ;</a>
<a name="ln6799">                  break;</a>
<a name="ln6800">                  }</a>
<a name="ln6801">            case 0xC: {</a>
<a name="ln6802">                  octaveShiftType = OctaveShiftType::OS_8;</a>
<a name="ln6803">                  positions.push_back(OctaveShiftPosition::Start);</a>
<a name="ln6804">                  positions.push_back(OctaveShiftPosition::Stop);</a>
<a name="ln6805">                  break;</a>
<a name="ln6806">                  }</a>
<a name="ln6807">            case 0xD: {</a>
<a name="ln6808">                  octaveShiftType = OctaveShiftType::OS_Minus_8;</a>
<a name="ln6809">                  positions.push_back(OctaveShiftPosition::Start);</a>
<a name="ln6810">                  positions.push_back(OctaveShiftPosition::Stop);</a>
<a name="ln6811">                  break;</a>
<a name="ln6812">                  }</a>
<a name="ln6813">            case 0xE: {</a>
<a name="ln6814">                  octaveShiftType = OctaveShiftType::OS_15;</a>
<a name="ln6815">                  positions.push_back(OctaveShiftPosition::Start);</a>
<a name="ln6816">                  positions.push_back(OctaveShiftPosition::Stop);</a>
<a name="ln6817">                  break;</a>
<a name="ln6818">                  }</a>
<a name="ln6819">            case 0xF: {</a>
<a name="ln6820">                  octaveShiftType = OctaveShiftType::OS_Minus_15;</a>
<a name="ln6821">                  positions.push_back(OctaveShiftPosition::Start);</a>
<a name="ln6822">                  positions.push_back(OctaveShiftPosition::Stop);</a>
<a name="ln6823">                  break;</a>
<a name="ln6824">                  }</a>
<a name="ln6825">            default:</a>
<a name="ln6826">                  break;</a>
<a name="ln6827">            }</a>
<a name="ln6828">      }</a>
<a name="ln6829"> </a>
<a name="ln6830">bool BarsParse::parseOctaveShift(MeasureData* measureData, int /*length*/) {</a>
<a name="ln6831">      Block placeHolder;</a>
<a name="ln6832"> </a>
<a name="ln6833">      OctaveShift* octave = new OctaveShift();</a>
<a name="ln6834">      measureData-&gt;addCrossMeasureElement(octave, true);</a>
<a name="ln6835"> </a>
<a name="ln6836">      if( !jump(3) ) { return false; }</a>
<a name="ln6837"> </a>
<a name="ln6838">      // common</a>
<a name="ln6839">      if( !parseCommonBlock(octave) ) { return false; }</a>
<a name="ln6840"> </a>
<a name="ln6841">      // octave</a>
<a name="ln6842">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6843">      unsigned int type = getLowNibble(placeHolder.toUnsignedInt());</a>
<a name="ln6844">      OctaveShiftType octaveShiftType = OctaveShiftType::OS_8;</a>
<a name="ln6845">      QList&lt;OctaveShiftPosition&gt; positions;</a>
<a name="ln6846">      extractOctave(type, octaveShiftType, positions);</a>
<a name="ln6847"> </a>
<a name="ln6848">      octave-&gt;setOctaveShiftType(octaveShiftType);</a>
<a name="ln6849"> </a>
<a name="ln6850">      if( !jump(1) ) { return false; }</a>
<a name="ln6851"> </a>
<a name="ln6852">      // y offset</a>
<a name="ln6853">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6854">      octave-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln6855"> </a>
<a name="ln6856">      if( !jump(4) ) { return false; }</a>
<a name="ln6857"> </a>
<a name="ln6858">      // length</a>
<a name="ln6859">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6860">      octave-&gt;setLength(placeHolder.toUnsignedInt());</a>
<a name="ln6861"> </a>
<a name="ln6862">      // end tick</a>
<a name="ln6863">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6864">      octave-&gt;setEndTick(placeHolder.toUnsignedInt());</a>
<a name="ln6865"> </a>
<a name="ln6866">      // start &amp; stop maybe appear in same measure</a>
<a name="ln6867">      for (int i=0; i&lt;positions.size(); ++i) {</a>
<a name="ln6868">            OctaveShiftPosition position = positions[i];</a>
<a name="ln6869">            OctaveShiftEndPoint* octavePoint = new OctaveShiftEndPoint();</a>
<a name="ln6870">            measureData-&gt;addMusicData(octavePoint);</a>
<a name="ln6871"> </a>
<a name="ln6872">            octavePoint-&gt;copyCommonBlock(*octave);</a>
<a name="ln6873">            octavePoint-&gt;setOctaveShiftType(octaveShiftType);</a>
<a name="ln6874">            octavePoint-&gt;setOctaveShiftPosition(position);</a>
<a name="ln6875">            octavePoint-&gt;setEndTick(octave-&gt;getEndTick());</a>
<a name="ln6876"> </a>
<a name="ln6877">            // stop</a>
<a name="ln6878">            if( i==0 &amp;&amp; position == OctaveShiftPosition::Stop ) {</a>
<a name="ln6879">                  octavePoint-&gt;start()-&gt;setOffset(octave-&gt;start()-&gt;getOffset()+octave-&gt;getLength());</a>
<a name="ln6880">                  }</a>
<a name="ln6881"> </a>
<a name="ln6882">            // end point</a>
<a name="ln6883">            if( i&gt;0 ) {</a>
<a name="ln6884">                  octavePoint-&gt;start()-&gt;setOffset(octave-&gt;start()-&gt;getOffset()+octave-&gt;getLength());</a>
<a name="ln6885">                  octavePoint-&gt;setTick(octave-&gt;getEndTick());</a>
<a name="ln6886">                  }</a>
<a name="ln6887">            }</a>
<a name="ln6888"> </a>
<a name="ln6889">      return true;</a>
<a name="ln6890">      }</a>
<a name="ln6891"> </a>
<a name="ln6892">bool BarsParse::parseMidiController(MeasureData* measureData, int /*length*/) {</a>
<a name="ln6893">      Block placeHolder;</a>
<a name="ln6894">      MidiController* controller = new MidiController();</a>
<a name="ln6895">      measureData-&gt;addMidiData(controller);</a>
<a name="ln6896"> </a>
<a name="ln6897">      parseMidiCommon(controller);</a>
<a name="ln6898"> </a>
<a name="ln6899">      // value [0, 128)</a>
<a name="ln6900">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6901">      controller-&gt;setValue(placeHolder.toUnsignedInt());</a>
<a name="ln6902"> </a>
<a name="ln6903">      // controller number</a>
<a name="ln6904">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6905">      controller-&gt;setController(placeHolder.toUnsignedInt());</a>
<a name="ln6906"> </a>
<a name="ln6907">      if( ove_-&gt;getIsVersion4() ) {</a>
<a name="ln6908">            if( !jump(2) ) { return false; }</a>
<a name="ln6909">            }</a>
<a name="ln6910"> </a>
<a name="ln6911">      return true;</a>
<a name="ln6912">      }</a>
<a name="ln6913"> </a>
<a name="ln6914">bool BarsParse::parseMidiProgramChange(MeasureData* measureData, int /*length*/) {</a>
<a name="ln6915">      Block placeHolder;</a>
<a name="ln6916">      MidiProgramChange* program = new MidiProgramChange();</a>
<a name="ln6917">      measureData-&gt;addMidiData(program);</a>
<a name="ln6918"> </a>
<a name="ln6919">      parseMidiCommon(program);</a>
<a name="ln6920"> </a>
<a name="ln6921">      if( !jump(1) ) { return false; }</a>
<a name="ln6922"> </a>
<a name="ln6923">      // patch</a>
<a name="ln6924">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6925">      program-&gt;setPatch(placeHolder.toUnsignedInt());</a>
<a name="ln6926"> </a>
<a name="ln6927">      if( ove_-&gt;getIsVersion4() ) {</a>
<a name="ln6928">            if( !jump(2) ) { return false; }</a>
<a name="ln6929">            }</a>
<a name="ln6930"> </a>
<a name="ln6931">      return true;</a>
<a name="ln6932">      }</a>
<a name="ln6933"> </a>
<a name="ln6934">bool BarsParse::parseMidiChannelPressure(MeasureData* measureData, int /*length*/) {</a>
<a name="ln6935">      Block placeHolder;</a>
<a name="ln6936">      MidiChannelPressure* pressure = new MidiChannelPressure();</a>
<a name="ln6937">      measureData-&gt;addMidiData(pressure);</a>
<a name="ln6938"> </a>
<a name="ln6939">      parseMidiCommon(pressure);</a>
<a name="ln6940"> </a>
<a name="ln6941">      if( !jump(1) ) { return false; }</a>
<a name="ln6942"> </a>
<a name="ln6943">      // pressure</a>
<a name="ln6944">      if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln6945">      pressure-&gt;setPressure(placeHolder.toUnsignedInt());</a>
<a name="ln6946"> </a>
<a name="ln6947">      if( ove_-&gt;getIsVersion4() )</a>
<a name="ln6948">            {</a>
<a name="ln6949">            if( !jump(2) ) { return false; }</a>
<a name="ln6950">            }</a>
<a name="ln6951"> </a>
<a name="ln6952">      return true;</a>
<a name="ln6953">      }</a>
<a name="ln6954"> </a>
<a name="ln6955">bool BarsParse::parseMidiPitchWheel(MeasureData* measureData, int /*length*/) {</a>
<a name="ln6956">      Block placeHolder;</a>
<a name="ln6957">      MidiPitchWheel* wheel = new MidiPitchWheel();</a>
<a name="ln6958">      measureData-&gt;addMidiData(wheel);</a>
<a name="ln6959"> </a>
<a name="ln6960">      parseMidiCommon(wheel);</a>
<a name="ln6961"> </a>
<a name="ln6962">      // pitch wheel</a>
<a name="ln6963">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6964">      int value = placeHolder.toUnsignedInt();</a>
<a name="ln6965">      wheel-&gt;setValue(value);</a>
<a name="ln6966"> </a>
<a name="ln6967">      if( ove_-&gt;getIsVersion4() ) {</a>
<a name="ln6968">            if( !jump(2) ) { return false; }</a>
<a name="ln6969">            }</a>
<a name="ln6970"> </a>
<a name="ln6971">      return true;</a>
<a name="ln6972">      }</a>
<a name="ln6973"> </a>
<a name="ln6974">bool BarsParse::parseSizeBlock(int length) {</a>
<a name="ln6975">      if( !jump(length) ) { return false; }</a>
<a name="ln6976"> </a>
<a name="ln6977">      return true;</a>
<a name="ln6978">      }</a>
<a name="ln6979"> </a>
<a name="ln6980">bool BarsParse::parseMidiCommon(MidiData* ptr) {</a>
<a name="ln6981">      Block placeHolder;</a>
<a name="ln6982"> </a>
<a name="ln6983">      if( !jump(3) ) { return false; }</a>
<a name="ln6984"> </a>
<a name="ln6985">      // start position</a>
<a name="ln6986">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6987">      ptr-&gt;setTick(placeHolder.toUnsignedInt());</a>
<a name="ln6988"> </a>
<a name="ln6989">      return true;</a>
<a name="ln6990">      }</a>
<a name="ln6991"> </a>
<a name="ln6992">bool BarsParse::parseCommonBlock(MusicData* ptr) {</a>
<a name="ln6993">      Block placeHolder;</a>
<a name="ln6994"> </a>
<a name="ln6995">      // start tick</a>
<a name="ln6996">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln6997">      ptr-&gt;setTick(placeHolder.toInt());</a>
<a name="ln6998"> </a>
<a name="ln6999">      // start unit</a>
<a name="ln7000">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln7001">      ptr-&gt;start()-&gt;setOffset(placeHolder.toInt());</a>
<a name="ln7002"> </a>
<a name="ln7003">      if( ove_-&gt;getIsVersion4() ) {</a>
<a name="ln7004">            // color</a>
<a name="ln7005">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln7006">            ptr-&gt;setColor(placeHolder.toUnsignedInt());</a>
<a name="ln7007"> </a>
<a name="ln7008">            if( !jump(1) ) { return false; }</a>
<a name="ln7009">            }</a>
<a name="ln7010"> </a>
<a name="ln7011">      return true;</a>
<a name="ln7012">      }</a>
<a name="ln7013"> </a>
<a name="ln7014">bool BarsParse::parseOffsetCommonBlock(MusicData* ptr) {</a>
<a name="ln7015">      Block placeHolder;</a>
<a name="ln7016"> </a>
<a name="ln7017">      // offset measure</a>
<a name="ln7018">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln7019">      ptr-&gt;stop()-&gt;setMeasure(placeHolder.toUnsignedInt());</a>
<a name="ln7020"> </a>
<a name="ln7021">      // end unit</a>
<a name="ln7022">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln7023">      ptr-&gt;stop()-&gt;setOffset(placeHolder.toInt());</a>
<a name="ln7024"> </a>
<a name="ln7025">      return true;</a>
<a name="ln7026">      }</a>
<a name="ln7027"> </a>
<a name="ln7028">bool BarsParse::parsePairLinesBlock(PairEnds* ptr) {</a>
<a name="ln7029">      Block placeHolder;</a>
<a name="ln7030"> </a>
<a name="ln7031">      // left line</a>
<a name="ln7032">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln7033">      ptr-&gt;getLeftLine()-&gt;setLine(placeHolder.toInt());</a>
<a name="ln7034"> </a>
<a name="ln7035">      // right line</a>
<a name="ln7036">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln7037">      ptr-&gt;getRightLine()-&gt;setLine(placeHolder.toInt());</a>
<a name="ln7038"> </a>
<a name="ln7039">      return true;</a>
<a name="ln7040">      }</a>
<a name="ln7041"> </a>
<a name="ln7042">bool BarsParse::parseOffsetElement(OffsetElement* ptr) {</a>
<a name="ln7043">      Block placeHolder;</a>
<a name="ln7044"> </a>
<a name="ln7045">      // x offset</a>
<a name="ln7046">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln7047">      ptr-&gt;setXOffset(placeHolder.toInt());</a>
<a name="ln7048"> </a>
<a name="ln7049">      // y offset</a>
<a name="ln7050">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln7051">      ptr-&gt;setYOffset(placeHolder.toInt());</a>
<a name="ln7052"> </a>
<a name="ln7053">      return true;</a>
<a name="ln7054">      }</a>
<a name="ln7055"> </a>
<a name="ln7056">bool BarsParse::getCondElementType(unsigned int byteData, CondType&amp; type) {</a>
<a name="ln7057">      if( byteData == 0x09 ) {</a>
<a name="ln7058">            type = CondType::Time_Parameters;</a>
<a name="ln7059">            } else if (byteData == 0x0A) {</a>
<a name="ln7060">            type = CondType::Bar_Number;</a>
<a name="ln7061">            } else if (byteData == 0x16) {</a>
<a name="ln7062">            type = CondType::Decorator;</a>
<a name="ln7063">            } else if (byteData == 0x1C) {</a>
<a name="ln7064">            type = CondType::Tempo;</a>
<a name="ln7065">            } else if (byteData == 0x1D) {</a>
<a name="ln7066">            type = CondType::Text;</a>
<a name="ln7067">            } else if (byteData == 0x25) {</a>
<a name="ln7068">            type = CondType::Expression;</a>
<a name="ln7069">            } else if (byteData == 0x30) {</a>
<a name="ln7070">            type = CondType::Barline_Parameters;</a>
<a name="ln7071">            } else if (byteData == 0x31) {</a>
<a name="ln7072">            type = CondType::Repeat;</a>
<a name="ln7073">            } else if (byteData == 0x32) {</a>
<a name="ln7074">            type = CondType::Numeric_Ending;</a>
<a name="ln7075">            } else {</a>
<a name="ln7076">            return false;</a>
<a name="ln7077">            }</a>
<a name="ln7078"> </a>
<a name="ln7079">      return true;</a>
<a name="ln7080">      }</a>
<a name="ln7081"> </a>
<a name="ln7082">bool BarsParse::getBdatElementType(unsigned int byteData, BdatType&amp; type) {</a>
<a name="ln7083">      if (byteData == 0x70) {</a>
<a name="ln7084">            type = BdatType::Raw_Note;</a>
<a name="ln7085">            } else if (byteData == 0x80) {</a>
<a name="ln7086">            type = BdatType::Rest;</a>
<a name="ln7087">            } else if (byteData == 0x90) {</a>
<a name="ln7088">            type = BdatType::Note;</a>
<a name="ln7089">            } else if (byteData == 0x10) {</a>
<a name="ln7090">            type = BdatType::Beam;</a>
<a name="ln7091">            } else if (byteData == 0x11) {</a>
<a name="ln7092">            type = BdatType::Harmony;</a>
<a name="ln7093">            } else if (byteData == 0x12) {</a>
<a name="ln7094">            type = BdatType::Clef;</a>
<a name="ln7095">            } else if (byteData == 0x13) {</a>
<a name="ln7096">            type = BdatType::Wedge;</a>
<a name="ln7097">            } else if (byteData == 0x14) {</a>
<a name="ln7098">            type = BdatType::Dynamics;</a>
<a name="ln7099">            } else if (byteData == 0x15) {</a>
<a name="ln7100">            type = BdatType::Glissando;</a>
<a name="ln7101">            } else if (byteData == 0x16) {</a>
<a name="ln7102">            type = BdatType::Decorator;</a>
<a name="ln7103">            } else if (byteData == 0x17) {</a>
<a name="ln7104">            type = BdatType::Key;</a>
<a name="ln7105">            } else if (byteData == 0x18) {</a>
<a name="ln7106">            type = BdatType::Lyric;</a>
<a name="ln7107">            } else if (byteData == 0x19) {</a>
<a name="ln7108">            type = BdatType::Octave_Shift;</a>
<a name="ln7109">            } else if (byteData == 0x1B) {</a>
<a name="ln7110">            type = BdatType::Slur;</a>
<a name="ln7111">            } else if (byteData == 0x1D) {</a>
<a name="ln7112">            type = BdatType::Text;</a>
<a name="ln7113">            } else if (byteData == 0x1E) {</a>
<a name="ln7114">            type = BdatType::Tie;</a>
<a name="ln7115">            } else if (byteData == 0x1F) {</a>
<a name="ln7116">            type = BdatType::Tuplet;</a>
<a name="ln7117">            } else if (byteData == 0x21) {</a>
<a name="ln7118">            type = BdatType::Guitar_Bend;</a>
<a name="ln7119">            } else if (byteData == 0x22) {</a>
<a name="ln7120">            type = BdatType::Guitar_Barre;</a>
<a name="ln7121">            } else if (byteData == 0x23) {</a>
<a name="ln7122">            type = BdatType::Pedal;</a>
<a name="ln7123">            } else if (byteData == 0x24) {</a>
<a name="ln7124">            type = BdatType::KuoHao;</a>
<a name="ln7125">            } else if (byteData == 0x25) {</a>
<a name="ln7126">            type = BdatType::Expressions;</a>
<a name="ln7127">            } else if (byteData == 0x26) {</a>
<a name="ln7128">            type = BdatType::Harp_Pedal;</a>
<a name="ln7129">            } else if (byteData == 0x27) {</a>
<a name="ln7130">            type = BdatType::Multi_Measure_Rest;</a>
<a name="ln7131">            } else if (byteData == 0x28) {</a>
<a name="ln7132">            type = BdatType::Harmony_GuitarFrame;</a>
<a name="ln7133">            } else if (byteData == 0x40) {</a>
<a name="ln7134">            type = BdatType::Graphics_40;</a>
<a name="ln7135">            } else if (byteData == 0x41) {</a>
<a name="ln7136">            type = BdatType::Graphics_RoundRect;</a>
<a name="ln7137">            } else if (byteData == 0x42) {</a>
<a name="ln7138">            type = BdatType::Graphics_Rect;</a>
<a name="ln7139">            } else if (byteData == 0x43) {</a>
<a name="ln7140">            type = BdatType::Graphics_Round;</a>
<a name="ln7141">            } else if (byteData == 0x44) {</a>
<a name="ln7142">            type = BdatType::Graphics_Line;</a>
<a name="ln7143">            } else if (byteData == 0x45) {</a>
<a name="ln7144">            type = BdatType::Graphics_Curve;</a>
<a name="ln7145">            } else if (byteData == 0x46) {</a>
<a name="ln7146">            type = BdatType::Graphics_WedgeSymbol;</a>
<a name="ln7147">            } else if (byteData == 0xAB) {</a>
<a name="ln7148">            type = BdatType::Midi_Controller;</a>
<a name="ln7149">            } else if (byteData == 0xAC) {</a>
<a name="ln7150">            type = BdatType::Midi_Program_Change;</a>
<a name="ln7151">            } else if (byteData == 0xAD) {</a>
<a name="ln7152">            type = BdatType::Midi_Channel_Pressure;</a>
<a name="ln7153">            } else if (byteData == 0xAE) {</a>
<a name="ln7154">            type = BdatType::Midi_Pitch_Wheel;</a>
<a name="ln7155">            } else if (byteData == 0xFF) {</a>
<a name="ln7156">            type = BdatType::Bar_End;</a>
<a name="ln7157">            } else {</a>
<a name="ln7158">            return false;</a>
<a name="ln7159">            }</a>
<a name="ln7160"> </a>
<a name="ln7161">      return true;</a>
<a name="ln7162">      }</a>
<a name="ln7163"> </a>
<a name="ln7164">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln7165">LyricChunkParse::LyricChunkParse(OveSong* ove) :</a>
<a name="ln7166">      BasicParse(ove) {</a>
<a name="ln7167">      }</a>
<a name="ln7168"> </a>
<a name="ln7169">void LyricChunkParse::setLyricChunk(SizeChunk* chunk) {</a>
<a name="ln7170">      chunk_ = chunk;</a>
<a name="ln7171">      }</a>
<a name="ln7172"> </a>
<a name="ln7173">// only ove3 has this chunk</a>
<a name="ln7174">bool LyricChunkParse::parse() {</a>
<a name="ln7175">      unsigned int i;</a>
<a name="ln7176">      Block* dataBlock = chunk_-&gt;getDataBlock();</a>
<a name="ln7177">      unsigned int blockSize = chunk_-&gt;getSizeBlock()-&gt;toSize();</a>
<a name="ln7178">      StreamHandle handle(dataBlock-&gt;data(), blockSize);</a>
<a name="ln7179">      Block placeHolder;</a>
<a name="ln7180"> </a>
<a name="ln7181">      handle_ = &amp;handle;</a>
<a name="ln7182"> </a>
<a name="ln7183">      if( !jump(4) ) { return false; }</a>
<a name="ln7184"> </a>
<a name="ln7185">      // Lyric count</a>
<a name="ln7186">      if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln7187">      unsigned int count = placeHolder.toUnsignedInt();</a>
<a name="ln7188"> </a>
<a name="ln7189">      for( i=0; i&lt;count; ++i ) {</a>
<a name="ln7190">            LyricInfo info;</a>
<a name="ln7191"> </a>
<a name="ln7192">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln7193">            //unsigned int size = placeHolder.toUnsignedInt();</a>
<a name="ln7194"> </a>
<a name="ln7195">            // 0x0D00</a>
<a name="ln7196">            if( !jump(2) ) { return false; }</a>
<a name="ln7197"> </a>
<a name="ln7198">            // voice</a>
<a name="ln7199">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln7200">            info.voice_ = placeHolder.toUnsignedInt();</a>
<a name="ln7201"> </a>
<a name="ln7202">            // verse</a>
<a name="ln7203">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln7204">            info.verse_ = placeHolder.toUnsignedInt();</a>
<a name="ln7205"> </a>
<a name="ln7206">            // track</a>
<a name="ln7207">            if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln7208">            info.track_ = placeHolder.toUnsignedInt();</a>
<a name="ln7209"> </a>
<a name="ln7210">            if( !jump(1) ) { return false; }</a>
<a name="ln7211"> </a>
<a name="ln7212">            // measure</a>
<a name="ln7213">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln7214">            info.measure_ = placeHolder.toUnsignedInt();</a>
<a name="ln7215"> </a>
<a name="ln7216">            // word count</a>
<a name="ln7217">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln7218">            info.wordCount_ = placeHolder.toUnsignedInt();</a>
<a name="ln7219"> </a>
<a name="ln7220">            // lyric size</a>
<a name="ln7221">            if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln7222">            info.lyricSize_ = placeHolder.toUnsignedInt();</a>
<a name="ln7223"> </a>
<a name="ln7224">            if( !jump(6) ) { return false; }</a>
<a name="ln7225"> </a>
<a name="ln7226">            // name</a>
<a name="ln7227">            if( !readBuffer(placeHolder, 32) ) { return false; }</a>
<a name="ln7228">            info.name_ = ove_-&gt;getCodecString(placeHolder.fixedSizeBufferToStrByteArray());</a>
<a name="ln7229"> </a>
<a name="ln7230">            if( info.lyricSize_ &gt; 0 ) {</a>
<a name="ln7231">                  // lyric</a>
<a name="ln7232">                  if( info.lyricSize_ &gt; 0 ) {</a>
<a name="ln7233">                        if( !readBuffer(placeHolder, info.lyricSize_) ) { return false; }</a>
<a name="ln7234">                        info.lyric_ = ove_-&gt;getCodecString(placeHolder.fixedSizeBufferToStrByteArray());</a>
<a name="ln7235">                        }</a>
<a name="ln7236"> </a>
<a name="ln7237">                  if( !jump(4) ) { return false; }</a>
<a name="ln7238"> </a>
<a name="ln7239">                  // font</a>
<a name="ln7240">                  if( !readBuffer(placeHolder, 2) ) { return false; }</a>
<a name="ln7241">                  info.font_ = placeHolder.toUnsignedInt();</a>
<a name="ln7242"> </a>
<a name="ln7243">                  if( !jump(1) ) { return false; }</a>
<a name="ln7244"> </a>
<a name="ln7245">                  // font size</a>
<a name="ln7246">                  if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln7247">                  info.fontSize_ = placeHolder.toUnsignedInt();</a>
<a name="ln7248"> </a>
<a name="ln7249">                  // font style</a>
<a name="ln7250">                  if( !readBuffer(placeHolder, 1) ) { return false; }</a>
<a name="ln7251">                  info.fontStyle_ = placeHolder.toUnsignedInt();</a>
<a name="ln7252"> </a>
<a name="ln7253">                  if( !jump(1) ) { return false; }</a>
<a name="ln7254"> </a>
<a name="ln7255">                  for( int j=0; j&lt;info.wordCount_; ++j ) {</a>
<a name="ln7256">                        if( !jump(8) ) { return false; }</a>
<a name="ln7257">                        }</a>
<a name="ln7258">                  }</a>
<a name="ln7259"> </a>
<a name="ln7260">            processLyricInfo(info);</a>
<a name="ln7261">            }</a>
<a name="ln7262"> </a>
<a name="ln7263">      return true;</a>
<a name="ln7264">      }</a>
<a name="ln7265"> </a>
<a name="ln7266">bool isSpace(char c) {</a>
<a name="ln7267">      return c == ' ' || c == '\n';</a>
<a name="ln7268">      }</a>
<a name="ln7269"> </a>
<a name="ln7270">void LyricChunkParse::processLyricInfo(const LyricInfo&amp; info) {</a>
<a name="ln7271">      int i;</a>
<a name="ln7272">      int j;</a>
<a name="ln7273">      int index = 0; //words</a>
<a name="ln7274"> </a>
<a name="ln7275">      int measureId = info.measure_-1;</a>
<a name="ln7276">      bool changeMeasure = true;</a>
<a name="ln7277">      MeasureData* measureData = 0;</a>
<a name="ln7278">      int trackMeasureCount = ove_-&gt;getTrackBarCount();</a>
<a name="ln7279">      QStringList words = info.lyric_.split(&quot; &quot;, QString::SkipEmptyParts);</a>
<a name="ln7280"> </a>
<a name="ln7281">      while ( index &lt; words.size() &amp;&amp; measureId+1 &lt; trackMeasureCount ) {</a>
<a name="ln7282">            if( changeMeasure ) {</a>
<a name="ln7283">                  ++measureId;</a>
<a name="ln7284">                  measureData = ove_-&gt;getMeasureData(info.track_, measureId);</a>
<a name="ln7285">                  changeMeasure = false;</a>
<a name="ln7286">                  }</a>
<a name="ln7287"> </a>
<a name="ln7288">            if( measureData == 0 ) { return; }</a>
<a name="ln7289">            QList&lt;NoteContainer*&gt; containers = measureData-&gt;getNoteContainers();</a>
<a name="ln7290">            QList&lt;MusicData*&gt; lyrics = measureData-&gt;getMusicDatas(MusicDataType::Lyric);</a>
<a name="ln7291"> </a>
<a name="ln7292">            for( i=0; i&lt;containers.size() &amp;&amp; index&lt;words.size(); ++i ) {</a>
<a name="ln7293">                  if( containers[i]-&gt;getIsRest() ) {</a>
<a name="ln7294">                        continue;</a>
<a name="ln7295">                        }</a>
<a name="ln7296"> </a>
<a name="ln7297">                  for( j=0; j&lt;lyrics.size(); ++j ) {</a>
<a name="ln7298">                        Lyric* lyric = static_cast&lt;Lyric*&gt;(lyrics[j]);</a>
<a name="ln7299"> </a>
<a name="ln7300">                        if( containers[i]-&gt;start()-&gt;getOffset() == lyric-&gt;start()-&gt;getOffset() &amp;&amp;</a>
<a name="ln7301">                            (int)containers[i]-&gt;getVoice() == info.voice_ &amp;&amp;</a>
<a name="ln7302">                            lyric-&gt;getVerse() == info.verse_ ) {</a>
<a name="ln7303">                              if(index&lt;words.size()) {</a>
<a name="ln7304">                                    QString l = words[index].trimmed();</a>
<a name="ln7305">                                    if(!l.isEmpty()) {</a>
<a name="ln7306">                                          lyric-&gt;setLyric(l);</a>
<a name="ln7307">                                          lyric-&gt;setVoice(info.voice_);</a>
<a name="ln7308">                                          }</a>
<a name="ln7309">                                    }</a>
<a name="ln7310"> </a>
<a name="ln7311">                              ++index;</a>
<a name="ln7312">                              }</a>
<a name="ln7313">                        }</a>
<a name="ln7314">                  }</a>
<a name="ln7315"> </a>
<a name="ln7316">            changeMeasure = true;</a>
<a name="ln7317">            }</a>
<a name="ln7318">      }</a>
<a name="ln7319"> </a>
<a name="ln7320">///////////////////////////////////////////////////////////////////////////////</a>
<a name="ln7321">TitleChunkParse::TitleChunkParse(OveSong* ove) :</a>
<a name="ln7322">      BasicParse(ove) {</a>
<a name="ln7323">      titleType_ = 0x00000001;</a>
<a name="ln7324">      annotateType_ = 0x00010000;</a>
<a name="ln7325">      writerType_ = 0x00020002;</a>
<a name="ln7326">      copyrightType_ = 0x00030001;</a>
<a name="ln7327">      headerType_ = 0x00040000;</a>
<a name="ln7328">      footerType_ = 0x00050002;</a>
<a name="ln7329">      }</a>
<a name="ln7330"> </a>
<a name="ln7331">void TitleChunkParse::setTitleChunk(SizeChunk* chunk) {</a>
<a name="ln7332">      chunk_ = chunk;</a>
<a name="ln7333">      }</a>
<a name="ln7334"> </a>
<a name="ln7335">QByteArray getByteArray(const Block&amp; block) {</a>
<a name="ln7336">      QByteArray array((char*)block.data(), block.size());</a>
<a name="ln7337">      int index0 = array.indexOf('\0');</a>
<a name="ln7338">      array = array.left(index0);</a>
<a name="ln7339"> </a>
<a name="ln7340">      return array;</a>
<a name="ln7341">      }</a>
<a name="ln7342"> </a>
<a name="ln7343">bool TitleChunkParse::parse() {</a>
<a name="ln7344">      Block* dataBlockP = chunk_-&gt;getDataBlock();</a>
<a name="ln7345">      unsigned int blockSize = chunk_-&gt;getSizeBlock()-&gt;toSize();</a>
<a name="ln7346">      StreamHandle handle(dataBlockP-&gt;data(), blockSize);</a>
<a name="ln7347">      Block typeBlock;</a>
<a name="ln7348">      unsigned int titleType;</a>
<a name="ln7349"> </a>
<a name="ln7350">      handle_ = &amp;handle;</a>
<a name="ln7351"> </a>
<a name="ln7352">      if( !readBuffer(typeBlock, 4) ) { return false; }</a>
<a name="ln7353"> </a>
<a name="ln7354">      titleType = typeBlock.toUnsignedInt();</a>
<a name="ln7355"> </a>
<a name="ln7356">      if( titleType == titleType_ || titleType == annotateType_ || titleType == writerType_ || titleType == copyrightType_ ) {</a>
<a name="ln7357">            Block offsetBlock;</a>
<a name="ln7358"> </a>
<a name="ln7359">            if( !readBuffer(offsetBlock, 4) ) { return false; }</a>
<a name="ln7360"> </a>
<a name="ln7361">            const unsigned int itemCount = 4;</a>
<a name="ln7362">            unsigned int i;</a>
<a name="ln7363"> </a>
<a name="ln7364">            for( i=0; i&lt;itemCount; ++i ) {</a>
<a name="ln7365">                  if( i&gt;0 ) {</a>
<a name="ln7366">                        //0x 00 AB 00 0C 00 00</a>
<a name="ln7367">                        if( !jump(6) ) { return false; }</a>
<a name="ln7368">                        }</a>
<a name="ln7369"> </a>
<a name="ln7370">                  Block countBlock;</a>
<a name="ln7371">                  if( !readBuffer(countBlock, 2) ) { return false; }</a>
<a name="ln7372">                  unsigned int titleSize = countBlock.toUnsignedInt();</a>
<a name="ln7373"> </a>
<a name="ln7374">                  Block dataBlock;</a>
<a name="ln7375">                  if( !readBuffer(dataBlock, titleSize) ) { return false; }</a>
<a name="ln7376"> </a>
<a name="ln7377">                  QByteArray array = getByteArray(dataBlock);</a>
<a name="ln7378">                  if(!array.isEmpty()) {</a>
<a name="ln7379">                        addToOve(ove_-&gt;getCodecString(array), titleType);</a>
<a name="ln7380">                        }</a>
<a name="ln7381">                  }</a>
<a name="ln7382"> </a>
<a name="ln7383">            return true;</a>
<a name="ln7384">            }</a>
<a name="ln7385"> </a>
<a name="ln7386">      if( titleType == headerType_ || titleType == footerType_ ) {</a>
<a name="ln7387">            if( !jump(10) ) { return false; }</a>
<a name="ln7388"> </a>
<a name="ln7389">            Block countBlock;</a>
<a name="ln7390">            if( !readBuffer(countBlock, 2) ) { return false; }</a>
<a name="ln7391">            unsigned int titleSize = countBlock.toUnsignedInt();</a>
<a name="ln7392"> </a>
<a name="ln7393">            Block dataBlock;</a>
<a name="ln7394">            if( !readBuffer(dataBlock, titleSize) ) { return false; }</a>
<a name="ln7395"> </a>
<a name="ln7396">            QByteArray array = getByteArray(dataBlock);</a>
<a name="ln7397">            addToOve(ove_-&gt;getCodecString(array), titleType);</a>
<a name="ln7398"> </a>
<a name="ln7399">            //0x 00 AB 00 0C 00 00</a>
<a name="ln7400">            if( !jump(6) ) { return false; }</a>
<a name="ln7401"> </a>
<a name="ln7402">            return true;</a>
<a name="ln7403">            }</a>
<a name="ln7404"> </a>
<a name="ln7405">      return false;</a>
<a name="ln7406">      }</a>
<a name="ln7407"> </a>
<a name="ln7408">void TitleChunkParse::addToOve(const QString&amp; str, unsigned int titleType) {</a>
<a name="ln7409">      if( str.isEmpty() ) { return; }</a>
<a name="ln7410"> </a>
<a name="ln7411">      if (titleType == titleType_) {</a>
<a name="ln7412">            ove_-&gt;addTitle(str);</a>
<a name="ln7413">            }</a>
<a name="ln7414"> </a>
<a name="ln7415">      if (titleType == annotateType_) {</a>
<a name="ln7416">            ove_-&gt;addAnnotate(str);</a>
<a name="ln7417">            }</a>
<a name="ln7418"> </a>
<a name="ln7419">      if (titleType == writerType_) {</a>
<a name="ln7420">            ove_-&gt;addWriter(str);</a>
<a name="ln7421">            }</a>
<a name="ln7422"> </a>
<a name="ln7423">      if (titleType == copyrightType_) {</a>
<a name="ln7424">            ove_-&gt;addCopyright(str);</a>
<a name="ln7425">            }</a>
<a name="ln7426"> </a>
<a name="ln7427">      if (titleType == headerType_) {</a>
<a name="ln7428">            ove_-&gt;addHeader(str);</a>
<a name="ln7429">            }</a>
<a name="ln7430"> </a>
<a name="ln7431">      if (titleType == footerType_) {</a>
<a name="ln7432">            ove_-&gt;addFooter(str);</a>
<a name="ln7433">            }</a>
<a name="ln7434">      }</a>
<a name="ln7435"> </a>
<a name="ln7436">// OveOrganize.cpp</a>
<a name="ln7437">OveOrganizer::OveOrganizer(OveSong* ove) {</a>
<a name="ln7438">      ove_ = ove;</a>
<a name="ln7439">      }</a>
<a name="ln7440"> </a>
<a name="ln7441">void OveOrganizer::organize() {</a>
<a name="ln7442">      if(ove_ == NULL) {</a>
<a name="ln7443">            return;</a>
<a name="ln7444">            }</a>
<a name="ln7445"> </a>
<a name="ln7446">      organizeTracks();</a>
<a name="ln7447">      organizeAttributes();</a>
<a name="ln7448">      organizeMeasures();</a>
<a name="ln7449">      }</a>
<a name="ln7450"> </a>
<a name="ln7451">void OveOrganizer::organizeAttributes() {</a>
<a name="ln7452">      int i;</a>
<a name="ln7453">      int j;</a>
<a name="ln7454">      int k;</a>
<a name="ln7455"> </a>
<a name="ln7456">      // key</a>
<a name="ln7457">      if(ove_-&gt;getLineCount() &gt; 0) {</a>
<a name="ln7458">            Line* line = ove_-&gt;getLine(0);</a>
<a name="ln7459">            int partBarCount = ove_-&gt;getPartBarCount();</a>
<a name="ln7460">            int lastKey = 0;</a>
<a name="ln7461"> </a>
<a name="ln7462">            if(line != 0){</a>
<a name="ln7463">                  for(i=0; i&lt;line-&gt;getStaffCount(); ++i) {</a>
<a name="ln7464">                        QPair&lt;int, int&gt; partStaff = ove_-&gt;trackToPartStaff(i);</a>
<a name="ln7465">                        Staff* staff = line-&gt;getStaff(i);</a>
<a name="ln7466">                        lastKey = staff-&gt;getKeyType();</a>
<a name="ln7467"> </a>
<a name="ln7468">                        for(j=0; j&lt;partBarCount; ++j) {</a>
<a name="ln7469">                              MeasureData* measureData = ove_-&gt;getMeasureData(partStaff.first, partStaff.second, j);</a>
<a name="ln7470"> </a>
<a name="ln7471">                              if(measureData != 0) {</a>
<a name="ln7472">                                    Key* key = measureData-&gt;getKey();</a>
<a name="ln7473"> </a>
<a name="ln7474">                                    if( j==0 ) {</a>
<a name="ln7475">                                          key-&gt;setKey(lastKey);</a>
<a name="ln7476">                                          key-&gt;setPreviousKey(lastKey);</a>
<a name="ln7477">                                          }</a>
<a name="ln7478"> </a>
<a name="ln7479">                                    if( !key-&gt;getSetKey() ) {</a>
<a name="ln7480">                                          key-&gt;setKey(lastKey);</a>
<a name="ln7481">                                          key-&gt;setPreviousKey(lastKey);</a>
<a name="ln7482">                                          }</a>
<a name="ln7483">                                    else {</a>
<a name="ln7484">                                          if( key-&gt;getKey() != lastKey ) {</a>
<a name="ln7485">                                                lastKey = key-&gt;getKey();</a>
<a name="ln7486">                                                }</a>
<a name="ln7487">                                          }</a>
<a name="ln7488">                                    }</a>
<a name="ln7489">                              }</a>
<a name="ln7490">                        }</a>
<a name="ln7491">                  }</a>
<a name="ln7492">            }</a>
<a name="ln7493"> </a>
<a name="ln7494">      // clef</a>
<a name="ln7495">      if( ove_-&gt;getLineCount() &gt; 0 ) {</a>
<a name="ln7496">            Line* line = ove_-&gt;getLine(0);</a>
<a name="ln7497">            int partBarCount = ove_-&gt;getPartBarCount();</a>
<a name="ln7498">            ClefType lastClefType = ClefType::Treble;</a>
<a name="ln7499"> </a>
<a name="ln7500">            if(line != 0){</a>
<a name="ln7501">                  for( i=0; i&lt;line-&gt;getStaffCount(); ++i ) {</a>
<a name="ln7502">                        QPair&lt;int, int&gt; partStaff = ove_-&gt;trackToPartStaff(i);</a>
<a name="ln7503">                        Staff* staff = line-&gt;getStaff(i);</a>
<a name="ln7504">                        lastClefType = staff-&gt;getClefType();</a>
<a name="ln7505"> </a>
<a name="ln7506">                        for( j=0; j&lt;partBarCount; ++j ) {</a>
<a name="ln7507">                              MeasureData* measureData = ove_-&gt;getMeasureData(partStaff.first, partStaff.second, j);</a>
<a name="ln7508"> </a>
<a name="ln7509">                              if(measureData != 0) {</a>
<a name="ln7510">                                    Clef* clefPtr = measureData-&gt;getClef();</a>
<a name="ln7511">                                    clefPtr-&gt;setClefType((int)lastClefType);</a>
<a name="ln7512"> </a>
<a name="ln7513">                                    const QList&lt;MusicData*&gt;&amp; clefs = measureData-&gt;getMusicDatas(MusicDataType::Clef);</a>
<a name="ln7514"> </a>
<a name="ln7515">                                    for( k=0; k&lt;clefs.size(); ++k ) {</a>
<a name="ln7516">                                          Clef* clef = static_cast&lt;Clef*&gt;(clefs[k]);</a>
<a name="ln7517">                                          lastClefType = clef-&gt;getClefType();</a>
<a name="ln7518">                                          }</a>
<a name="ln7519">                                    }</a>
<a name="ln7520">                              }</a>
<a name="ln7521">                        }</a>
<a name="ln7522">                  }</a>
<a name="ln7523">            }</a>
<a name="ln7524">      }</a>
<a name="ln7525"> </a>
<a name="ln7526">Staff* getStaff(OveSong* ove, int track) {</a>
<a name="ln7527">      if (ove-&gt;getLineCount() &gt; 0) {</a>
<a name="ln7528">            Line* line = ove-&gt;getLine(0);</a>
<a name="ln7529">            if(line != 0 &amp;&amp; line-&gt;getStaffCount() &gt; 0) {</a>
<a name="ln7530">                  Staff* staff = line-&gt;getStaff(track);</a>
<a name="ln7531">                  return staff;</a>
<a name="ln7532">                  }</a>
<a name="ln7533">            }</a>
<a name="ln7534"> </a>
<a name="ln7535">      return 0;</a>
<a name="ln7536">      }</a>
<a name="ln7537"> </a>
<a name="ln7538">void OveOrganizer::organizeTracks() {</a>
<a name="ln7539">      int i;</a>
<a name="ln7540">      //QList&lt;QPair&lt;ClefType, int&gt; &gt; trackChannels;</a>
<a name="ln7541">      QList&lt;Track*&gt; tracks = ove_-&gt;getTracks();</a>
<a name="ln7542">      QList&lt;bool&gt; comboStaveStarts;</a>
<a name="ln7543"> </a>
<a name="ln7544">      for( i=0; i&lt;tracks.size(); ++i ) {</a>
<a name="ln7545">            comboStaveStarts.push_back(false);</a>
<a name="ln7546">            }</a>
<a name="ln7547"> </a>
<a name="ln7548">      for( i=0; i&lt;tracks.size(); ++i ) {</a>
<a name="ln7549">            Staff* staff = getStaff(ove_, i);</a>
<a name="ln7550">            if(staff != 0) {</a>
<a name="ln7551">                  if(staff-&gt;getGroupType() == GroupType::Brace &amp;&amp; staff-&gt;getGroupStaffCount() == 1 ) {</a>
<a name="ln7552">                        comboStaveStarts[i] = true;</a>
<a name="ln7553">                        }</a>
<a name="ln7554">                  }</a>
<a name="ln7555"> </a>
<a name="ln7556">            /*if( i &lt; tracks.size() - 1 ) {</a>
<a name="ln7557">         if( tracks[i]-&gt;getStartClef() == ClefType::Treble &amp;&amp;</a>
<a name="ln7558">            tracks[i+1]-&gt;getStartClef() == ClefType::Bass &amp;&amp;</a>
<a name="ln7559">            tracks[i]-&gt;getChannel() == tracks[i+1]-&gt;get_channel() ) {</a>
<a name="ln7560">         }</a>
<a name="ln7561">      }*/</a>
<a name="ln7562">            }</a>
<a name="ln7563"> </a>
<a name="ln7564">      int trackId = 0;</a>
<a name="ln7565">      QList&lt;int&gt; partStaffCounts;</a>
<a name="ln7566"> </a>
<a name="ln7567">      while( trackId &lt; (int)tracks.size() ) {</a>
<a name="ln7568">            int partTrackCount = 1;</a>
<a name="ln7569"> </a>
<a name="ln7570">            if( comboStaveStarts[trackId] ) {</a>
<a name="ln7571">                  partTrackCount = 2;</a>
<a name="ln7572">                  }</a>
<a name="ln7573"> </a>
<a name="ln7574">            partStaffCounts.push_back(partTrackCount);</a>
<a name="ln7575">            trackId += partTrackCount;</a>
<a name="ln7576">            }</a>
<a name="ln7577"> </a>
<a name="ln7578">      ove_-&gt;setPartStaffCounts(partStaffCounts);</a>
<a name="ln7579">      }</a>
<a name="ln7580"> </a>
<a name="ln7581">void OveOrganizer::organizeMeasures() {</a>
<a name="ln7582">      int trackBarCount = ove_-&gt;getTrackBarCount();</a>
<a name="ln7583"> </a>
<a name="ln7584">      for( int i=0; i&lt;ove_-&gt;getPartCount(); ++i ) {</a>
<a name="ln7585">            int partStaffCount = ove_-&gt;getStaffCount(i);</a>
<a name="ln7586"> </a>
<a name="ln7587">            for( int j=0; j&lt;partStaffCount; ++j ) {</a>
<a name="ln7588">                  for( int k=0; k&lt;trackBarCount; ++k ) {</a>
<a name="ln7589">                        Measure* measure = ove_-&gt;getMeasure(k);</a>
<a name="ln7590">                        MeasureData* measureData = ove_-&gt;getMeasureData(i, j, k);</a>
<a name="ln7591"> </a>
<a name="ln7592">                        organizeMeasure(i, j, measure, measureData);</a>
<a name="ln7593">                        }</a>
<a name="ln7594">                  }</a>
<a name="ln7595">            }</a>
<a name="ln7596">      }</a>
<a name="ln7597"> </a>
<a name="ln7598">void OveOrganizer::organizeMeasure(int part, int track, Measure* measure, MeasureData* measureData) {</a>
<a name="ln7599">      // note containers</a>
<a name="ln7600">      organizeContainers(part, track, measure, measureData);</a>
<a name="ln7601"> </a>
<a name="ln7602">      // single end data</a>
<a name="ln7603">      organizeMusicDatas(part, track, measure, measureData);</a>
<a name="ln7604"> </a>
<a name="ln7605">      // cross measure elements</a>
<a name="ln7606">      organizeCrossMeasureElements(part, track, measure, measureData);</a>
<a name="ln7607">      }</a>
<a name="ln7608"> </a>
<a name="ln7609">void addToList(QList&lt;int&gt;&amp; list, int number) {</a>
<a name="ln7610">      for(int i=0; i&lt;list.size(); ++i){</a>
<a name="ln7611">            if(list[i] == number){</a>
<a name="ln7612">                  return;</a>
<a name="ln7613">                  }</a>
<a name="ln7614">            }</a>
<a name="ln7615"> </a>
<a name="ln7616">      list.push_back(number);</a>
<a name="ln7617">      }</a>
<a name="ln7618"> </a>
<a name="ln7619">void OveOrganizer::organizeContainers(int /*part*/, int /*track*/,</a>
<a name="ln7620">                                      Measure* measure, MeasureData* measureData) {</a>
<a name="ln7621">      int i;</a>
<a name="ln7622">      QList&lt;NoteContainer*&gt; containers = measureData-&gt;getNoteContainers();</a>
<a name="ln7623">      int barUnits = measure-&gt;getTime()-&gt;getUnits();</a>
<a name="ln7624">      QList&lt;int&gt; voices;</a>
<a name="ln7625"> </a>
<a name="ln7626">      for(i=0; i&lt;containers.size(); ++i){</a>
<a name="ln7627">            int endUnit = barUnits;</a>
<a name="ln7628">            if( i &lt; containers.size() - 1 ) {</a>
<a name="ln7629">                  endUnit = containers[i+1]-&gt;start()-&gt;getOffset();</a>
<a name="ln7630">                  }</a>
<a name="ln7631"> </a>
<a name="ln7632">            containers[i]-&gt;stop()-&gt;setOffset(endUnit);</a>
<a name="ln7633">            addToList(voices, containers[i]-&gt;getVoice());</a>
<a name="ln7634">            }</a>
<a name="ln7635"> </a>
<a name="ln7636">      // shift voices</a>
<a name="ln7637">      qSort(voices.begin(), voices.end());</a>
<a name="ln7638"> </a>
<a name="ln7639">      for (i = 0; i &lt; voices.size(); ++i) {</a>
<a name="ln7640">            int voice = voices[i];</a>
<a name="ln7641">            // voice -&gt; i</a>
<a name="ln7642">            for(int j=0; j&lt;(int)containers.size(); ++j) {</a>
<a name="ln7643">                  int avoice = containers[j]-&gt;getVoice();</a>
<a name="ln7644">                  if ( avoice == voice &amp;&amp; avoice != i ) {</a>
<a name="ln7645">                        containers[j]-&gt;setVoice(i);</a>
<a name="ln7646">                        }</a>
<a name="ln7647">                  }</a>
<a name="ln7648">            }</a>
<a name="ln7649">      }</a>
<a name="ln7650"> </a>
<a name="ln7651">void OveOrganizer::organizeMusicDatas(int /*part*/, int /*track*/, Measure* measure, MeasureData* measureData) {</a>
<a name="ln7652">      int i;</a>
<a name="ln7653">      int barIndex = measure-&gt;getBarNumber()-&gt;getIndex();</a>
<a name="ln7654">      QList&lt;MusicData*&gt; datas = measureData-&gt;getMusicDatas(MusicDataType::None);</a>
<a name="ln7655"> </a>
<a name="ln7656">      for(i=0; i&lt;datas.size(); ++i) {</a>
<a name="ln7657">            datas[i]-&gt;start()-&gt;setMeasure(barIndex);</a>
<a name="ln7658">            }</a>
<a name="ln7659">      }</a>
<a name="ln7660"> </a>
<a name="ln7661">void OveOrganizer::organizeCrossMeasureElements(int part, int track, Measure* measure, MeasureData* measureData) {</a>
<a name="ln7662">      int i;</a>
<a name="ln7663">      QList&lt;MusicData*&gt; pairs = measureData-&gt;getCrossMeasureElements(MusicDataType::None, MeasureData::PairType::Start);</a>
<a name="ln7664"> </a>
<a name="ln7665">      for(i=0; i&lt;pairs.size(); ++i) {</a>
<a name="ln7666">            MusicData* pair = pairs[i];</a>
<a name="ln7667"> </a>
<a name="ln7668">            switch ( pair-&gt;getMusicDataType() ) {</a>
<a name="ln7669">                  case MusicDataType::Beam :</a>
<a name="ln7670">                  case MusicDataType::Glissando :</a>
<a name="ln7671">                  case MusicDataType::Slur :</a>
<a name="ln7672">                  case MusicDataType::Tie :</a>
<a name="ln7673">                  case MusicDataType::Tuplet :</a>
<a name="ln7674">                  case MusicDataType::Pedal :</a>
<a name="ln7675">                  case MusicDataType::Numeric_Ending :</a>
<a name="ln7676">                        //case MusicDataType::OctaveShift_EndPoint :</a>
<a name="ln7677">                  case MusicDataType::Measure_Repeat : {</a>
<a name="ln7678">                        organizePairElement(pair, part, track, measure, measureData);</a>
<a name="ln7679">                        break;</a>
<a name="ln7680">                        }</a>
<a name="ln7681">                  case MusicDataType::OctaveShift : {</a>
<a name="ln7682">                        OctaveShift* octave = static_cast&lt;OctaveShift*&gt;(pair);</a>
<a name="ln7683">                        organizeOctaveShift(octave, measure, measureData);</a>
<a name="ln7684">                        break;</a>
<a name="ln7685">                        }</a>
<a name="ln7686">                  case MusicDataType::Wedge : {</a>
<a name="ln7687">                        Wedge* wedge = static_cast&lt;Wedge*&gt;(pair);</a>
<a name="ln7688">                        organizeWedge(wedge, part, track, measure, measureData);</a>
<a name="ln7689">                        break;</a>
<a name="ln7690">                        }</a>
<a name="ln7691">                  default:</a>
<a name="ln7692">                        break;</a>
<a name="ln7693">                  }</a>
<a name="ln7694">            }</a>
<a name="ln7695">      }</a>
<a name="ln7696"> </a>
<a name="ln7697">void OveOrganizer::organizePairElement(</a>
<a name="ln7698">            MusicData* data,</a>
<a name="ln7699">            int part,</a>
<a name="ln7700">            int track,</a>
<a name="ln7701">            Measure* measure,</a>
<a name="ln7702">            MeasureData* measureData) {</a>
<a name="ln7703">      int bar1Index = measure-&gt;getBarNumber()-&gt;getIndex();</a>
<a name="ln7704">      int bar2Index = bar1Index + data-&gt;stop()-&gt;getMeasure();</a>
<a name="ln7705">      MeasureData* measureData2 = ove_-&gt;getMeasureData(part, track, bar2Index);</a>
<a name="ln7706"> </a>
<a name="ln7707">      data-&gt;start()-&gt;setMeasure(bar1Index);</a>
<a name="ln7708"> </a>
<a name="ln7709">      if(measureData2 != 0 &amp;&amp; measureData != measureData2) {</a>
<a name="ln7710">            measureData2-&gt;addCrossMeasureElement(data, false);</a>
<a name="ln7711">            }</a>
<a name="ln7712"> </a>
<a name="ln7713">      if( data-&gt;getMusicDataType() == MusicDataType::Tuplet ){</a>
<a name="ln7714">            Tuplet* tuplet = static_cast&lt;Tuplet*&gt;(data);</a>
<a name="ln7715">            const QList&lt;NoteContainer*&gt; containers = measureData-&gt;getNoteContainers();</a>
<a name="ln7716"> </a>
<a name="ln7717">            for(int i=0; i&lt;containers.size(); ++i){</a>
<a name="ln7718">                  if(containers[i]-&gt;getTick() &gt; tuplet-&gt;getTick()){</a>
<a name="ln7719">                        break;</a>
<a name="ln7720">                        }</a>
<a name="ln7721"> </a>
<a name="ln7722">                  if(containers[i]-&gt;getTick() == tuplet-&gt;getTick()){</a>
<a name="ln7723">                        tuplet-&gt;setNoteType(containers[i]-&gt;getNoteType());</a>
<a name="ln7724">                        }</a>
<a name="ln7725">                  }</a>
<a name="ln7726"> </a>
<a name="ln7727">            int tupletTick = NoteTypeToTick(tuplet-&gt;getNoteType(), ove_-&gt;getQuarter())*tuplet-&gt;getSpace();</a>
<a name="ln7728">            if( tuplet-&gt;getTick() % tupletTick != 0 ) {</a>
<a name="ln7729">                  int newStartTick = (tuplet-&gt;getTick() / tupletTick) * tupletTick;</a>
<a name="ln7730"> </a>
<a name="ln7731">                  for(int i=0; i&lt;containers.size(); ++i){</a>
<a name="ln7732">                        if( containers[i]-&gt;getTick() == newStartTick &amp;&amp;</a>
<a name="ln7733">                            containers[i]-&gt;getTuplet() == tuplet-&gt;getTuplet()) {</a>
<a name="ln7734">                              tuplet-&gt;setTick(containers[i]-&gt;getTick());</a>
<a name="ln7735">                              tuplet-&gt;start()-&gt;setOffset(containers[i]-&gt;start()-&gt;getOffset());</a>
<a name="ln7736">                              }</a>
<a name="ln7737">                        }</a>
<a name="ln7738">                  }</a>
<a name="ln7739">            }</a>
<a name="ln7740">      }</a>
<a name="ln7741"> </a>
<a name="ln7742">void OveOrganizer::organizeOctaveShift(</a>
<a name="ln7743">            OctaveShift* octave,</a>
<a name="ln7744">            Measure* measure,</a>
<a name="ln7745">            MeasureData* measureData) {</a>
<a name="ln7746">      // octave shift</a>
<a name="ln7747">      int i;</a>
<a name="ln7748">      const QList&lt;NoteContainer*&gt; containers = measureData-&gt;getNoteContainers();</a>
<a name="ln7749">      int barIndex = measure-&gt;getBarNumber()-&gt;getIndex();</a>
<a name="ln7750"> </a>
<a name="ln7751">      octave-&gt;start()-&gt;setMeasure(barIndex);</a>
<a name="ln7752"> </a>
<a name="ln7753">      for(i=0; i&lt;containers.size(); ++i) {</a>
<a name="ln7754">            int noteShift = octave-&gt;getNoteShift();</a>
<a name="ln7755">            int containerTick = containers[i]-&gt;getTick();</a>
<a name="ln7756"> </a>
<a name="ln7757">            if( octave-&gt;getTick() &lt;= containerTick &amp;&amp; octave-&gt;getEndTick() &gt; containerTick ) {</a>
<a name="ln7758">                  containers[i]-&gt;setNoteShift(noteShift);</a>
<a name="ln7759">                  }</a>
<a name="ln7760">            }</a>
<a name="ln7761">      }</a>
<a name="ln7762"> </a>
<a name="ln7763">bool getMiddleUnit(</a>
<a name="ln7764">            OveSong* ove, int /*part*/, int /*track*/,</a>
<a name="ln7765">            Measure* measure1, Measure* measure2, int unit1, int /*unit2*/,</a>
<a name="ln7766">            Measure* middleMeasure, int&amp; middleUnit) {</a>
<a name="ln7767">      Q_UNUSED(middleMeasure); // avoid (bogus?) warning to show up</a>
<a name="ln7768">      QList&lt;int&gt; barUnits;</a>
<a name="ln7769">      int i;</a>
<a name="ln7770">      int bar1Index = measure1-&gt;getBarNumber()-&gt;getIndex();</a>
<a name="ln7771">      int bar2Index = measure2-&gt;getBarNumber()-&gt;getIndex();</a>
<a name="ln7772">      int sumUnit = 0;</a>
<a name="ln7773"> </a>
<a name="ln7774">      for( int j=bar1Index; j&lt;=bar2Index; ++j ) {</a>
<a name="ln7775">            Measure* measure = ove-&gt;getMeasure(j);</a>
<a name="ln7776">            barUnits.push_back(measure-&gt;getTime()-&gt;getUnits());</a>
<a name="ln7777">            sumUnit += measure-&gt;getTime()-&gt;getUnits();</a>
<a name="ln7778">            }</a>
<a name="ln7779"> </a>
<a name="ln7780">      int currentSumUnit = 0;</a>
<a name="ln7781">      for( i=0; i&lt;barUnits.size(); ++i ) {</a>
<a name="ln7782">            int barUnit = barUnits[i];</a>
<a name="ln7783"> </a>
<a name="ln7784">            if( i==0 ) {</a>
<a name="ln7785">                  barUnit = barUnits[i] - unit1;</a>
<a name="ln7786">                  }</a>
<a name="ln7787"> </a>
<a name="ln7788">            if( currentSumUnit + barUnit &lt; sumUnit/2 ) {</a>
<a name="ln7789">                  currentSumUnit += barUnit;</a>
<a name="ln7790">                  }</a>
<a name="ln7791">            else {</a>
<a name="ln7792">                  break;</a>
<a name="ln7793">                  }</a>
<a name="ln7794">            }</a>
<a name="ln7795"> </a>
<a name="ln7796">      if( i &lt; barUnits.size() ) {</a>
<a name="ln7797">            int barMiddleIndex = bar1Index + i;</a>
<a name="ln7798">            middleMeasure = ove-&gt;getMeasure(barMiddleIndex);</a>
<a name="ln7799">            middleUnit = sumUnit/2 - currentSumUnit;</a>
<a name="ln7800"> </a>
<a name="ln7801">            return true;</a>
<a name="ln7802">            }</a>
<a name="ln7803"> </a>
<a name="ln7804">      return false;</a>
<a name="ln7805">      }</a>
<a name="ln7806"> </a>
<a name="ln7807">void OveOrganizer::organizeWedge(Wedge* wedge, int part, int track, Measure* measure, MeasureData* measureData) {</a>
<a name="ln7808">      int bar1Index = measure-&gt;getBarNumber()-&gt;getIndex();</a>
<a name="ln7809">      int bar2Index = bar1Index + wedge-&gt;stop()-&gt;getMeasure();</a>
<a name="ln7810">      MeasureData* measureData2 = ove_-&gt;getMeasureData(part, track, bar2Index);</a>
<a name="ln7811">      WedgeType wedgeType = wedge-&gt;getWedgeType();</a>
<a name="ln7812"> </a>
<a name="ln7813">      if( wedge-&gt;getWedgeType() == WedgeType::Double_Line ) {</a>
<a name="ln7814">            wedgeType = WedgeType::Cres_Line;</a>
<a name="ln7815">            }</a>
<a name="ln7816"> </a>
<a name="ln7817">      wedge-&gt;start()-&gt;setMeasure(bar1Index);</a>
<a name="ln7818"> </a>
<a name="ln7819">      WedgeEndPoint* startPoint = new WedgeEndPoint();</a>
<a name="ln7820">      measureData-&gt;addMusicData(startPoint);</a>
<a name="ln7821"> </a>
<a name="ln7822">      startPoint-&gt;setTick(wedge-&gt;getTick());</a>
<a name="ln7823">      startPoint-&gt;start()-&gt;setOffset(wedge-&gt;start()-&gt;getOffset());</a>
<a name="ln7824">      startPoint-&gt;setWedgeStart(true);</a>
<a name="ln7825">      startPoint-&gt;setWedgeType(wedgeType);</a>
<a name="ln7826">      startPoint-&gt;setHeight(wedge-&gt;getHeight());</a>
<a name="ln7827"> </a>
<a name="ln7828">      WedgeEndPoint* stopPoint = new WedgeEndPoint();</a>
<a name="ln7829"> </a>
<a name="ln7830">      stopPoint-&gt;setTick(wedge-&gt;getTick());</a>
<a name="ln7831">      stopPoint-&gt;start()-&gt;setOffset(wedge-&gt;stop()-&gt;getOffset());</a>
<a name="ln7832">      stopPoint-&gt;setWedgeStart(false);</a>
<a name="ln7833">      stopPoint-&gt;setWedgeType(wedgeType);</a>
<a name="ln7834">      stopPoint-&gt;setHeight(wedge-&gt;getHeight());</a>
<a name="ln7835"> </a>
<a name="ln7836">      if(measureData2 != 0) {</a>
<a name="ln7837">            measureData2-&gt;addMusicData(stopPoint);</a>
<a name="ln7838">            }</a>
<a name="ln7839"> </a>
<a name="ln7840">      if( wedge-&gt;getWedgeType() == WedgeType::Double_Line ) {</a>
<a name="ln7841">            Measure* middleMeasure = NULL;</a>
<a name="ln7842">            int middleUnit = 0;</a>
<a name="ln7843"> </a>
<a name="ln7844">            getMiddleUnit(</a>
<a name="ln7845">                              ove_, part, track,</a>
<a name="ln7846">                              measure, ove_-&gt;getMeasure(bar2Index),</a>
<a name="ln7847">                              wedge-&gt;start()-&gt;getOffset(), wedge-&gt;stop()-&gt;getOffset(),</a>
<a name="ln7848">                              middleMeasure, middleUnit);</a>
<a name="ln7849"> </a>
<a name="ln7850">            if( middleUnit != 0 ) {</a>
<a name="ln7851">                  WedgeEndPoint* midStopPoint = new WedgeEndPoint();</a>
<a name="ln7852">                  measureData-&gt;addMusicData(midStopPoint);</a>
<a name="ln7853"> </a>
<a name="ln7854">                  midStopPoint-&gt;setTick(wedge-&gt;getTick());</a>
<a name="ln7855">                  midStopPoint-&gt;start()-&gt;setOffset(middleUnit);</a>
<a name="ln7856">                  midStopPoint-&gt;setWedgeStart(false);</a>
<a name="ln7857">                  midStopPoint-&gt;setWedgeType(WedgeType::Cres_Line);</a>
<a name="ln7858">                  midStopPoint-&gt;setHeight(wedge-&gt;getHeight());</a>
<a name="ln7859"> </a>
<a name="ln7860">                  WedgeEndPoint* midStartPoint = new WedgeEndPoint();</a>
<a name="ln7861">                  measureData-&gt;addMusicData(midStartPoint);</a>
<a name="ln7862"> </a>
<a name="ln7863">                  midStartPoint-&gt;setTick(wedge-&gt;getTick());</a>
<a name="ln7864">                  midStartPoint-&gt;start()-&gt;setOffset(middleUnit);</a>
<a name="ln7865">                  midStartPoint-&gt;setWedgeStart(true);</a>
<a name="ln7866">                  midStartPoint-&gt;setWedgeType(WedgeType::Decresc_Line);</a>
<a name="ln7867">                  midStartPoint-&gt;setHeight(wedge-&gt;getHeight());</a>
<a name="ln7868">                  }</a>
<a name="ln7869">            }</a>
<a name="ln7870">      }</a>
<a name="ln7871"> </a>
<a name="ln7872"> </a>
<a name="ln7873">// OveSerialize.cpp</a>
<a name="ln7874">enum class ChunkType : char {</a>
<a name="ln7875">      OVSC = 00 ,</a>
<a name="ln7876">      TRKL,</a>
<a name="ln7877">      TRAK,</a>
<a name="ln7878">      PAGL,</a>
<a name="ln7879">      PAGE,</a>
<a name="ln7880">      LINL,</a>
<a name="ln7881">      LINE,</a>
<a name="ln7882">      STAF,</a>
<a name="ln7883">      BARL,</a>
<a name="ln7884">      MEAS,</a>
<a name="ln7885">      COND,</a>
<a name="ln7886">      BDAT,</a>
<a name="ln7887">      PACH,</a>
<a name="ln7888">      FNTS,</a>
<a name="ln7889">      ODEV,</a>
<a name="ln7890">      TITL,</a>
<a name="ln7891">      ALOT,</a>
<a name="ln7892">      ENGR,</a>
<a name="ln7893">      FMAP,</a>
<a name="ln7894">      PCPR,</a>
<a name="ln7895"> </a>
<a name="ln7896">      // Overture 3.6</a>
<a name="ln7897">      LYRC,</a>
<a name="ln7898"> </a>
<a name="ln7899">      NONE</a>
<a name="ln7900">      };</a>
<a name="ln7901"> </a>
<a name="ln7902">ChunkType nameToChunkType(const NameBlock&amp; name) {</a>
<a name="ln7903">      ChunkType type = ChunkType::NONE;</a>
<a name="ln7904"> </a>
<a name="ln7905">      if (name.isEqual(&quot;OVSC&quot;)) {</a>
<a name="ln7906">            type = ChunkType::OVSC;</a>
<a name="ln7907">            } else if (name.isEqual(&quot;TRKL&quot;)) {</a>
<a name="ln7908">            type = ChunkType::TRKL;</a>
<a name="ln7909">            } else if (name.isEqual(&quot;TRAK&quot;)) {</a>
<a name="ln7910">            type = ChunkType::TRAK;</a>
<a name="ln7911">            } else if (name.isEqual(&quot;PAGL&quot;)) {</a>
<a name="ln7912">            type = ChunkType::PAGL;</a>
<a name="ln7913">            } else if (name.isEqual(&quot;PAGE&quot;)) {</a>
<a name="ln7914">            type = ChunkType::PAGE;</a>
<a name="ln7915">            } else if (name.isEqual(&quot;LINL&quot;)) {</a>
<a name="ln7916">            type = ChunkType::LINL;</a>
<a name="ln7917">            } else if (name.isEqual(&quot;LINE&quot;)) {</a>
<a name="ln7918">            type = ChunkType::LINE;</a>
<a name="ln7919">            } else if (name.isEqual(&quot;STAF&quot;)) {</a>
<a name="ln7920">            type = ChunkType::STAF;</a>
<a name="ln7921">            } else if (name.isEqual(&quot;BARL&quot;)) {</a>
<a name="ln7922">            type = ChunkType::BARL;</a>
<a name="ln7923">            } else if (name.isEqual(&quot;MEAS&quot;)) {</a>
<a name="ln7924">            type = ChunkType::MEAS;</a>
<a name="ln7925">            } else if (name.isEqual(&quot;COND&quot;)) {</a>
<a name="ln7926">            type = ChunkType::COND;</a>
<a name="ln7927">            } else if (name.isEqual(&quot;BDAT&quot;)) {</a>
<a name="ln7928">            type = ChunkType::BDAT;</a>
<a name="ln7929">            } else if (name.isEqual(&quot;PACH&quot;)) {</a>
<a name="ln7930">            type = ChunkType::PACH;</a>
<a name="ln7931">            } else if (name.isEqual(&quot;FNTS&quot;)) {</a>
<a name="ln7932">            type = ChunkType::FNTS;</a>
<a name="ln7933">            } else if (name.isEqual(&quot;ODEV&quot;)) {</a>
<a name="ln7934">            type = ChunkType::ODEV;</a>
<a name="ln7935">            } else if (name.isEqual(&quot;TITL&quot;)) {</a>
<a name="ln7936">            type = ChunkType::TITL;</a>
<a name="ln7937">            } else if (name.isEqual(&quot;ALOT&quot;)) {</a>
<a name="ln7938">            type = ChunkType::ALOT;</a>
<a name="ln7939">            } else if (name.isEqual(&quot;ENGR&quot;)) {</a>
<a name="ln7940">            type = ChunkType::ENGR;</a>
<a name="ln7941">            } else if (name.isEqual(&quot;FMAP&quot;)) {</a>
<a name="ln7942">            type = ChunkType::FMAP;</a>
<a name="ln7943">            } else if (name.isEqual(&quot;PCPR&quot;)) {</a>
<a name="ln7944">            type = ChunkType::PCPR;</a>
<a name="ln7945">            } else if (name.isEqual(&quot;LYRC&quot;)) {</a>
<a name="ln7946">            type = ChunkType::LYRC;</a>
<a name="ln7947">            }</a>
<a name="ln7948"> </a>
<a name="ln7949">      return type;</a>
<a name="ln7950">      }</a>
<a name="ln7951"> </a>
<a name="ln7952">int chunkTypeToMaxTimes(ChunkType type) {</a>
<a name="ln7953">      int maxTimes = -1; // no limit</a>
<a name="ln7954"> </a>
<a name="ln7955">      switch (type) {</a>
<a name="ln7956">            case ChunkType::OVSC: {</a>
<a name="ln7957">                  maxTimes = 1;</a>
<a name="ln7958">                  break;</a>
<a name="ln7959">                  }</a>
<a name="ln7960">            case ChunkType::TRKL: {// case ChunkType::TRAK :</a>
<a name="ln7961">                  maxTimes = 1;</a>
<a name="ln7962">                  break;</a>
<a name="ln7963">                  }</a>
<a name="ln7964">            case ChunkType::PAGL: {// case ChunkType::PAGE :</a>
<a name="ln7965">                  maxTimes = 1;</a>
<a name="ln7966">                  break;</a>
<a name="ln7967">                  }</a>
<a name="ln7968">                  // case ChunkType::LINE :</a>
<a name="ln7969">                  // case ChunkType::STAF :</a>
<a name="ln7970">            case ChunkType::LINL: {</a>
<a name="ln7971">                  maxTimes = 1;</a>
<a name="ln7972">                  break;</a>
<a name="ln7973">                  }</a>
<a name="ln7974">                  // case ChunkType::MEAS :</a>
<a name="ln7975">                  // case ChunkType::COND :</a>
<a name="ln7976">                  // case ChunkType::BDAT :</a>
<a name="ln7977">            case ChunkType::BARL: {</a>
<a name="ln7978">                  maxTimes = 1;</a>
<a name="ln7979">                  break;</a>
<a name="ln7980">                  }</a>
<a name="ln7981">            case ChunkType::PACH:</a>
<a name="ln7982">            case ChunkType::FNTS:</a>
<a name="ln7983">            case ChunkType::ODEV:</a>
<a name="ln7984">            case ChunkType::ALOT:</a>
<a name="ln7985">            case ChunkType::ENGR:</a>
<a name="ln7986">            case ChunkType::FMAP:</a>
<a name="ln7987">            case ChunkType::PCPR: {</a>
<a name="ln7988">                  maxTimes = 1;</a>
<a name="ln7989">                  break;</a>
<a name="ln7990">                  }</a>
<a name="ln7991">            case ChunkType::TITL: {</a>
<a name="ln7992">                  maxTimes = 8;</a>
<a name="ln7993">                  break;</a>
<a name="ln7994">                  }</a>
<a name="ln7995">            case ChunkType::LYRC: {</a>
<a name="ln7996">                  maxTimes = 1;</a>
<a name="ln7997">                  break;</a>
<a name="ln7998">                  }</a>
<a name="ln7999">                  // case ChunkType::NONE :</a>
<a name="ln8000">            default:</a>
<a name="ln8001">                  break;</a>
<a name="ln8002">            }</a>
<a name="ln8003"> </a>
<a name="ln8004">      return maxTimes;</a>
<a name="ln8005">      }</a>
<a name="ln8006"> </a>
<a name="ln8007">///////////////////////////////////////////////////////////////////////////////////////////</a>
<a name="ln8008"> </a>
<a name="ln8009">OveSerialize::OveSerialize() :</a>
<a name="ln8010">      ove_(0),</a>
<a name="ln8011">      streamHandle_(0),</a>
<a name="ln8012">      notify_(0) {</a>
<a name="ln8013">      }</a>
<a name="ln8014"> </a>
<a name="ln8015">OveSerialize::~OveSerialize() {</a>
<a name="ln8016">      if(streamHandle_ != 0) {</a>
<a name="ln8017">            delete streamHandle_;</a>
<a name="ln8018">            streamHandle_ = 0;</a>
<a name="ln8019">            }</a>
<a name="ln8020">      }</a>
<a name="ln8021"> </a>
<a name="ln8022">void OveSerialize::setOve(OveSong* ove) {</a>
<a name="ln8023">      ove_ = ove;</a>
<a name="ln8024">      }</a>
<a name="ln8025"> </a>
<a name="ln8026">void OveSerialize::setFileStream(unsigned char* buffer, unsigned int size) {</a>
<a name="ln8027">      streamHandle_ = new StreamHandle(buffer, size);</a>
<a name="ln8028">      }</a>
<a name="ln8029"> </a>
<a name="ln8030">void OveSerialize::setNotify(IOveNotify* notify) {</a>
<a name="ln8031">      notify_ = notify;</a>
<a name="ln8032">      }</a>
<a name="ln8033"> </a>
<a name="ln8034">void OveSerialize::messageOutError() {</a>
<a name="ln8035">      if (notify_ != NULL) {</a>
<a name="ln8036">            notify_-&gt;loadError();</a>
<a name="ln8037">            }</a>
<a name="ln8038">      }</a>
<a name="ln8039"> </a>
<a name="ln8040">void OveSerialize::messageOut(const QString&amp; str) {</a>
<a name="ln8041">      if (notify_ != NULL) {</a>
<a name="ln8042">            notify_-&gt;loadInfo(str);</a>
<a name="ln8043">            }</a>
<a name="ln8044">      }</a>
<a name="ln8045"> </a>
<a name="ln8046">bool OveSerialize::load(void) {</a>
<a name="ln8047">      if(streamHandle_ == 0)</a>
<a name="ln8048">            return false;</a>
<a name="ln8049"> </a>
<a name="ln8050">      if( !readHeader() ) {</a>
<a name="ln8051">            messageOutError();</a>
<a name="ln8052">            return false;</a>
<a name="ln8053">            }</a>
<a name="ln8054"> </a>
<a name="ln8055">      unsigned int i;</a>
<a name="ln8056">      QMap&lt;ChunkType, int&gt; chunkTimes;</a>
<a name="ln8057">      //bool firstEnter = true;</a>
<a name="ln8058"> </a>
<a name="ln8059">      for( i=(int)ChunkType::OVSC; i&lt;(int)ChunkType::NONE; ++i ) {</a>
<a name="ln8060">            chunkTimes[(ChunkType)i] = 0;</a>
<a name="ln8061">            }</a>
<a name="ln8062"> </a>
<a name="ln8063">      ChunkType chunkType = ChunkType::NONE;</a>
<a name="ln8064"> </a>
<a name="ln8065">      do {</a>
<a name="ln8066">            NameBlock nameBlock;</a>
<a name="ln8067">            SizeChunk sizeChunk;</a>
<a name="ln8068"> </a>
<a name="ln8069">            if( !readNameBlock(nameBlock) ) { return false; }</a>
<a name="ln8070"> </a>
<a name="ln8071">            chunkType = nameToChunkType(nameBlock);</a>
<a name="ln8072">            ++chunkTimes[chunkType];</a>
<a name="ln8073">            int maxTime = chunkTypeToMaxTimes(chunkType);</a>
<a name="ln8074"> </a>
<a name="ln8075">            if( maxTime &gt; 0 &amp;&amp; chunkTimes[chunkType] &gt; maxTime ) {</a>
<a name="ln8076">                  messageOut(&quot;format not support, chunk appear more than accept.\n&quot;);</a>
<a name="ln8077">                  return false;</a>
<a name="ln8078">                  }</a>
<a name="ln8079"> </a>
<a name="ln8080">            switch (chunkType) {</a>
<a name="ln8081">                  /*case ChunkType::OVSC :</a>
<a name="ln8082">       {</a>
<a name="ln8083">       if( !readHeadData(&amp;sizeChunk) )</a>
<a name="ln8084">       {</a>
<a name="ln8085">       messageOut_error();</a>
<a name="ln8086">       return false;</a>
<a name="ln8087">       }</a>
<a name="ln8088"> </a>
<a name="ln8089">       break;</a>
<a name="ln8090">       }*/</a>
<a name="ln8091">                  case ChunkType::TRKL: {</a>
<a name="ln8092">                        if (!readTracksData()) {</a>
<a name="ln8093">                              messageOutError();</a>
<a name="ln8094">                              return false;</a>
<a name="ln8095">                              }</a>
<a name="ln8096"> </a>
<a name="ln8097">                        break;</a>
<a name="ln8098">                        }</a>
<a name="ln8099">                  case ChunkType::PAGL: {</a>
<a name="ln8100">                        if (!readPagesData()) {</a>
<a name="ln8101">                              messageOutError();</a>
<a name="ln8102">                              return false;</a>
<a name="ln8103">                              }</a>
<a name="ln8104"> </a>
<a name="ln8105">                        break;</a>
<a name="ln8106">                        }</a>
<a name="ln8107">                  case ChunkType::LINL: {</a>
<a name="ln8108">                        if (!readLinesData()) {</a>
<a name="ln8109">                              messageOutError();</a>
<a name="ln8110">                              return false;</a>
<a name="ln8111">                              }</a>
<a name="ln8112"> </a>
<a name="ln8113">                        break;</a>
<a name="ln8114">                        }</a>
<a name="ln8115">                  case ChunkType::BARL: {</a>
<a name="ln8116">                        if (!readBarsData()) {</a>
<a name="ln8117">                              messageOutError();</a>
<a name="ln8118">                              return false;</a>
<a name="ln8119">                              }</a>
<a name="ln8120"> </a>
<a name="ln8121">                        break;</a>
<a name="ln8122">                        }</a>
<a name="ln8123">                  case ChunkType::TRAK:</a>
<a name="ln8124">                  case ChunkType::PAGE:</a>
<a name="ln8125">                  case ChunkType::LINE:</a>
<a name="ln8126">                  case ChunkType::STAF:</a>
<a name="ln8127">                  case ChunkType::MEAS:</a>
<a name="ln8128">                  case ChunkType::COND:</a>
<a name="ln8129">                  case ChunkType::BDAT: {</a>
<a name="ln8130">                        return false;</a>
<a name="ln8131">                        break;</a>
<a name="ln8132">                        }</a>
<a name="ln8133">                  case ChunkType::LYRC: {</a>
<a name="ln8134">                        SizeChunk lyricChunk;</a>
<a name="ln8135">                        if (!readSizeChunk(&amp;lyricChunk)) {</a>
<a name="ln8136">                              messageOutError();</a>
<a name="ln8137">                              return false;</a>
<a name="ln8138">                              }</a>
<a name="ln8139"> </a>
<a name="ln8140">                        LyricChunkParse parse(ove_);</a>
<a name="ln8141"> </a>
<a name="ln8142">                        parse.setLyricChunk(&amp;lyricChunk);</a>
<a name="ln8143">                        parse.parse();</a>
<a name="ln8144"> </a>
<a name="ln8145">                        break;</a>
<a name="ln8146">                        }</a>
<a name="ln8147">                  case ChunkType::TITL: {</a>
<a name="ln8148">                        SizeChunk titleChunk;</a>
<a name="ln8149">                        if (!readSizeChunk(&amp;titleChunk)) {</a>
<a name="ln8150">                              messageOutError();</a>
<a name="ln8151">                              return false;</a>
<a name="ln8152">                              }</a>
<a name="ln8153"> </a>
<a name="ln8154">                        TitleChunkParse titleChunkParse(ove_);</a>
<a name="ln8155"> </a>
<a name="ln8156">                        titleChunkParse.setTitleChunk(&amp;titleChunk);</a>
<a name="ln8157">                        titleChunkParse.parse();</a>
<a name="ln8158"> </a>
<a name="ln8159">                        break;</a>
<a name="ln8160">                        }</a>
<a name="ln8161">                  case ChunkType::PACH:</a>
<a name="ln8162">                  case ChunkType::FNTS:</a>
<a name="ln8163">                  case ChunkType::ODEV:</a>
<a name="ln8164">                  case ChunkType::ALOT:</a>
<a name="ln8165">                  case ChunkType::ENGR:</a>
<a name="ln8166">                  case ChunkType::FMAP:</a>
<a name="ln8167">                  case ChunkType::PCPR: {</a>
<a name="ln8168">                        if (!readSizeChunk(&amp;sizeChunk)) {</a>
<a name="ln8169">                              messageOutError();</a>
<a name="ln8170">                              return false;</a>
<a name="ln8171">                              }</a>
<a name="ln8172"> </a>
<a name="ln8173">                        break;</a>
<a name="ln8174">                        }</a>
<a name="ln8175">                  default:</a>
<a name="ln8176">                        /*if( firstEnter )</a>
<a name="ln8177">          {</a>
<a name="ln8178">          QString info = &quot;Not compatible file, try to load and save with newer version, Overture 4 is recommended.\n&quot;;</a>
<a name="ln8179">          messageOut(info);</a>
<a name="ln8180">          messageOutError();</a>
<a name="ln8181"> </a>
<a name="ln8182">          return false;</a>
<a name="ln8183">          }*/</a>
<a name="ln8184"> </a>
<a name="ln8185">                        break;</a>
<a name="ln8186">                  }</a>
<a name="ln8187"> </a>
<a name="ln8188">            //firstEnter = false;</a>
<a name="ln8189">            }</a>
<a name="ln8190">      while ( chunkType != ChunkType::NONE );</a>
<a name="ln8191"> </a>
<a name="ln8192">      // if( !readOveEnd() ) { return false; }</a>
<a name="ln8193"> </a>
<a name="ln8194">      // organize OveData</a>
<a name="ln8195">      OVE::OveOrganizer organizer(ove_);</a>
<a name="ln8196">      organizer.organize();</a>
<a name="ln8197"> </a>
<a name="ln8198">      return true;</a>
<a name="ln8199">      }</a>
<a name="ln8200"> </a>
<a name="ln8201">void OveSerialize::release() {</a>
<a name="ln8202">      delete this;</a>
<a name="ln8203">      }</a>
<a name="ln8204"> </a>
<a name="ln8205">bool OveSerialize::readHeader() {</a>
<a name="ln8206">      ChunkType chunkType = ChunkType::NONE;</a>
<a name="ln8207">      NameBlock nameBlock;</a>
<a name="ln8208">      SizeChunk sizeChunk;</a>
<a name="ln8209"> </a>
<a name="ln8210">      if (!readNameBlock(nameBlock)) {</a>
<a name="ln8211">            return false;</a>
<a name="ln8212">            }</a>
<a name="ln8213"> </a>
<a name="ln8214">      chunkType = nameToChunkType(nameBlock);</a>
<a name="ln8215">      //int maxTime = chunkTypeToMaxTimes(chunkType);</a>
<a name="ln8216"> </a>
<a name="ln8217">      if (chunkType == ChunkType::OVSC) {</a>
<a name="ln8218">            if (readHeadData(&amp;sizeChunk)) {</a>
<a name="ln8219">                  return true;</a>
<a name="ln8220">                  }</a>
<a name="ln8221">            }</a>
<a name="ln8222"> </a>
<a name="ln8223">      QString info = &quot;Not compatible file, try to load and save with newer version, Overture 4 is recommended.\n&quot;;</a>
<a name="ln8224">      messageOut(info);</a>
<a name="ln8225"> </a>
<a name="ln8226">      return false;</a>
<a name="ln8227">      }</a>
<a name="ln8228"> </a>
<a name="ln8229">bool OveSerialize::readHeadData(SizeChunk* ovscChunk) {</a>
<a name="ln8230">      if (!readSizeChunk(ovscChunk))</a>
<a name="ln8231">            return false;</a>
<a name="ln8232"> </a>
<a name="ln8233">      OvscParse ovscParse(ove_);</a>
<a name="ln8234"> </a>
<a name="ln8235">      ovscParse.setNotify(notify_);</a>
<a name="ln8236">      ovscParse.setOvsc(ovscChunk);</a>
<a name="ln8237"> </a>
<a name="ln8238">      return ovscParse.parse();</a>
<a name="ln8239">      }</a>
<a name="ln8240"> </a>
<a name="ln8241">bool OveSerialize::readTracksData() {</a>
<a name="ln8242">      GroupChunk trackGroupChunk;</a>
<a name="ln8243"> </a>
<a name="ln8244">      if (!readGroupChunk(&amp;trackGroupChunk))</a>
<a name="ln8245">            return false;</a>
<a name="ln8246"> </a>
<a name="ln8247">      unsigned int i;</a>
<a name="ln8248">      unsigned short trackCount = trackGroupChunk.getCountBlock()-&gt;toCount();</a>
<a name="ln8249"> </a>
<a name="ln8250">      for (i = 0; i &lt; trackCount; ++i) {</a>
<a name="ln8251">            SizeChunk* trackChunk = new SizeChunk();</a>
<a name="ln8252"> </a>
<a name="ln8253">            if (ove_-&gt;getIsVersion4()) {</a>
<a name="ln8254">                  if (!readChunkName(trackChunk, Chunk::TrackName)) {</a>
<a name="ln8255">                        return false;</a>
<a name="ln8256">                        }</a>
<a name="ln8257">                  if (!readSizeChunk(trackChunk)) {</a>
<a name="ln8258">                        return false;</a>
<a name="ln8259">                        }</a>
<a name="ln8260">                  } else {</a>
<a name="ln8261">                  if (!readDataChunk(trackChunk-&gt;getDataBlock(),</a>
<a name="ln8262">                                     SizeChunk::version3TrackSize)) {</a>
<a name="ln8263">                        return false;</a>
<a name="ln8264">                        }</a>
<a name="ln8265">                  }</a>
<a name="ln8266"> </a>
<a name="ln8267">            TrackParse trackParse(ove_);</a>
<a name="ln8268"> </a>
<a name="ln8269">            trackParse.setTrack(trackChunk);</a>
<a name="ln8270">            trackParse.parse();</a>
<a name="ln8271">            }</a>
<a name="ln8272"> </a>
<a name="ln8273">      return true;</a>
<a name="ln8274">      }</a>
<a name="ln8275"> </a>
<a name="ln8276">bool OveSerialize::readPagesData() {</a>
<a name="ln8277">      GroupChunk pageGroupChunk;</a>
<a name="ln8278"> </a>
<a name="ln8279">      if (!readGroupChunk(&amp;pageGroupChunk))</a>
<a name="ln8280">            return false;</a>
<a name="ln8281"> </a>
<a name="ln8282">      unsigned short pageCount = pageGroupChunk.getCountBlock()-&gt;toCount();</a>
<a name="ln8283">      unsigned int i;</a>
<a name="ln8284">      PageGroupParse parse(ove_);</a>
<a name="ln8285"> </a>
<a name="ln8286">      for (i = 0; i &lt; pageCount; ++i) {</a>
<a name="ln8287">            SizeChunk* pageChunk = new SizeChunk();</a>
<a name="ln8288"> </a>
<a name="ln8289">            if (!readChunkName(pageChunk, Chunk::PageName)) {</a>
<a name="ln8290">                  return false;</a>
<a name="ln8291">                  }</a>
<a name="ln8292">            if (!readSizeChunk(pageChunk)) {</a>
<a name="ln8293">                  return false;</a>
<a name="ln8294">                  }</a>
<a name="ln8295"> </a>
<a name="ln8296">            parse.addPage(pageChunk);</a>
<a name="ln8297">            }</a>
<a name="ln8298"> </a>
<a name="ln8299">      if (!parse.parse()) {</a>
<a name="ln8300">            return false;</a>
<a name="ln8301">            }</a>
<a name="ln8302"> </a>
<a name="ln8303">      return true;</a>
<a name="ln8304">      }</a>
<a name="ln8305"> </a>
<a name="ln8306">bool OveSerialize::readLinesData() {</a>
<a name="ln8307">      GroupChunk lineGroupChunk;</a>
<a name="ln8308">      if (!readGroupChunk(&amp;lineGroupChunk))</a>
<a name="ln8309">            return false;</a>
<a name="ln8310"> </a>
<a name="ln8311">      unsigned short lineCount = lineGroupChunk.getCountBlock()-&gt;toCount();</a>
<a name="ln8312">      int i;</a>
<a name="ln8313">      unsigned int j;</a>
<a name="ln8314">      QList&lt;SizeChunk*&gt; lineChunks;</a>
<a name="ln8315">      QList&lt;SizeChunk*&gt; staffChunks;</a>
<a name="ln8316"> </a>
<a name="ln8317">      for (i = 0; i &lt; lineCount; ++i) {</a>
<a name="ln8318">            SizeChunk* lineChunk = new SizeChunk();</a>
<a name="ln8319"> </a>
<a name="ln8320">            if (!readChunkName(lineChunk, Chunk::LineName)) {</a>
<a name="ln8321">                  return false;</a>
<a name="ln8322">                  }</a>
<a name="ln8323">            if (!readSizeChunk(lineChunk)) {</a>
<a name="ln8324">                  return false;</a>
<a name="ln8325">                  }</a>
<a name="ln8326"> </a>
<a name="ln8327">            lineChunks.push_back(lineChunk);</a>
<a name="ln8328"> </a>
<a name="ln8329">            StaffCountGetter getter(ove_);</a>
<a name="ln8330">            unsigned int staffCount = getter.getStaffCount(lineChunk);</a>
<a name="ln8331"> </a>
<a name="ln8332">            for (j = 0; j &lt; staffCount; ++j) {</a>
<a name="ln8333">                  SizeChunk* staffChunk = new SizeChunk();</a>
<a name="ln8334"> </a>
<a name="ln8335">                  if (!readChunkName(staffChunk, Chunk::StaffName)) {</a>
<a name="ln8336">                        return false;</a>
<a name="ln8337">                        }</a>
<a name="ln8338">                  if (!readSizeChunk(staffChunk)) {</a>
<a name="ln8339">                        return false;</a>
<a name="ln8340">                        }</a>
<a name="ln8341"> </a>
<a name="ln8342">                  staffChunks.push_back(staffChunk);</a>
<a name="ln8343">                  }</a>
<a name="ln8344">            }</a>
<a name="ln8345"> </a>
<a name="ln8346">      LineGroupParse parse(ove_);</a>
<a name="ln8347"> </a>
<a name="ln8348">      parse.setLineGroup(&amp;lineGroupChunk);</a>
<a name="ln8349"> </a>
<a name="ln8350">      for (i = 0; i &lt; lineChunks.size(); ++i) {</a>
<a name="ln8351">            parse.addLine(lineChunks[i]);</a>
<a name="ln8352">            }</a>
<a name="ln8353"> </a>
<a name="ln8354">      for (i = 0; i &lt; staffChunks.size(); ++i) {</a>
<a name="ln8355">            parse.addStaff(staffChunks[i]);</a>
<a name="ln8356">            }</a>
<a name="ln8357"> </a>
<a name="ln8358">      if (!parse.parse()) {</a>
<a name="ln8359">            return false;</a>
<a name="ln8360">            }</a>
<a name="ln8361"> </a>
<a name="ln8362">      return true;</a>
<a name="ln8363">      }</a>
<a name="ln8364"> </a>
<a name="ln8365">bool OveSerialize::readBarsData() {</a>
<a name="ln8366">      GroupChunk barGroupChunk;</a>
<a name="ln8367">      if (!readGroupChunk(&amp;barGroupChunk))</a>
<a name="ln8368">            return false;</a>
<a name="ln8369"> </a>
<a name="ln8370">      unsigned short measCount = barGroupChunk.getCountBlock()-&gt;toCount();</a>
<a name="ln8371">      int i;</a>
<a name="ln8372"> </a>
<a name="ln8373">      QList&lt;SizeChunk*&gt; measureChunks;</a>
<a name="ln8374">      QList&lt;SizeChunk*&gt; conductChunks;</a>
<a name="ln8375">      QList&lt;SizeChunk*&gt; bdatChunks;</a>
<a name="ln8376"> </a>
<a name="ln8377">      ove_-&gt;setTrackBarCount(measCount);</a>
<a name="ln8378"> </a>
<a name="ln8379">      // read chunks</a>
<a name="ln8380">      for (i = 0; i &lt; measCount; ++i) {</a>
<a name="ln8381">            SizeChunk* measureChunkPtr = new SizeChunk();</a>
<a name="ln8382"> </a>
<a name="ln8383">            if (!readChunkName(measureChunkPtr, Chunk::MeasureName)) {</a>
<a name="ln8384">                  return false;</a>
<a name="ln8385">                  }</a>
<a name="ln8386">            if (!readSizeChunk(measureChunkPtr)) {</a>
<a name="ln8387">                  return false;</a>
<a name="ln8388">                  }</a>
<a name="ln8389"> </a>
<a name="ln8390">            measureChunks.push_back(measureChunkPtr);</a>
<a name="ln8391">            }</a>
<a name="ln8392"> </a>
<a name="ln8393">      for (i = 0; i &lt; measCount; ++i) {</a>
<a name="ln8394">            SizeChunk* conductChunkPtr = new SizeChunk();</a>
<a name="ln8395"> </a>
<a name="ln8396">            if (!readChunkName(conductChunkPtr, Chunk::ConductName))</a>
<a name="ln8397">                  return false;</a>
<a name="ln8398"> </a>
<a name="ln8399">            if (!readSizeChunk(conductChunkPtr))</a>
<a name="ln8400">                  return false;</a>
<a name="ln8401"> </a>
<a name="ln8402">            conductChunks.push_back(conductChunkPtr);</a>
<a name="ln8403">            }</a>
<a name="ln8404"> </a>
<a name="ln8405">      int bdatCount = ove_-&gt;getTrackCount() * measCount;</a>
<a name="ln8406">      for (i = 0; i &lt; bdatCount; ++i) {</a>
<a name="ln8407">            SizeChunk* batChunkPtr = new SizeChunk();</a>
<a name="ln8408"> </a>
<a name="ln8409">            if (!readChunkName(batChunkPtr, Chunk::BdatName)) {</a>
<a name="ln8410">                  return false;</a>
<a name="ln8411">                  }</a>
<a name="ln8412">            if (!readSizeChunk(batChunkPtr)) {</a>
<a name="ln8413">                  return false;</a>
<a name="ln8414">                  }</a>
<a name="ln8415"> </a>
<a name="ln8416">            bdatChunks.push_back(batChunkPtr);</a>
<a name="ln8417">            }</a>
<a name="ln8418"> </a>
<a name="ln8419">      // parse bars</a>
<a name="ln8420">      BarsParse barsParse(ove_);</a>
<a name="ln8421"> </a>
<a name="ln8422">      for (i = 0; i &lt; measureChunks.size(); ++i) {</a>
<a name="ln8423">            barsParse.addMeasure(measureChunks[i]);</a>
<a name="ln8424">            }</a>
<a name="ln8425"> </a>
<a name="ln8426">      for (i = 0; i &lt; conductChunks.size(); ++i) {</a>
<a name="ln8427">            barsParse.addConduct(conductChunks[i]);</a>
<a name="ln8428">            }</a>
<a name="ln8429"> </a>
<a name="ln8430">      for (i = 0; i &lt; bdatChunks.size(); ++i) {</a>
<a name="ln8431">            barsParse.addBdat(bdatChunks[i]);</a>
<a name="ln8432">            }</a>
<a name="ln8433"> </a>
<a name="ln8434">      barsParse.setNotify(notify_);</a>
<a name="ln8435">      if (!barsParse.parse()) {</a>
<a name="ln8436">            return false;</a>
<a name="ln8437">            }</a>
<a name="ln8438"> </a>
<a name="ln8439">      return true;</a>
<a name="ln8440">      }</a>
<a name="ln8441"> </a>
<a name="ln8442">bool OveSerialize::readOveEnd() {</a>
<a name="ln8443">      if (streamHandle_ == 0)</a>
<a name="ln8444">            return false;</a>
<a name="ln8445"> </a>
<a name="ln8446">      const unsigned int END_OVE1 = 0xffffffff;</a>
<a name="ln8447">      const unsigned int END_OVE2 = 0x00000000;</a>
<a name="ln8448">      unsigned int buffer;</a>
<a name="ln8449"> </a>
<a name="ln8450">      if (!streamHandle_-&gt;read((char*) &amp;buffer, sizeof(unsigned int)))</a>
<a name="ln8451">            return false;</a>
<a name="ln8452"> </a>
<a name="ln8453">      if (buffer != END_OVE1)</a>
<a name="ln8454">            return false;</a>
<a name="ln8455"> </a>
<a name="ln8456">      if (!streamHandle_-&gt;read((char*) &amp;buffer, sizeof(unsigned int)))</a>
<a name="ln8457">            return false;</a>
<a name="ln8458"> </a>
<a name="ln8459">      if (buffer != END_OVE2)</a>
<a name="ln8460">            return false;</a>
<a name="ln8461"> </a>
<a name="ln8462">      return true;</a>
<a name="ln8463">      }</a>
<a name="ln8464"> </a>
<a name="ln8465">/////////////////////////////////////////////////////////////////////////////////////////</a>
<a name="ln8466">bool OveSerialize::readNameBlock(NameBlock&amp; nameBlock) {</a>
<a name="ln8467">      if (streamHandle_ == 0)</a>
<a name="ln8468">            return false;</a>
<a name="ln8469"> </a>
<a name="ln8470">      if (!streamHandle_-&gt;read((char*) nameBlock.data(), nameBlock.size()))</a>
<a name="ln8471">            return false;</a>
<a name="ln8472"> </a>
<a name="ln8473">      return true;</a>
<a name="ln8474">      }</a>
<a name="ln8475"> </a>
<a name="ln8476">bool OveSerialize::readChunkName(Chunk* /*chunk*/, const QString&amp; name) {</a>
<a name="ln8477">      if (streamHandle_ == 0)</a>
<a name="ln8478">            return false;</a>
<a name="ln8479"> </a>
<a name="ln8480">      NameBlock nameBlock;</a>
<a name="ln8481"> </a>
<a name="ln8482">      if (!streamHandle_-&gt;read((char*) nameBlock.data(), nameBlock.size()))</a>
<a name="ln8483">            return false;</a>
<a name="ln8484"> </a>
<a name="ln8485">      if (!(nameBlock.toStrByteArray() == name))</a>
<a name="ln8486">            return false;</a>
<a name="ln8487"> </a>
<a name="ln8488">      return true;</a>
<a name="ln8489">      }</a>
<a name="ln8490"> </a>
<a name="ln8491">bool OveSerialize::readSizeChunk(SizeChunk* sizeChunk) {</a>
<a name="ln8492">      if (streamHandle_ == 0)</a>
<a name="ln8493">            return false;</a>
<a name="ln8494"> </a>
<a name="ln8495">      SizeBlock* sizeBlock = sizeChunk-&gt;getSizeBlock();</a>
<a name="ln8496"> </a>
<a name="ln8497">      if (!streamHandle_-&gt;read((char*) sizeBlock-&gt;data(), sizeBlock-&gt;size()))</a>
<a name="ln8498">            return false;</a>
<a name="ln8499"> </a>
<a name="ln8500">      unsigned int blockSize = sizeBlock-&gt;toSize();</a>
<a name="ln8501"> </a>
<a name="ln8502">      sizeChunk-&gt;getDataBlock()-&gt;resize(blockSize);</a>
<a name="ln8503"> </a>
<a name="ln8504">      Block* dataBlock = sizeChunk-&gt;getDataBlock();</a>
<a name="ln8505"> </a>
<a name="ln8506">      if (!streamHandle_-&gt;read((char*) dataBlock-&gt;data(), blockSize))</a>
<a name="ln8507">            return false;</a>
<a name="ln8508"> </a>
<a name="ln8509">      return true;</a>
<a name="ln8510">      }</a>
<a name="ln8511"> </a>
<a name="ln8512">bool OveSerialize::readDataChunk(Block* block, unsigned int size) {</a>
<a name="ln8513">      if (streamHandle_ == 0)</a>
<a name="ln8514">            return false;</a>
<a name="ln8515"> </a>
<a name="ln8516">      block-&gt;resize(size);</a>
<a name="ln8517"> </a>
<a name="ln8518">      if (!streamHandle_-&gt;read((char*) block-&gt;data(), size))</a>
<a name="ln8519">            return false;</a>
<a name="ln8520"> </a>
<a name="ln8521">      return true;</a>
<a name="ln8522">      }</a>
<a name="ln8523"> </a>
<a name="ln8524">bool OveSerialize::readGroupChunk(GroupChunk* groupChunk) {</a>
<a name="ln8525">      if (streamHandle_ == 0)</a>
<a name="ln8526">            return false;</a>
<a name="ln8527"> </a>
<a name="ln8528">      CountBlock* countBlock = groupChunk-&gt;getCountBlock();</a>
<a name="ln8529"> </a>
<a name="ln8530">      if (!streamHandle_-&gt;read((char*) countBlock-&gt;data(), countBlock-&gt;size()))</a>
<a name="ln8531">            return false;</a>
<a name="ln8532"> </a>
<a name="ln8533">      return true;</a>
<a name="ln8534">      }</a>
<a name="ln8535"> </a>
<a name="ln8536">IOVEStreamLoader* createOveStreamLoader() {</a>
<a name="ln8537">      return new OveSerialize;</a>
<a name="ln8538">      }</a>
<a name="ln8539"> </a>
<a name="ln8540">}</a>

</code></pre>
<div class="balloon" rel="3777"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v506/" target="_blank">V506</a> Pointer to local variable 'handle' is stored outside the scope of this variable. Such a pointer will become invalid.</p></div>
<div class="balloon" rel="3965"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v773/" target="_blank">V773</a> The function was exited without releasing the 'voicePtr' pointer. A memory leak is possible.</p></div>
<div class="balloon" rel="3847"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v506/" target="_blank">V506</a> Pointer to local variable 'handle' is stored outside the scope of this variable. Such a pointer will become invalid.</p></div>
<div class="balloon" rel="4165"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v506/" target="_blank">V506</a> Pointer to local variable 'handle' is stored outside the scope of this variable. Such a pointer will become invalid.</p></div>
<div class="balloon" rel="5115"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1037/" target="_blank">V1037</a> Two or more case-branches perform the same actions. Check lines: 5115, 5149</p></div>
<div class="balloon" rel="5511"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v773/" target="_blank">V773</a> The function was exited without releasing the 'tuplet' pointer. A memory leak is possible.</p></div>
<div class="balloon" rel="6315"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v773/" target="_blank">V773</a> The function was exited without releasing the 'musicData' pointer. A memory leak is possible.</p></div>
<div class="balloon" rel="6368"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v773/" target="_blank">V773</a> The function was exited without releasing the 'wedge' pointer. A memory leak is possible.</p></div>
<div class="balloon" rel="7232"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v547/" target="_blank">V547</a> Expression 'info.lyricSize_ > 0' is always true.</p></div>
<div class="balloon" rel="7232"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v571/" target="_blank">V571</a> Recurring check. The 'if (info.lyricSize_ > 0)' condition was already verified in line 7230.</p></div>
<div class="balloon" rel="7181"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v506/" target="_blank">V506</a> Pointer to local variable 'handle' is stored outside the scope of this variable. Such a pointer will become invalid.</p></div>
<div class="balloon" rel="7350"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v506/" target="_blank">V506</a> Pointer to local variable 'handle' is stored outside the scope of this variable. Such a pointer will become invalid.</p></div>
<div class="balloon" rel="3830"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v730/" target="_blank">V730</a> Not all members of a class are initialized inside the constructor. Consider inspecting: chunk_.</p></div>
<div class="balloon" rel="7165"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v730/" target="_blank">V730</a> Not all members of a class are initialized inside the constructor. Consider inspecting: chunk_.</p></div>
<div class="balloon" rel="7321"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v730/" target="_blank">V730</a> Not all members of a class are initialized inside the constructor. Consider inspecting: chunk_.</p></div>
<div class="balloon" rel="8"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
