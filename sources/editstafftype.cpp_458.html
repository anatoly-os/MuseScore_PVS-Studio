
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>editstafftype.cpp</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">//=============================================================================</a>
<a name="ln2">//  MuseScore</a>
<a name="ln3">//  Music Composition &amp; Notation</a>
<a name="ln4">//</a>
<a name="ln5">//  Copyright (C) 2010-2014 Werner Schweer and others</a>
<a name="ln6">//</a>
<a name="ln7">//  This program is free software; you can redistribute it and/or modify</a>
<a name="ln8">//  it under the terms of the GNU General Public License version 2</a>
<a name="ln9">//  as published by the Free Software Foundation and appearing in</a>
<a name="ln10">//  the file LICENCE.GPL</a>
<a name="ln11">//=============================================================================</a>
<a name="ln12"> </a>
<a name="ln13">#include &quot;editstafftype.h&quot;</a>
<a name="ln14">#include &quot;libmscore/part.h&quot;</a>
<a name="ln15">#include &quot;libmscore/mscore.h&quot;</a>
<a name="ln16">#include &quot;libmscore/score.h&quot;</a>
<a name="ln17">#include &quot;libmscore/staff.h&quot;</a>
<a name="ln18">#include &quot;libmscore/stringdata.h&quot;</a>
<a name="ln19">#include &quot;musescore.h&quot;</a>
<a name="ln20">#include &quot;navigator.h&quot;</a>
<a name="ln21">#include &quot;scoreview.h&quot;</a>
<a name="ln22"> </a>
<a name="ln23">namespace Ms {</a>
<a name="ln24"> </a>
<a name="ln25">extern Score::FileError readScore(MasterScore* score, QString name, bool ignoreVersionError);</a>
<a name="ln26"> </a>
<a name="ln27">const char* g_groupNames[STAFF_GROUP_MAX] = {</a>
<a name="ln28">      QT_TRANSLATE_NOOP(&quot;staff group header name&quot;, &quot;STANDARD STAFF&quot;),</a>
<a name="ln29">      QT_TRANSLATE_NOOP(&quot;staff group header name&quot;, &quot;PERCUSSION STAFF&quot;),</a>
<a name="ln30">      QT_TRANSLATE_NOOP(&quot;staff group header name&quot;, &quot;TABLATURE STAFF&quot;)</a>
<a name="ln31">      };</a>
<a name="ln32"> </a>
<a name="ln33">//---------------------------------------------------------</a>
<a name="ln34">//   noteHeadSchemes</a>
<a name="ln35">//---------------------------------------------------------</a>
<a name="ln36"> </a>
<a name="ln37">NoteHeadScheme noteHeadSchemes[] = {</a>
<a name="ln38">      NoteHeadScheme::HEAD_NORMAL,</a>
<a name="ln39">      NoteHeadScheme::HEAD_PITCHNAME,</a>
<a name="ln40">      NoteHeadScheme::HEAD_PITCHNAME_GERMAN,</a>
<a name="ln41">      NoteHeadScheme::HEAD_SOLFEGE,</a>
<a name="ln42">      NoteHeadScheme::HEAD_SOLFEGE_FIXED,</a>
<a name="ln43">      NoteHeadScheme::HEAD_SHAPE_NOTE_4,</a>
<a name="ln44">      NoteHeadScheme::HEAD_SHAPE_NOTE_7_AIKIN,</a>
<a name="ln45">      NoteHeadScheme::HEAD_SHAPE_NOTE_7_FUNK,</a>
<a name="ln46">      NoteHeadScheme::HEAD_SHAPE_NOTE_7_WALKER</a>
<a name="ln47">      };</a>
<a name="ln48"> </a>
<a name="ln49">//---------------------------------------------------------</a>
<a name="ln50">//   EditStaffType</a>
<a name="ln51">//---------------------------------------------------------</a>
<a name="ln52"> </a>
<a name="ln53">EditStaffType::EditStaffType(QWidget* parent, Staff* st)</a>
<a name="ln54">   : QDialog(parent)</a>
<a name="ln55">      {</a>
<a name="ln56">      setObjectName(&quot;EditStaffType&quot;);</a>
<a name="ln57">      setWindowFlags(this-&gt;windowFlags() &amp; ~Qt::WindowContextHelpButtonHint);</a>
<a name="ln58">      setupUi(this);</a>
<a name="ln59"> </a>
<a name="ln60">      staff     = st;</a>
<a name="ln61">      staffType = *staff-&gt;staffType(Fraction(0,1));</a>
<a name="ln62">      Instrument* instr = staff-&gt;part()-&gt;instrument();</a>
<a name="ln63"> </a>
<a name="ln64">      // template combo</a>
<a name="ln65"> </a>
<a name="ln66">      templateCombo-&gt;clear();</a>
<a name="ln67">      // standard group also as fall-back (but excluded by percussion)</a>
<a name="ln68">      bool bStandard    = !(instr != nullptr &amp;&amp; instr-&gt;drumset() != nullptr);</a>
<a name="ln69">      bool bPerc        = (instr != nullptr &amp;&amp; instr-&gt;drumset() != nullptr);</a>
<a name="ln70">      bool bTab         = (instr != nullptr &amp;&amp; instr-&gt;stringData() != nullptr &amp;&amp; instr-&gt;stringData()-&gt;frettedStrings() &gt; 0);</a>
<a name="ln71">      int idx           = 0;</a>
<a name="ln72">      for (const StaffType&amp; t : StaffType::presets()) {</a>
<a name="ln73">            if ( (t.group() == StaffGroup::STANDARD &amp;&amp; bStandard)</a>
<a name="ln74">                        || (t.group() == StaffGroup::PERCUSSION &amp;&amp; bPerc)</a>
<a name="ln75">                        || (t.group() == StaffGroup::TAB &amp;&amp; bTab &amp;&amp; t.lines() &lt;= instr-&gt;stringData()-&gt;frettedStrings()))</a>
<a name="ln76">                  templateCombo-&gt;addItem(t.name(), idx);</a>
<a name="ln77">            idx++;</a>
<a name="ln78">            }</a>
<a name="ln79">      templateCombo-&gt;setCurrentIndex(-1);</a>
<a name="ln80"> </a>
<a name="ln81">      // tab page configuration</a>
<a name="ln82">      QList&lt;QString&gt; fontNames = StaffType::fontNames(false);</a>
<a name="ln83">      foreach (const QString&amp; fn, fontNames)   // fill fret font name combo</a>
<a name="ln84">            fretFontName-&gt;addItem(fn);</a>
<a name="ln85">      fretFontName-&gt;setCurrentIndex(0);</a>
<a name="ln86">      fontNames = StaffType::fontNames(true);</a>
<a name="ln87">      foreach(const QString&amp; fn, fontNames)   // fill duration font name combo</a>
<a name="ln88">            durFontName-&gt;addItem(fn);</a>
<a name="ln89">      durFontName-&gt;setCurrentIndex(0);</a>
<a name="ln90"> </a>
<a name="ln91">      for (auto i : noteHeadSchemes)</a>
<a name="ln92">            noteHeadScheme-&gt;addItem(StaffType::scheme2userName(i), StaffType::scheme2name(i));</a>
<a name="ln93"> </a>
<a name="ln94">      // load a sample standard score in preview</a>
<a name="ln95">      MasterScore* sc = new MasterScore(MScore::defaultStyle());</a>
<a name="ln96">      if (readScore(sc, QString(&quot;:/data/std_sample.mscx&quot;), false) == Score::FileError::FILE_NO_ERROR)</a>
<a name="ln97">            standardPreview-&gt;setScore(sc);</a>
<a name="ln98">      else {</a>
<a name="ln99">            Q_ASSERT_X(false, &quot;EditStaffType::EditStaffType&quot;, &quot;Error in opening sample standard file for preview&quot;);</a>
<a name="ln100">            }</a>
<a name="ln101"> </a>
<a name="ln102">      // load a sample tabulature score in preview</a>
<a name="ln103">      sc = new MasterScore(MScore::defaultStyle());</a>
<a name="ln104">      if (readScore(sc, QString(&quot;:/data/tab_sample.mscx&quot;), false) == Score::FileError::FILE_NO_ERROR)</a>
<a name="ln105">            tabPreview-&gt;setScore(sc);</a>
<a name="ln106">      else {</a>
<a name="ln107">            Q_ASSERT_X(false, &quot;EditStaffType::EditStaffType&quot;, &quot;Error in opening sample tab file for preview&quot;);</a>
<a name="ln108">            }</a>
<a name="ln109">      tabPreview-&gt;adjustSize();</a>
<a name="ln110"> </a>
<a name="ln111">      setValues();</a>
<a name="ln112"> </a>
<a name="ln113">      connect(name,           SIGNAL(textEdited(const QString&amp;)), SLOT(nameEdited(const QString&amp;)));</a>
<a name="ln114">      connect(lines,          SIGNAL(valueChanged(int)),          SLOT(updatePreview()));</a>
<a name="ln115">      connect(lineDistance,   SIGNAL(valueChanged(double)),       SLOT(updatePreview()));</a>
<a name="ln116">      connect(showBarlines,   SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln117">      connect(genClef,        SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln118">      connect(genTimesig,     SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln119">      connect(noteHeadScheme, SIGNAL(currentIndexChanged(int)),   SLOT(updatePreview()));</a>
<a name="ln120"> </a>
<a name="ln121">      connect(genKeysigPitched,           SIGNAL(toggled(bool)),  SLOT(updatePreview()));</a>
<a name="ln122">      connect(showLedgerLinesPitched,     SIGNAL(toggled(bool)),  SLOT(updatePreview()));</a>
<a name="ln123">      connect(stemlessPitched,            SIGNAL(toggled(bool)),  SLOT(updatePreview()));</a>
<a name="ln124">      connect(genKeysigPercussion,        SIGNAL(toggled(bool)),  SLOT(updatePreview()));</a>
<a name="ln125">      connect(showLedgerLinesPercussion,  SIGNAL(toggled(bool)),  SLOT(updatePreview()));</a>
<a name="ln126">      connect(stemlessPercussion,         SIGNAL(toggled(bool)),  SLOT(updatePreview()));</a>
<a name="ln127"> </a>
<a name="ln128">      connect(noteValuesSymb,       SIGNAL(toggled(bool)),              SLOT(tabStemsToggled(bool)));</a>
<a name="ln129">      connect(noteValuesStems,      SIGNAL(toggled(bool)),              SLOT(tabStemsToggled(bool)));</a>
<a name="ln130">      connect(valuesRepeatNever,    SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln131">      connect(valuesRepeatSystem,   SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln132">      connect(valuesRepeatMeasure,  SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln133">      connect(valuesRepeatAlways,   SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln134">      connect(stemBesideRadio,      SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln135">      connect(stemThroughRadio,     SIGNAL(toggled(bool)),              SLOT(tabStemThroughToggled(bool)));</a>
<a name="ln136">      connect(stemAboveRadio,       SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln137">      connect(stemBelowRadio,       SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln138">      connect(minimShortRadio,      SIGNAL(toggled(bool)),              SLOT(tabMinimShortToggled(bool)));</a>
<a name="ln139">      connect(minimSlashedRadio,    SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln140">      connect(showRests,            SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln141">      connect(durFontName,          SIGNAL(currentIndexChanged(int)),   SLOT(durFontNameChanged(int)));</a>
<a name="ln142">      connect(durFontSize,          SIGNAL(valueChanged(double)),       SLOT(updatePreview()));</a>
<a name="ln143">      connect(durY,                 SIGNAL(valueChanged(double)),       SLOT(updatePreview()));</a>
<a name="ln144">      connect(fretFontName,         SIGNAL(currentIndexChanged(int)),   SLOT(fretFontNameChanged(int)));</a>
<a name="ln145">      connect(fretFontSize,         SIGNAL(valueChanged(double)),       SLOT(updatePreview()));</a>
<a name="ln146">      connect(fretY,                SIGNAL(valueChanged(double)),       SLOT(updatePreview()));</a>
<a name="ln147"> </a>
<a name="ln148">      connect(linesThroughRadio,    SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln149">      connect(onLinesRadio,         SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln150">      connect(showTabFingering,     SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln151">      connect(upsideDown,           SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln152">      connect(numbersRadio,         SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln153">      connect(showBackTied,         SIGNAL(toggled(bool)),              SLOT(updatePreview()));</a>
<a name="ln154"> </a>
<a name="ln155">      connect(templateReset,        SIGNAL(clicked()),                  SLOT(resetToTemplateClicked()));</a>
<a name="ln156">      connect(addToTemplates,       SIGNAL(clicked()),                  SLOT(addToTemplatesClicked()));</a>
<a name="ln157">//      connect(groupCombo,           SIGNAL(currentIndexChanged(int)),   SLOT(staffGroupChanged(int)));</a>
<a name="ln158">      addToTemplates-&gt;setVisible(false);</a>
<a name="ln159"> </a>
<a name="ln160">      MuseScore::restoreGeometry(this);</a>
<a name="ln161">      }</a>
<a name="ln162"> </a>
<a name="ln163">//---------------------------------------------------------</a>
<a name="ln164">//   hideEvent</a>
<a name="ln165">//---------------------------------------------------------</a>
<a name="ln166"> </a>
<a name="ln167">void EditStaffType::hideEvent(QHideEvent* ev)</a>
<a name="ln168">      {</a>
<a name="ln169">      MuseScore::saveGeometry(this);</a>
<a name="ln170">      QWidget::hideEvent(ev);</a>
<a name="ln171">      }</a>
<a name="ln172"> </a>
<a name="ln173">//---------------------------------------------------------</a>
<a name="ln174">//   staffGroupChanged</a>
<a name="ln175">//---------------------------------------------------------</a>
<a name="ln176">/*</a>
<a name="ln177">void EditStaffType::staffGroupChanged(int n)</a>
<a name="ln178">      {</a>
<a name="ln179">      int groupIdx = groupCombo-&gt;itemData(groupCombo-&gt;currentIndex()).toInt();</a>
<a name="ln180">      StaffGroup group = StaffGroup(groupIdx);</a>
<a name="ln181">      staffType = *StaffType::getDefaultPreset(group); // overwrite with default</a>
<a name="ln182">      setValues();</a>
<a name="ln183">      }</a>
<a name="ln184">*/</a>
<a name="ln185">//---------------------------------------------------------</a>
<a name="ln186">//   setValues</a>
<a name="ln187">//---------------------------------------------------------</a>
<a name="ln188"> </a>
<a name="ln189">void EditStaffType::setValues()</a>
<a name="ln190">      {</a>
<a name="ln191">      blockSignals(true);</a>
<a name="ln192"> </a>
<a name="ln193">      StaffGroup group = staffType.group();</a>
<a name="ln194">      int i = int(group);</a>
<a name="ln195">      stack-&gt;setCurrentIndex(i);</a>
<a name="ln196">      groupName-&gt;setText(qApp-&gt;translate(&quot;staff group header name&quot;, g_groupNames[i]));</a>
<a name="ln197">//      groupCombo-&gt;setCurrentIndex(i);</a>
<a name="ln198"> </a>
<a name="ln199">      name-&gt;setText(staffType.name());</a>
<a name="ln200">      lines-&gt;setValue(staffType.lines());</a>
<a name="ln201">      lineDistance-&gt;setValue(staffType.lineDistance().val());</a>
<a name="ln202">      genClef-&gt;setChecked(staffType.genClef());</a>
<a name="ln203">      showBarlines-&gt;setChecked(staffType.showBarlines());</a>
<a name="ln204">      genTimesig-&gt;setChecked(staffType.genTimesig());</a>
<a name="ln205"> </a>
<a name="ln206">      switch (group) {</a>
<a name="ln207">            case StaffGroup::STANDARD:</a>
<a name="ln208">                  genKeysigPitched-&gt;setChecked(staffType.genKeysig());</a>
<a name="ln209">                  showLedgerLinesPitched-&gt;setChecked(staffType.showLedgerLines());</a>
<a name="ln210">                  stemlessPitched-&gt;setChecked(staffType.stemless());</a>
<a name="ln211">                  noteHeadScheme-&gt;setCurrentIndex(int(staffType.noteHeadScheme()));</a>
<a name="ln212">                  break;</a>
<a name="ln213"> </a>
<a name="ln214">            case StaffGroup::TAB:</a>
<a name="ln215">                  {</a>
<a name="ln216">                  upsideDown-&gt;setChecked(staffType.upsideDown());</a>
<a name="ln217">                  showTabFingering-&gt;setChecked(staffType.showTabFingering());</a>
<a name="ln218">                  int idx = fretFontName-&gt;findText(staffType.fretFontName(), Qt::MatchFixedString);</a>
<a name="ln219">                  if (idx == -1)</a>
<a name="ln220">                        idx = 0;          // if name not found, use first name</a>
<a name="ln221">                  fretFontName-&gt;setCurrentIndex(idx);</a>
<a name="ln222">                  fretFontSize-&gt;setValue(staffType.fretFontSize());</a>
<a name="ln223">                  fretY-&gt;setValue(staffType.fretFontUserY());</a>
<a name="ln224"> </a>
<a name="ln225">                  numbersRadio-&gt;setChecked(staffType.useNumbers());</a>
<a name="ln226">                  lettersRadio-&gt;setChecked(!staffType.useNumbers());</a>
<a name="ln227">                  onLinesRadio-&gt;setChecked(staffType.onLines());</a>
<a name="ln228">                  aboveLinesRadio-&gt;setChecked(!staffType.onLines());</a>
<a name="ln229">                  linesThroughRadio-&gt;setChecked(staffType.linesThrough());</a>
<a name="ln230">                  linesBrokenRadio-&gt;setChecked(!staffType.linesThrough());</a>
<a name="ln231">                  showBackTied-&gt;setChecked(staffType.showBackTied());</a>
<a name="ln232"> </a>
<a name="ln233">                  idx = durFontName-&gt;findText(staffType.durationFontName(), Qt::MatchFixedString);</a>
<a name="ln234">                  if (idx == -1)</a>
<a name="ln235">                        idx = 0;          // if name not found, use first name</a>
<a name="ln236">                  durFontName-&gt;setCurrentIndex(idx);</a>
<a name="ln237">                  durFontSize-&gt;setValue(staffType.durationFontSize());</a>
<a name="ln238">                  durY-&gt;setValue(staffType.durationFontUserY());</a>
<a name="ln239">                  // convert combined values of genDurations and slashStyle/stemless into noteValuesx radio buttons</a>
<a name="ln240">                  // Sbove/Below, Beside/Through and minim are only used if stems-and-beams</a>
<a name="ln241">                  // but set them from stt values anyway, to ensure preset matching</a>
<a name="ln242">                  stemAboveRadio-&gt;setChecked(!staffType.stemsDown());</a>
<a name="ln243">                  stemBelowRadio-&gt;setChecked(staffType.stemsDown());</a>
<a name="ln244">                  stemBesideRadio-&gt;setChecked(!staffType.stemThrough());</a>
<a name="ln245">                  stemThroughRadio-&gt;setChecked(staffType.stemThrough());</a>
<a name="ln246">                  TablatureMinimStyle minimStyle = staffType.minimStyle();</a>
<a name="ln247">                  minimNoneRadio-&gt;setChecked(minimStyle == TablatureMinimStyle::NONE);</a>
<a name="ln248">                  minimShortRadio-&gt;setChecked(minimStyle == TablatureMinimStyle::SHORTER);</a>
<a name="ln249">                  minimSlashedRadio-&gt;setChecked(minimStyle == TablatureMinimStyle::SLASHED);</a>
<a name="ln250">                  TablatureSymbolRepeat symRepeat = staffType.symRepeat();</a>
<a name="ln251">                  valuesRepeatNever-&gt;setChecked(symRepeat == TablatureSymbolRepeat::NEVER);</a>
<a name="ln252">                  valuesRepeatSystem-&gt;setChecked(symRepeat == TablatureSymbolRepeat::SYSTEM);</a>
<a name="ln253">                  valuesRepeatMeasure-&gt;setChecked(symRepeat == TablatureSymbolRepeat::MEASURE);</a>
<a name="ln254">                  valuesRepeatAlways-&gt;setChecked(symRepeat == TablatureSymbolRepeat::ALWAYS);</a>
<a name="ln255">                  if (staffType.genDurations()) {</a>
<a name="ln256">                        noteValuesNone-&gt;setChecked(false);</a>
<a name="ln257">                        noteValuesSymb-&gt;setChecked(true);</a>
<a name="ln258">                        noteValuesStems-&gt;setChecked(false);</a>
<a name="ln259">                        }</a>
<a name="ln260">                  else {</a>
<a name="ln261">                        if (staffType.stemless()) {</a>
<a name="ln262">                              noteValuesNone-&gt;setChecked(true);</a>
<a name="ln263">                              noteValuesSymb-&gt;setChecked(false);</a>
<a name="ln264">                              noteValuesStems-&gt;setChecked(false);</a>
<a name="ln265">                              }</a>
<a name="ln266">                        else {</a>
<a name="ln267">                              noteValuesNone-&gt;setChecked(false);</a>
<a name="ln268">                              noteValuesSymb-&gt;setChecked(false);</a>
<a name="ln269">                              noteValuesStems-&gt;setChecked(true);</a>
<a name="ln270">                              }</a>
<a name="ln271">                        }</a>
<a name="ln272">                  showRests-&gt;setChecked(staffType.showRests());</a>
<a name="ln273">                  // adjust compatibility across different settings</a>
<a name="ln274">                  tabStemThroughCompatibility(stemThroughRadio-&gt;isChecked());</a>
<a name="ln275">                  tabMinimShortCompatibility(minimShortRadio-&gt;isChecked());</a>
<a name="ln276">                  tabStemsCompatibility(noteValuesStems-&gt;isChecked());</a>
<a name="ln277">                  }</a>
<a name="ln278">                  break;</a>
<a name="ln279"> </a>
<a name="ln280">            case StaffGroup::PERCUSSION:</a>
<a name="ln281">                  genKeysigPercussion-&gt;setChecked(staffType.genKeysig());</a>
<a name="ln282">                  showLedgerLinesPercussion-&gt;setChecked(staffType.showLedgerLines());</a>
<a name="ln283">                  stemlessPercussion-&gt;setChecked(staffType.stemless());</a>
<a name="ln284">                  break;</a>
<a name="ln285">            }</a>
<a name="ln286">      updatePreview();</a>
<a name="ln287">      blockSignals(false);</a>
<a name="ln288">      }</a>
<a name="ln289"> </a>
<a name="ln290">//---------------------------------------------------------</a>
<a name="ln291">//   nameEdited</a>
<a name="ln292">//---------------------------------------------------------</a>
<a name="ln293"> </a>
<a name="ln294">void EditStaffType::nameEdited(const QString&amp; /*s*/)</a>
<a name="ln295">      {</a>
<a name="ln296">//      staffTypeList-&gt;currentItem()-&gt;setText(s);</a>
<a name="ln297">      }</a>
<a name="ln298"> </a>
<a name="ln299">//=========================================================</a>
<a name="ln300">//   PERCUSSION PAGE METHODS</a>
<a name="ln301">//=========================================================</a>
<a name="ln302"> </a>
<a name="ln303"> </a>
<a name="ln304">//=========================================================</a>
<a name="ln305">//   TABULATURE PAGE METHODS</a>
<a name="ln306">//=========================================================</a>
<a name="ln307"> </a>
<a name="ln308">//---------------------------------------------------------</a>
<a name="ln309">//   Tabulature duration / fret font name changed</a>
<a name="ln310">//</a>
<a name="ln311">//    set depending parameters</a>
<a name="ln312">//---------------------------------------------------------</a>
<a name="ln313"> </a>
<a name="ln314">void EditStaffType::durFontNameChanged(int idx)</a>
<a name="ln315">      {</a>
<a name="ln316">      qreal size, yOff;</a>
<a name="ln317">      if (StaffType::fontData(true, idx, 0, 0, &amp;size, &amp;yOff)) {</a>
<a name="ln318">            durFontSize-&gt;setValue(size);</a>
<a name="ln319">            durY-&gt;setValue(yOff);</a>
<a name="ln320">            }</a>
<a name="ln321">      updatePreview();</a>
<a name="ln322">      }</a>
<a name="ln323"> </a>
<a name="ln324">void EditStaffType::fretFontNameChanged(int idx)</a>
<a name="ln325">      {</a>
<a name="ln326">      qreal size, yOff;</a>
<a name="ln327">      if (StaffType::fontData(false, idx, 0, 0, &amp;size, &amp;yOff)) {</a>
<a name="ln328">            fretFontSize-&gt;setValue(size);</a>
<a name="ln329">            fretY-&gt;setValue(yOff);</a>
<a name="ln330">            }</a>
<a name="ln331">      updatePreview();</a>
<a name="ln332">      }</a>
<a name="ln333"> </a>
<a name="ln334">//---------------------------------------------------------</a>
<a name="ln335">//   Tabulature note stems toggled</a>
<a name="ln336">//</a>
<a name="ln337">//    enable / disable all controls related to stems</a>
<a name="ln338">//---------------------------------------------------------</a>
<a name="ln339"> </a>
<a name="ln340">void EditStaffType::tabStemsToggled(bool checked)</a>
<a name="ln341">      {</a>
<a name="ln342">      tabStemsCompatibility(checked);</a>
<a name="ln343">      updatePreview();</a>
<a name="ln344">      }</a>
<a name="ln345"> </a>
<a name="ln346">//---------------------------------------------------------</a>
<a name="ln347">//   Tabulature &quot;minim short&quot; toggled</a>
<a name="ln348">//</a>
<a name="ln349">//    contra-toggle &quot;stems through&quot;</a>
<a name="ln350">//---------------------------------------------------------</a>
<a name="ln351"> </a>
<a name="ln352">void EditStaffType::tabMinimShortToggled(bool checked)</a>
<a name="ln353">      {</a>
<a name="ln354">      tabMinimShortCompatibility(checked);</a>
<a name="ln355">      updatePreview();</a>
<a name="ln356">      }</a>
<a name="ln357"> </a>
<a name="ln358">//---------------------------------------------------------</a>
<a name="ln359">//   Tabulature &quot;stems through&quot; toggled</a>
<a name="ln360">//---------------------------------------------------------</a>
<a name="ln361"> </a>
<a name="ln362">void EditStaffType::tabStemThroughToggled(bool checked)</a>
<a name="ln363">      {</a>
<a name="ln364">      tabStemThroughCompatibility(checked);</a>
<a name="ln365">      updatePreview();</a>
<a name="ln366">      }</a>
<a name="ln367"> </a>
<a name="ln368">//---------------------------------------------------------</a>
<a name="ln369">//   setFromDlg</a>
<a name="ln370">//</a>
<a name="ln371">//    initializes a StaffType from dlg controls</a>
<a name="ln372">//---------------------------------------------------------</a>
<a name="ln373"> </a>
<a name="ln374">void EditStaffType::setFromDlg()</a>
<a name="ln375">      {</a>
<a name="ln376">      staffType.setName(name-&gt;text());</a>
<a name="ln377">      staffType.setLines(lines-&gt;value());</a>
<a name="ln378">      staffType.setLineDistance(Spatium(lineDistance-&gt;value()));</a>
<a name="ln379">      staffType.setGenClef(genClef-&gt;isChecked());</a>
<a name="ln380">      staffType.setShowBarlines(showBarlines-&gt;isChecked());</a>
<a name="ln381">      staffType.setGenTimesig(genTimesig-&gt;isChecked());</a>
<a name="ln382">      if (staffType.group() == StaffGroup::STANDARD) {</a>
<a name="ln383">            staffType.setGenKeysig(genKeysigPitched-&gt;isChecked());</a>
<a name="ln384">            staffType.setShowLedgerLines(showLedgerLinesPitched-&gt;isChecked());</a>
<a name="ln385">            staffType.setStemless(stemlessPitched-&gt;isChecked());</a>
<a name="ln386">            staffType.setNoteHeadScheme(StaffType::name2scheme(noteHeadScheme-&gt;currentData().toString()));</a>
<a name="ln387">            }</a>
<a name="ln388">      if (staffType.group() == StaffGroup::PERCUSSION) {</a>
<a name="ln389">            staffType.setGenKeysig(genKeysigPercussion-&gt;isChecked());</a>
<a name="ln390">            staffType.setShowLedgerLines(showLedgerLinesPercussion-&gt;isChecked());</a>
<a name="ln391">            staffType.setStemless(stemlessPercussion-&gt;isChecked());</a>
<a name="ln392">            }</a>
<a name="ln393">      staffType.setDurationFontName(durFontName-&gt;currentText());</a>
<a name="ln394">      staffType.setDurationFontSize(durFontSize-&gt;value());</a>
<a name="ln395">      staffType.setDurationFontUserY(durY-&gt;value());</a>
<a name="ln396">      staffType.setFretFontName(fretFontName-&gt;currentText());</a>
<a name="ln397">      staffType.setFretFontSize(fretFontSize-&gt;value());</a>
<a name="ln398">      staffType.setFretFontUserY(fretY-&gt;value());</a>
<a name="ln399">      staffType.setLinesThrough(linesThroughRadio-&gt;isChecked());</a>
<a name="ln400">      staffType.setShowBackTied(showBackTied-&gt;isChecked());</a>
<a name="ln401">      staffType.setMinimStyle(minimNoneRadio-&gt;isChecked() ? TablatureMinimStyle::NONE :</a>
<a name="ln402">            (minimShortRadio-&gt;isChecked() ? TablatureMinimStyle::SHORTER : TablatureMinimStyle::SLASHED));</a>
<a name="ln403">      staffType.setSymbolRepeat(valuesRepeatNever-&gt;isChecked() ? TablatureSymbolRepeat::NEVER :</a>
<a name="ln404">            (valuesRepeatSystem-&gt;isChecked() ? TablatureSymbolRepeat::SYSTEM :</a>
<a name="ln405">                  valuesRepeatMeasure-&gt;isChecked() ? TablatureSymbolRepeat::MEASURE : TablatureSymbolRepeat::ALWAYS));</a>
<a name="ln406">      staffType.setOnLines(onLinesRadio-&gt;isChecked());</a>
<a name="ln407">      staffType.setShowRests(showRests-&gt;isChecked());</a>
<a name="ln408">      staffType.setUpsideDown(upsideDown-&gt;isChecked());</a>
<a name="ln409">      staffType.setShowTabFingering(showTabFingering-&gt;isChecked());</a>
<a name="ln410">      staffType.setUseNumbers(numbersRadio-&gt;isChecked());</a>
<a name="ln411">      //note values</a>
<a name="ln412">      staffType.setStemsDown(stemBelowRadio-&gt;isChecked());</a>
<a name="ln413">      staffType.setStemsThrough(stemThroughRadio-&gt;isChecked());</a>
<a name="ln414">      if (staffType.group() == StaffGroup::TAB) {</a>
<a name="ln415">            staffType.setGenKeysig(false);</a>
<a name="ln416">            staffType.setStemless(true);                   // assume no note values</a>
<a name="ln417">            staffType.setGenDurations(false);              //    &quot;     &quot;</a>
<a name="ln418">            if (noteValuesSymb-&gt;isChecked())</a>
<a name="ln419">                  staffType.setGenDurations(true);</a>
<a name="ln420">            if (noteValuesStems-&gt;isChecked())</a>
<a name="ln421">                  staffType.setStemless(false);</a>
<a name="ln422">            }</a>
<a name="ln423">      }</a>
<a name="ln424"> </a>
<a name="ln425">//---------------------------------------------------------</a>
<a name="ln426">//   Block preview signals</a>
<a name="ln427">//---------------------------------------------------------</a>
<a name="ln428"> </a>
<a name="ln429">void EditStaffType::blockSignals(bool block)</a>
<a name="ln430">      {</a>
<a name="ln431">      stack-&gt;blockSignals(block);</a>
<a name="ln432">//      groupCombo-&gt;blockSignals(block);</a>
<a name="ln433">      lines-&gt;blockSignals(block);</a>
<a name="ln434">      lineDistance-&gt;blockSignals(block);</a>
<a name="ln435">      showBarlines-&gt;blockSignals(block);</a>
<a name="ln436">      genClef-&gt;blockSignals(block);</a>
<a name="ln437">      genTimesig-&gt;blockSignals(block);</a>
<a name="ln438">      noteValuesSymb-&gt;blockSignals(block);</a>
<a name="ln439">      noteValuesStems-&gt;blockSignals(block);</a>
<a name="ln440">      durFontName-&gt;blockSignals(block);</a>
<a name="ln441">      durFontSize-&gt;blockSignals(block);</a>
<a name="ln442">      durY-&gt;blockSignals(block);</a>
<a name="ln443">      fretFontName-&gt;blockSignals(block);</a>
<a name="ln444">      fretFontSize-&gt;blockSignals(block);</a>
<a name="ln445">      fretY-&gt;blockSignals(block);</a>
<a name="ln446"> </a>
<a name="ln447">      numbersRadio-&gt;blockSignals(block);</a>
<a name="ln448">      linesThroughRadio-&gt;blockSignals(block);</a>
<a name="ln449">      onLinesRadio-&gt;blockSignals(block);</a>
<a name="ln450">      showBackTied-&gt;blockSignals(block);</a>
<a name="ln451"> </a>
<a name="ln452">      upsideDown-&gt;blockSignals(block);</a>
<a name="ln453">      showTabFingering-&gt;blockSignals(block);</a>
<a name="ln454">      valuesRepeatNever-&gt;blockSignals(block);</a>
<a name="ln455">      valuesRepeatSystem-&gt;blockSignals(block);</a>
<a name="ln456">      valuesRepeatMeasure-&gt;blockSignals(block);</a>
<a name="ln457">      valuesRepeatAlways-&gt;blockSignals(block);</a>
<a name="ln458">      stemAboveRadio-&gt;blockSignals(block);</a>
<a name="ln459">      stemBelowRadio-&gt;blockSignals(block);</a>
<a name="ln460">      stemBesideRadio-&gt;blockSignals(block);</a>
<a name="ln461">      stemThroughRadio-&gt;blockSignals(block);</a>
<a name="ln462">      minimShortRadio-&gt;blockSignals(block);</a>
<a name="ln463">      minimSlashedRadio-&gt;blockSignals(block);</a>
<a name="ln464">      showRests-&gt;blockSignals(block);</a>
<a name="ln465"> </a>
<a name="ln466">      showLedgerLinesPercussion-&gt;blockSignals(block);</a>
<a name="ln467">      genKeysigPercussion-&gt;blockSignals(block);</a>
<a name="ln468">      stemlessPercussion-&gt;blockSignals(block);</a>
<a name="ln469">      }</a>
<a name="ln470"> </a>
<a name="ln471">//---------------------------------------------------------</a>
<a name="ln472">//   Tabulature note stems compatibility</a>
<a name="ln473">//</a>
<a name="ln474">//    Enable / disable all stem-related controls according to &quot;Stems and beams&quot; is checked/unchecked</a>
<a name="ln475">//---------------------------------------------------------</a>
<a name="ln476"> </a>
<a name="ln477">void EditStaffType::tabStemsCompatibility(bool checked)</a>
<a name="ln478">      {</a>
<a name="ln479">      valuesRepeatNever-&gt;setEnabled(noteValuesSymb-&gt;isChecked());</a>
<a name="ln480">      valuesRepeatSystem-&gt;setEnabled(noteValuesSymb-&gt;isChecked());</a>
<a name="ln481">      valuesRepeatMeasure-&gt;setEnabled(noteValuesSymb-&gt;isChecked());</a>
<a name="ln482">      valuesRepeatAlways-&gt;setEnabled(noteValuesSymb-&gt;isChecked());</a>
<a name="ln483">      stemAboveRadio-&gt;setEnabled(checked &amp;&amp; !stemThroughRadio-&gt;isChecked());</a>
<a name="ln484">      stemBelowRadio-&gt;setEnabled(checked &amp;&amp; !stemThroughRadio-&gt;isChecked());</a>
<a name="ln485">      stemBesideRadio-&gt;setEnabled(checked);</a>
<a name="ln486">      stemThroughRadio-&gt;setEnabled(checked &amp;&amp; !minimShortRadio-&gt;isChecked());</a>
<a name="ln487">      minimNoneRadio-&gt;setEnabled(checked);</a>
<a name="ln488">      minimShortRadio-&gt;setEnabled(checked &amp;&amp; !stemThroughRadio-&gt;isChecked());</a>
<a name="ln489">      minimSlashedRadio-&gt;setEnabled(checked);</a>
<a name="ln490">      }</a>
<a name="ln491"> </a>
<a name="ln492">//---------------------------------------------------------</a>
<a name="ln493">//   Tabulature &quot;minim short&quot; compatibility</a>
<a name="ln494">//</a>
<a name="ln495">//    Setting &quot;short minim&quot; stems is incompatible with &quot;stems through&quot;:</a>
<a name="ln496">//    if checked and &quot;stems through&quot; is checked, move check to &quot;stems beside&quot;</a>
<a name="ln497">//---------------------------------------------------------</a>
<a name="ln498"> </a>
<a name="ln499">void EditStaffType::tabMinimShortCompatibility(bool checked)</a>
<a name="ln500">      {</a>
<a name="ln501">      if (checked) {</a>
<a name="ln502">            if(stemThroughRadio-&gt;isChecked()) {</a>
<a name="ln503">                  stemThroughRadio-&gt;setChecked(false);</a>
<a name="ln504">                  stemBesideRadio-&gt;setChecked(true);</a>
<a name="ln505">                  }</a>
<a name="ln506">            }</a>
<a name="ln507">      // disable / enable &quot;stems through&quot; according &quot;minim short&quot; is checked / unchecked</a>
<a name="ln508">      stemThroughRadio-&gt;setEnabled(!checked &amp;&amp; noteValuesStems-&gt;isChecked());</a>
<a name="ln509">      }</a>
<a name="ln510"> </a>
<a name="ln511">//---------------------------------------------------------</a>
<a name="ln512">//   Tabulature &quot;stems through&quot; compatibility</a>
<a name="ln513">//</a>
<a name="ln514">//    Setting &quot;stems through&quot; is incompatible with &quot;minim short&quot;:</a>
<a name="ln515">//    if checking and &quot;minim short&quot; is checked, move check to &quot;minim slashed&quot;</a>
<a name="ln516">//    It also make &quot;Stems above&quot; and &quot;Stems below&quot; meaningless: disable them</a>
<a name="ln517">//---------------------------------------------------------</a>
<a name="ln518"> </a>
<a name="ln519">void EditStaffType::tabStemThroughCompatibility(bool checked)</a>
<a name="ln520">      {</a>
<a name="ln521">      if (checked) {</a>
<a name="ln522">            if(minimShortRadio-&gt;isChecked()) {</a>
<a name="ln523">                  minimShortRadio-&gt;setChecked(false);</a>
<a name="ln524">                  minimSlashedRadio-&gt;setChecked(true);</a>
<a name="ln525">                  }</a>
<a name="ln526">            }</a>
<a name="ln527">      // disable / enable &quot;minim short&quot; and &quot;stems above/below&quot; according &quot;stems through&quot; is checked / unchecked</a>
<a name="ln528">      bool enab = !checked &amp;&amp; noteValuesStems-&gt;isChecked();</a>
<a name="ln529">      minimShortRadio-&gt;setEnabled(enab);</a>
<a name="ln530">      stemAboveRadio-&gt;setEnabled(enab);</a>
<a name="ln531">      stemBelowRadio-&gt;setEnabled(enab);</a>
<a name="ln532">      }</a>
<a name="ln533"> </a>
<a name="ln534">//---------------------------------------------------------</a>
<a name="ln535">//    updatePreview</a>
<a name="ln536">///   update staff type in preview score</a>
<a name="ln537">//---------------------------------------------------------</a>
<a name="ln538"> </a>
<a name="ln539">void EditStaffType::updatePreview()</a>
<a name="ln540">      {</a>
<a name="ln541">      setFromDlg();</a>
<a name="ln542">      ExampleView* preview = nullptr;</a>
<a name="ln543">      if (staffType.group() == StaffGroup::TAB)</a>
<a name="ln544">             preview = tabPreview;</a>
<a name="ln545">      else if (staffType.group() == StaffGroup::STANDARD)</a>
<a name="ln546">             preview = standardPreview;</a>
<a name="ln547">      if (preview) {</a>
<a name="ln548">            preview-&gt;score()-&gt;staff(0)-&gt;setStaffType(Fraction(0,1), staffType);</a>
<a name="ln549">            preview-&gt;score()-&gt;doLayout();</a>
<a name="ln550">            preview-&gt;updateAll();</a>
<a name="ln551">            preview-&gt;update();</a>
<a name="ln552">            }</a>
<a name="ln553">      }</a>
<a name="ln554"> </a>
<a name="ln555">//---------------------------------------------------------</a>
<a name="ln556">//   createUniqueStaffTypeName</a>
<a name="ln557">///  create unique new name for StaffType</a>
<a name="ln558">//---------------------------------------------------------</a>
<a name="ln559"> </a>
<a name="ln560">QString EditStaffType::createUniqueStaffTypeName(StaffGroup group)</a>
<a name="ln561">      {</a>
<a name="ln562">      QString sn;</a>
<a name="ln563">      for (int idx = 1; ; ++idx) {</a>
<a name="ln564">            switch (group) {</a>
<a name="ln565">                  case StaffGroup::STANDARD:</a>
<a name="ln566">                        sn = QString(&quot;Standard-%1 [*]&quot;).arg(idx);</a>
<a name="ln567">                        break;</a>
<a name="ln568">                  case StaffGroup::PERCUSSION:</a>
<a name="ln569">                        sn = QString(&quot;Perc-%1 [*]&quot;).arg(idx);</a>
<a name="ln570">                        break;</a>
<a name="ln571">                  case StaffGroup::TAB:</a>
<a name="ln572">                        sn = QString(&quot;Tab-%1 [*]&quot;).arg(idx);</a>
<a name="ln573">                        break;</a>
<a name="ln574">                  }</a>
<a name="ln575">            bool found = false;</a>
<a name="ln576">            for (const StaffType&amp; st : StaffType::presets()) {</a>
<a name="ln577">                  if (st.name() == sn) {</a>
<a name="ln578">                        found = true;</a>
<a name="ln579">                        break;</a>
<a name="ln580">                        }</a>
<a name="ln581">                  }</a>
<a name="ln582">            if (!found)</a>
<a name="ln583">                  break;</a>
<a name="ln584">            }</a>
<a name="ln585">      return sn;</a>
<a name="ln586">      }</a>
<a name="ln587"> </a>
<a name="ln588">//---------------------------------------------------------</a>
<a name="ln589">//   savePresets</a>
<a name="ln590">//---------------------------------------------------------</a>
<a name="ln591"> </a>
<a name="ln592">void EditStaffType::savePresets()</a>
<a name="ln593">      {</a>
<a name="ln594">      qDebug(&quot;savePresets&quot;);</a>
<a name="ln595">      }</a>
<a name="ln596"> </a>
<a name="ln597">//---------------------------------------------------------</a>
<a name="ln598">//   loadPresets</a>
<a name="ln599">//---------------------------------------------------------</a>
<a name="ln600"> </a>
<a name="ln601">void EditStaffType::loadPresets()</a>
<a name="ln602">      {</a>
<a name="ln603">      qDebug(&quot;loadPresets&quot;);</a>
<a name="ln604">      }</a>
<a name="ln605"> </a>
<a name="ln606">//---------------------------------------------------------</a>
<a name="ln607">//   loadFromTemplate</a>
<a name="ln608">//---------------------------------------------------------</a>
<a name="ln609">/*</a>
<a name="ln610">void EditStaffType::loadFromTemplateClicked()</a>
<a name="ln611">      {</a>
<a name="ln612">      StaffTypeTemplates stt(staffType);</a>
<a name="ln613">      if (stt.exec()) {</a>
<a name="ln614">            StaffType* st = stt.staffType();</a>
<a name="ln615">            staffType = *st;</a>
<a name="ln616">            setValues();</a>
<a name="ln617">            updatePreview();</a>
<a name="ln618">            }</a>
<a name="ln619">      }</a>
<a name="ln620">*/</a>
<a name="ln621">void EditStaffType::resetToTemplateClicked()</a>
<a name="ln622">      {</a>
<a name="ln623">      int idx = templateCombo-&gt;itemData(templateCombo-&gt;currentIndex()).toInt();</a>
<a name="ln624">      if (idx &gt;= 0) {</a>
<a name="ln625">            staffType = *(StaffType::preset(StaffTypes(idx)));</a>
<a name="ln626">            setValues();</a>
<a name="ln627">            }</a>
<a name="ln628">      }</a>
<a name="ln629"> </a>
<a name="ln630">//---------------------------------------------------------</a>
<a name="ln631">//   addToTemplates</a>
<a name="ln632">//---------------------------------------------------------</a>
<a name="ln633"> </a>
<a name="ln634">void EditStaffType::addToTemplatesClicked()</a>
<a name="ln635">      {</a>
<a name="ln636">      qDebug(&quot;not implemented: add to templates&quot;);</a>
<a name="ln637">      }</a>
<a name="ln638"> </a>
<a name="ln639">//---------------------------------------------------------</a>
<a name="ln640">//   StaffTypeTemplates</a>
<a name="ln641">//---------------------------------------------------------</a>
<a name="ln642">/*</a>
<a name="ln643">StaffTypeTemplates::StaffTypeTemplates(const StaffType&amp; st, QWidget* parent)</a>
<a name="ln644">   : QDialog(parent)</a>
<a name="ln645">      {</a>
<a name="ln646">      setupUi(this);</a>
<a name="ln647"> </a>
<a name="ln648">      QList&lt;const StaffType*&gt; stl;</a>
<a name="ln649">      for (const StaffType&amp; t : StaffType::presets()) {</a>
<a name="ln650">            if (t.group() == st.group())</a>
<a name="ln651">                  stl.append(&amp;t);</a>
<a name="ln652">            }</a>
<a name="ln653">      for (const StaffType* t : stl) {</a>
<a name="ln654">            QListWidgetItem* item = new QListWidgetItem(t-&gt;name());</a>
<a name="ln655">            item-&gt;setData(Qt::UserRole,</a>
<a name="ln656">               QVariant::fromValue&lt;void*&gt;((void*)t)</a>
<a name="ln657">               );</a>
<a name="ln658">            staffTypeList-&gt;addItem(item);</a>
<a name="ln659">            }</a>
<a name="ln660">      staffTypeList-&gt;setCurrentRow(0);</a>
<a name="ln661">      }</a>
<a name="ln662">*/</a>
<a name="ln663">//---------------------------------------------------------</a>
<a name="ln664">//   staffType</a>
<a name="ln665">//---------------------------------------------------------</a>
<a name="ln666">/*</a>
<a name="ln667">StaffType* StaffTypeTemplates::staffType() const</a>
<a name="ln668">      {</a>
<a name="ln669">      return (StaffType*)staffTypeList-&gt;currentItem()-&gt;data(Qt::UserRole).value&lt;void*&gt;();</a>
<a name="ln670">      }</a>
<a name="ln671">*/</a>
<a name="ln672">}</a>
<a name="ln673"> </a>

</code></pre>
<div class="balloon" rel="8"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
