
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>undo.h</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">//=============================================================================</a>
<a name="ln2">//  MuseScore</a>
<a name="ln3">//  Music Composition &amp; Notation</a>
<a name="ln4">//</a>
<a name="ln5">//  Copyright (C) 2002-2017 Werner Schweer</a>
<a name="ln6">//</a>
<a name="ln7">//  This program is free software; you can redistribute it and/or modify</a>
<a name="ln8">//  it under the terms of the GNU General Public License version 2</a>
<a name="ln9">//  as published by the Free Software Foundation and appearing in</a>
<a name="ln10">//  the file LICENCE.GPL</a>
<a name="ln11">//=============================================================================</a>
<a name="ln12"> </a>
<a name="ln13">#ifndef __UNDO_H__</a>
<a name="ln14">#define __UNDO_H__</a>
<a name="ln15"> </a>
<a name="ln16">/**</a>
<a name="ln17"> \file</a>
<a name="ln18"> Definition of undo-releated classes and structs.</a>
<a name="ln19">*/</a>
<a name="ln20"> </a>
<a name="ln21">#include &quot;spatium.h&quot;</a>
<a name="ln22">#include &quot;mscore.h&quot;</a>
<a name="ln23">#include &quot;sig.h&quot;</a>
<a name="ln24">#include &quot;tempo.h&quot;</a>
<a name="ln25">#include &quot;input.h&quot;</a>
<a name="ln26">#include &quot;style.h&quot;</a>
<a name="ln27">#include &quot;key.h&quot;</a>
<a name="ln28">#include &quot;select.h&quot;</a>
<a name="ln29">#include &quot;instrument.h&quot;</a>
<a name="ln30">#include &quot;synthesizer/midipatch.h&quot;</a>
<a name="ln31">#include &quot;pitchvalue.h&quot;</a>
<a name="ln32">#include &quot;timesig.h&quot;</a>
<a name="ln33">#include &quot;noteevent.h&quot;</a>
<a name="ln34">#include &quot;synthesizerstate.h&quot;</a>
<a name="ln35">#include &quot;dynamic.h&quot;</a>
<a name="ln36">#include &quot;staff.h&quot;</a>
<a name="ln37">#include &quot;stafftype.h&quot;</a>
<a name="ln38">#include &quot;cleflist.h&quot;</a>
<a name="ln39">#include &quot;note.h&quot;</a>
<a name="ln40">#include &quot;chord.h&quot;</a>
<a name="ln41">#include &quot;drumset.h&quot;</a>
<a name="ln42">#include &quot;rest.h&quot;</a>
<a name="ln43">#include &quot;fret.h&quot;</a>
<a name="ln44"> </a>
<a name="ln45">Q_DECLARE_LOGGING_CATEGORY(undoRedo);</a>
<a name="ln46"> </a>
<a name="ln47">namespace Ms {</a>
<a name="ln48"> </a>
<a name="ln49">class ElementList;</a>
<a name="ln50">class Element;</a>
<a name="ln51">class Instrument;</a>
<a name="ln52">class System;</a>
<a name="ln53">class Measure;</a>
<a name="ln54">class Segment;</a>
<a name="ln55">class Staff;</a>
<a name="ln56">class Part;</a>
<a name="ln57">class Volta;</a>
<a name="ln58">class Score;</a>
<a name="ln59">class Note;</a>
<a name="ln60">class Chord;</a>
<a name="ln61">class ChordRest;</a>
<a name="ln62">class Harmony;</a>
<a name="ln63">class SlurTie;</a>
<a name="ln64">class MStaff;</a>
<a name="ln65">class MeasureBase;</a>
<a name="ln66">class Dynamic;</a>
<a name="ln67">class Selection;</a>
<a name="ln68">class Text;</a>
<a name="ln69">class Channel;</a>
<a name="ln70">class Tuplet;</a>
<a name="ln71">class KeySig;</a>
<a name="ln72">class TimeSig;</a>
<a name="ln73">class Clef;</a>
<a name="ln74">class Image;</a>
<a name="ln75">class Bend;</a>
<a name="ln76">class TremoloBar;</a>
<a name="ln77">class NoteEvent;</a>
<a name="ln78">class SlurSegment;</a>
<a name="ln79">class InstrumentChange;</a>
<a name="ln80">class Box;</a>
<a name="ln81">class Spanner;</a>
<a name="ln82">class BarLine;</a>
<a name="ln83">enum class ClefType : signed char;</a>
<a name="ln84">enum class PlayEventType : char;</a>
<a name="ln85">class Excerpt;</a>
<a name="ln86">class EditData;</a>
<a name="ln87"> </a>
<a name="ln88">#define UNDO_NAME(a)  virtual const char* name() const override { return a; }</a>
<a name="ln89"> </a>
<a name="ln90">enum class LayoutMode : char;</a>
<a name="ln91"> </a>
<a name="ln92">//---------------------------------------------------------</a>
<a name="ln93">//   UndoCommand</a>
<a name="ln94">//---------------------------------------------------------</a>
<a name="ln95"> </a>
<a name="ln96">class UndoCommand {</a>
<a name="ln97">      QList&lt;UndoCommand*&gt; childList;</a>
<a name="ln98"> </a>
<a name="ln99">   protected:</a>
<a name="ln100">      virtual void flip(EditData*) {}</a>
<a name="ln101">      void appendChildren(UndoCommand*);</a>
<a name="ln102"> </a>
<a name="ln103">   public:</a>
<a name="ln104">      enum class Filter {</a>
<a name="ln105">            TextEdit,</a>
<a name="ln106">            AddElement,</a>
<a name="ln107">            AddElementLinked,</a>
<a name="ln108">            Link,</a>
<a name="ln109">            RemoveElement,</a>
<a name="ln110">            RemoveElementLinked,</a>
<a name="ln111">            ChangePropertyLinked,</a>
<a name="ln112">            };</a>
<a name="ln113"> </a>
<a name="ln114">      virtual ~UndoCommand();</a>
<a name="ln115">      virtual void undo(EditData*);</a>
<a name="ln116">      virtual void redo(EditData*);</a>
<a name="ln117">      void appendChild(UndoCommand* cmd) { childList.append(cmd);       }</a>
<a name="ln118">      UndoCommand* removeChild()         { return childList.takeLast(); }</a>
<a name="ln119">      int childCount() const             { return childList.size();     }</a>
<a name="ln120">      void unwind();</a>
<a name="ln121">      const QList&lt;UndoCommand*&gt;&amp; commands() const { return childList; }</a>
<a name="ln122">      virtual void cleanup(bool undo);</a>
<a name="ln123">// #ifndef QT_NO_DEBUG</a>
<a name="ln124">      virtual const char* name() const { return &quot;UndoCommand&quot;; }</a>
<a name="ln125">// #endif</a>
<a name="ln126"> </a>
<a name="ln127">      virtual bool isFiltered(Filter, const Element* /* target */) const { return false; }</a>
<a name="ln128">      bool hasFilteredChildren(Filter, const Element* target) const;</a>
<a name="ln129">      bool hasUnfilteredChildren(const std::vector&lt;Filter&gt;&amp; filters, const Element* target) const;</a>
<a name="ln130">      void filterChildren(UndoCommand::Filter f, Element* target);</a>
<a name="ln131">      };</a>
<a name="ln132"> </a>
<a name="ln133">//---------------------------------------------------------</a>
<a name="ln134">//   UndoMacro</a>
<a name="ln135">//    A root element for undo macro which is stored</a>
<a name="ln136">//    directly in UndoStack</a>
<a name="ln137">//---------------------------------------------------------</a>
<a name="ln138"> </a>
<a name="ln139">class UndoMacro : public UndoCommand {</a>
<a name="ln140">      struct SelectionInfo {</a>
<a name="ln141">            std::vector&lt;Element*&gt; elements;</a>
<a name="ln142">            Fraction tickStart;</a>
<a name="ln143">            Fraction tickEnd;</a>
<a name="ln144">            int staffStart = -1;</a>
<a name="ln145">            int staffEnd = -1;</a>
<a name="ln146"> </a>
<a name="ln147">            bool isValid() const { return !elements.empty() || staffStart != -1; }</a>
<a name="ln148">            };</a>
<a name="ln149"> </a>
<a name="ln150">      InputState undoInputState;</a>
<a name="ln151">      InputState redoInputState;</a>
<a name="ln152">      SelectionInfo undoSelectionInfo;</a>
<a name="ln153">      SelectionInfo redoSelectionInfo;</a>
<a name="ln154"> </a>
<a name="ln155">      Score* score;</a>
<a name="ln156"> </a>
<a name="ln157">      static void fillSelectionInfo(SelectionInfo&amp;, const Selection&amp;);</a>
<a name="ln158">      static void applySelectionInfo(const SelectionInfo&amp;, Selection&amp;);</a>
<a name="ln159"> </a>
<a name="ln160">   public:</a>
<a name="ln161">      UndoMacro(Score* s);</a>
<a name="ln162">      virtual void undo(EditData*) override;</a>
<a name="ln163">      virtual void redo(EditData*) override;</a>
<a name="ln164">      bool empty() const { return childCount() == 0; }</a>
<a name="ln165">      void append(UndoMacro&amp;&amp; other);</a>
<a name="ln166"> </a>
<a name="ln167">      UNDO_NAME(&quot;UndoMacro&quot;);</a>
<a name="ln168">      };</a>
<a name="ln169"> </a>
<a name="ln170">//---------------------------------------------------------</a>
<a name="ln171">//   UndoStack</a>
<a name="ln172">//---------------------------------------------------------</a>
<a name="ln173"> </a>
<a name="ln174">class UndoStack {</a>
<a name="ln175">      UndoMacro* curCmd;</a>
<a name="ln176">      QList&lt;UndoMacro*&gt; list;</a>
<a name="ln177">      std::vector&lt;int&gt; stateList;</a>
<a name="ln178">      int nextState;</a>
<a name="ln179">      int cleanState;</a>
<a name="ln180">      int curIdx;</a>
<a name="ln181"> </a>
<a name="ln182">      void remove(int idx);</a>
<a name="ln183"> </a>
<a name="ln184">   public:</a>
<a name="ln185">      UndoStack();</a>
<a name="ln186">      ~UndoStack();</a>
<a name="ln187"> </a>
<a name="ln188">      bool active() const           { return curCmd != 0; }</a>
<a name="ln189">      void beginMacro(Score*);</a>
<a name="ln190">      void endMacro(bool rollback);</a>
<a name="ln191">      void push(UndoCommand*, EditData*);      // push &amp; execute</a>
<a name="ln192">      void push1(UndoCommand*);</a>
<a name="ln193">      void pop();</a>
<a name="ln194">      void setClean();</a>
<a name="ln195">      bool canUndo() const          { return curIdx &gt; 0;           }</a>
<a name="ln196">      bool canRedo() const          { return curIdx &lt; list.size(); }</a>
<a name="ln197">      int state() const             { return stateList[curIdx];    }</a>
<a name="ln198">      bool isClean() const          { return cleanState == state();     }</a>
<a name="ln199">      int getCurIdx() const         { return curIdx; }</a>
<a name="ln200">      bool empty() const            { return !canUndo() &amp;&amp; !canRedo();  }</a>
<a name="ln201">      UndoMacro* current() const    { return curCmd;               }</a>
<a name="ln202">      UndoMacro* last() const       { return curIdx &gt; 0 ? list[curIdx-1] : 0; }</a>
<a name="ln203">      UndoMacro* prev() const       { return curIdx &gt; 1 ? list[curIdx-2] : 0; }</a>
<a name="ln204">      void undo(EditData*);</a>
<a name="ln205">      void redo(EditData*);</a>
<a name="ln206">      void rollback();</a>
<a name="ln207">      void reopen();</a>
<a name="ln208"> </a>
<a name="ln209">      void mergeCommands(int startIdx);</a>
<a name="ln210">      void cleanRedoStack() { remove(curIdx); }</a>
<a name="ln211">      };</a>
<a name="ln212"> </a>
<a name="ln213">//---------------------------------------------------------</a>
<a name="ln214">//   InsertPart</a>
<a name="ln215">//---------------------------------------------------------</a>
<a name="ln216"> </a>
<a name="ln217">class InsertPart : public UndoCommand {</a>
<a name="ln218">      Part* part;</a>
<a name="ln219">      int idx;</a>
<a name="ln220"> </a>
<a name="ln221">   public:</a>
<a name="ln222">      InsertPart(Part* p, int i);</a>
<a name="ln223">      virtual void undo(EditData*) override;</a>
<a name="ln224">      virtual void redo(EditData*) override;</a>
<a name="ln225">      UNDO_NAME(&quot;InsertPart&quot;)</a>
<a name="ln226">      };</a>
<a name="ln227"> </a>
<a name="ln228">//---------------------------------------------------------</a>
<a name="ln229">//   RemovePart</a>
<a name="ln230">//---------------------------------------------------------</a>
<a name="ln231"> </a>
<a name="ln232">class RemovePart : public UndoCommand {</a>
<a name="ln233">      Part* part;</a>
<a name="ln234">      int idx;</a>
<a name="ln235"> </a>
<a name="ln236">   public:</a>
<a name="ln237">      RemovePart(Part*, int idx);</a>
<a name="ln238">      virtual void undo(EditData*) override;</a>
<a name="ln239">      virtual void redo(EditData*) override;</a>
<a name="ln240">      UNDO_NAME(&quot;RemovePart&quot;)</a>
<a name="ln241">      };</a>
<a name="ln242"> </a>
<a name="ln243">//---------------------------------------------------------</a>
<a name="ln244">//   InsertStaff</a>
<a name="ln245">//---------------------------------------------------------</a>
<a name="ln246"> </a>
<a name="ln247">class InsertStaff : public UndoCommand {</a>
<a name="ln248">      Staff* staff;</a>
<a name="ln249">      int ridx;</a>
<a name="ln250"> </a>
<a name="ln251">   public:</a>
<a name="ln252">      InsertStaff(Staff*, int idx);</a>
<a name="ln253">      virtual void undo(EditData*) override;</a>
<a name="ln254">      virtual void redo(EditData*) override;</a>
<a name="ln255">      UNDO_NAME(&quot;InsertStaff&quot;)</a>
<a name="ln256">      };</a>
<a name="ln257"> </a>
<a name="ln258">//---------------------------------------------------------</a>
<a name="ln259">//   RemoveStaff</a>
<a name="ln260">//---------------------------------------------------------</a>
<a name="ln261"> </a>
<a name="ln262">class RemoveStaff : public UndoCommand {</a>
<a name="ln263">      Staff* staff;</a>
<a name="ln264">      int ridx;</a>
<a name="ln265"> </a>
<a name="ln266">   public:</a>
<a name="ln267">      RemoveStaff(Staff*);</a>
<a name="ln268">      virtual void undo(EditData*) override;</a>
<a name="ln269">      virtual void redo(EditData*) override;</a>
<a name="ln270">      UNDO_NAME(&quot;RemoveStaff&quot;)</a>
<a name="ln271">      };</a>
<a name="ln272"> </a>
<a name="ln273">//---------------------------------------------------------</a>
<a name="ln274">//   InsertMStaff</a>
<a name="ln275">//---------------------------------------------------------</a>
<a name="ln276"> </a>
<a name="ln277">class InsertMStaff : public UndoCommand {</a>
<a name="ln278">      Measure* measure;</a>
<a name="ln279">      MStaff* mstaff;</a>
<a name="ln280">      int idx;</a>
<a name="ln281"> </a>
<a name="ln282">   public:</a>
<a name="ln283">      InsertMStaff(Measure*, MStaff*, int);</a>
<a name="ln284">      virtual void undo(EditData*) override;</a>
<a name="ln285">      virtual void redo(EditData*) override;</a>
<a name="ln286">      UNDO_NAME(&quot;InsertMStaff&quot;)</a>
<a name="ln287">      };</a>
<a name="ln288"> </a>
<a name="ln289">//---------------------------------------------------------</a>
<a name="ln290">//   RemoveMStaff</a>
<a name="ln291">//---------------------------------------------------------</a>
<a name="ln292"> </a>
<a name="ln293">class RemoveMStaff : public UndoCommand {</a>
<a name="ln294">      Measure* measure;</a>
<a name="ln295">      MStaff* mstaff;</a>
<a name="ln296">      int idx;</a>
<a name="ln297"> </a>
<a name="ln298">   public:</a>
<a name="ln299">      RemoveMStaff(Measure*, MStaff*, int);</a>
<a name="ln300">      virtual void undo(EditData*) override;</a>
<a name="ln301">      virtual void redo(EditData*) override;</a>
<a name="ln302">      UNDO_NAME(&quot;RemoveMStaff&quot;)</a>
<a name="ln303">      };</a>
<a name="ln304"> </a>
<a name="ln305">//---------------------------------------------------------</a>
<a name="ln306">//   InsertStaves</a>
<a name="ln307">//---------------------------------------------------------</a>
<a name="ln308"> </a>
<a name="ln309">class InsertStaves : public UndoCommand {</a>
<a name="ln310">      Measure* measure;</a>
<a name="ln311">      int a;</a>
<a name="ln312">      int b;</a>
<a name="ln313"> </a>
<a name="ln314">   public:</a>
<a name="ln315">      InsertStaves(Measure*, int, int);</a>
<a name="ln316">      virtual void undo(EditData*) override;</a>
<a name="ln317">      virtual void redo(EditData*) override;</a>
<a name="ln318">      UNDO_NAME(&quot;InsertStaves&quot;)</a>
<a name="ln319">      };</a>
<a name="ln320"> </a>
<a name="ln321">//---------------------------------------------------------</a>
<a name="ln322">//   RemoveStaves</a>
<a name="ln323">//---------------------------------------------------------</a>
<a name="ln324"> </a>
<a name="ln325">class RemoveStaves : public UndoCommand {</a>
<a name="ln326">      Measure* measure;</a>
<a name="ln327">      int a;</a>
<a name="ln328">      int b;</a>
<a name="ln329"> </a>
<a name="ln330">   public:</a>
<a name="ln331">      RemoveStaves(Measure*, int, int);</a>
<a name="ln332">      virtual void undo(EditData*) override;</a>
<a name="ln333">      virtual void redo(EditData*) override;</a>
<a name="ln334">      UNDO_NAME(&quot;RemoveStaves&quot;)</a>
<a name="ln335">      };</a>
<a name="ln336"> </a>
<a name="ln337">//---------------------------------------------------------</a>
<a name="ln338">//   SortStaves</a>
<a name="ln339">//---------------------------------------------------------</a>
<a name="ln340"> </a>
<a name="ln341">class SortStaves : public UndoCommand {</a>
<a name="ln342">      Score* score;</a>
<a name="ln343">      QList&lt;int&gt; list;</a>
<a name="ln344">      QList&lt;int&gt; rlist;</a>
<a name="ln345"> </a>
<a name="ln346">   public:</a>
<a name="ln347">      SortStaves(Score*, QList&lt;int&gt;);</a>
<a name="ln348">      virtual void undo(EditData*) override;</a>
<a name="ln349">      virtual void redo(EditData*) override;</a>
<a name="ln350">      UNDO_NAME(&quot;SortStaves&quot;)</a>
<a name="ln351">      };</a>
<a name="ln352"> </a>
<a name="ln353">//---------------------------------------------------------</a>
<a name="ln354">//   ChangePitch</a>
<a name="ln355">//---------------------------------------------------------</a>
<a name="ln356"> </a>
<a name="ln357">class ChangePitch : public UndoCommand {</a>
<a name="ln358">      Note* note;</a>
<a name="ln359">      int pitch;</a>
<a name="ln360">      int tpc1;</a>
<a name="ln361">      int tpc2;</a>
<a name="ln362">      void flip(EditData*) override;</a>
<a name="ln363"> </a>
<a name="ln364">   public:</a>
<a name="ln365">      ChangePitch(Note* note, int pitch, int tpc1, int tpc2);</a>
<a name="ln366">      UNDO_NAME(&quot;ChangePitch&quot;)</a>
<a name="ln367">      };</a>
<a name="ln368"> </a>
<a name="ln369">//---------------------------------------------------------</a>
<a name="ln370">//   ChangeFretting</a>
<a name="ln371">//---------------------------------------------------------</a>
<a name="ln372"> </a>
<a name="ln373">class ChangeFretting : public UndoCommand {</a>
<a name="ln374">      Note* note;</a>
<a name="ln375">      int pitch;</a>
<a name="ln376">      int string;</a>
<a name="ln377">      int fret;</a>
<a name="ln378">      int tpc1;</a>
<a name="ln379">      int tpc2;</a>
<a name="ln380">      void flip(EditData*) override;</a>
<a name="ln381"> </a>
<a name="ln382">   public:</a>
<a name="ln383">      ChangeFretting(Note* note, int pitch, int string, int fret, int tpc1, int tpc2);</a>
<a name="ln384">      UNDO_NAME(&quot;ChangeFretting&quot;)</a>
<a name="ln385">      };</a>
<a name="ln386"> </a>
<a name="ln387">//---------------------------------------------------------</a>
<a name="ln388">//   ChangeKeySig</a>
<a name="ln389">//---------------------------------------------------------</a>
<a name="ln390"> </a>
<a name="ln391">class ChangeKeySig : public UndoCommand {</a>
<a name="ln392">      KeySig* keysig;</a>
<a name="ln393">      KeySigEvent ks;</a>
<a name="ln394">      bool showCourtesy;</a>
<a name="ln395">      bool evtInStaff;</a>
<a name="ln396"> </a>
<a name="ln397">      void flip(EditData*) override;</a>
<a name="ln398"> </a>
<a name="ln399">   public:</a>
<a name="ln400">      ChangeKeySig(KeySig* k, KeySigEvent newKeySig, bool sc, bool addEvtToStaff = true);</a>
<a name="ln401">      UNDO_NAME(&quot;ChangeKeySig&quot;)</a>
<a name="ln402">      };</a>
<a name="ln403"> </a>
<a name="ln404">//---------------------------------------------------------</a>
<a name="ln405">//   ChangeMeasureLen</a>
<a name="ln406">//---------------------------------------------------------</a>
<a name="ln407"> </a>
<a name="ln408">class ChangeMeasureLen : public UndoCommand {</a>
<a name="ln409">      Measure* measure;</a>
<a name="ln410">      Fraction len;</a>
<a name="ln411">      void flip(EditData*) override;</a>
<a name="ln412"> </a>
<a name="ln413">   public:</a>
<a name="ln414">      ChangeMeasureLen(Measure*, Fraction);</a>
<a name="ln415">      UNDO_NAME(&quot;ChangeMeasureLen&quot;)</a>
<a name="ln416">      };</a>
<a name="ln417"> </a>
<a name="ln418">//---------------------------------------------------------</a>
<a name="ln419">//   ChangeElement</a>
<a name="ln420">//---------------------------------------------------------</a>
<a name="ln421"> </a>
<a name="ln422">class ChangeElement : public UndoCommand {</a>
<a name="ln423">      Element* oldElement;</a>
<a name="ln424">      Element* newElement;</a>
<a name="ln425">      void flip(EditData*) override;</a>
<a name="ln426"> </a>
<a name="ln427">   public:</a>
<a name="ln428">      ChangeElement(Element* oldElement, Element* newElement);</a>
<a name="ln429">      UNDO_NAME(&quot;ChangeElement&quot;)</a>
<a name="ln430">      };</a>
<a name="ln431"> </a>
<a name="ln432">//---------------------------------------------------------</a>
<a name="ln433">//   TransposeHarmony</a>
<a name="ln434">//---------------------------------------------------------</a>
<a name="ln435"> </a>
<a name="ln436">class TransposeHarmony : public UndoCommand {</a>
<a name="ln437">      Harmony* harmony;</a>
<a name="ln438">      int rootTpc, baseTpc;</a>
<a name="ln439">      void flip(EditData*) override;</a>
<a name="ln440"> </a>
<a name="ln441">   public:</a>
<a name="ln442">      TransposeHarmony(Harmony*, int rootTpc, int baseTpc);</a>
<a name="ln443">      UNDO_NAME(&quot;TransposeHarmony&quot;)</a>
<a name="ln444">      };</a>
<a name="ln445"> </a>
<a name="ln446">//---------------------------------------------------------</a>
<a name="ln447">//   ExchangeVoice</a>
<a name="ln448">//---------------------------------------------------------</a>
<a name="ln449"> </a>
<a name="ln450">class ExchangeVoice : public UndoCommand {</a>
<a name="ln451">      Measure* measure;</a>
<a name="ln452">      int val1, val2;</a>
<a name="ln453">      int staff;</a>
<a name="ln454"> </a>
<a name="ln455">   public:</a>
<a name="ln456">      ExchangeVoice(Measure* ,int val1, int val2, int staff);</a>
<a name="ln457">      virtual void undo(EditData*) override;</a>
<a name="ln458">      virtual void redo(EditData*) override;</a>
<a name="ln459">      UNDO_NAME(&quot;ExchangeVoice&quot;)</a>
<a name="ln460">      };</a>
<a name="ln461"> </a>
<a name="ln462">//---------------------------------------------------------</a>
<a name="ln463">//   CloneVoice</a>
<a name="ln464">//---------------------------------------------------------</a>
<a name="ln465"> </a>
<a name="ln466">class CloneVoice : public UndoCommand {</a>
<a name="ln467">      Segment* sf;</a>
<a name="ln468">      Fraction lTick;</a>
<a name="ln469">      Segment* d;             //Destination</a>
<a name="ln470">      int strack, dtrack;</a>
<a name="ln471">      int otrack;</a>
<a name="ln472">      bool linked;</a>
<a name="ln473">      bool first = true;      //first redo</a>
<a name="ln474"> </a>
<a name="ln475">   public:</a>
<a name="ln476">      CloneVoice(Segment* sf, const Fraction&amp; lTick, Segment* d, int strack, int dtrack, int otrack, bool linked = true);</a>
<a name="ln477">      virtual void undo(EditData*) override;</a>
<a name="ln478">      virtual void redo(EditData*) override;</a>
<a name="ln479">      UNDO_NAME(&quot;CloneVoice&quot;)</a>
<a name="ln480">      };</a>
<a name="ln481"> </a>
<a name="ln482">//---------------------------------------------------------</a>
<a name="ln483">//   ChangeInstrumentShort</a>
<a name="ln484">//---------------------------------------------------------</a>
<a name="ln485"> </a>
<a name="ln486">class ChangeInstrumentShort : public UndoCommand {</a>
<a name="ln487">      Part* part;</a>
<a name="ln488">      Fraction tick;</a>
<a name="ln489">      QList&lt;StaffName&gt; text;</a>
<a name="ln490">      void flip(EditData*) override;</a>
<a name="ln491"> </a>
<a name="ln492">   public:</a>
<a name="ln493">      ChangeInstrumentShort(const Fraction&amp;, Part*, QList&lt;StaffName&gt;);</a>
<a name="ln494">      UNDO_NAME(&quot;ChangeInstrumentShort&quot;)</a>
<a name="ln495">      };</a>
<a name="ln496"> </a>
<a name="ln497">//---------------------------------------------------------</a>
<a name="ln498">//   ChangeInstrumentLong</a>
<a name="ln499">//---------------------------------------------------------</a>
<a name="ln500"> </a>
<a name="ln501">class ChangeInstrumentLong : public UndoCommand {</a>
<a name="ln502">      Part* part;</a>
<a name="ln503">      Fraction tick;</a>
<a name="ln504">      QList&lt;StaffName&gt; text;</a>
<a name="ln505">      void flip(EditData*) override;</a>
<a name="ln506"> </a>
<a name="ln507">   public:</a>
<a name="ln508">      const QList&lt;StaffName&gt;&amp; longNames() const;</a>
<a name="ln509">      ChangeInstrumentLong(const Fraction&amp;, Part*, QList&lt;StaffName&gt;);</a>
<a name="ln510">      UNDO_NAME(&quot;ChangeInstrumentLong&quot;)</a>
<a name="ln511">      };</a>
<a name="ln512"> </a>
<a name="ln513">//---------------------------------------------------------</a>
<a name="ln514">//   ChangeBracketType</a>
<a name="ln515">//---------------------------------------------------------</a>
<a name="ln516"> </a>
<a name="ln517">class ChangeBracketType : public UndoCommand {</a>
<a name="ln518">      Bracket* bracket;</a>
<a name="ln519">      BracketType type;</a>
<a name="ln520">      void flip(EditData*) override;</a>
<a name="ln521"> </a>
<a name="ln522">   public:</a>
<a name="ln523">      ChangeBracketType(Bracket*, BracketType type);</a>
<a name="ln524">      UNDO_NAME(&quot;ChangeBracketType&quot;)</a>
<a name="ln525">      };</a>
<a name="ln526"> </a>
<a name="ln527">//---------------------------------------------------------</a>
<a name="ln528">//   AddElement</a>
<a name="ln529">//---------------------------------------------------------</a>
<a name="ln530"> </a>
<a name="ln531">class AddElement : public UndoCommand {</a>
<a name="ln532">      Element* element;</a>
<a name="ln533"> </a>
<a name="ln534">      void endUndoRedo(bool) const;</a>
<a name="ln535">      void undo(EditData*) override;</a>
<a name="ln536">      void redo(EditData*) override;</a>
<a name="ln537"> </a>
<a name="ln538">   public:</a>
<a name="ln539">      AddElement(Element*);</a>
<a name="ln540">      Element* getElement() const { return element; }</a>
<a name="ln541">      virtual void cleanup(bool);</a>
<a name="ln542">      virtual const char* name() const override;</a>
<a name="ln543"> </a>
<a name="ln544">      bool isFiltered(UndoCommand::Filter f, const Element* target) const override;</a>
<a name="ln545">      };</a>
<a name="ln546"> </a>
<a name="ln547">//---------------------------------------------------------</a>
<a name="ln548">//   RemoveElement</a>
<a name="ln549">//---------------------------------------------------------</a>
<a name="ln550"> </a>
<a name="ln551">class RemoveElement : public UndoCommand {</a>
<a name="ln552">      Element* element;</a>
<a name="ln553"> </a>
<a name="ln554">   public:</a>
<a name="ln555">      RemoveElement(Element*);</a>
<a name="ln556">      virtual void undo(EditData*) override;</a>
<a name="ln557">      virtual void redo(EditData*) override;</a>
<a name="ln558">      virtual void cleanup(bool);</a>
<a name="ln559">      virtual const char* name() const override;</a>
<a name="ln560"> </a>
<a name="ln561">      bool isFiltered(UndoCommand::Filter f, const Element* target) const override;</a>
<a name="ln562">      };</a>
<a name="ln563"> </a>
<a name="ln564">//---------------------------------------------------------</a>
<a name="ln565">//   EditText</a>
<a name="ln566">//---------------------------------------------------------</a>
<a name="ln567"> </a>
<a name="ln568">class EditText : public UndoCommand {</a>
<a name="ln569">      Text* text;</a>
<a name="ln570">      QString oldText;</a>
<a name="ln571">      //int undoLevel;</a>
<a name="ln572"> </a>
<a name="ln573">      void undoRedo();</a>
<a name="ln574"> </a>
<a name="ln575">   public:</a>
<a name="ln576">      EditText(Text* t, const QString&amp; ot, int /*l*/) : text(t), oldText(ot)/*, undoLevel(l)*/ {}</a>
<a name="ln577">      virtual void undo(EditData*) override;</a>
<a name="ln578">      virtual void redo(EditData*) override;</a>
<a name="ln579">      UNDO_NAME(&quot;EditText&quot;)</a>
<a name="ln580">      };</a>
<a name="ln581"> </a>
<a name="ln582">//---------------------------------------------------------</a>
<a name="ln583">//   ChangePatch</a>
<a name="ln584">//---------------------------------------------------------</a>
<a name="ln585"> </a>
<a name="ln586">class ChangePatch : public UndoCommand {</a>
<a name="ln587">      Score* score;</a>
<a name="ln588">      Channel* channel;</a>
<a name="ln589">      MidiPatch patch;</a>
<a name="ln590"> </a>
<a name="ln591">      void flip(EditData*) override;</a>
<a name="ln592"> </a>
<a name="ln593">   public:</a>
<a name="ln594">      ChangePatch(Score* s, Channel* c, const MidiPatch* pt)</a>
<a name="ln595">         : score(s), channel(c), patch(*pt) {}</a>
<a name="ln596">      UNDO_NAME(&quot;ChangePatch&quot;)</a>
<a name="ln597">      };</a>
<a name="ln598"> </a>
<a name="ln599">//---------------------------------------------------------</a>
<a name="ln600">//   SetUserBankController</a>
<a name="ln601">//---------------------------------------------------------</a>
<a name="ln602"> </a>
<a name="ln603">class SetUserBankController : public UndoCommand {</a>
<a name="ln604">      Channel* channel;</a>
<a name="ln605">      bool val;</a>
<a name="ln606"> </a>
<a name="ln607">      void flip(EditData*) override;</a>
<a name="ln608"> </a>
<a name="ln609">   public:</a>
<a name="ln610">      SetUserBankController(Channel* c, bool v)</a>
<a name="ln611">         : channel(c), val(v) {}</a>
<a name="ln612">      UNDO_NAME(&quot;SetUserBankController&quot;)</a>
<a name="ln613">      };</a>
<a name="ln614"> </a>
<a name="ln615">//---------------------------------------------------------</a>
<a name="ln616">//   ChangeStaff</a>
<a name="ln617">//---------------------------------------------------------</a>
<a name="ln618"> </a>
<a name="ln619">class ChangeStaff : public UndoCommand {</a>
<a name="ln620">      Staff*   staff;</a>
<a name="ln621">      bool     invisible;</a>
<a name="ln622">      ClefTypeList clefType;</a>
<a name="ln623">      qreal    userDist;</a>
<a name="ln624">      Staff::HideMode hideMode;</a>
<a name="ln625">      bool     showIfEmpty;</a>
<a name="ln626">      bool     cutaway;</a>
<a name="ln627">      bool     hideSystemBarLine;</a>
<a name="ln628"> </a>
<a name="ln629">      void flip(EditData*) override;</a>
<a name="ln630"> </a>
<a name="ln631">   public:</a>
<a name="ln632">      ChangeStaff(Staff*, bool invisible, ClefTypeList _clefType, qreal userDist, Staff::HideMode _hideMode,</a>
<a name="ln633">         bool _showIfEmpty, bool _cutaway, bool hide);</a>
<a name="ln634">      UNDO_NAME(&quot;ChangeStaff&quot;)</a>
<a name="ln635">      };</a>
<a name="ln636"> </a>
<a name="ln637">//---------------------------------------------------------</a>
<a name="ln638">//   ChangeStaffType</a>
<a name="ln639">//---------------------------------------------------------</a>
<a name="ln640"> </a>
<a name="ln641">class ChangeStaffType : public UndoCommand {</a>
<a name="ln642">      Staff*       staff;</a>
<a name="ln643">      StaffType    staffType;</a>
<a name="ln644"> </a>
<a name="ln645">      void flip(EditData*) override;</a>
<a name="ln646"> </a>
<a name="ln647">   public:</a>
<a name="ln648">      ChangeStaffType(Staff* s, const StaffType&amp; t) : staff(s), staffType(t) {}</a>
<a name="ln649">      UNDO_NAME(&quot;ChangeStaffType&quot;)</a>
<a name="ln650">      };</a>
<a name="ln651"> </a>
<a name="ln652">//---------------------------------------------------------</a>
<a name="ln653">//   ChangePart</a>
<a name="ln654">//---------------------------------------------------------</a>
<a name="ln655"> </a>
<a name="ln656">class ChangePart : public UndoCommand {</a>
<a name="ln657">      Part* part;</a>
<a name="ln658">      Instrument* instrument;</a>
<a name="ln659">      QString partName;</a>
<a name="ln660"> </a>
<a name="ln661">      void flip(EditData*) override;</a>
<a name="ln662"> </a>
<a name="ln663">   public:</a>
<a name="ln664">      ChangePart(Part*, Instrument*, const QString&amp; name);</a>
<a name="ln665">      UNDO_NAME(&quot;ChangePart&quot;)</a>
<a name="ln666">      };</a>
<a name="ln667"> </a>
<a name="ln668">//---------------------------------------------------------</a>
<a name="ln669">//   ChangeStyle</a>
<a name="ln670">//---------------------------------------------------------</a>
<a name="ln671"> </a>
<a name="ln672">class ChangeStyle : public UndoCommand {</a>
<a name="ln673">      Score* score;</a>
<a name="ln674">      MStyle style;</a>
<a name="ln675">      void flip(EditData*) override;</a>
<a name="ln676"> </a>
<a name="ln677">   public:</a>
<a name="ln678">      ChangeStyle(Score*, const MStyle&amp;);</a>
<a name="ln679">      UNDO_NAME(&quot;ChangeStyle&quot;)</a>
<a name="ln680">      };</a>
<a name="ln681"> </a>
<a name="ln682">//---------------------------------------------------------</a>
<a name="ln683">//   ChangeStyleVal</a>
<a name="ln684">//---------------------------------------------------------</a>
<a name="ln685"> </a>
<a name="ln686">class ChangeStyleVal : public UndoCommand {</a>
<a name="ln687">      Score* score;</a>
<a name="ln688">      Sid idx;</a>
<a name="ln689">      QVariant value;</a>
<a name="ln690"> </a>
<a name="ln691">      void flip(EditData*) override;</a>
<a name="ln692"> </a>
<a name="ln693">   public:</a>
<a name="ln694">      ChangeStyleVal(Score* s, Sid i, const QVariant&amp; v) : score(s), idx(i), value(v) {}</a>
<a name="ln695">      UNDO_NAME(&quot;ChangeStyleVal&quot;)</a>
<a name="ln696">      };</a>
<a name="ln697"> </a>
<a name="ln698">//---------------------------------------------------------</a>
<a name="ln699">//   ChangePageNumberOffset</a>
<a name="ln700">//---------------------------------------------------------</a>
<a name="ln701"> </a>
<a name="ln702">class ChangePageNumberOffset : public UndoCommand {</a>
<a name="ln703">      Score* score;</a>
<a name="ln704">      int pageOffset;</a>
<a name="ln705"> </a>
<a name="ln706">      void flip(EditData*) override;</a>
<a name="ln707"> </a>
<a name="ln708">   public:</a>
<a name="ln709">      ChangePageNumberOffset(Score* s, int po) : score(s), pageOffset(po) {}</a>
<a name="ln710">      UNDO_NAME(&quot;ChangePageNumberOffset&quot;)</a>
<a name="ln711">      };</a>
<a name="ln712"> </a>
<a name="ln713">//---------------------------------------------------------</a>
<a name="ln714">//   ChangeChordStaffMove</a>
<a name="ln715">//---------------------------------------------------------</a>
<a name="ln716"> </a>
<a name="ln717">class ChangeChordStaffMove : public UndoCommand {</a>
<a name="ln718">      ChordRest* chordRest;</a>
<a name="ln719">      int staffMove;</a>
<a name="ln720">      void flip(EditData*) override;</a>
<a name="ln721"> </a>
<a name="ln722">   public:</a>
<a name="ln723">      ChangeChordStaffMove(ChordRest* cr, int);</a>
<a name="ln724">      UNDO_NAME(&quot;ChangeChordStaffMove&quot;)</a>
<a name="ln725">      };</a>
<a name="ln726"> </a>
<a name="ln727">//---------------------------------------------------------</a>
<a name="ln728">//   ChangeVelocity</a>
<a name="ln729">//---------------------------------------------------------</a>
<a name="ln730"> </a>
<a name="ln731">class ChangeVelocity : public UndoCommand {</a>
<a name="ln732">      Note* note;</a>
<a name="ln733">      Note::ValueType veloType;</a>
<a name="ln734">      int veloOffset;</a>
<a name="ln735">      void flip(EditData*) override;</a>
<a name="ln736"> </a>
<a name="ln737">   public:</a>
<a name="ln738">      ChangeVelocity(Note*, Note::ValueType, int);</a>
<a name="ln739">      UNDO_NAME(&quot;ChangeVelocity&quot;)</a>
<a name="ln740">      };</a>
<a name="ln741"> </a>
<a name="ln742">//---------------------------------------------------------</a>
<a name="ln743">//   ChangeMStaffProperties</a>
<a name="ln744">//---------------------------------------------------------</a>
<a name="ln745"> </a>
<a name="ln746">class ChangeMStaffProperties : public UndoCommand {</a>
<a name="ln747">      Measure* measure;</a>
<a name="ln748">      int staffIdx;</a>
<a name="ln749">      bool visible;</a>
<a name="ln750">      bool stemless;</a>
<a name="ln751">      void flip(EditData*) override;</a>
<a name="ln752"> </a>
<a name="ln753">   public:</a>
<a name="ln754">      ChangeMStaffProperties(Measure*, int staffIdx, bool visible, bool stemless);</a>
<a name="ln755">      UNDO_NAME(&quot;ChangeMStaffProperties&quot;)</a>
<a name="ln756">      };</a>
<a name="ln757"> </a>
<a name="ln758">//---------------------------------------------------------</a>
<a name="ln759">//   InsertRemoveMeasures</a>
<a name="ln760">//---------------------------------------------------------</a>
<a name="ln761"> </a>
<a name="ln762">class InsertRemoveMeasures : public UndoCommand {</a>
<a name="ln763">      MeasureBase* fm;</a>
<a name="ln764">      MeasureBase* lm;</a>
<a name="ln765"> </a>
<a name="ln766">      static std::vector&lt;Clef*&gt; getCourtesyClefs(Measure* m);</a>
<a name="ln767"> </a>
<a name="ln768">   protected:</a>
<a name="ln769">      void removeMeasures();</a>
<a name="ln770">      void insertMeasures();</a>
<a name="ln771"> </a>
<a name="ln772">   public:</a>
<a name="ln773">      InsertRemoveMeasures(MeasureBase* _fm, MeasureBase* _lm) : fm(_fm), lm(_lm) {}</a>
<a name="ln774">      virtual void undo(EditData*) override = 0;</a>
<a name="ln775">      virtual void redo(EditData*) override = 0;</a>
<a name="ln776">      };</a>
<a name="ln777"> </a>
<a name="ln778">//---------------------------------------------------------</a>
<a name="ln779">//   RemoveMeasures</a>
<a name="ln780">//---------------------------------------------------------</a>
<a name="ln781"> </a>
<a name="ln782">class RemoveMeasures : public InsertRemoveMeasures {</a>
<a name="ln783"> </a>
<a name="ln784">   public:</a>
<a name="ln785">      RemoveMeasures(MeasureBase* m1, MeasureBase* m2) : InsertRemoveMeasures(m1, m2) {}</a>
<a name="ln786">      virtual void undo(EditData*) override { insertMeasures(); }</a>
<a name="ln787">      virtual void redo(EditData*) override { removeMeasures(); }</a>
<a name="ln788">      UNDO_NAME(&quot;RemoveMeasures&quot;)</a>
<a name="ln789">      };</a>
<a name="ln790"> </a>
<a name="ln791">//---------------------------------------------------------</a>
<a name="ln792">//   InsertMeasures</a>
<a name="ln793">//---------------------------------------------------------</a>
<a name="ln794"> </a>
<a name="ln795">class InsertMeasures : public InsertRemoveMeasures {</a>
<a name="ln796"> </a>
<a name="ln797">   public:</a>
<a name="ln798">      InsertMeasures(MeasureBase* m1, MeasureBase* m2) : InsertRemoveMeasures(m1, m2) {}</a>
<a name="ln799">      virtual void redo(EditData*) override { insertMeasures(); }</a>
<a name="ln800">      virtual void undo(EditData*) override { removeMeasures(); }</a>
<a name="ln801">      UNDO_NAME(&quot;InsertMeasures&quot;)</a>
<a name="ln802">      };</a>
<a name="ln803"> </a>
<a name="ln804">//---------------------------------------------------------</a>
<a name="ln805">//   AddExcerpt</a>
<a name="ln806">//---------------------------------------------------------</a>
<a name="ln807"> </a>
<a name="ln808">class AddExcerpt : public UndoCommand {</a>
<a name="ln809">      Excerpt* excerpt;</a>
<a name="ln810"> </a>
<a name="ln811">   public:</a>
<a name="ln812">      AddExcerpt(Excerpt* ex) : excerpt(ex) {}</a>
<a name="ln813">      virtual void undo(EditData*) override;</a>
<a name="ln814">      virtual void redo(EditData*) override;</a>
<a name="ln815">      UNDO_NAME(&quot;AddExcerpt&quot;)</a>
<a name="ln816">      };</a>
<a name="ln817"> </a>
<a name="ln818">//---------------------------------------------------------</a>
<a name="ln819">//   RemoveExcerpt</a>
<a name="ln820">//---------------------------------------------------------</a>
<a name="ln821"> </a>
<a name="ln822">class RemoveExcerpt : public UndoCommand {</a>
<a name="ln823">      Excerpt* excerpt;</a>
<a name="ln824"> </a>
<a name="ln825">   public:</a>
<a name="ln826">      RemoveExcerpt(Excerpt* ex) : excerpt(ex) {}</a>
<a name="ln827">      virtual void undo(EditData*) override;</a>
<a name="ln828">      virtual void redo(EditData*) override;</a>
<a name="ln829">      UNDO_NAME(&quot;RemoveExcerpt&quot;)</a>
<a name="ln830">      };</a>
<a name="ln831"> </a>
<a name="ln832">//---------------------------------------------------------</a>
<a name="ln833">//   SwapExcerpt</a>
<a name="ln834">//---------------------------------------------------------</a>
<a name="ln835"> </a>
<a name="ln836">class SwapExcerpt : public UndoCommand {</a>
<a name="ln837">      MasterScore* score;</a>
<a name="ln838">      int pos1;</a>
<a name="ln839">      int pos2;</a>
<a name="ln840"> </a>
<a name="ln841">      void flip(EditData*) override;</a>
<a name="ln842"> </a>
<a name="ln843">   public:</a>
<a name="ln844">      SwapExcerpt(MasterScore* s, int p1, int p2) : score(s), pos1(p1), pos2(p2) {}</a>
<a name="ln845">      UNDO_NAME(&quot;SwapExcerpt&quot;)</a>
<a name="ln846">      };</a>
<a name="ln847"> </a>
<a name="ln848">//---------------------------------------------------------</a>
<a name="ln849">//   ChangeExcerptTitle</a>
<a name="ln850">//---------------------------------------------------------</a>
<a name="ln851"> </a>
<a name="ln852">class ChangeExcerptTitle : public UndoCommand {</a>
<a name="ln853">      Excerpt* excerpt;</a>
<a name="ln854">      QString title;</a>
<a name="ln855"> </a>
<a name="ln856">      void flip(EditData*) override;</a>
<a name="ln857"> </a>
<a name="ln858">   public:</a>
<a name="ln859">      ChangeExcerptTitle(Excerpt* x, const QString&amp; t) : excerpt(x), title(t) {}</a>
<a name="ln860">      UNDO_NAME(&quot;ChangeExcerptTitle&quot;)</a>
<a name="ln861">      };</a>
<a name="ln862"> </a>
<a name="ln863">//---------------------------------------------------------</a>
<a name="ln864">//   ChangeBend</a>
<a name="ln865">//---------------------------------------------------------</a>
<a name="ln866"> </a>
<a name="ln867">class ChangeBend : public UndoCommand {</a>
<a name="ln868">      Bend* bend;</a>
<a name="ln869">      QList&lt;PitchValue&gt; points;</a>
<a name="ln870"> </a>
<a name="ln871">      void flip(EditData*) override;</a>
<a name="ln872"> </a>
<a name="ln873">   public:</a>
<a name="ln874">      ChangeBend(Bend* b, QList&lt;PitchValue&gt; p) : bend(b), points(p) {}</a>
<a name="ln875">      UNDO_NAME(&quot;ChangeBend&quot;)</a>
<a name="ln876">      };</a>
<a name="ln877"> </a>
<a name="ln878">//---------------------------------------------------------</a>
<a name="ln879">//   ChangeTremoloBar</a>
<a name="ln880">//---------------------------------------------------------</a>
<a name="ln881"> </a>
<a name="ln882">class ChangeTremoloBar : public UndoCommand {</a>
<a name="ln883">      TremoloBar* bend;</a>
<a name="ln884">      QList&lt;PitchValue&gt; points;</a>
<a name="ln885"> </a>
<a name="ln886">      void flip(EditData*) override;</a>
<a name="ln887"> </a>
<a name="ln888">   public:</a>
<a name="ln889">      ChangeTremoloBar(TremoloBar* b, QList&lt;PitchValue&gt; p) : bend(b), points(p) {}</a>
<a name="ln890">      UNDO_NAME(&quot;ChangeTremoloBar&quot;)</a>
<a name="ln891">      };</a>
<a name="ln892"> </a>
<a name="ln893">//---------------------------------------------------------</a>
<a name="ln894">//   ChangeNoteEvents</a>
<a name="ln895">//---------------------------------------------------------</a>
<a name="ln896"> </a>
<a name="ln897">class ChangeNoteEvents : public UndoCommand {</a>
<a name="ln898">      //Chord* chord;</a>
<a name="ln899">      QList&lt;NoteEvent*&gt; events;</a>
<a name="ln900"> </a>
<a name="ln901">      void flip(EditData*) override;</a>
<a name="ln902"> </a>
<a name="ln903">   public:</a>
<a name="ln904">      ChangeNoteEvents(Chord* /*n*/, const QList&lt;NoteEvent*&gt;&amp; l) : /*chord(n),*/ events(l) {}</a>
<a name="ln905">      UNDO_NAME(&quot;ChangeNoteEvents&quot;)</a>
<a name="ln906">      };</a>
<a name="ln907"> </a>
<a name="ln908">//---------------------------------------------------------</a>
<a name="ln909">//   ChangeNoteEventList</a>
<a name="ln910">//---------------------------------------------------------</a>
<a name="ln911"> </a>
<a name="ln912">class ChangeNoteEventList : public UndoCommand {</a>
<a name="ln913">      Ms::Note*      note;</a>
<a name="ln914">      NoteEventList  newEvents;</a>
<a name="ln915">      PlayEventType  newPetype;</a>
<a name="ln916"> </a>
<a name="ln917">      void flip(EditData*) override;</a>
<a name="ln918"> </a>
<a name="ln919">   public:</a>
<a name="ln920">      ChangeNoteEventList(Ms::Note* n, NoteEventList&amp; ne) :</a>
<a name="ln921">         note(n), newEvents(ne), newPetype(PlayEventType::User) {}</a>
<a name="ln922">      UNDO_NAME(&quot;ChangeNoteEventList&quot;)</a>
<a name="ln923">      };</a>
<a name="ln924"> </a>
<a name="ln925">//---------------------------------------------------------</a>
<a name="ln926">//   ChangeChordPlayEventType</a>
<a name="ln927">//---------------------------------------------------------</a>
<a name="ln928"> </a>
<a name="ln929">class ChangeChordPlayEventType : public UndoCommand {</a>
<a name="ln930">      Ms::Chord* chord;</a>
<a name="ln931">      Ms::PlayEventType petype;</a>
<a name="ln932">      QList&lt;NoteEventList&gt; events;</a>
<a name="ln933"> </a>
<a name="ln934">      void flip(EditData*) override;</a>
<a name="ln935"> </a>
<a name="ln936">   public:</a>
<a name="ln937">      ChangeChordPlayEventType(Chord* c, Ms::PlayEventType pet) : chord(c), petype(pet) { events = c-&gt;getNoteEventLists(); }</a>
<a name="ln938">      UNDO_NAME(&quot;ChangeChordPlayEventType&quot;)</a>
<a name="ln939">      };</a>
<a name="ln940"> </a>
<a name="ln941">//---------------------------------------------------------</a>
<a name="ln942">//   ChangeInstrument</a>
<a name="ln943">//    change instrument in an InstrumentChange element</a>
<a name="ln944">//---------------------------------------------------------</a>
<a name="ln945"> </a>
<a name="ln946">class ChangeInstrument : public UndoCommand {</a>
<a name="ln947">      InstrumentChange* is;</a>
<a name="ln948">      Instrument* instrument;</a>
<a name="ln949"> </a>
<a name="ln950">      void flip(EditData*) override;</a>
<a name="ln951"> </a>
<a name="ln952">   public:</a>
<a name="ln953">      ChangeInstrument(InstrumentChange* _is, Instrument* i) : is(_is), instrument(i) {}</a>
<a name="ln954">      UNDO_NAME(&quot;ChangeInstrument&quot;)</a>
<a name="ln955">      };</a>
<a name="ln956"> </a>
<a name="ln957">extern void updateNoteLines(Segment*, int track);</a>
<a name="ln958"> </a>
<a name="ln959">//---------------------------------------------------------</a>
<a name="ln960">//   SwapCR</a>
<a name="ln961">//---------------------------------------------------------</a>
<a name="ln962"> </a>
<a name="ln963">class SwapCR : public UndoCommand {</a>
<a name="ln964">      ChordRest* cr1;</a>
<a name="ln965">      ChordRest* cr2;</a>
<a name="ln966"> </a>
<a name="ln967">      void flip(EditData*) override;</a>
<a name="ln968"> </a>
<a name="ln969">   public:</a>
<a name="ln970">      SwapCR(ChordRest* a, ChordRest* b) : cr1(a), cr2(b) {}</a>
<a name="ln971">      UNDO_NAME(&quot;SwapCR&quot;)</a>
<a name="ln972">      };</a>
<a name="ln973"> </a>
<a name="ln974">//---------------------------------------------------------</a>
<a name="ln975">//   ChangeClefType</a>
<a name="ln976">//---------------------------------------------------------</a>
<a name="ln977"> </a>
<a name="ln978">class ChangeClefType : public UndoCommand {</a>
<a name="ln979">      Clef* clef;</a>
<a name="ln980">      ClefType concertClef;</a>
<a name="ln981">      ClefType transposingClef;</a>
<a name="ln982">      void flip(EditData*) override;</a>
<a name="ln983"> </a>
<a name="ln984">   public:</a>
<a name="ln985">      ChangeClefType(Clef*, ClefType cl, ClefType tc);</a>
<a name="ln986">      UNDO_NAME(&quot;ChangeClef&quot;)</a>
<a name="ln987">      };</a>
<a name="ln988"> </a>
<a name="ln989">//---------------------------------------------------------</a>
<a name="ln990">//   MoveStaff</a>
<a name="ln991">//---------------------------------------------------------</a>
<a name="ln992">#if 0 // commented out in mscore/instrwidget.cpp, not used anywhere else</a>
<a name="ln993">class MoveStaff : public UndoCommand {</a>
<a name="ln994">      Staff* staff;</a>
<a name="ln995">      Part* part;</a>
<a name="ln996">      int rstaff;</a>
<a name="ln997"> </a>
<a name="ln998">      void flip(EditData*) override;</a>
<a name="ln999"> </a>
<a name="ln1000">   public:</a>
<a name="ln1001">      MoveStaff(Staff* s, Part* p, int idx) : staff(s), part(p), rstaff(idx) {}</a>
<a name="ln1002">      UNDO_NAME(&quot;MoveStaff&quot;)</a>
<a name="ln1003">      };</a>
<a name="ln1004">#endif</a>
<a name="ln1005"> </a>
<a name="ln1006">//---------------------------------------------------------</a>
<a name="ln1007">//   ChangeProperty</a>
<a name="ln1008">//---------------------------------------------------------</a>
<a name="ln1009"> </a>
<a name="ln1010">class ChangeProperty : public UndoCommand {</a>
<a name="ln1011">   protected:</a>
<a name="ln1012">      ScoreElement* element;</a>
<a name="ln1013">      Pid id;</a>
<a name="ln1014">      QVariant property;</a>
<a name="ln1015">      PropertyFlags flags;</a>
<a name="ln1016"> </a>
<a name="ln1017">      void flip(EditData*) override;</a>
<a name="ln1018"> </a>
<a name="ln1019">   public:</a>
<a name="ln1020">      ChangeProperty(ScoreElement* e, Pid i, const QVariant&amp; v, PropertyFlags ps = PropertyFlags::NOSTYLE)</a>
<a name="ln1021">         : element(e), id(i), property(v), flags(ps) {}</a>
<a name="ln1022">      Pid getId() const  { return id; }</a>
<a name="ln1023">      ScoreElement* getElement() const { return element; }</a>
<a name="ln1024">      QVariant data() const { return property; }</a>
<a name="ln1025">      UNDO_NAME(&quot;ChangeProperty&quot;)</a>
<a name="ln1026"> </a>
<a name="ln1027">      bool isFiltered(UndoCommand::Filter f, const Element* target) const override</a>
<a name="ln1028">            {</a>
<a name="ln1029">            return f == UndoCommand::Filter::ChangePropertyLinked &amp;&amp; target-&gt;linkList().contains(element);</a>
<a name="ln1030">            }</a>
<a name="ln1031">      };</a>
<a name="ln1032"> </a>
<a name="ln1033">//---------------------------------------------------------</a>
<a name="ln1034">//   ChangeBracketProperty</a>
<a name="ln1035">//---------------------------------------------------------</a>
<a name="ln1036"> </a>
<a name="ln1037">class ChangeBracketProperty : public ChangeProperty {</a>
<a name="ln1038">      Staff* staff;</a>
<a name="ln1039">      int level;</a>
<a name="ln1040"> </a>
<a name="ln1041">      void flip(EditData*) override;</a>
<a name="ln1042"> </a>
<a name="ln1043">   public:</a>
<a name="ln1044">      ChangeBracketProperty(Staff* s, int l, Pid i, const QVariant&amp; v, PropertyFlags ps = PropertyFlags::NOSTYLE)</a>
<a name="ln1045">         : ChangeProperty(nullptr, i, v, ps), staff(s), level(l) {}</a>
<a name="ln1046">      UNDO_NAME(&quot;ChangeBracketProperty&quot;)</a>
<a name="ln1047">      };</a>
<a name="ln1048"> </a>
<a name="ln1049">//---------------------------------------------------------</a>
<a name="ln1050">//   ChangeMetaText</a>
<a name="ln1051">//---------------------------------------------------------</a>
<a name="ln1052"> </a>
<a name="ln1053">class ChangeMetaText : public UndoCommand {</a>
<a name="ln1054">      Score* score;</a>
<a name="ln1055">      QString id;</a>
<a name="ln1056">      QString text;</a>
<a name="ln1057"> </a>
<a name="ln1058">      void flip(EditData*) override;</a>
<a name="ln1059"> </a>
<a name="ln1060">   public:</a>
<a name="ln1061">      ChangeMetaText(Score* s, const QString&amp; i, const QString&amp; t) : score(s), id(i), text(t) {}</a>
<a name="ln1062">      UNDO_NAME(&quot;ChangeMetaText&quot;)</a>
<a name="ln1063">      };</a>
<a name="ln1064"> </a>
<a name="ln1065">//---------------------------------------------------------</a>
<a name="ln1066">//   ChangeSynthesizerState</a>
<a name="ln1067">//---------------------------------------------------------</a>
<a name="ln1068"> </a>
<a name="ln1069">class ChangeSynthesizerState : public UndoCommand {</a>
<a name="ln1070">      Score* score;</a>
<a name="ln1071">      SynthesizerState state;</a>
<a name="ln1072"> </a>
<a name="ln1073">      void flip(EditData*) override;</a>
<a name="ln1074"> </a>
<a name="ln1075">   public:</a>
<a name="ln1076">      ChangeSynthesizerState(Score* s, const SynthesizerState&amp; st) : score(s), state(st) {}</a>
<a name="ln1077">      UNDO_NAME(&quot;ChangeSynthesizerState&quot;)</a>
<a name="ln1078">      };</a>
<a name="ln1079"> </a>
<a name="ln1080">//---------------------------------------------------------</a>
<a name="ln1081">//   RemoveBracket</a>
<a name="ln1082">//---------------------------------------------------------</a>
<a name="ln1083"> </a>
<a name="ln1084">class RemoveBracket : public UndoCommand {</a>
<a name="ln1085">      Staff* staff;</a>
<a name="ln1086">      int level;</a>
<a name="ln1087">      BracketType type;</a>
<a name="ln1088">      int span;</a>
<a name="ln1089"> </a>
<a name="ln1090">      virtual void undo(EditData*) override;</a>
<a name="ln1091">      virtual void redo(EditData*) override;</a>
<a name="ln1092"> </a>
<a name="ln1093">   public:</a>
<a name="ln1094">      RemoveBracket(Staff* s, int l, BracketType t, int sp) : staff(s), level(l), type(t), span(sp) {}</a>
<a name="ln1095">      UNDO_NAME(&quot;RemoveBracket&quot;)</a>
<a name="ln1096">      };</a>
<a name="ln1097"> </a>
<a name="ln1098">//---------------------------------------------------------</a>
<a name="ln1099">//   AddBracket</a>
<a name="ln1100">//---------------------------------------------------------</a>
<a name="ln1101"> </a>
<a name="ln1102">class AddBracket : public UndoCommand {</a>
<a name="ln1103">      Staff* staff;</a>
<a name="ln1104">      int level;</a>
<a name="ln1105">      BracketType type;</a>
<a name="ln1106">      int span;</a>
<a name="ln1107"> </a>
<a name="ln1108">      virtual void undo(EditData*) override;</a>
<a name="ln1109">      virtual void redo(EditData*) override;</a>
<a name="ln1110"> </a>
<a name="ln1111">   public:</a>
<a name="ln1112">      AddBracket(Staff* s, int l, BracketType t, int sp) : staff(s), level(l), type(t), span(sp) {}</a>
<a name="ln1113">      UNDO_NAME(&quot;AddBracket&quot;)</a>
<a name="ln1114">      };</a>
<a name="ln1115"> </a>
<a name="ln1116">//---------------------------------------------------------</a>
<a name="ln1117">//   ChangeSpannerElements</a>
<a name="ln1118">//---------------------------------------------------------</a>
<a name="ln1119"> </a>
<a name="ln1120">class ChangeSpannerElements : public UndoCommand {</a>
<a name="ln1121">      Spanner* spanner;</a>
<a name="ln1122">      Element* startElement;</a>
<a name="ln1123">      Element* endElement;</a>
<a name="ln1124"> </a>
<a name="ln1125">      void flip(EditData*) override;</a>
<a name="ln1126"> </a>
<a name="ln1127">   public:</a>
<a name="ln1128">      ChangeSpannerElements(Spanner* s, Element* se, Element* ee)</a>
<a name="ln1129">         : spanner(s), startElement(se), endElement(ee) {}</a>
<a name="ln1130">      UNDO_NAME(&quot;ChangeSpannerElements&quot;)</a>
<a name="ln1131">      };</a>
<a name="ln1132"> </a>
<a name="ln1133">//---------------------------------------------------------</a>
<a name="ln1134">//   ChangeParent</a>
<a name="ln1135">//---------------------------------------------------------</a>
<a name="ln1136"> </a>
<a name="ln1137">class ChangeParent : public UndoCommand {</a>
<a name="ln1138">      Element* element;</a>
<a name="ln1139">      Element* parent;</a>
<a name="ln1140">      int staffIdx;</a>
<a name="ln1141"> </a>
<a name="ln1142">      void flip(EditData*) override;</a>
<a name="ln1143"> </a>
<a name="ln1144">   public:</a>
<a name="ln1145">      ChangeParent(Element* e, Element* p, int si) : element(e), parent(p), staffIdx(si) {}</a>
<a name="ln1146">      UNDO_NAME(&quot;ChangeParent&quot;)</a>
<a name="ln1147">      };</a>
<a name="ln1148"> </a>
<a name="ln1149">//---------------------------------------------------------</a>
<a name="ln1150">//   ChangeMMRest</a>
<a name="ln1151">//---------------------------------------------------------</a>
<a name="ln1152"> </a>
<a name="ln1153">class ChangeMMRest : public UndoCommand {</a>
<a name="ln1154">      Measure* m;</a>
<a name="ln1155">      Measure* mmrest;</a>
<a name="ln1156"> </a>
<a name="ln1157">      void flip(EditData*) override;</a>
<a name="ln1158"> </a>
<a name="ln1159">   public:</a>
<a name="ln1160">      ChangeMMRest(Measure* _m, Measure* _mmr) : m(_m), mmrest(_mmr) {}</a>
<a name="ln1161">      UNDO_NAME(&quot;ChangeMMRest&quot;)</a>
<a name="ln1162">      };</a>
<a name="ln1163"> </a>
<a name="ln1164">//---------------------------------------------------------</a>
<a name="ln1165">//   InsertTime</a>
<a name="ln1166">//---------------------------------------------------------</a>
<a name="ln1167"> </a>
<a name="ln1168">class InsertTime : public UndoCommand {</a>
<a name="ln1169">      Score* score;</a>
<a name="ln1170">      Fraction tick;</a>
<a name="ln1171">      Fraction len;</a>
<a name="ln1172"> </a>
<a name="ln1173">      void redo(EditData*) override;</a>
<a name="ln1174">      void undo(EditData*) override;</a>
<a name="ln1175"> </a>
<a name="ln1176">   public:</a>
<a name="ln1177">      InsertTime(Score* _score, const Fraction&amp; _tick, const Fraction&amp; _len)</a>
<a name="ln1178">         : score(_score), tick(_tick), len(_len) {}</a>
<a name="ln1179">      UNDO_NAME(&quot;InsertTime&quot;)</a>
<a name="ln1180">      };</a>
<a name="ln1181"> </a>
<a name="ln1182">//---------------------------------------------------------</a>
<a name="ln1183">//   InsertTimeUnmanagedSpanner</a>
<a name="ln1184">//---------------------------------------------------------</a>
<a name="ln1185"> </a>
<a name="ln1186">class InsertTimeUnmanagedSpanner : public UndoCommand {</a>
<a name="ln1187">      Score* score;</a>
<a name="ln1188">      Fraction tick;</a>
<a name="ln1189">      Fraction len;</a>
<a name="ln1190"> </a>
<a name="ln1191">      void flip(EditData*) override;</a>
<a name="ln1192"> </a>
<a name="ln1193">   public:</a>
<a name="ln1194">      InsertTimeUnmanagedSpanner(Score* s, const Fraction&amp; _tick, const Fraction&amp; _len)</a>
<a name="ln1195">         : score(s), tick(_tick), len(_len) {}</a>
<a name="ln1196">      UNDO_NAME(&quot;InsertTimeUnmanagedSpanner&quot;)</a>
<a name="ln1197">      };</a>
<a name="ln1198"> </a>
<a name="ln1199">//---------------------------------------------------------</a>
<a name="ln1200">//   ChangeNoteEvent</a>
<a name="ln1201">//---------------------------------------------------------</a>
<a name="ln1202"> </a>
<a name="ln1203">class ChangeNoteEvent : public UndoCommand {</a>
<a name="ln1204">      Note* note;</a>
<a name="ln1205">      NoteEvent* oldEvent;</a>
<a name="ln1206">      NoteEvent newEvent;</a>
<a name="ln1207">      PlayEventType  newPetype;</a>
<a name="ln1208"> </a>
<a name="ln1209">      void flip(EditData*) override;</a>
<a name="ln1210"> </a>
<a name="ln1211">   public:</a>
<a name="ln1212">      ChangeNoteEvent(Note* n, NoteEvent* oe, const NoteEvent&amp; ne)</a>
<a name="ln1213">         : note(n), oldEvent(oe), newEvent(ne), newPetype(PlayEventType::User) {}</a>
<a name="ln1214">      UNDO_NAME(&quot;ChangeNoteEvent&quot;)</a>
<a name="ln1215">      };</a>
<a name="ln1216"> </a>
<a name="ln1217">//---------------------------------------------------------</a>
<a name="ln1218">//   LinkUnlink</a>
<a name="ln1219">//---------------------------------------------------------</a>
<a name="ln1220"> </a>
<a name="ln1221">class LinkUnlink : public UndoCommand {</a>
<a name="ln1222">      bool mustDelete  { false };</a>
<a name="ln1223"> </a>
<a name="ln1224">   protected:</a>
<a name="ln1225">      LinkedElements* le;</a>
<a name="ln1226">      ScoreElement* e;</a>
<a name="ln1227"> </a>
<a name="ln1228">      void link();</a>
<a name="ln1229">      void unlink();</a>
<a name="ln1230"> </a>
<a name="ln1231">   public:</a>
<a name="ln1232">      LinkUnlink() {}</a>
<a name="ln1233">      ~LinkUnlink();</a>
<a name="ln1234">      };</a>
<a name="ln1235"> </a>
<a name="ln1236">//---------------------------------------------------------</a>
<a name="ln1237">//   Unlink</a>
<a name="ln1238">//---------------------------------------------------------</a>
<a name="ln1239"> </a>
<a name="ln1240">class Unlink : public LinkUnlink {</a>
<a name="ln1241">   public:</a>
<a name="ln1242">      Unlink(ScoreElement*);</a>
<a name="ln1243">      virtual void undo(EditData*) override { link(); }</a>
<a name="ln1244">      virtual void redo(EditData*) override { unlink(); }</a>
<a name="ln1245">      UNDO_NAME(&quot;Unlink&quot;)</a>
<a name="ln1246">      };</a>
<a name="ln1247"> </a>
<a name="ln1248">//---------------------------------------------------------</a>
<a name="ln1249">//   Link</a>
<a name="ln1250">//---------------------------------------------------------</a>
<a name="ln1251"> </a>
<a name="ln1252">class Link : public LinkUnlink {</a>
<a name="ln1253">   public:</a>
<a name="ln1254">      Link(ScoreElement*, ScoreElement*);</a>
<a name="ln1255">      virtual void undo(EditData*) override { unlink(); }</a>
<a name="ln1256">      virtual void redo(EditData*) override { link();   }</a>
<a name="ln1257">      UNDO_NAME(&quot;Link&quot;)</a>
<a name="ln1258"> </a>
<a name="ln1259">      bool isFiltered(UndoCommand::Filter f, const Element* target) const override;</a>
<a name="ln1260">      };</a>
<a name="ln1261"> </a>
<a name="ln1262">//---------------------------------------------------------</a>
<a name="ln1263">//   ChangeStartEndSpanner</a>
<a name="ln1264">//---------------------------------------------------------</a>
<a name="ln1265"> </a>
<a name="ln1266">class ChangeStartEndSpanner : public UndoCommand {</a>
<a name="ln1267">      Spanner* spanner;</a>
<a name="ln1268">      Element* start;</a>
<a name="ln1269">      Element* end;</a>
<a name="ln1270"> </a>
<a name="ln1271">      void flip(EditData*) override;</a>
<a name="ln1272"> </a>
<a name="ln1273">   public:</a>
<a name="ln1274">      ChangeStartEndSpanner(Spanner* sp, Element*s, Element*e) : spanner(sp), start(s), end(e) {}</a>
<a name="ln1275">      UNDO_NAME(&quot;ChangeStartEndSpanner&quot;)</a>
<a name="ln1276">      };</a>
<a name="ln1277"> </a>
<a name="ln1278">//---------------------------------------------------------</a>
<a name="ln1279">//   ChangeMetaTags</a>
<a name="ln1280">//---------------------------------------------------------</a>
<a name="ln1281"> </a>
<a name="ln1282">class ChangeMetaTags : public UndoCommand {</a>
<a name="ln1283">      Score* score;</a>
<a name="ln1284">      QMap&lt;QString,QString&gt; metaTags;</a>
<a name="ln1285"> </a>
<a name="ln1286">      void flip(EditData*) override;</a>
<a name="ln1287"> </a>
<a name="ln1288">   public:</a>
<a name="ln1289">      ChangeMetaTags(Score* s, const QMap&lt;QString,QString&gt;&amp; m) : score(s), metaTags(m) {}</a>
<a name="ln1290">      UNDO_NAME(&quot;ChangeMetaTags&quot;)</a>
<a name="ln1291">      };</a>
<a name="ln1292"> </a>
<a name="ln1293">//---------------------------------------------------------</a>
<a name="ln1294">//   ChangeDrumset</a>
<a name="ln1295">//---------------------------------------------------------</a>
<a name="ln1296"> </a>
<a name="ln1297">class ChangeDrumset : public UndoCommand {</a>
<a name="ln1298">      Instrument* instrument;</a>
<a name="ln1299">      Drumset drumset;</a>
<a name="ln1300"> </a>
<a name="ln1301">      void flip(EditData*) override;</a>
<a name="ln1302"> </a>
<a name="ln1303">   public:</a>
<a name="ln1304">      ChangeDrumset(Instrument* i, const Drumset* d) : instrument(i), drumset(*d) {}</a>
<a name="ln1305">      UNDO_NAME(&quot;ChangeDrumset&quot;)</a>
<a name="ln1306">      };</a>
<a name="ln1307"> </a>
<a name="ln1308">//---------------------------------------------------------</a>
<a name="ln1309">//   FretDot</a>
<a name="ln1310">//---------------------------------------------------------</a>
<a name="ln1311"> </a>
<a name="ln1312">class FretDot : public UndoCommand {</a>
<a name="ln1313">      FretDiagram* diagram;</a>
<a name="ln1314">      int string;</a>
<a name="ln1315">      int fret;</a>
<a name="ln1316">      bool add;</a>
<a name="ln1317">      FretDotType dtype;</a>
<a name="ln1318">      FretUndoData undoData;</a>
<a name="ln1319"> </a>
<a name="ln1320">      void redo(EditData*) override;</a>
<a name="ln1321">      void undo(EditData*) override;</a>
<a name="ln1322"> </a>
<a name="ln1323">   public:</a>
<a name="ln1324">      FretDot(FretDiagram* d, int _string, int _fret, bool _add = false, FretDotType _dtype = FretDotType::NORMAL)</a>
<a name="ln1325">         : diagram(d), string(_string), fret(_fret), add(_add), dtype(_dtype) {}</a>
<a name="ln1326">      UNDO_NAME(&quot;FretDot&quot;)</a>
<a name="ln1327">      };</a>
<a name="ln1328"> </a>
<a name="ln1329">//---------------------------------------------------------</a>
<a name="ln1330">//   FretMarker</a>
<a name="ln1331">//---------------------------------------------------------</a>
<a name="ln1332"> </a>
<a name="ln1333">class FretMarker : public UndoCommand {</a>
<a name="ln1334">      FretDiagram* diagram;</a>
<a name="ln1335">      int string;</a>
<a name="ln1336">      FretMarkerType mtype;</a>
<a name="ln1337">      FretUndoData undoData;</a>
<a name="ln1338"> </a>
<a name="ln1339">      void redo(EditData*) override;</a>
<a name="ln1340">      void undo(EditData*) override;</a>
<a name="ln1341"> </a>
<a name="ln1342">   public:</a>
<a name="ln1343">      FretMarker(FretDiagram* d, int _string, FretMarkerType _mtype) : diagram(d), string(_string), mtype(_mtype) {}</a>
<a name="ln1344">      UNDO_NAME(&quot;FretMarker&quot;)</a>
<a name="ln1345">      };</a>
<a name="ln1346"> </a>
<a name="ln1347">//---------------------------------------------------------</a>
<a name="ln1348">//   FretBarre</a>
<a name="ln1349">//---------------------------------------------------------</a>
<a name="ln1350"> </a>
<a name="ln1351">class FretBarre : public UndoCommand {</a>
<a name="ln1352">      FretDiagram* diagram;</a>
<a name="ln1353">      int string;</a>
<a name="ln1354">      int fret;</a>
<a name="ln1355">      bool add;</a>
<a name="ln1356">      FretUndoData undoData;</a>
<a name="ln1357"> </a>
<a name="ln1358">      void redo(EditData*) override;</a>
<a name="ln1359">      void undo(EditData*) override;</a>
<a name="ln1360"> </a>
<a name="ln1361">   public:</a>
<a name="ln1362">      FretBarre(FretDiagram* d, int _string, int _fret, bool _add = false) : diagram(d), string(_string), fret(_fret), add(_add) {}</a>
<a name="ln1363">      UNDO_NAME(&quot;FretBarre&quot;)</a>
<a name="ln1364">      };</a>
<a name="ln1365"> </a>
<a name="ln1366">//---------------------------------------------------------</a>
<a name="ln1367">//   FretClear</a>
<a name="ln1368">//---------------------------------------------------------</a>
<a name="ln1369"> </a>
<a name="ln1370">class FretClear : public UndoCommand {</a>
<a name="ln1371">      FretDiagram* diagram;</a>
<a name="ln1372">      FretUndoData undoData;</a>
<a name="ln1373"> </a>
<a name="ln1374">      void redo(EditData*) override;</a>
<a name="ln1375">      void undo(EditData*) override;</a>
<a name="ln1376"> </a>
<a name="ln1377">   public:</a>
<a name="ln1378">      FretClear(FretDiagram* d) : diagram(d) {}</a>
<a name="ln1379">      UNDO_NAME(&quot;FretClear&quot;)</a>
<a name="ln1380">      };</a>
<a name="ln1381"> </a>
<a name="ln1382">//---------------------------------------------------------</a>
<a name="ln1383">//   MoveTremolo</a>
<a name="ln1384">//---------------------------------------------------------</a>
<a name="ln1385"> </a>
<a name="ln1386">class MoveTremolo : public UndoCommand {</a>
<a name="ln1387">      Score* score;</a>
<a name="ln1388">      Fraction chord1Tick;</a>
<a name="ln1389">      Fraction chord2Tick;</a>
<a name="ln1390">      Tremolo* trem;</a>
<a name="ln1391">      int track;</a>
<a name="ln1392"> </a>
<a name="ln1393">      Chord* oldC1;</a>
<a name="ln1394">      Chord* oldC2;</a>
<a name="ln1395"> </a>
<a name="ln1396">      void undo(EditData*) override;</a>
<a name="ln1397">      void redo(EditData*) override;</a>
<a name="ln1398"> </a>
<a name="ln1399">   public:</a>
<a name="ln1400">      MoveTremolo(Score* s, Fraction c1, Fraction c2, Tremolo* tr, int t) : score(s), chord1Tick(c1), chord2Tick(c2), trem(tr), track(t) {}</a>
<a name="ln1401">      UNDO_NAME(&quot;MoveTremolo&quot;)</a>
<a name="ln1402">      };</a>
<a name="ln1403"> </a>
<a name="ln1404">}     // namespace Ms</a>
<a name="ln1405">#endif</a>

</code></pre>
<div class="balloon" rel="1232"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v730/" target="_blank">V730</a> Not all members of a class are initialized inside the constructor. Consider inspecting: le, e.</p></div>
<div class="balloon" rel="1400"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v730/" target="_blank">V730</a> Not all members of a class are initialized inside the constructor. Consider inspecting: oldC1, oldC2.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
