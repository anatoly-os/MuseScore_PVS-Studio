
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>prefsdialog.cpp</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">//=============================================================================</a>
<a name="ln2">//  MuseScore</a>
<a name="ln3">//  Music Composition &amp; Notation</a>
<a name="ln4">//</a>
<a name="ln5">//  Copyright (C) 2002-2017 Werner Schweer and others</a>
<a name="ln6">//</a>
<a name="ln7">//  This program is free software; you can redistribute it and/or modify</a>
<a name="ln8">//  it under the terms of the GNU General Public License version 2.</a>
<a name="ln9">//</a>
<a name="ln10">//  This program is distributed in the hope that it will be useful,</a>
<a name="ln11">//  but WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln12">//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</a>
<a name="ln13">//  GNU General Public License for more details.</a>
<a name="ln14">//</a>
<a name="ln15">//  You should have received a copy of the GNU General Public License</a>
<a name="ln16">//  along with this program; if not, write to the Free Software</a>
<a name="ln17">//  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</a>
<a name="ln18">//=============================================================================</a>
<a name="ln19"> </a>
<a name="ln20">#include &quot;musescore.h&quot;</a>
<a name="ln21">#include &quot;preferences.h&quot;</a>
<a name="ln22">#include &quot;prefsdialog.h&quot;</a>
<a name="ln23">#include &quot;seq.h&quot;</a>
<a name="ln24">#include &quot;shortcutcapturedialog.h&quot;</a>
<a name="ln25">#include &quot;scoreview.h&quot;</a>
<a name="ln26">#include &quot;pa.h&quot;</a>
<a name="ln27">#include &quot;shortcut.h&quot;</a>
<a name="ln28">#include &quot;workspace.h&quot;</a>
<a name="ln29"> </a>
<a name="ln30">#ifdef USE_PORTMIDI</a>
<a name="ln31">#include &quot;pm.h&quot;</a>
<a name="ln32">#endif</a>
<a name="ln33"> </a>
<a name="ln34">#include &quot;pathlistdialog.h&quot;</a>
<a name="ln35">#include &quot;resourceManager.h&quot;</a>
<a name="ln36">#include &quot;synthesizer/msynthesizer.h&quot;</a>
<a name="ln37"> </a>
<a name="ln38">namespace Ms {</a>
<a name="ln39"> </a>
<a name="ln40">//---------------------------------------------------------</a>
<a name="ln41">//   startPreferenceDialog</a>
<a name="ln42">//---------------------------------------------------------</a>
<a name="ln43"> </a>
<a name="ln44">void MuseScore::startPreferenceDialog()</a>
<a name="ln45">      {</a>
<a name="ln46">      if (!preferenceDialog) {</a>
<a name="ln47">            preferenceDialog = new PreferenceDialog(this);</a>
<a name="ln48">            connect(preferenceDialog, SIGNAL(preferencesChanged()),</a>
<a name="ln49">               SLOT(preferencesChanged()));</a>
<a name="ln50">            connect(preferenceDialog, SIGNAL(mixerPreferencesChanged(bool)),</a>
<a name="ln51">               SLOT(mixerPreferencesChanged(bool)));</a>
<a name="ln52">            }</a>
<a name="ln53">      preferenceDialog-&gt;start();</a>
<a name="ln54">      }</a>
<a name="ln55"> </a>
<a name="ln56">//---------------------------------------------------------</a>
<a name="ln57">//   PreferenceDialog</a>
<a name="ln58">//---------------------------------------------------------</a>
<a name="ln59"> </a>
<a name="ln60">PreferenceDialog::PreferenceDialog(QWidget* parent)</a>
<a name="ln61">   : AbstractDialog(parent)</a>
<a name="ln62">      {</a>
<a name="ln63">      setObjectName(&quot;PreferenceDialog&quot;);</a>
<a name="ln64">      setupUi(this);</a>
<a name="ln65">      setWindowFlags(this-&gt;windowFlags() &amp; ~Qt::WindowContextHelpButtonHint);</a>
<a name="ln66">      setModal(true);</a>
<a name="ln67">      shortcutsChanged        = false;</a>
<a name="ln68"> </a>
<a name="ln69">#ifndef USE_JACK</a>
<a name="ln70">      jackDriver-&gt;setVisible(false);</a>
<a name="ln71">#endif</a>
<a name="ln72">#ifndef USE_ALSA</a>
<a name="ln73">      alsaDriver-&gt;setVisible(false);</a>
<a name="ln74">      alsaDriver-&gt;setChecked(false);</a>
<a name="ln75">#else</a>
<a name="ln76">      alsaSampleRate-&gt;clear();</a>
<a name="ln77">      alsaSampleRate-&gt;addItem(tr(&quot;192000&quot;), 192000);</a>
<a name="ln78">      alsaSampleRate-&gt;addItem( tr(&quot;96000&quot;),  96000);</a>
<a name="ln79">      alsaSampleRate-&gt;addItem( tr(&quot;88200&quot;),  88200);</a>
<a name="ln80">      alsaSampleRate-&gt;addItem( tr(&quot;48000&quot;),  48000); // default</a>
<a name="ln81">      alsaSampleRate-&gt;addItem( tr(&quot;44100&quot;),  44100);</a>
<a name="ln82">      alsaSampleRate-&gt;addItem( tr(&quot;32000&quot;),  32000);</a>
<a name="ln83">      alsaSampleRate-&gt;addItem( tr(&quot;22050&quot;),  22050);</a>
<a name="ln84"> </a>
<a name="ln85">      alsaPeriodSize-&gt;clear();</a>
<a name="ln86">      alsaPeriodSize-&gt;addItem(tr(&quot;4096&quot;), 4096);</a>
<a name="ln87">      alsaPeriodSize-&gt;addItem(tr(&quot;2048&quot;), 2048);</a>
<a name="ln88">      alsaPeriodSize-&gt;addItem(tr(&quot;1024&quot;), 1024); // default</a>
<a name="ln89">      alsaPeriodSize-&gt;addItem( tr(&quot;512&quot;),  512);</a>
<a name="ln90">      alsaPeriodSize-&gt;addItem( tr(&quot;256&quot;),  256);</a>
<a name="ln91">      alsaPeriodSize-&gt;addItem( tr(&quot;128&quot;),  128);</a>
<a name="ln92">      alsaPeriodSize-&gt;addItem(  tr(&quot;64&quot;),   64);</a>
<a name="ln93">#endif</a>
<a name="ln94"> </a>
<a name="ln95">      exportAudioSampleRate-&gt;clear();</a>
<a name="ln96">      exportAudioSampleRate-&gt;addItem(tr(&quot;32000&quot;), 32000);</a>
<a name="ln97">      exportAudioSampleRate-&gt;addItem(tr(&quot;44100&quot;), 44100); // default</a>
<a name="ln98">      exportAudioSampleRate-&gt;addItem(tr(&quot;48000&quot;), 48000);</a>
<a name="ln99"> </a>
<a name="ln100">#ifndef USE_LAME</a>
<a name="ln101">      exportMp3BitRateLabel-&gt;setVisible(false);</a>
<a name="ln102">      exportMp3BitRate-&gt;setVisible(false);</a>
<a name="ln103">      exportMp3BitRateUnit-&gt;setVisible(false);</a>
<a name="ln104">#else</a>
<a name="ln105">      exportMp3BitRate-&gt;clear();</a>
<a name="ln106">      exportMp3BitRate-&gt;addItem( tr(&quot;32&quot;),  32);</a>
<a name="ln107">      exportMp3BitRate-&gt;addItem( tr(&quot;40&quot;),  40);</a>
<a name="ln108">      exportMp3BitRate-&gt;addItem( tr(&quot;48&quot;),  48);</a>
<a name="ln109">      exportMp3BitRate-&gt;addItem( tr(&quot;56&quot;),  56);</a>
<a name="ln110">      exportMp3BitRate-&gt;addItem( tr(&quot;64&quot;),  64);</a>
<a name="ln111">      exportMp3BitRate-&gt;addItem( tr(&quot;80&quot;),  80);</a>
<a name="ln112">      exportMp3BitRate-&gt;addItem( tr(&quot;96&quot;),  96);</a>
<a name="ln113">      exportMp3BitRate-&gt;addItem(tr(&quot;112&quot;), 112);</a>
<a name="ln114">      exportMp3BitRate-&gt;addItem(tr(&quot;128&quot;), 128); // default</a>
<a name="ln115">      exportMp3BitRate-&gt;addItem(tr(&quot;160&quot;), 160);</a>
<a name="ln116">      exportMp3BitRate-&gt;addItem(tr(&quot;192&quot;), 192);</a>
<a name="ln117">      exportMp3BitRate-&gt;addItem(tr(&quot;224&quot;), 224);</a>
<a name="ln118">      exportMp3BitRate-&gt;addItem(tr(&quot;256&quot;), 256);</a>
<a name="ln119">      exportMp3BitRate-&gt;addItem(tr(&quot;320&quot;), 320);</a>
<a name="ln120">#endif</a>
<a name="ln121"> </a>
<a name="ln122">#ifndef USE_PORTAUDIO</a>
<a name="ln123">      portaudioDriver-&gt;setVisible(false);</a>
<a name="ln124">#endif</a>
<a name="ln125">#ifndef USE_PORTMIDI</a>
<a name="ln126">      portMidiInput-&gt;setVisible(false);</a>
<a name="ln127">      portMidiInputLabel-&gt;setVisible(false);</a>
<a name="ln128">#endif</a>
<a name="ln129">#ifndef USE_PULSEAUDIO</a>
<a name="ln130">      pulseaudioDriver-&gt;setVisible(false);</a>
<a name="ln131">#endif</a>
<a name="ln132"> </a>
<a name="ln133">      tabIO-&gt;setEnabled(!noSeq);</a>
<a name="ln134"> </a>
<a name="ln135">      QButtonGroup* fgButtons = new QButtonGroup(this);</a>
<a name="ln136">      fgButtons-&gt;setExclusive(true);</a>
<a name="ln137">      fgButtons-&gt;addButton(fgColorButton);</a>
<a name="ln138">      fgButtons-&gt;addButton(fgWallpaperButton);</a>
<a name="ln139">      connect(fgColorButton, SIGNAL(toggled(bool)), SLOT(updateFgView(bool)));</a>
<a name="ln140"> </a>
<a name="ln141">      QButtonGroup* bgButtons = new QButtonGroup(this);</a>
<a name="ln142">      bgButtons-&gt;setExclusive(true);</a>
<a name="ln143">      bgButtons-&gt;addButton(bgColorButton);</a>
<a name="ln144">      bgButtons-&gt;addButton(bgWallpaperButton);</a>
<a name="ln145">      connect(bgColorButton, SIGNAL(toggled(bool)), SLOT(updateBgView(bool)));</a>
<a name="ln146"> </a>
<a name="ln147">      connect(buttonBox,          SIGNAL(clicked(QAbstractButton*)), SLOT(buttonBoxClicked(QAbstractButton*)));</a>
<a name="ln148">      connect(fgWallpaperSelect,  SIGNAL(clicked()), SLOT(selectFgWallpaper()));</a>
<a name="ln149">      connect(bgWallpaperSelect,  SIGNAL(clicked()), SLOT(selectBgWallpaper()));</a>
<a name="ln150"> </a>
<a name="ln151">      bgWallpaperSelect-&gt;setIcon(*icons[int(Icons::fileOpen_ICON)]);</a>
<a name="ln152">      fgWallpaperSelect-&gt;setIcon(*icons[int(Icons::fileOpen_ICON)]);</a>
<a name="ln153"> </a>
<a name="ln154">      connect(myScoresButton, SIGNAL(clicked()), SLOT(selectScoresDirectory()));</a>
<a name="ln155">      connect(myStylesButton, SIGNAL(clicked()), SLOT(selectStylesDirectory()));</a>
<a name="ln156">      connect(myTemplatesButton, SIGNAL(clicked()), SLOT(selectTemplatesDirectory()));</a>
<a name="ln157">      connect(myPluginsButton, SIGNAL(clicked()), SLOT(selectPluginsDirectory()));</a>
<a name="ln158">      connect(mySoundfontsButton, SIGNAL(clicked()), SLOT(changeSoundfontPaths()));</a>
<a name="ln159">      connect(myImagesButton, SIGNAL(clicked()), SLOT(selectImagesDirectory()));</a>
<a name="ln160">      connect(myExtensionsButton, SIGNAL(clicked()), SLOT(selectExtensionsDirectory()));</a>
<a name="ln161"> </a>
<a name="ln162">      myScoresButton-&gt;setIcon(*icons[int(Icons::fileOpen_ICON)]);</a>
<a name="ln163">      myStylesButton-&gt;setIcon(*icons[int(Icons::fileOpen_ICON)]);</a>
<a name="ln164">      myTemplatesButton-&gt;setIcon(*icons[int(Icons::fileOpen_ICON)]);</a>
<a name="ln165">      myPluginsButton-&gt;setIcon(*icons[int(Icons::fileOpen_ICON)]);</a>
<a name="ln166">      mySoundfontsButton-&gt;setIcon(*icons[int(Icons::edit_ICON)]);</a>
<a name="ln167">      myImagesButton-&gt;setIcon(*icons[int(Icons::fileOpen_ICON)]);</a>
<a name="ln168">      myExtensionsButton-&gt;setIcon(*icons[int(Icons::fileOpen_ICON)]);</a>
<a name="ln169"> </a>
<a name="ln170">      connect(updateTranslation, SIGNAL(clicked()), SLOT(updateTranslationClicked()));</a>
<a name="ln171"> </a>
<a name="ln172">      connect(defaultStyleButton,     SIGNAL(clicked()), SLOT(selectDefaultStyle()));</a>
<a name="ln173">      connect(partStyleButton,        SIGNAL(clicked()), SLOT(selectPartStyle()));</a>
<a name="ln174">      connect(styleFileButton,        SIGNAL(clicked()), SLOT(styleFileButtonClicked()));</a>
<a name="ln175">      connect(instrumentList1Button,  SIGNAL(clicked()), SLOT(selectInstrumentList1()));</a>
<a name="ln176">      connect(instrumentList2Button,  SIGNAL(clicked()), SLOT(selectInstrumentList2()));</a>
<a name="ln177">      connect(startWithButton,        SIGNAL(clicked()), SLOT(selectStartWith()));</a>
<a name="ln178"> </a>
<a name="ln179">      defaultStyleButton-&gt;setIcon(*icons[int(Icons::fileOpen_ICON)]);</a>
<a name="ln180">      partStyleButton-&gt;setIcon(*icons[int(Icons::fileOpen_ICON)]);</a>
<a name="ln181">      styleFileButton-&gt;setIcon(*icons[int(Icons::fileOpen_ICON)]);</a>
<a name="ln182">      instrumentList1Button-&gt;setIcon(*icons[int(Icons::fileOpen_ICON)]);</a>
<a name="ln183">      instrumentList2Button-&gt;setIcon(*icons[int(Icons::fileOpen_ICON)]);</a>
<a name="ln184">      startWithButton-&gt;setIcon(*icons[int(Icons::fileOpen_ICON)]);</a>
<a name="ln185"> </a>
<a name="ln186">      connect(shortcutList,   SIGNAL(itemActivated(QTreeWidgetItem*, int)), SLOT(defineShortcutClicked()));</a>
<a name="ln187">      connect(resetShortcut,  SIGNAL(clicked()), SLOT(resetShortcutClicked()));</a>
<a name="ln188">      connect(saveShortcutList,  SIGNAL(clicked()), SLOT(saveShortcutListClicked()));</a>
<a name="ln189">      connect(loadShortcutList,  SIGNAL(clicked()), SLOT(loadShortcutListClicked()));</a>
<a name="ln190">      connect(clearShortcut,  SIGNAL(clicked()), SLOT(clearShortcutClicked()));</a>
<a name="ln191">      connect(defineShortcut, SIGNAL(clicked()), SLOT(defineShortcutClicked()));</a>
<a name="ln192">      connect(resetToDefault, SIGNAL(clicked()), SLOT(resetAllValues()));</a>
<a name="ln193">      connect(filterShortcuts, SIGNAL(textChanged(const QString&amp;)), SLOT(filterShortcutsTextChanged(const QString &amp;)));</a>
<a name="ln194">      connect(printShortcuts, SIGNAL(clicked()), SLOT(printShortcutsClicked()));</a>
<a name="ln195"> </a>
<a name="ln196">      recordButtons = new QButtonGroup(this);</a>
<a name="ln197">      recordButtons-&gt;setExclusive(false);</a>
<a name="ln198">      recordButtons-&gt;addButton(recordRewind, RMIDI_REWIND);</a>
<a name="ln199">      recordButtons-&gt;addButton(recordTogglePlay,   RMIDI_TOGGLE_PLAY);</a>
<a name="ln200">      recordButtons-&gt;addButton(recordPlay,   RMIDI_PLAY);</a>
<a name="ln201">      recordButtons-&gt;addButton(recordStop,   RMIDI_STOP);</a>
<a name="ln202">      recordButtons-&gt;addButton(rcr2,         RMIDI_NOTE1);</a>
<a name="ln203">      recordButtons-&gt;addButton(rcr3,         RMIDI_NOTE2);</a>
<a name="ln204">      recordButtons-&gt;addButton(rcr4,         RMIDI_NOTE4);</a>
<a name="ln205">      recordButtons-&gt;addButton(rcr5,         RMIDI_NOTE8);</a>
<a name="ln206">      recordButtons-&gt;addButton(rcr6,         RMIDI_NOTE16);</a>
<a name="ln207">      recordButtons-&gt;addButton(rcr7,         RMIDI_NOTE32);</a>
<a name="ln208">      recordButtons-&gt;addButton(rcr8,         RMIDI_NOTE64);</a>
<a name="ln209">      recordButtons-&gt;addButton(rcr9,         RMIDI_REST);</a>
<a name="ln210">      recordButtons-&gt;addButton(rcr10,        RMIDI_DOT);</a>
<a name="ln211">      recordButtons-&gt;addButton(rcr11,        RMIDI_DOTDOT);</a>
<a name="ln212">      recordButtons-&gt;addButton(rcr12,        RMIDI_TIE);</a>
<a name="ln213">      recordButtons-&gt;addButton(recordUndo,   RMIDI_UNDO);</a>
<a name="ln214">      recordButtons-&gt;addButton(recordEditMode, RMIDI_NOTE_EDIT_MODE);</a>
<a name="ln215">      recordButtons-&gt;addButton(recordRealtimeAdvance, RMIDI_REALTIME_ADVANCE);</a>
<a name="ln216"> </a>
<a name="ln217">      connect(recordButtons,          SIGNAL(buttonClicked(int)), SLOT(recordButtonClicked(int)));</a>
<a name="ln218">      connect(midiRemoteControlClear, SIGNAL(clicked()), SLOT(midiRemoteControlClearClicked()));</a>
<a name="ln219">      connect(portaudioDriver, SIGNAL(toggled(bool)), SLOT(exclusiveAudioDriver(bool)));</a>
<a name="ln220">      connect(pulseaudioDriver, SIGNAL(toggled(bool)), SLOT(exclusiveAudioDriver(bool)));</a>
<a name="ln221">      connect(alsaDriver, SIGNAL(toggled(bool)), SLOT(exclusiveAudioDriver(bool)));</a>
<a name="ln222">      connect(jackDriver, SIGNAL(toggled(bool)), SLOT(exclusiveAudioDriver(bool)));</a>
<a name="ln223">      connect(useJackAudio, SIGNAL(toggled(bool)), SLOT(nonExclusiveJackDriver(bool)));</a>
<a name="ln224">      connect(useJackMidi,  SIGNAL(toggled(bool)), SLOT(nonExclusiveJackDriver(bool)));</a>
<a name="ln225">      connect(rescanDrivers, SIGNAL(clicked()), this, SLOT(restartAudioEngine()));</a>
<a name="ln226">      updateRemote();</a>
<a name="ln227"> </a>
<a name="ln228">      advancedWidget = new PreferencesListWidget();</a>
<a name="ln229">      QVBoxLayout* l = static_cast&lt;QVBoxLayout*&gt; (tabAdvanced-&gt;layout());</a>
<a name="ln230">      l-&gt;insertWidget(0, advancedWidget);</a>
<a name="ln231">      advancedWidget-&gt;loadPreferences();</a>
<a name="ln232">      connect(advancedSearch, &amp;QLineEdit::textChanged, this, &amp;PreferenceDialog::filterAdvancedPreferences);</a>
<a name="ln233">      connect(resetPreference, &amp;QPushButton::clicked, this, &amp;PreferenceDialog::resetAdvancedPreferenceToDefault);</a>
<a name="ln234"> </a>
<a name="ln235">      MuseScore::restoreGeometry(this);</a>
<a name="ln236">#if !defined(Q_OS_MAC) &amp;&amp; (!defined(Q_OS_WIN) || defined(FOR_WINSTORE))</a>
<a name="ln237">      General-&gt;removeTab(General-&gt;indexOf(tabUpdate)); // updateTab not needed on Linux and not wanted in Windows Store</a>
<a name="ln238">#endif</a>
<a name="ln239">      }</a>
<a name="ln240"> </a>
<a name="ln241">//---------------------------------------------------------</a>
<a name="ln242">//   start</a>
<a name="ln243">//---------------------------------------------------------</a>
<a name="ln244"> </a>
<a name="ln245">void PreferenceDialog::start()</a>
<a name="ln246">      {</a>
<a name="ln247">      updateValues();</a>
<a name="ln248">      show();</a>
<a name="ln249">      }</a>
<a name="ln250"> </a>
<a name="ln251">//---------------------------------------------------------</a>
<a name="ln252">//   ~PreferenceDialog</a>
<a name="ln253">//---------------------------------------------------------</a>
<a name="ln254"> </a>
<a name="ln255">PreferenceDialog::~PreferenceDialog()</a>
<a name="ln256">      {</a>
<a name="ln257">      qDeleteAll(localShortcuts);</a>
<a name="ln258">      }</a>
<a name="ln259"> </a>
<a name="ln260">//---------------------------------------------------------</a>
<a name="ln261">//   hideEvent</a>
<a name="ln262">//---------------------------------------------------------</a>
<a name="ln263"> </a>
<a name="ln264">void PreferenceDialog::hideEvent(QHideEvent* ev)</a>
<a name="ln265">      {</a>
<a name="ln266">      MuseScore::saveGeometry(this);</a>
<a name="ln267">      QWidget::hideEvent(ev);</a>
<a name="ln268">      }</a>
<a name="ln269"> </a>
<a name="ln270">//---------------------------------------------------------</a>
<a name="ln271">//   recordButtonClicked</a>
<a name="ln272">//---------------------------------------------------------</a>
<a name="ln273"> </a>
<a name="ln274">void PreferenceDialog::recordButtonClicked(int val)</a>
<a name="ln275">      {</a>
<a name="ln276">      for (QAbstractButton* b : recordButtons-&gt;buttons()) {</a>
<a name="ln277">            b-&gt;setChecked(recordButtons-&gt;id(b) == val);</a>
<a name="ln278">            }</a>
<a name="ln279">      mscore-&gt;setMidiRecordId(val);</a>
<a name="ln280">      }</a>
<a name="ln281"> </a>
<a name="ln282">//---------------------------------------------------------</a>
<a name="ln283">//   updateRemote</a>
<a name="ln284">//---------------------------------------------------------</a>
<a name="ln285"> </a>
<a name="ln286">void PreferenceDialog::updateRemote()</a>
<a name="ln287">      {</a>
<a name="ln288">      rewindActive-&gt;setChecked(preferences.midiRemote(RMIDI_REWIND).type != -1);</a>
<a name="ln289">      togglePlayActive-&gt;setChecked(preferences.midiRemote(RMIDI_TOGGLE_PLAY).type   != -1);</a>
<a name="ln290">      playActive-&gt;setChecked(preferences.midiRemote(RMIDI_PLAY).type         != -1);</a>
<a name="ln291">      stopActive-&gt;setChecked(preferences.midiRemote(RMIDI_STOP).type         != -1);</a>
<a name="ln292">      rca2-&gt;setChecked(preferences.midiRemote(RMIDI_NOTE1).type        != -1);</a>
<a name="ln293">      rca3-&gt;setChecked(preferences.midiRemote(RMIDI_NOTE2).type        != -1);</a>
<a name="ln294">      rca4-&gt;setChecked(preferences.midiRemote(RMIDI_NOTE4).type        != -1);</a>
<a name="ln295">      rca5-&gt;setChecked(preferences.midiRemote(RMIDI_NOTE8).type        != -1);</a>
<a name="ln296">      rca6-&gt;setChecked(preferences.midiRemote(RMIDI_NOTE16).type       != -1);</a>
<a name="ln297">      rca7-&gt;setChecked(preferences.midiRemote(RMIDI_NOTE32).type       != -1);</a>
<a name="ln298">      rca8-&gt;setChecked(preferences.midiRemote(RMIDI_NOTE64).type      != -1);</a>
<a name="ln299">      rca9-&gt;setChecked(preferences.midiRemote(RMIDI_REST).type        != -1);</a>
<a name="ln300">      rca10-&gt;setChecked(preferences.midiRemote(RMIDI_DOT).type         != -1);</a>
<a name="ln301">      rca11-&gt;setChecked(preferences.midiRemote(RMIDI_DOTDOT).type      != -1);</a>
<a name="ln302">      rca12-&gt;setChecked(preferences.midiRemote(RMIDI_TIE).type        != -1);</a>
<a name="ln303">      recordUndoActive-&gt;setChecked(preferences.midiRemote(RMIDI_UNDO).type != -1);</a>
<a name="ln304">      editModeActive-&gt;setChecked(preferences.midiRemote(RMIDI_NOTE_EDIT_MODE).type != -1);</a>
<a name="ln305">      realtimeAdvanceActive-&gt;setChecked(preferences.midiRemote(RMIDI_REALTIME_ADVANCE).type != -1);</a>
<a name="ln306"> </a>
<a name="ln307">      int id = mscore-&gt;midiRecordId();</a>
<a name="ln308">      recordRewind-&gt;setChecked(id == RMIDI_REWIND);</a>
<a name="ln309">      recordTogglePlay-&gt;setChecked(id == RMIDI_TOGGLE_PLAY);</a>
<a name="ln310">      recordPlay-&gt;setChecked(id == RMIDI_PLAY);</a>
<a name="ln311">      recordStop-&gt;setChecked(id == RMIDI_STOP);</a>
<a name="ln312">      rcr2-&gt;setChecked(id       == RMIDI_NOTE1);</a>
<a name="ln313">      rcr3-&gt;setChecked(id       == RMIDI_NOTE2);</a>
<a name="ln314">      rcr4-&gt;setChecked(id       == RMIDI_NOTE4);</a>
<a name="ln315">      rcr5-&gt;setChecked(id       == RMIDI_NOTE8);</a>
<a name="ln316">      rcr6-&gt;setChecked(id       == RMIDI_NOTE16);</a>
<a name="ln317">      rcr7-&gt;setChecked(id       == RMIDI_NOTE32);</a>
<a name="ln318">      rcr8-&gt;setChecked(id       == RMIDI_NOTE64);</a>
<a name="ln319">      rcr9-&gt;setChecked(id       == RMIDI_REST);</a>
<a name="ln320">      rcr10-&gt;setChecked(id      == RMIDI_DOT);</a>
<a name="ln321">      rcr11-&gt;setChecked(id      == RMIDI_DOTDOT);</a>
<a name="ln322">      rcr12-&gt;setChecked(id      == RMIDI_TIE);</a>
<a name="ln323">      recordUndo-&gt;setChecked(id == RMIDI_UNDO);</a>
<a name="ln324">      recordEditMode-&gt;setChecked(id == RMIDI_NOTE_EDIT_MODE);</a>
<a name="ln325">      recordRealtimeAdvance-&gt;setChecked(id == RMIDI_REALTIME_ADVANCE);</a>
<a name="ln326">      }</a>
<a name="ln327"> </a>
<a name="ln328">//---------------------------------------------------------</a>
<a name="ln329">//   updateValues</a>
<a name="ln330">//---------------------------------------------------------</a>
<a name="ln331"> </a>
<a name="ln332">void PreferenceDialog::updateValues(bool useDefaultValues)</a>
<a name="ln333">      {</a>
<a name="ln334">      if (useDefaultValues)</a>
<a name="ln335">            preferences.setReturnDefaultValuesMode(true);</a>
<a name="ln336"> </a>
<a name="ln337">      advancedWidget-&gt;updatePreferences();</a>
<a name="ln338"> </a>
<a name="ln339">      rcGroup-&gt;setChecked(preferences.getBool(PREF_IO_MIDI_USEREMOTECONTROL));</a>
<a name="ln340">      advanceOnRelease-&gt;setChecked(preferences.getBool(PREF_IO_MIDI_ADVANCEONRELEASE));</a>
<a name="ln341"> </a>
<a name="ln342">      fgWallpaper-&gt;setText(preferences.getString(PREF_UI_CANVAS_FG_WALLPAPER));</a>
<a name="ln343">      bgWallpaper-&gt;setText(preferences.getString(PREF_UI_CANVAS_BG_WALLPAPER));</a>
<a name="ln344"> </a>
<a name="ln345">      bool useBgColor = preferences.getBool(PREF_UI_CANVAS_BG_USECOLOR);</a>
<a name="ln346">      updateBgView(useBgColor);</a>
<a name="ln347"> </a>
<a name="ln348">      bool useFgColor = preferences.getBool(PREF_UI_CANVAS_FG_USECOLOR);</a>
<a name="ln349">      updateFgView(useFgColor);</a>
<a name="ln350"> </a>
<a name="ln351">      iconWidth-&gt;setValue(preferences.getInt(PREF_UI_THEME_ICONWIDTH));</a>
<a name="ln352">      iconHeight-&gt;setValue(preferences.getInt(PREF_UI_THEME_ICONHEIGHT));</a>
<a name="ln353">      </a>
<a name="ln354">      //macOS default fonts are not in QFontCombobox because they are &quot;private&quot;:</a>
<a name="ln355">      //https://code.woboq.org/qt5/qtbase/src/widgets/widgets/qfontcombobox.cpp.html#329</a>
<a name="ln356">      auto currFontFamily = preferences.getString(PREF_UI_THEME_FONTFAMILY);</a>
<a name="ln357">      if (-1 == fontFamily-&gt;findText(currFontFamily))</a>
<a name="ln358">            fontFamily-&gt;addItem(currFontFamily);</a>
<a name="ln359">      fontFamily-&gt;setCurrentIndex(fontFamily-&gt;findText(currFontFamily));</a>
<a name="ln360">      </a>
<a name="ln361">      fontSize-&gt;setValue(preferences.getInt(PREF_UI_THEME_FONTSIZE));</a>
<a name="ln362"> </a>
<a name="ln363">      enableMidiInput-&gt;setChecked(preferences.getBool(PREF_IO_MIDI_ENABLEINPUT));</a>
<a name="ln364">      realtimeDelay-&gt;setValue(preferences.getInt(PREF_IO_MIDI_REALTIMEDELAY));</a>
<a name="ln365">      playNotes-&gt;setChecked(preferences.getBool(PREF_SCORE_NOTE_PLAYONCLICK));</a>
<a name="ln366">      playChordOnAddNote-&gt;setChecked(preferences.getBool(PREF_SCORE_CHORD_PLAYONADDNOTE));</a>
<a name="ln367"> </a>
<a name="ln368">      checkUpdateStartup-&gt;setChecked(preferences.getBool(PREF_UI_APP_STARTUP_CHECKUPDATE));</a>
<a name="ln369"> </a>
<a name="ln370">      navigatorShow-&gt;setChecked(preferences.getBool(PREF_UI_APP_STARTUP_SHOWNAVIGATOR));</a>
<a name="ln371">      playPanelShow-&gt;setChecked(preferences.getBool(PREF_UI_APP_STARTUP_SHOWPLAYPANEL));</a>
<a name="ln372">      showSplashScreen-&gt;setChecked(preferences.getBool(PREF_UI_APP_STARTUP_SHOWSPLASHSCREEN));</a>
<a name="ln373">      showStartcenter-&gt;setChecked(preferences.getBool(PREF_UI_APP_STARTUP_SHOWSTARTCENTER));</a>
<a name="ln374">      showTours-&gt;setChecked(preferences.getBool(PREF_UI_APP_STARTUP_SHOWTOURS));</a>
<a name="ln375">      collectTelemetry-&gt;setChecked(preferences.getBool(PREF_APP_TELEMETRY_ALLOWED));</a>
<a name="ln376"> </a>
<a name="ln377">      alsaDriver-&gt;setChecked(preferences.getBool(PREF_IO_ALSA_USEALSAAUDIO));</a>
<a name="ln378">      jackDriver-&gt;setChecked(preferences.getBool(PREF_IO_JACK_USEJACKAUDIO) || preferences.getBool(PREF_IO_JACK_USEJACKMIDI));</a>
<a name="ln379">      useJackAudio-&gt;setChecked(preferences.getBool(PREF_IO_JACK_USEJACKAUDIO));</a>
<a name="ln380">      portaudioDriver-&gt;setChecked(preferences.getBool(PREF_IO_PORTAUDIO_USEPORTAUDIO));</a>
<a name="ln381">      pulseaudioDriver-&gt;setChecked(preferences.getBool(PREF_IO_PULSEAUDIO_USEPULSEAUDIO));</a>
<a name="ln382">      useJackMidi-&gt;setChecked(preferences.getBool(PREF_IO_JACK_USEJACKMIDI));</a>
<a name="ln383">      useJackTransport-&gt;setChecked(preferences.getBool(PREF_IO_JACK_USEJACKTRANSPORT));</a>
<a name="ln384">      becomeTimebaseMaster-&gt;setChecked(preferences.getBool(PREF_IO_JACK_TIMEBASEMASTER));</a>
<a name="ln385"> </a>
<a name="ln386">      alsaDevice-&gt;setText(preferences.getString(PREF_IO_ALSA_DEVICE));</a>
<a name="ln387"> </a>
<a name="ln388">      int index = alsaSampleRate-&gt;findData(preferences.getInt(PREF_IO_ALSA_SAMPLERATE));</a>
<a name="ln389">      alsaSampleRate-&gt;setCurrentIndex(index);</a>
<a name="ln390"> </a>
<a name="ln391">      index = alsaPeriodSize-&gt;findData(preferences.getInt(PREF_IO_ALSA_PERIODSIZE));</a>
<a name="ln392">      alsaPeriodSize-&gt;setCurrentIndex(index);</a>
<a name="ln393"> </a>
<a name="ln394">      alsaFragments-&gt;setValue(preferences.getInt(PREF_IO_ALSA_FRAGMENTS));</a>
<a name="ln395">      drawAntialiased-&gt;setChecked(preferences.getBool(PREF_UI_CANVAS_MISC_ANTIALIASEDDRAWING));</a>
<a name="ln396">      limitScrollArea-&gt;setChecked(preferences.getBool(PREF_UI_CANVAS_SCROLL_LIMITSCROLLAREA));</a>
<a name="ln397">      switch (preferences.sessionStart()) {</a>
<a name="ln398">            case SessionStart::EMPTY:  emptySession-&gt;setChecked(true); break;</a>
<a name="ln399">            case SessionStart::LAST:   lastSession-&gt;setChecked(true); break;</a>
<a name="ln400">            case SessionStart::NEW:    newSession-&gt;setChecked(true); break;</a>
<a name="ln401">            case SessionStart::SCORE:  scoreSession-&gt;setChecked(true); break;</a>
<a name="ln402">            }</a>
<a name="ln403">      sessionScore-&gt;setText(preferences.getString(PREF_APP_STARTUP_STARTSCORE));</a>
<a name="ln404">      expandRepeats-&gt;setChecked(preferences.getBool(PREF_IO_MIDI_EXPANDREPEATS));</a>
<a name="ln405">      normalize-&gt;setChecked(preferences.getBool(PREF_EXPORT_AUDIO_NORMALIZE));</a>
<a name="ln406">      exportRPNs-&gt;setChecked(preferences.getBool(PREF_IO_MIDI_EXPORTRPNS));</a>
<a name="ln407">      instrumentList1-&gt;setText(preferences.getString(PREF_APP_PATHS_INSTRUMENTLIST1));</a>
<a name="ln408">      instrumentList2-&gt;setText(preferences.getString(PREF_APP_PATHS_INSTRUMENTLIST2));</a>
<a name="ln409"> </a>
<a name="ln410">      importLayout-&gt;setChecked(preferences.getBool(PREF_IMPORT_MUSICXML_IMPORTLAYOUT));</a>
<a name="ln411">      importBreaks-&gt;setChecked(preferences.getBool(PREF_IMPORT_MUSICXML_IMPORTBREAKS));</a>
<a name="ln412">      QString resPref = preferences.getString(PREF_IMPORT_COMPATIBILITY_RESET_ELEMENT_POSITIONS);</a>
<a name="ln413">      if (resPref == &quot;No&quot;)</a>
<a name="ln414">            resetElementPositionsNo-&gt;setChecked(true);</a>
<a name="ln415">      else if (resPref == &quot;Yes&quot;)</a>
<a name="ln416">            resetElementPositionsYes-&gt;setChecked(true);</a>
<a name="ln417">      else // &quot;Ask&quot; or unset (or anything else)</a>
<a name="ln418">            resetElementPositionsAlwaysAsk-&gt;setChecked(true);</a>
<a name="ln419">      if (preferences.getBool(PREF_EXPORT_MUSICXML_EXPORTLAYOUT)) {</a>
<a name="ln420">            exportAllLayouts-&gt;setChecked(true);</a>
<a name="ln421">            }</a>
<a name="ln422">      else {</a>
<a name="ln423">            switch(preferences.musicxmlExportBreaks()) {</a>
<a name="ln424">                  case MusicxmlExportBreaks::ALL:     exportAllBreaks-&gt;setChecked(true); break;</a>
<a name="ln425">                  case MusicxmlExportBreaks::MANUAL:  exportManualBreaks-&gt;setChecked(true); break;</a>
<a name="ln426">                  case MusicxmlExportBreaks::NO:      exportNoBreaks-&gt;setChecked(true); break;</a>
<a name="ln427">                  }</a>
<a name="ln428">            }</a>
<a name="ln429"> </a>
<a name="ln430">      rememberLastMidiConnections-&gt;setChecked(preferences.getBool(PREF_IO_JACK_REMEMBERLASTCONNECTIONS));</a>
<a name="ln431">      proximity-&gt;setValue(preferences.getInt(PREF_UI_CANVAS_MISC_SELECTIONPROXIMITY));</a>
<a name="ln432">      autoSave-&gt;setChecked(preferences.getBool(PREF_APP_AUTOSAVE_USEAUTOSAVE));</a>
<a name="ln433">      autoSaveTime-&gt;setValue(preferences.getInt(PREF_APP_AUTOSAVE_AUTOSAVETIME));</a>
<a name="ln434">      pngResolution-&gt;setValue(preferences.getDouble(PREF_EXPORT_PNG_RESOLUTION));</a>
<a name="ln435">      pngTransparent-&gt;setChecked(preferences.getBool(PREF_EXPORT_PNG_USETRANSPARENCY));</a>
<a name="ln436">      language-&gt;blockSignals(true);</a>
<a name="ln437">      for (int i = 0; i &lt; language-&gt;count(); ++i) {</a>
<a name="ln438">            if (language-&gt;itemText(i).startsWith(preferences.getString(PREF_UI_APP_LANGUAGE))) {</a>
<a name="ln439">                  language-&gt;setCurrentIndex(i);</a>
<a name="ln440">                  break;</a>
<a name="ln441">                  }</a>
<a name="ln442">            }</a>
<a name="ln443">      language-&gt;blockSignals(false);</a>
<a name="ln444"> </a>
<a name="ln445">      //</a>
<a name="ln446">      // initialize local shortcut table</a>
<a name="ln447">      //    we need a deep copy to be able to rewind all</a>
<a name="ln448">      //    changes on &quot;Abort&quot;</a>
<a name="ln449">      //</a>
<a name="ln450">      qDeleteAll(localShortcuts);</a>
<a name="ln451">      localShortcuts.clear();</a>
<a name="ln452">      for(const Shortcut* s : Shortcut::shortcuts())</a>
<a name="ln453">            localShortcuts[s-&gt;key()] = new Shortcut(*s);</a>
<a name="ln454">      updateSCListView();</a>
<a name="ln455"> </a>
<a name="ln456">      //Generate the filtered Shortcut List</a>
<a name="ln457">      filterShortcutsTextChanged(filterShortcuts-&gt;text());</a>
<a name="ln458"> </a>
<a name="ln459">      //</a>
<a name="ln460">      // initialize portaudio</a>
<a name="ln461">      //</a>
<a name="ln462">#ifdef USE_PORTAUDIO</a>
<a name="ln463">      if (portAudioIsUsed) {</a>
<a name="ln464">            Portaudio* audio = static_cast&lt;Portaudio*&gt;(seq-&gt;driver());</a>
<a name="ln465">            if (audio) {</a>
<a name="ln466">                  QStringList apis = audio-&gt;apiList();</a>
<a name="ln467">                  portaudioApi-&gt;clear();</a>
<a name="ln468">                  portaudioApi-&gt;addItems(apis);</a>
<a name="ln469">                  portaudioApi-&gt;setCurrentIndex(audio-&gt;currentApi());</a>
<a name="ln470"> </a>
<a name="ln471">                  QStringList devices = audio-&gt;deviceList(audio-&gt;currentApi());</a>
<a name="ln472">                  portaudioDevice-&gt;clear();</a>
<a name="ln473">                  portaudioDevice-&gt;addItems(devices);</a>
<a name="ln474">                  portaudioDevice-&gt;setCurrentIndex(audio-&gt;currentDevice());</a>
<a name="ln475"> </a>
<a name="ln476">                  connect(portaudioApi, SIGNAL(activated(int)), SLOT(portaudioApiActivated(int)));</a>
<a name="ln477">#ifdef USE_PORTMIDI</a>
<a name="ln478">                  PortMidiDriver* midiDriver = static_cast&lt;PortMidiDriver*&gt;(audio-&gt;mididriver());</a>
<a name="ln479">                  if (midiDriver) {</a>
<a name="ln480">                        QStringList midiInputs = midiDriver-&gt;deviceInList();</a>
<a name="ln481">                        int curMidiInIdx = 0;</a>
<a name="ln482">                        portMidiInput-&gt;clear();</a>
<a name="ln483">                        for(int i = 0; i &lt; midiInputs.size(); ++i) {</a>
<a name="ln484">                              portMidiInput-&gt;addItem(midiInputs.at(i), i);</a>
<a name="ln485">                              if (midiInputs.at(i) == preferences.getString(PREF_IO_PORTMIDI_INPUTDEVICE))</a>
<a name="ln486">                                    curMidiInIdx = i;</a>
<a name="ln487">                              }</a>
<a name="ln488">                        portMidiInput-&gt;setCurrentIndex(curMidiInIdx);</a>
<a name="ln489"> </a>
<a name="ln490">                        QStringList midiOutputs = midiDriver-&gt;deviceOutList();</a>
<a name="ln491">                        int curMidiOutIdx = -1; // do not set a midi out device if user never selected one</a>
<a name="ln492">                        portMidiOutput-&gt;clear();</a>
<a name="ln493">                        portMidiOutput-&gt;addItem(&quot;&quot;, -1);</a>
<a name="ln494">                        for(int i = 0; i &lt; midiOutputs.size(); ++i) {</a>
<a name="ln495">                              portMidiOutput-&gt;addItem(midiOutputs.at(i), i);</a>
<a name="ln496">                              if (midiOutputs.at(i) == preferences.getString(PREF_IO_PORTMIDI_OUTPUTDEVICE))</a>
<a name="ln497">                                    curMidiOutIdx = i + 1;</a>
<a name="ln498">                              }</a>
<a name="ln499">                        portMidiOutput-&gt;setCurrentIndex(curMidiOutIdx);</a>
<a name="ln500"> </a>
<a name="ln501">                        portMidiOutputLatencyMilliseconds-&gt;setValue(preferences.getInt(PREF_IO_PORTMIDI_OUTPUTLATENCYMILLISECONDS));</a>
<a name="ln502">                        }</a>
<a name="ln503">#endif</a>
<a name="ln504">                  }</a>
<a name="ln505">            }</a>
<a name="ln506">#endif</a>
<a name="ln507"> </a>
<a name="ln508">#ifndef HAS_MIDI</a>
<a name="ln509">      enableMidiInput-&gt;setEnabled(false);</a>
<a name="ln510">      rcGroup-&gt;setEnabled(false);</a>
<a name="ln511">#endif</a>
<a name="ln512"> </a>
<a name="ln513">      //</a>
<a name="ln514">      // score settings</a>
<a name="ln515">      //</a>
<a name="ln516">      scale-&gt;setValue(preferences.getDouble(PREF_SCORE_MAGNIFICATION) * 100.0);</a>
<a name="ln517">      showMidiControls-&gt;setChecked(preferences.getBool(PREF_IO_MIDI_SHOWCONTROLSINMIXER));</a>
<a name="ln518"> </a>
<a name="ln519">      defaultPlayDuration-&gt;setValue(preferences.getInt(PREF_SCORE_NOTE_DEFAULTPLAYDURATION));</a>
<a name="ln520"> </a>
<a name="ln521">      int shortestNoteIndex = 2;</a>
<a name="ln522">      int nn = (preferences.getInt(PREF_IO_MIDI_SHORTESTNOTE) * 16)/MScore::division;</a>
<a name="ln523">      switch(nn) {</a>
<a name="ln524">            case 16: shortestNoteIndex = 0; break;</a>
<a name="ln525">            case 8:  shortestNoteIndex = 1; break;</a>
<a name="ln526">            case 4:  shortestNoteIndex = 2; break;</a>
<a name="ln527">            case 2:  shortestNoteIndex = 3; break;</a>
<a name="ln528">            case 1:  shortestNoteIndex = 4; break;</a>
<a name="ln529">            }</a>
<a name="ln530">      shortestNote-&gt;setCurrentIndex(shortestNoteIndex);</a>
<a name="ln531"> </a>
<a name="ln532">      QString styleFile = preferences.getString(PREF_IMPORT_STYLE_STYLEFILE);</a>
<a name="ln533">      importStyleFile-&gt;setText(styleFile);</a>
<a name="ln534">      useImportBuiltinStyle-&gt;setChecked(styleFile.isEmpty());</a>
<a name="ln535">      useImportStyleFile-&gt;setChecked(!styleFile.isEmpty());</a>
<a name="ln536"> </a>
<a name="ln537">      QList&lt;QByteArray&gt; charsets = QTextCodec::availableCodecs();</a>
<a name="ln538">      qSort(charsets.begin(), charsets.end());</a>
<a name="ln539">      int idx = 0;</a>
<a name="ln540">      importCharsetListOve-&gt;clear();</a>
<a name="ln541">      importCharsetListGP-&gt;clear();</a>
<a name="ln542">      for (QByteArray charset : charsets) {</a>
<a name="ln543">            importCharsetListOve-&gt;addItem(charset);</a>
<a name="ln544">            importCharsetListGP-&gt;addItem(charset);</a>
<a name="ln545">            if (charset == preferences.getString(PREF_IMPORT_OVERTURE_CHARSET))</a>
<a name="ln546">                  importCharsetListOve-&gt;setCurrentIndex(idx);</a>
<a name="ln547">            if (charset == preferences.getString(PREF_IMPORT_GUITARPRO_CHARSET))</a>
<a name="ln548">                  importCharsetListGP-&gt;setCurrentIndex(idx);</a>
<a name="ln549">            idx++;</a>
<a name="ln550">            }</a>
<a name="ln551"> </a>
<a name="ln552">      warnPitchRange-&gt;setChecked(preferences.getBool(PREF_SCORE_NOTE_WARNPITCHRANGE));</a>
<a name="ln553"> </a>
<a name="ln554">      language-&gt;blockSignals(true);</a>
<a name="ln555">      language-&gt;clear();</a>
<a name="ln556">      QString lang = preferences.getString(PREF_UI_APP_LANGUAGE);</a>
<a name="ln557">      int curIdx = 0;</a>
<a name="ln558">      for(int i = 0; i &lt; mscore-&gt;languages().size(); ++i) {</a>
<a name="ln559">            language-&gt;addItem(mscore-&gt;languages().at(i).name, i);</a>
<a name="ln560">            if (mscore-&gt;languages().at(i).key == lang)</a>
<a name="ln561">                  curIdx = i;</a>
<a name="ln562">            }</a>
<a name="ln563">      language-&gt;setCurrentIndex(curIdx);</a>
<a name="ln564">      language-&gt;blockSignals(false);</a>
<a name="ln565"> </a>
<a name="ln566">      oscServer-&gt;setChecked(preferences.getBool(PREF_IO_OSC_USEREMOTECONTROL));</a>
<a name="ln567">      oscPort-&gt;setValue(preferences.getInt(PREF_IO_OSC_PORTNUMBER));</a>
<a name="ln568"> </a>
<a name="ln569">      styleName-&gt;setCurrentIndex(int(preferences.globalStyle()));</a>
<a name="ln570">      defaultStyle-&gt;setText(preferences.getString(PREF_SCORE_STYLE_DEFAULTSTYLEFILE));</a>
<a name="ln571">      partStyle-&gt;setText(preferences.getString(PREF_SCORE_STYLE_PARTSTYLEFILE));</a>
<a name="ln572"> </a>
<a name="ln573">      myScores-&gt;setText(preferences.getString(PREF_APP_PATHS_MYSCORES));</a>
<a name="ln574">      myStyles-&gt;setText(preferences.getString(PREF_APP_PATHS_MYSTYLES));</a>
<a name="ln575">      myImages-&gt;setText(preferences.getString(PREF_APP_PATHS_MYIMAGES));</a>
<a name="ln576">      myTemplates-&gt;setText(preferences.getString(PREF_APP_PATHS_MYTEMPLATES));</a>
<a name="ln577">      myPlugins-&gt;setText(preferences.getString(PREF_APP_PATHS_MYPLUGINS));</a>
<a name="ln578">      mySoundfonts-&gt;setText(preferences.getString(PREF_APP_PATHS_MYSOUNDFONTS));</a>
<a name="ln579">      myExtensions-&gt;setText(preferences.getString(PREF_APP_PATHS_MYEXTENSIONS));</a>
<a name="ln580"> </a>
<a name="ln581">      index = exportAudioSampleRate-&gt;findData(preferences.getInt(PREF_EXPORT_AUDIO_SAMPLERATE));</a>
<a name="ln582">      exportAudioSampleRate-&gt;setCurrentIndex(index);</a>
<a name="ln583"> </a>
<a name="ln584">      index = exportMp3BitRate-&gt;findData(preferences.getInt(PREF_EXPORT_MP3_BITRATE));</a>
<a name="ln585">      exportMp3BitRate-&gt;setCurrentIndex(index);</a>
<a name="ln586"> </a>
<a name="ln587">      exportPdfDpi-&gt;setValue(preferences.getInt(PREF_EXPORT_PDF_DPI));</a>
<a name="ln588">      pageVertical-&gt;setChecked(MScore::verticalOrientation());</a>
<a name="ln589"> </a>
<a name="ln590">      if (useDefaultValues)</a>
<a name="ln591">            preferences.setReturnDefaultValuesMode(false);</a>
<a name="ln592">}</a>
<a name="ln593"> </a>
<a name="ln594">//---------------------------------------------------------</a>
<a name="ln595">//   portaudioApiActivated</a>
<a name="ln596">//---------------------------------------------------------</a>
<a name="ln597"> </a>
<a name="ln598">#ifdef USE_PORTAUDIO</a>
<a name="ln599">void PreferenceDialog::portaudioApiActivated(int idx)</a>
<a name="ln600">      {</a>
<a name="ln601">      Portaudio* audio = static_cast&lt;Portaudio*&gt;(seq-&gt;driver());</a>
<a name="ln602">      QStringList devices = audio-&gt;deviceList(idx);</a>
<a name="ln603">      portaudioDevice-&gt;clear();</a>
<a name="ln604">      portaudioDevice-&gt;addItems(devices);</a>
<a name="ln605">      }</a>
<a name="ln606">#else</a>
<a name="ln607">void PreferenceDialog::portaudioApiActivated(int)  {}</a>
<a name="ln608">#endif</a>
<a name="ln609"> </a>
<a name="ln610">//---------------------------------------------------------</a>
<a name="ln611">//   ShortcutItem</a>
<a name="ln612">//---------------------------------------------------------</a>
<a name="ln613"> </a>
<a name="ln614">bool ShortcutItem::operator&lt;(const QTreeWidgetItem&amp; item) const</a>
<a name="ln615">      {</a>
<a name="ln616"> </a>
<a name="ln617">      const QTreeWidget * pTree =treeWidget ();</a>
<a name="ln618">      int column   = pTree ? pTree-&gt;sortColumn() : 0;</a>
<a name="ln619">      return QString::localeAwareCompare(text(column).toLower(), item.text(column).toLower()) &gt; 0;</a>
<a name="ln620">      }</a>
<a name="ln621"> </a>
<a name="ln622">//---------------------------------------------------------</a>
<a name="ln623">//   updateSCListView</a>
<a name="ln624">//---------------------------------------------------------</a>
<a name="ln625"> </a>
<a name="ln626">void PreferenceDialog::updateSCListView()</a>
<a name="ln627">      {</a>
<a name="ln628">      shortcutList-&gt;clear();</a>
<a name="ln629">      for (Shortcut* s : localShortcuts) {</a>
<a name="ln630">            if (!s)</a>
<a name="ln631">                  continue;</a>
<a name="ln632">            ShortcutItem* newItem = new ShortcutItem;</a>
<a name="ln633">            newItem-&gt;setText(0, s-&gt;descr());</a>
<a name="ln634">            if (s-&gt;icon() != Icons::Invalid_ICON)</a>
<a name="ln635">                  newItem-&gt;setIcon(0, *icons[int(s-&gt;icon())]);</a>
<a name="ln636">            newItem-&gt;setText(1, s-&gt;keysToString());</a>
<a name="ln637">            newItem-&gt;setData(0, Qt::UserRole, s-&gt;key());</a>
<a name="ln638">            QString accessibleInfo = tr(&quot;Action: %1; Shortcut: %2&quot;)</a>
<a name="ln639">               .arg(newItem-&gt;text(0)).arg(newItem-&gt;text(1).isEmpty()</a>
<a name="ln640">                  ? tr(&quot;No shortcut defined&quot;) : newItem-&gt;text(1));</a>
<a name="ln641">            newItem-&gt;setData(0, Qt::AccessibleTextRole, accessibleInfo);</a>
<a name="ln642">            newItem-&gt;setData(1, Qt::AccessibleTextRole, accessibleInfo);</a>
<a name="ln643">            if (enableExperimental</a>
<a name="ln644">                        || (!s-&gt;key().startsWith(&quot;media&quot;)</a>
<a name="ln645">                            &amp;&amp; !s-&gt;key().startsWith(&quot;layer&quot;)</a>
<a name="ln646">#ifdef NDEBUG</a>
<a name="ln647">                            &amp;&amp; !s-&gt;key().startsWith(&quot;debugger&quot;)</a>
<a name="ln648">#endif</a>
<a name="ln649">                            &amp;&amp; !s-&gt;key().startsWith(&quot;edit_harmony&quot;)</a>
<a name="ln650">                            &amp;&amp; !s-&gt;key().startsWith(&quot;insert-fretframe&quot;))) {</a>
<a name="ln651">                  shortcutList-&gt;addTopLevelItem(newItem);</a>
<a name="ln652">                  }</a>
<a name="ln653">            }</a>
<a name="ln654">      shortcutList-&gt;resizeColumnToContents(0);</a>
<a name="ln655">      }</a>
<a name="ln656"> </a>
<a name="ln657">//---------------------------------------------------------</a>
<a name="ln658">//   resetShortcutClicked</a>
<a name="ln659">//    reset selected shortcut to buildin default</a>
<a name="ln660">//---------------------------------------------------------</a>
<a name="ln661"> </a>
<a name="ln662">void PreferenceDialog::resetShortcutClicked()</a>
<a name="ln663">      {</a>
<a name="ln664">      QTreeWidgetItem* active = shortcutList-&gt;currentItem();</a>
<a name="ln665">      if (!active)</a>
<a name="ln666">            return;</a>
<a name="ln667">      QString str = active-&gt;data(0, Qt::UserRole).toString();</a>
<a name="ln668">      if (str.isEmpty())</a>
<a name="ln669">            return;</a>
<a name="ln670">      Shortcut* shortcut = localShortcuts[str.toLatin1().data()];</a>
<a name="ln671"> </a>
<a name="ln672">      shortcut-&gt;reset();</a>
<a name="ln673"> </a>
<a name="ln674">      active-&gt;setText(1, shortcut-&gt;keysToString());</a>
<a name="ln675">      shortcutsChanged = true;</a>
<a name="ln676">      }</a>
<a name="ln677"> </a>
<a name="ln678">void PreferenceDialog::saveShortcutListClicked()</a>
<a name="ln679">      {</a>
<a name="ln680">      QString saveFileName = QFileDialog::getSaveFileName(this, tr(&quot;Save Shortcuts&quot;), preferences.getString(PREF_APP_PATHS_MYSHORTCUTS) + &quot;/shortcuts.xml&quot;, tr(&quot;MuseScore Shortcuts File&quot;) + &quot; (*.xml)&quot;, 0, preferences.getBool(PREF_UI_APP_USENATIVEDIALOGS) ? QFileDialog::Options() : QFileDialog::DontUseNativeDialog);</a>
<a name="ln681">      preferences.setPreference(PREF_APP_PATHS_MYSHORTCUTS, saveFileName);</a>
<a name="ln682">      Shortcut::saveToNewFile(saveFileName);</a>
<a name="ln683">      }</a>
<a name="ln684"> </a>
<a name="ln685">void PreferenceDialog::loadShortcutListClicked()</a>
<a name="ln686">      {</a>
<a name="ln687">      QString loadFileName = QFileDialog::getOpenFileName(this, tr(&quot;Load Shortcuts&quot;), preferences.getString(PREF_APP_PATHS_MYSHORTCUTS), tr(&quot;MuseScore Shortcuts File&quot;) +  &quot; (*.xml)&quot;, 0, preferences.getBool(PREF_UI_APP_USENATIVEDIALOGS) ? QFileDialog::Options() : QFileDialog::DontUseNativeDialog);</a>
<a name="ln688">      if (!loadFileName.isNull()) {</a>
<a name="ln689">            preferences.setPreference(PREF_APP_PATHS_MYSHORTCUTS, loadFileName);</a>
<a name="ln690">            Shortcut::loadFromNewFile(loadFileName);</a>
<a name="ln691">            }</a>
<a name="ln692">      }</a>
<a name="ln693"> </a>
<a name="ln694">//---------------------------------------------------------</a>
<a name="ln695">//   clearShortcutClicked</a>
<a name="ln696">//---------------------------------------------------------</a>
<a name="ln697"> </a>
<a name="ln698">void PreferenceDialog::clearShortcutClicked()</a>
<a name="ln699">      {</a>
<a name="ln700">      QTreeWidgetItem* active = shortcutList-&gt;currentItem();</a>
<a name="ln701">      if (!active)</a>
<a name="ln702">            return;</a>
<a name="ln703">      QString str = active-&gt;data(0, Qt::UserRole).toString();</a>
<a name="ln704">      if (str.isEmpty())</a>
<a name="ln705">            return;</a>
<a name="ln706">      Shortcut* s = localShortcuts[str.toLatin1().data()];</a>
<a name="ln707">      s-&gt;clear();</a>
<a name="ln708">      active-&gt;setText(1, &quot;&quot;);</a>
<a name="ln709">      shortcutsChanged = true;</a>
<a name="ln710">      }</a>
<a name="ln711"> </a>
<a name="ln712">//--------------------------------------------------------</a>
<a name="ln713">//   filterShortcutsTextChanged</a>
<a name="ln714">//--------------------------------------------------------</a>
<a name="ln715"> </a>
<a name="ln716">void  PreferenceDialog::filterShortcutsTextChanged(const QString &amp;query )</a>
<a name="ln717">      {</a>
<a name="ln718">      QTreeWidgetItem *item;</a>
<a name="ln719">      for(int i = 0; i &lt; shortcutList-&gt;topLevelItemCount(); i++) {</a>
<a name="ln720">          item = shortcutList-&gt;topLevelItem(i);</a>
<a name="ln721">          item-&gt;setHidden(!(item-&gt;text(0).contains(query, Qt::CaseInsensitive) || item-&gt;text(1).contains(query, Qt::CaseInsensitive)));</a>
<a name="ln722">          }</a>
<a name="ln723">      }</a>
<a name="ln724"> </a>
<a name="ln725">//--------------------------------------------------------</a>
<a name="ln726">//   filterAdvancedPreferences</a>
<a name="ln727">//--------------------------------------------------------</a>
<a name="ln728"> </a>
<a name="ln729">void PreferenceDialog::filterAdvancedPreferences(const QString&amp; query)</a>
<a name="ln730">      {</a>
<a name="ln731">      QTreeWidgetItem *item;</a>
<a name="ln732">      for(int i = 0; i &lt; advancedWidget-&gt;topLevelItemCount(); i++) {</a>
<a name="ln733">            item = advancedWidget-&gt;topLevelItem(i);</a>
<a name="ln734"> </a>
<a name="ln735">            if(item-&gt;text(0).toLower().contains(query.toLower()))</a>
<a name="ln736">                  item-&gt;setHidden(false);</a>
<a name="ln737">            else</a>
<a name="ln738">                  item-&gt;setHidden(true);</a>
<a name="ln739">            }</a>
<a name="ln740">      }</a>
<a name="ln741"> </a>
<a name="ln742">//--------------------------------------------------------</a>
<a name="ln743">//   resetAdvancedPreferenceToDefault</a>
<a name="ln744">//--------------------------------------------------------</a>
<a name="ln745"> </a>
<a name="ln746">void PreferenceDialog::resetAdvancedPreferenceToDefault()</a>
<a name="ln747">      {</a>
<a name="ln748">      preferences.setReturnDefaultValuesMode(true);</a>
<a name="ln749">      for (QTreeWidgetItem* item : advancedWidget-&gt;selectedItems()) {</a>
<a name="ln750">            PreferenceItem* pref = static_cast&lt;PreferenceItem*&gt;(item);</a>
<a name="ln751">            pref-&gt;setDefaultValue();</a>
<a name="ln752">            }</a>
<a name="ln753">      preferences.setReturnDefaultValuesMode(false);</a>
<a name="ln754">      }</a>
<a name="ln755"> </a>
<a name="ln756">//---------------------------------------------------------</a>
<a name="ln757">//   selectFgWallpaper</a>
<a name="ln758">//---------------------------------------------------------</a>
<a name="ln759"> </a>
<a name="ln760">void PreferenceDialog::selectFgWallpaper()</a>
<a name="ln761">      {</a>
<a name="ln762">      QString s = mscore-&gt;getWallpaper(tr(&quot;Choose Notepaper&quot;));</a>
<a name="ln763">      if (!s.isNull()) {</a>
<a name="ln764">            fgWallpaper-&gt;setText(s);</a>
<a name="ln765">            updateFgView(false);</a>
<a name="ln766">            }</a>
<a name="ln767">      }</a>
<a name="ln768"> </a>
<a name="ln769">//---------------------------------------------------------</a>
<a name="ln770">//   selectBgWallpaper</a>
<a name="ln771">//---------------------------------------------------------</a>
<a name="ln772"> </a>
<a name="ln773">void PreferenceDialog::selectBgWallpaper()</a>
<a name="ln774">      {</a>
<a name="ln775">      QString s = mscore-&gt;getWallpaper(tr(&quot;Choose Background Wallpaper&quot;));</a>
<a name="ln776">      if (!s.isNull()) {</a>
<a name="ln777">            bgWallpaper-&gt;setText(s);</a>
<a name="ln778">            updateBgView(false);</a>
<a name="ln779">            }</a>
<a name="ln780">      }</a>
<a name="ln781"> </a>
<a name="ln782">//---------------------------------------------------------</a>
<a name="ln783">//   selectDefaultStyle</a>
<a name="ln784">//---------------------------------------------------------</a>
<a name="ln785"> </a>
<a name="ln786">void PreferenceDialog::selectDefaultStyle()</a>
<a name="ln787">      {</a>
<a name="ln788">      QString s = mscore-&gt;getStyleFilename(true, tr(&quot;Choose Default Style&quot;));</a>
<a name="ln789">      if (!s.isNull())</a>
<a name="ln790">            defaultStyle-&gt;setText(s);</a>
<a name="ln791">      }</a>
<a name="ln792"> </a>
<a name="ln793">//---------------------------------------------------------</a>
<a name="ln794">//   selectPartStyle</a>
<a name="ln795">//---------------------------------------------------------</a>
<a name="ln796"> </a>
<a name="ln797">void PreferenceDialog::selectPartStyle()</a>
<a name="ln798">      {</a>
<a name="ln799">      QString s = mscore-&gt;getStyleFilename(true, tr(&quot;Choose Default Style for Parts&quot;));</a>
<a name="ln800">      if (!s.isNull())</a>
<a name="ln801">            partStyle-&gt;setText(s);</a>
<a name="ln802">      }</a>
<a name="ln803"> </a>
<a name="ln804">//---------------------------------------------------------</a>
<a name="ln805">//   selectInstrumentList1</a>
<a name="ln806">//---------------------------------------------------------</a>
<a name="ln807"> </a>
<a name="ln808">void PreferenceDialog::selectInstrumentList1()</a>
<a name="ln809">      {</a>
<a name="ln810">      QString s = QFileDialog::getOpenFileName(</a>
<a name="ln811">         this,</a>
<a name="ln812">         tr(&quot;Choose Instrument List&quot;),</a>
<a name="ln813">         instrumentList1-&gt;text(),</a>
<a name="ln814">         tr(&quot;Instrument List&quot;) + &quot; (*.xml)&quot;,</a>
<a name="ln815">         0,</a>
<a name="ln816">         preferences.getBool(PREF_UI_APP_USENATIVEDIALOGS) ? QFileDialog::Options() : QFileDialog::DontUseNativeDialog</a>
<a name="ln817">         );</a>
<a name="ln818">      if (!s.isNull())</a>
<a name="ln819">            instrumentList1-&gt;setText(s);</a>
<a name="ln820">      }</a>
<a name="ln821"> </a>
<a name="ln822">//---------------------------------------------------------</a>
<a name="ln823">//   selectInstrumentList2</a>
<a name="ln824">//---------------------------------------------------------</a>
<a name="ln825"> </a>
<a name="ln826">void PreferenceDialog::selectInstrumentList2()</a>
<a name="ln827">      {</a>
<a name="ln828">      QString s = QFileDialog::getOpenFileName(</a>
<a name="ln829">         this,</a>
<a name="ln830">         tr(&quot;Choose Instrument List&quot;),</a>
<a name="ln831">         instrumentList2-&gt;text(),</a>
<a name="ln832">         tr(&quot;Instrument List&quot;) + &quot; (*.xml)&quot;,</a>
<a name="ln833">         0,</a>
<a name="ln834">         preferences.getBool(PREF_UI_APP_USENATIVEDIALOGS) ? QFileDialog::Options() : QFileDialog::DontUseNativeDialog</a>
<a name="ln835">         );</a>
<a name="ln836">      if (!s.isNull())</a>
<a name="ln837">            instrumentList2-&gt;setText(s);</a>
<a name="ln838">      }</a>
<a name="ln839"> </a>
<a name="ln840">//---------------------------------------------------------</a>
<a name="ln841">//   selectStartWith</a>
<a name="ln842">//---------------------------------------------------------</a>
<a name="ln843"> </a>
<a name="ln844">void PreferenceDialog::selectStartWith()</a>
<a name="ln845">      {</a>
<a name="ln846">      QString s = QFileDialog::getOpenFileName(</a>
<a name="ln847">         this,</a>
<a name="ln848">         tr(&quot;Choose Starting Score&quot;),</a>
<a name="ln849">         sessionScore-&gt;text(),</a>
<a name="ln850">         tr(&quot;MuseScore Files&quot;) + &quot; (*.mscz *.mscx);;&quot; + tr(&quot;All&quot;) + &quot; (*)&quot;,</a>
<a name="ln851">         0,</a>
<a name="ln852">         preferences.getBool(PREF_UI_APP_USENATIVEDIALOGS) ? QFileDialog::Options() : QFileDialog::DontUseNativeDialog</a>
<a name="ln853">         );</a>
<a name="ln854">      if (!s.isNull())</a>
<a name="ln855">            sessionScore-&gt;setText(s);</a>
<a name="ln856">      }</a>
<a name="ln857"> </a>
<a name="ln858">//---------------------------------------------------------</a>
<a name="ln859">//   fgClicked</a>
<a name="ln860">//---------------------------------------------------------</a>
<a name="ln861"> </a>
<a name="ln862">void PreferenceDialog::updateFgView(bool useColor)</a>
<a name="ln863">      {</a>
<a name="ln864">      fgColorButton-&gt;setChecked(useColor);</a>
<a name="ln865">      fgWallpaperButton-&gt;setChecked(!useColor);</a>
<a name="ln866">      fgUseColorInPalettes-&gt;setChecked(preferences.getBool(PREF_UI_CANVAS_FG_USECOLOR_IN_PALETTES));</a>
<a name="ln867">      fgWallpaper-&gt;setEnabled(!useColor);</a>
<a name="ln868">      fgWallpaperSelect-&gt;setEnabled(!useColor);</a>
<a name="ln869">      fgUseColorInPalettes-&gt;setEnabled(useColor);</a>
<a name="ln870"> </a>
<a name="ln871">      if (useColor) {</a>
<a name="ln872">            fgColorLabel-&gt;setColor(preferences.getColor(PREF_UI_CANVAS_FG_COLOR));</a>
<a name="ln873">            fgColorLabel-&gt;setPixmap(0);</a>
<a name="ln874">            }</a>
<a name="ln875">      else {</a>
<a name="ln876">            fgColorLabel-&gt;setPixmap(new QPixmap(fgWallpaper-&gt;text()));</a>
<a name="ln877">            }</a>
<a name="ln878">      }</a>
<a name="ln879"> </a>
<a name="ln880">//---------------------------------------------------------</a>
<a name="ln881">//   bgClicked</a>
<a name="ln882">//---------------------------------------------------------</a>
<a name="ln883"> </a>
<a name="ln884">void PreferenceDialog::updateBgView(bool useColor)</a>
<a name="ln885">      {</a>
<a name="ln886">      bgColorButton-&gt;setChecked(useColor);</a>
<a name="ln887">      bgWallpaperButton-&gt;setChecked(!useColor);</a>
<a name="ln888">      bgWallpaper-&gt;setEnabled(!useColor);</a>
<a name="ln889">      bgWallpaperSelect-&gt;setEnabled(!useColor);</a>
<a name="ln890"> </a>
<a name="ln891">      if (useColor) {</a>
<a name="ln892">            bgColorLabel-&gt;setColor(preferences.getColor(PREF_UI_CANVAS_BG_COLOR));</a>
<a name="ln893">            bgColorLabel-&gt;setPixmap(0);</a>
<a name="ln894">            }</a>
<a name="ln895">      else {</a>
<a name="ln896">            bgColorLabel-&gt;setPixmap(new QPixmap(bgWallpaper-&gt;text()));</a>
<a name="ln897">            }</a>
<a name="ln898">      }</a>
<a name="ln899"> </a>
<a name="ln900">//---------------------------------------------------------</a>
<a name="ln901">//   buttonBoxClicked</a>
<a name="ln902">//---------------------------------------------------------</a>
<a name="ln903"> </a>
<a name="ln904">void PreferenceDialog::buttonBoxClicked(QAbstractButton* button)</a>
<a name="ln905">      {</a>
<a name="ln906">      switch(buttonBox-&gt;standardButton(button)) {</a>
<a name="ln907">            case QDialogButtonBox::Apply:</a>
<a name="ln908">                  apply();</a>
<a name="ln909">                  break;</a>
<a name="ln910">            case QDialogButtonBox::Ok:</a>
<a name="ln911">                  apply();</a>
<a name="ln912">                  // intentional ??</a>
<a name="ln913">                  // fall through</a>
<a name="ln914">            case QDialogButtonBox::Cancel:</a>
<a name="ln915">            default:</a>
<a name="ln916">                  hide();</a>
<a name="ln917">                  break;</a>
<a name="ln918">            }</a>
<a name="ln919">      }</a>
<a name="ln920"> </a>
<a name="ln921">//---------------------------------------------------------</a>
<a name="ln922">//   apply</a>
<a name="ln923">//---------------------------------------------------------</a>
<a name="ln924"> </a>
<a name="ln925">void PreferenceDialog::apply()</a>
<a name="ln926">      {</a>
<a name="ln927">      advancedWidget-&gt;save();</a>
<a name="ln928"> </a>
<a name="ln929">      if (lastSession-&gt;isChecked())</a>
<a name="ln930">            preferences.setCustomPreference&lt;SessionStart&gt;(PREF_APP_STARTUP_SESSIONSTART, SessionStart::LAST);</a>
<a name="ln931">      else if (newSession-&gt;isChecked())</a>
<a name="ln932">            preferences.setCustomPreference&lt;SessionStart&gt;(PREF_APP_STARTUP_SESSIONSTART, SessionStart::NEW);</a>
<a name="ln933">      else if (scoreSession-&gt;isChecked())</a>
<a name="ln934">            preferences.setCustomPreference&lt;SessionStart&gt;(PREF_APP_STARTUP_SESSIONSTART, SessionStart::SCORE);</a>
<a name="ln935">      else if (emptySession-&gt;isChecked())</a>
<a name="ln936">            preferences.setCustomPreference&lt;SessionStart&gt;(PREF_APP_STARTUP_SESSIONSTART, SessionStart::EMPTY);</a>
<a name="ln937"> </a>
<a name="ln938">      preferences.setPreference(PREF_APP_AUTOSAVE_AUTOSAVETIME, autoSaveTime-&gt;value());</a>
<a name="ln939">      preferences.setPreference(PREF_APP_AUTOSAVE_USEAUTOSAVE, autoSave-&gt;isChecked());</a>
<a name="ln940">      preferences.setPreference(PREF_APP_PATHS_INSTRUMENTLIST1, instrumentList1-&gt;text());</a>
<a name="ln941">      preferences.setPreference(PREF_APP_PATHS_INSTRUMENTLIST2, instrumentList2-&gt;text());</a>
<a name="ln942">      preferences.setPreference(PREF_APP_PATHS_MYIMAGES, myImages-&gt;text());</a>
<a name="ln943">      preferences.setPreference(PREF_APP_PATHS_MYPLUGINS, myPlugins-&gt;text());</a>
<a name="ln944">      preferences.setPreference(PREF_APP_PATHS_MYSCORES, myScores-&gt;text());</a>
<a name="ln945">      preferences.setPreference(PREF_APP_PATHS_MYSOUNDFONTS, mySoundfonts-&gt;text());</a>
<a name="ln946">      preferences.setPreference(PREF_APP_PATHS_MYSTYLES, myStyles-&gt;text());</a>
<a name="ln947">      preferences.setPreference(PREF_APP_PATHS_MYTEMPLATES, myTemplates-&gt;text());</a>
<a name="ln948">      preferences.setPreference(PREF_APP_PATHS_MYEXTENSIONS, myExtensions-&gt;text());</a>
<a name="ln949">      preferences.setPreference(PREF_APP_STARTUP_STARTSCORE, sessionScore-&gt;text());</a>
<a name="ln950">      preferences.setPreference(PREF_EXPORT_AUDIO_SAMPLERATE, exportAudioSampleRate-&gt;currentData().toInt());</a>
<a name="ln951">      preferences.setPreference(PREF_EXPORT_MP3_BITRATE, exportMp3BitRate-&gt;currentData().toInt());</a>
<a name="ln952">      preferences.setPreference(PREF_EXPORT_MUSICXML_EXPORTLAYOUT, exportAllLayouts-&gt;isChecked());</a>
<a name="ln953">      preferences.setPreference(PREF_EXPORT_PDF_DPI, exportPdfDpi-&gt;value());</a>
<a name="ln954">      preferences.setPreference(PREF_EXPORT_PNG_RESOLUTION, pngResolution-&gt;value());</a>
<a name="ln955">      preferences.setPreference(PREF_EXPORT_PNG_USETRANSPARENCY, pngTransparent-&gt;isChecked());</a>
<a name="ln956">      preferences.setPreference(PREF_IMPORT_MUSICXML_IMPORTBREAKS, importBreaks-&gt;isChecked());</a>
<a name="ln957">      preferences.setPreference(PREF_IMPORT_MUSICXML_IMPORTLAYOUT, importLayout-&gt;isChecked());</a>
<a name="ln958">      if (resetElementPositionsAlwaysAsk-&gt;isChecked())</a>
<a name="ln959">            preferences.setPreference(PREF_IMPORT_COMPATIBILITY_RESET_ELEMENT_POSITIONS, &quot;Ask&quot;);</a>
<a name="ln960">      else if (resetElementPositionsYes-&gt;isChecked())</a>
<a name="ln961">            preferences.setPreference(PREF_IMPORT_COMPATIBILITY_RESET_ELEMENT_POSITIONS, &quot;Yes&quot;);</a>
<a name="ln962">      else if (resetElementPositionsNo-&gt;isChecked())</a>
<a name="ln963">            preferences.setPreference(PREF_IMPORT_COMPATIBILITY_RESET_ELEMENT_POSITIONS, &quot;No&quot;);</a>
<a name="ln964">      preferences.setPreference(PREF_IO_MIDI_ADVANCEONRELEASE, advanceOnRelease-&gt;isChecked());</a>
<a name="ln965">      preferences.setPreference(PREF_IO_MIDI_ENABLEINPUT, enableMidiInput-&gt;isChecked());</a>
<a name="ln966">      preferences.setPreference(PREF_IO_MIDI_EXPANDREPEATS, expandRepeats-&gt;isChecked());</a>
<a name="ln967">      preferences.setPreference(PREF_EXPORT_AUDIO_NORMALIZE, normalize-&gt;isChecked());</a>
<a name="ln968">      preferences.setPreference(PREF_IO_MIDI_EXPORTRPNS, exportRPNs-&gt;isChecked());</a>
<a name="ln969">      preferences.setPreference(PREF_IO_MIDI_REALTIMEDELAY, realtimeDelay-&gt;value());</a>
<a name="ln970">      preferences.setPreference(PREF_IO_MIDI_USEREMOTECONTROL, rcGroup-&gt;isChecked());</a>
<a name="ln971">      preferences.setPreference(PREF_IO_OSC_PORTNUMBER, oscPort-&gt;value());</a>
<a name="ln972">      preferences.setPreference(PREF_IO_OSC_USEREMOTECONTROL, oscServer-&gt;isChecked());</a>
<a name="ln973">      preferences.setPreference(PREF_SCORE_CHORD_PLAYONADDNOTE, playChordOnAddNote-&gt;isChecked());</a>
<a name="ln974">      preferences.setPreference(PREF_SCORE_NOTE_DEFAULTPLAYDURATION, defaultPlayDuration-&gt;value());</a>
<a name="ln975">      preferences.setPreference(PREF_SCORE_NOTE_PLAYONCLICK, playNotes-&gt;isChecked());</a>
<a name="ln976">      preferences.setPreference(PREF_UI_APP_STARTUP_CHECKUPDATE, checkUpdateStartup-&gt;isChecked());</a>
<a name="ln977">      preferences.setPreference(PREF_UI_APP_STARTUP_SHOWNAVIGATOR, navigatorShow-&gt;isChecked());</a>
<a name="ln978">      preferences.setPreference(PREF_UI_APP_STARTUP_SHOWPLAYPANEL, playPanelShow-&gt;isChecked());</a>
<a name="ln979">      preferences.setPreference(PREF_UI_APP_STARTUP_SHOWSPLASHSCREEN, showSplashScreen-&gt;isChecked());</a>
<a name="ln980">      preferences.setPreference(PREF_UI_APP_STARTUP_SHOWSTARTCENTER, showStartcenter-&gt;isChecked());</a>
<a name="ln981">      preferences.setPreference(PREF_UI_APP_STARTUP_SHOWTOURS, showTours-&gt;isChecked());</a>
<a name="ln982">      preferences.setPreference(PREF_APP_TELEMETRY_ALLOWED, collectTelemetry-&gt;isChecked());</a>
<a name="ln983">      preferences.setPreference(PREF_UI_CANVAS_BG_USECOLOR, bgColorButton-&gt;isChecked());</a>
<a name="ln984">      preferences.setPreference(PREF_UI_CANVAS_BG_COLOR, bgColorLabel-&gt;color());</a>
<a name="ln985">      preferences.setPreference(PREF_UI_CANVAS_FG_USECOLOR, fgColorButton-&gt;isChecked());</a>
<a name="ln986">      preferences.setPreference(PREF_UI_CANVAS_FG_USECOLOR_IN_PALETTES, fgUseColorInPalettes-&gt;isChecked());</a>
<a name="ln987">      preferences.setPreference(PREF_UI_CANVAS_FG_COLOR, fgColorLabel-&gt;color());</a>
<a name="ln988">      preferences.setPreference(PREF_UI_CANVAS_BG_WALLPAPER, bgWallpaper-&gt;text());</a>
<a name="ln989">      preferences.setPreference(PREF_UI_CANVAS_FG_WALLPAPER, fgWallpaper-&gt;text());</a>
<a name="ln990">      preferences.setPreference(PREF_UI_CANVAS_MISC_ANTIALIASEDDRAWING, drawAntialiased-&gt;isChecked());</a>
<a name="ln991">      preferences.setPreference(PREF_UI_CANVAS_MISC_SELECTIONPROXIMITY, proximity-&gt;value());</a>
<a name="ln992">      preferences.setPreference(PREF_UI_CANVAS_SCROLL_LIMITSCROLLAREA, limitScrollArea-&gt;isChecked());</a>
<a name="ln993">      preferences.setPreference(PREF_UI_THEME_ICONWIDTH, iconWidth-&gt;value());</a>
<a name="ln994">      preferences.setPreference(PREF_UI_THEME_ICONHEIGHT, iconHeight-&gt;value());</a>
<a name="ln995">      preferences.setPreference(PREF_UI_THEME_FONTFAMILY, fontFamily-&gt;currentFont().family());</a>
<a name="ln996">      preferences.setPreference(PREF_UI_THEME_FONTSIZE, fontSize-&gt;value());</a>
<a name="ln997"> </a>
<a name="ln998">      bool wasJack = (preferences.getBool(PREF_IO_JACK_USEJACKMIDI) || preferences.getBool(PREF_IO_JACK_USEJACKAUDIO));</a>
<a name="ln999">      bool wasJackAudio = preferences.getBool(PREF_IO_JACK_USEJACKAUDIO);</a>
<a name="ln1000">      bool wasJackMidi = preferences.getBool(PREF_IO_JACK_USEJACKMIDI);</a>
<a name="ln1001">      preferences.setPreference(PREF_IO_JACK_USEJACKAUDIO, jackDriver-&gt;isChecked() &amp;&amp; useJackAudio-&gt;isChecked());</a>
<a name="ln1002">      preferences.setPreference(PREF_IO_JACK_USEJACKMIDI, jackDriver-&gt;isChecked() &amp;&amp; useJackMidi-&gt;isChecked());</a>
<a name="ln1003">      bool nowJack = (preferences.getBool(PREF_IO_JACK_USEJACKMIDI) || preferences.getBool(PREF_IO_JACK_USEJACKAUDIO));</a>
<a name="ln1004">      bool jackParametersChanged = (preferences.getBool(PREF_IO_JACK_USEJACKAUDIO) != wasJackAudio</a>
<a name="ln1005">                  || preferences.getBool(PREF_IO_JACK_USEJACKMIDI) != wasJackMidi</a>
<a name="ln1006">                  || preferences.getBool(PREF_IO_JACK_REMEMBERLASTCONNECTIONS) != rememberLastMidiConnections-&gt;isChecked()</a>
<a name="ln1007">                  || preferences.getBool(PREF_IO_JACK_TIMEBASEMASTER) != becomeTimebaseMaster-&gt;isChecked())</a>
<a name="ln1008">                  &amp;&amp; (wasJack &amp;&amp; nowJack);</a>
<a name="ln1009"> </a>
<a name="ln1010">      preferences.setPreference(PREF_IO_JACK_TIMEBASEMASTER, becomeTimebaseMaster-&gt;isChecked());</a>
<a name="ln1011">      preferences.setPreference(PREF_IO_JACK_REMEMBERLASTCONNECTIONS, rememberLastMidiConnections-&gt;isChecked());</a>
<a name="ln1012">      preferences.setPreference(PREF_IO_JACK_USEJACKTRANSPORT, jackDriver-&gt;isChecked() &amp;&amp; useJackTransport-&gt;isChecked());</a>
<a name="ln1013"> </a>
<a name="ln1014">      if (jackParametersChanged) {</a>
<a name="ln1015">            // Change parameters of JACK driver without unload</a>
<a name="ln1016">            if (seq) {</a>
<a name="ln1017">                  seq-&gt;driver()-&gt;init(true);</a>
<a name="ln1018">                  if (!seq-&gt;init(true))</a>
<a name="ln1019">                        qDebug(&quot;sequencer init failed&quot;);</a>
<a name="ln1020">                  }</a>
<a name="ln1021">            }</a>
<a name="ln1022">      else if (</a>
<a name="ln1023">         (wasJack != nowJack)</a>
<a name="ln1024">         || (preferences.getBool(PREF_IO_PORTAUDIO_USEPORTAUDIO) != portaudioDriver-&gt;isChecked())</a>
<a name="ln1025">         || (preferences.getBool(PREF_IO_PULSEAUDIO_USEPULSEAUDIO) != pulseaudioDriver-&gt;isChecked())</a>
<a name="ln1026">#ifdef USE_ALSA</a>
<a name="ln1027">         || (preferences.getString(PREF_IO_ALSA_DEVICE) != alsaDevice-&gt;text())</a>
<a name="ln1028">         || (preferences.getInt(PREF_IO_ALSA_SAMPLERATE) != alsaSampleRate-&gt;currentData().toInt())</a>
<a name="ln1029">         || (preferences.getInt(PREF_IO_ALSA_PERIODSIZE) != alsaPeriodSize-&gt;currentData().toInt())</a>
<a name="ln1030">         || (preferences.getInt(PREF_IO_ALSA_FRAGMENTS) != alsaFragments-&gt;value())</a>
<a name="ln1031">#endif</a>
<a name="ln1032">            ) {</a>
<a name="ln1033"> </a>
<a name="ln1034">            preferences.setPreference(PREF_IO_ALSA_USEALSAAUDIO, alsaDriver-&gt;isChecked());</a>
<a name="ln1035">            preferences.setPreference(PREF_IO_PORTAUDIO_USEPORTAUDIO, portaudioDriver-&gt;isChecked());</a>
<a name="ln1036">            preferences.setPreference(PREF_IO_PULSEAUDIO_USEPULSEAUDIO, pulseaudioDriver-&gt;isChecked());</a>
<a name="ln1037">            preferences.setPreference(PREF_IO_ALSA_DEVICE, alsaDevice-&gt;text());</a>
<a name="ln1038">            preferences.setPreference(PREF_IO_ALSA_SAMPLERATE, alsaSampleRate-&gt;currentData().toInt());</a>
<a name="ln1039">            preferences.setPreference(PREF_IO_ALSA_PERIODSIZE, alsaPeriodSize-&gt;currentData().toInt());</a>
<a name="ln1040">            preferences.setPreference(PREF_IO_ALSA_FRAGMENTS, alsaFragments-&gt;value());</a>
<a name="ln1041"> </a>
<a name="ln1042">            restartAudioEngine();</a>
<a name="ln1043">            }</a>
<a name="ln1044"> </a>
<a name="ln1045">#ifdef USE_PORTAUDIO</a>
<a name="ln1046">      if (portAudioIsUsed &amp;&amp; !noSeq) {</a>
<a name="ln1047">            Portaudio* audio = static_cast&lt;Portaudio*&gt;(seq-&gt;driver());</a>
<a name="ln1048">            preferences.setPreference(PREF_IO_PORTAUDIO_DEVICE, audio-&gt;deviceIndex(portaudioApi-&gt;currentIndex(), portaudioDevice-&gt;currentIndex()));</a>
<a name="ln1049">            }</a>
<a name="ln1050">#endif</a>
<a name="ln1051"> </a>
<a name="ln1052">#ifdef USE_PORTMIDI</a>
<a name="ln1053">      preferences.setPreference(PREF_IO_PORTMIDI_INPUTDEVICE, portMidiInput-&gt;currentText());</a>
<a name="ln1054">      preferences.setPreference(PREF_IO_PORTMIDI_OUTPUTDEVICE, portMidiOutput-&gt;currentText());</a>
<a name="ln1055">      if (seq-&gt;driver() &amp;&amp; static_cast&lt;PortMidiDriver*&gt;(static_cast&lt;Portaudio*&gt;(seq-&gt;driver())-&gt;mididriver())-&gt;isSameCoreMidiIacBus(preferences.getString(PREF_IO_PORTMIDI_INPUTDEVICE), preferences.getString(PREF_IO_PORTMIDI_OUTPUTDEVICE))) {</a>
<a name="ln1056">            QMessageBox msgBox;</a>
<a name="ln1057">            msgBox.setWindowTitle(tr(&quot;Possible MIDI Loopback&quot;));</a>
<a name="ln1058">            msgBox.setIcon(QMessageBox::Warning);</a>
<a name="ln1059">            msgBox.setText(tr(&quot;Warning: You used the same CoreMIDI IAC bus for input and output. This will cause problematic loopback, whereby MuseScore's output MIDI messages will be sent back to MuseScore as input, causing confusion. To avoid this problem, access Audio MIDI Setup via Spotlight to create a dedicated virtual port for MuseScore's MIDI output, restart MuseScore, return to Preferences, and select your new virtual port for MuseScore's MIDI output. Other programs may then use that dedicated virtual port to receive MuseScore's MIDI output.&quot;));</a>
<a name="ln1060">            msgBox.exec();</a>
<a name="ln1061">            }</a>
<a name="ln1062">      preferences.setPreference(PREF_IO_PORTMIDI_OUTPUTLATENCYMILLISECONDS, portMidiOutputLatencyMilliseconds-&gt;value());</a>
<a name="ln1063">#endif</a>
<a name="ln1064"> </a>
<a name="ln1065">      if (exportAllLayouts-&gt;isChecked() || exportAllBreaks-&gt;isChecked())</a>
<a name="ln1066">            preferences.setCustomPreference&lt;MusicxmlExportBreaks&gt;(PREF_EXPORT_MUSICXML_EXPORTBREAKS, MusicxmlExportBreaks::ALL);</a>
<a name="ln1067">      else if (exportManualBreaks-&gt;isChecked())</a>
<a name="ln1068">            preferences.setCustomPreference&lt;MusicxmlExportBreaks&gt;(PREF_EXPORT_MUSICXML_EXPORTBREAKS, MusicxmlExportBreaks::MANUAL);</a>
<a name="ln1069">      else if (exportNoBreaks-&gt;isChecked())</a>
<a name="ln1070">            preferences.setCustomPreference&lt;MusicxmlExportBreaks&gt;(PREF_EXPORT_MUSICXML_EXPORTBREAKS, MusicxmlExportBreaks::NO);</a>
<a name="ln1071"> </a>
<a name="ln1072">      if (preferences.getBool(PREF_UI_CANVAS_SCROLL_VERTICALORIENTATION) != pageVertical-&gt;isChecked()) {</a>
<a name="ln1073">            preferences.setPreference(PREF_UI_CANVAS_SCROLL_VERTICALORIENTATION, pageVertical-&gt;isChecked());</a>
<a name="ln1074">            MScore::setVerticalOrientation(pageVertical-&gt;isChecked());</a>
<a name="ln1075">            for (Score* s : mscore-&gt;scores()) {</a>
<a name="ln1076">                  s-&gt;doLayout();</a>
<a name="ln1077">                  for (Score* ss : s-&gt;scoreList())</a>
<a name="ln1078">                        ss-&gt;doLayout();</a>
<a name="ln1079">                  }</a>
<a name="ln1080">            if (mscore-&gt;currentScoreView())</a>
<a name="ln1081">                  mscore-&gt;currentScoreView()-&gt;setOffset(0.0, 0.0);</a>
<a name="ln1082">            mscore-&gt;scorePageLayoutChanged();</a>
<a name="ln1083">            mscore-&gt;update();</a>
<a name="ln1084">            }</a>
<a name="ln1085"> </a>
<a name="ln1086">      if (shortcutsChanged) {</a>
<a name="ln1087">            shortcutsChanged = false;</a>
<a name="ln1088">            for(const Shortcut* s : localShortcuts) {</a>
<a name="ln1089">                  Shortcut* os = Shortcut::getShortcut(s-&gt;key());</a>
<a name="ln1090">                  if (os) {</a>
<a name="ln1091">                        if (!os-&gt;compareKeys(*s))</a>
<a name="ln1092">                              os-&gt;setKeys(*s);</a>
<a name="ln1093">                        }</a>
<a name="ln1094">                  }</a>
<a name="ln1095">            Shortcut::dirty = true;</a>
<a name="ln1096">            }</a>
<a name="ln1097"> </a>
<a name="ln1098">      int lang = language-&gt;itemData(language-&gt;currentIndex()).toInt();</a>
<a name="ln1099">      QString l = lang == 0 ? &quot;system&quot; : mscore-&gt;languages().at(lang).key;</a>
<a name="ln1100">      bool languageChanged = l != preferences.getString(PREF_UI_APP_LANGUAGE);</a>
<a name="ln1101">      preferences.setPreference(PREF_UI_APP_LANGUAGE, l);</a>
<a name="ln1102"> </a>
<a name="ln1103">      preferences.setPreference(PREF_SCORE_MAGNIFICATION, scale-&gt;value()/100.0);</a>
<a name="ln1104"> </a>
<a name="ln1105">      if (showMidiControls-&gt;isChecked() != preferences.getBool(PREF_IO_MIDI_SHOWCONTROLSINMIXER)) {</a>
<a name="ln1106">            preferences.setPreference(PREF_IO_MIDI_SHOWCONTROLSINMIXER, showMidiControls-&gt;isChecked());</a>
<a name="ln1107">            emit mixerPreferencesChanged(preferences.getBool(PREF_IO_MIDI_SHOWCONTROLSINMIXER));</a>
<a name="ln1108">            }</a>
<a name="ln1109"> </a>
<a name="ln1110"> </a>
<a name="ln1111">      if (useImportStyleFile-&gt;isChecked())</a>
<a name="ln1112">            preferences.setPreference(PREF_IMPORT_STYLE_STYLEFILE, importStyleFile-&gt;text());</a>
<a name="ln1113">      else</a>
<a name="ln1114">            preferences.setPreference(PREF_IMPORT_STYLE_STYLEFILE, &quot;&quot;);</a>
<a name="ln1115"> </a>
<a name="ln1116">      int ticks = MScore::division/4;</a>
<a name="ln1117">      switch(shortestNote-&gt;currentIndex()) {</a>
<a name="ln1118">            case 0: ticks = MScore::division;    break;</a>
<a name="ln1119">            case 1: ticks = MScore::division/2;  break;</a>
<a name="ln1120">            case 2: ticks = MScore::division/4;  break;</a>
<a name="ln1121">            case 3: ticks = MScore::division/8;  break;</a>
<a name="ln1122">            case 4: ticks = MScore::division/16; break;</a>
<a name="ln1123">            }</a>
<a name="ln1124">      preferences.setPreference(PREF_IO_MIDI_SHORTESTNOTE, ticks);</a>
<a name="ln1125"> </a>
<a name="ln1126">      preferences.setPreference(PREF_IMPORT_OVERTURE_CHARSET, importCharsetListOve-&gt;currentText());</a>
<a name="ln1127">      preferences.setPreference(PREF_IMPORT_GUITARPRO_CHARSET, importCharsetListGP-&gt;currentText());</a>
<a name="ln1128">      preferences.setPreference(PREF_SCORE_NOTE_WARNPITCHRANGE, warnPitchRange-&gt;isChecked());</a>
<a name="ln1129"> </a>
<a name="ln1130">      preferences.setCustomPreference&lt;MuseScoreStyleType&gt;(PREF_UI_APP_GLOBALSTYLE, MuseScoreStyleType(styleName-&gt;currentIndex()));</a>
<a name="ln1131"> </a>
<a name="ln1132">      if (languageChanged) {</a>
<a name="ln1133">            setMscoreLocale(preferences.getString(PREF_UI_APP_LANGUAGE));</a>
<a name="ln1134">            mscore-&gt;update();</a>
<a name="ln1135">            }</a>
<a name="ln1136"> </a>
<a name="ln1137">      if (defaultStyle-&gt;text() != preferences.getString(PREF_SCORE_STYLE_DEFAULTSTYLEFILE)) {</a>
<a name="ln1138">            preferences.setPreference(PREF_SCORE_STYLE_DEFAULTSTYLEFILE, defaultStyle-&gt;text());</a>
<a name="ln1139">            MScore::readDefaultStyle(preferences.getString(PREF_SCORE_STYLE_DEFAULTSTYLEFILE));</a>
<a name="ln1140">            }</a>
<a name="ln1141"> </a>
<a name="ln1142">      if (partStyle-&gt;text() != preferences.getString(PREF_SCORE_STYLE_PARTSTYLEFILE)) {</a>
<a name="ln1143">            preferences.setPreference(PREF_SCORE_STYLE_PARTSTYLEFILE, partStyle-&gt;text());</a>
<a name="ln1144">            MScore::defaultStyleForPartsHasChanged();</a>
<a name="ln1145">            }</a>
<a name="ln1146">      </a>
<a name="ln1147">      WorkspacesManager::retranslateAll();</a>
<a name="ln1148">      preferences.setPreference(PREF_APP_WORKSPACE, WorkspacesManager::currentWorkspace()-&gt;name());</a>
<a name="ln1149">      mscore-&gt;changeWorkspace(WorkspacesManager::currentWorkspace());</a>
<a name="ln1150">      emit mscore-&gt;workspacesChanged();</a>
<a name="ln1151">      </a>
<a name="ln1152">      emit preferencesChanged();</a>
<a name="ln1153">      preferences.save();</a>
<a name="ln1154">      mscore-&gt;startAutoSave();</a>
<a name="ln1155">      }</a>
<a name="ln1156"> </a>
<a name="ln1157">//---------------------------------------------------------</a>
<a name="ln1158">//   resetAllValues</a>
<a name="ln1159">//---------------------------------------------------------</a>
<a name="ln1160"> </a>
<a name="ln1161">void PreferenceDialog::resetAllValues()</a>
<a name="ln1162">      {</a>
<a name="ln1163">      updateValues(true);</a>
<a name="ln1164"> </a>
<a name="ln1165">      shortcutsChanged = true;</a>
<a name="ln1166">      qDeleteAll(localShortcuts);</a>
<a name="ln1167">      localShortcuts.clear();</a>
<a name="ln1168">      Shortcut::resetToDefault();</a>
<a name="ln1169">      for (const Shortcut* s : Shortcut::shortcuts())</a>
<a name="ln1170">            localShortcuts[s-&gt;key()] = new Shortcut(*s);</a>
<a name="ln1171">      updateSCListView();</a>
<a name="ln1172">      }</a>
<a name="ln1173"> </a>
<a name="ln1174">//---------------------------------------------------------</a>
<a name="ln1175">//   styleFileButtonClicked</a>
<a name="ln1176">//---------------------------------------------------------</a>
<a name="ln1177"> </a>
<a name="ln1178">void PreferenceDialog::styleFileButtonClicked()</a>
<a name="ln1179">      {</a>
<a name="ln1180">      QString fn = mscore-&gt;getStyleFilename(true, tr(&quot;Choose Default Style for Imports&quot;));</a>
<a name="ln1181">      if (fn.isEmpty())</a>
<a name="ln1182">            return;</a>
<a name="ln1183">      importStyleFile-&gt;setText(fn);</a>
<a name="ln1184">      }</a>
<a name="ln1185"> </a>
<a name="ln1186">//---------------------------------------------------------</a>
<a name="ln1187">//   midiRemoteControlClearClicked</a>
<a name="ln1188">//---------------------------------------------------------</a>
<a name="ln1189"> </a>
<a name="ln1190">void PreferenceDialog::midiRemoteControlClearClicked()</a>
<a name="ln1191">      {</a>
<a name="ln1192">      for (int i = 0; i &lt; MIDI_REMOTES; ++i)</a>
<a name="ln1193">            preferences.clearMidiRemote(i);</a>
<a name="ln1194">      updateRemote();</a>
<a name="ln1195">      }</a>
<a name="ln1196"> </a>
<a name="ln1197">//---------------------------------------------------------</a>
<a name="ln1198">//   exclusiveAudioDriver</a>
<a name="ln1199">//   Allow user to select only one audio driver, restrict</a>
<a name="ln1200">//   to uncheck all drivers.</a>
<a name="ln1201">//---------------------------------------------------------</a>
<a name="ln1202"> </a>
<a name="ln1203">void PreferenceDialog::exclusiveAudioDriver(bool on)</a>
<a name="ln1204">      {</a>
<a name="ln1205">      if (on) {</a>
<a name="ln1206">            if (portaudioDriver != QObject::sender())</a>
<a name="ln1207">                  portaudioDriver-&gt;setChecked(false);</a>
<a name="ln1208">            if (pulseaudioDriver != QObject::sender())</a>
<a name="ln1209">                  pulseaudioDriver-&gt;setChecked(false);</a>
<a name="ln1210">            if (alsaDriver != QObject::sender())</a>
<a name="ln1211">                  alsaDriver-&gt;setChecked(false);</a>
<a name="ln1212">            if (jackDriver != QObject::sender())</a>
<a name="ln1213">                  jackDriver-&gt;setChecked(false);</a>
<a name="ln1214">            if (jackDriver == QObject::sender() &amp;&amp; !useJackMidi-&gt;isChecked() &amp;&amp; !useJackAudio-&gt;isChecked()) {</a>
<a name="ln1215">                  useJackMidi-&gt;setChecked(true);</a>
<a name="ln1216">                  useJackAudio-&gt;setChecked(true);</a>
<a name="ln1217">                  }</a>
<a name="ln1218">            }</a>
<a name="ln1219">      else {</a>
<a name="ln1220">            // True if QGroupBox is checked now or was checked before clicking on it</a>
<a name="ln1221">            bool portAudioChecked =  portaudioDriver-&gt;isVisible()  &amp;&amp; ((QObject::sender() != portaudioDriver  &amp;&amp; portaudioDriver-&gt;isChecked())  || QObject::sender() == portaudioDriver);</a>
<a name="ln1222">            bool pulseaudioChecked = pulseaudioDriver-&gt;isVisible() &amp;&amp; ((QObject::sender() != pulseaudioDriver &amp;&amp; pulseaudioDriver-&gt;isChecked()) || QObject::sender() == pulseaudioDriver);</a>
<a name="ln1223">            bool alsaChecked =       alsaDriver-&gt;isVisible()       &amp;&amp; ((QObject::sender() != alsaDriver       &amp;&amp; alsaDriver-&gt;isChecked())       || QObject::sender() == alsaDriver);</a>
<a name="ln1224">            bool jackChecked =       jackDriver-&gt;isVisible()       &amp;&amp; ((QObject::sender() != jackDriver       &amp;&amp; jackDriver-&gt;isChecked())       || QObject::sender() == jackDriver);</a>
<a name="ln1225">            // If nothing is checked, prevent looping (run with -s, sequencer disabled)</a>
<a name="ln1226">            if (!(portAudioChecked || pulseaudioChecked || alsaChecked || jackChecked))</a>
<a name="ln1227">                  return;</a>
<a name="ln1228">            // Don't allow to uncheck all drivers</a>
<a name="ln1229">            if (portaudioDriver == QObject::sender())</a>
<a name="ln1230">                  portaudioDriver-&gt;setChecked(!(pulseaudioChecked || alsaChecked || jackChecked));</a>
<a name="ln1231">            if (pulseaudioDriver == QObject::sender())</a>
<a name="ln1232">                  pulseaudioDriver-&gt;setChecked(!(portAudioChecked || alsaChecked || jackChecked));</a>
<a name="ln1233">            if (alsaDriver == QObject::sender())</a>
<a name="ln1234">                  alsaDriver-&gt;setChecked(!(portAudioChecked || pulseaudioChecked || jackChecked));</a>
<a name="ln1235">            if (jackDriver == QObject::sender())</a>
<a name="ln1236">                  jackDriver-&gt;setChecked(!(portAudioChecked || pulseaudioChecked || alsaChecked));</a>
<a name="ln1237">            }</a>
<a name="ln1238">      }</a>
<a name="ln1239"> </a>
<a name="ln1240">//---------------------------------------------------------</a>
<a name="ln1241">//   exclusiveJackDriver</a>
<a name="ln1242">//   Allow user to select &quot;use Jack Audio&quot;, &quot;use Jack MIDI&quot;</a>
<a name="ln1243">//   or both, but forbid unchecking both.</a>
<a name="ln1244">//   There is no need to select &quot;JACK audio server&quot; without</a>
<a name="ln1245">//   checking any of them.</a>
<a name="ln1246">//---------------------------------------------------------</a>
<a name="ln1247"> </a>
<a name="ln1248">void PreferenceDialog::nonExclusiveJackDriver(bool on)</a>
<a name="ln1249">      {</a>
<a name="ln1250">      if (!on) {</a>
<a name="ln1251">            if (QObject::sender() == useJackAudio)</a>
<a name="ln1252">                  useJackAudio-&gt;setChecked(!useJackMidi-&gt;isChecked());</a>
<a name="ln1253">            else if (QObject::sender() == useJackMidi)</a>
<a name="ln1254">                  useJackMidi-&gt;setChecked(!useJackAudio-&gt;isChecked());</a>
<a name="ln1255">            }</a>
<a name="ln1256">      }</a>
<a name="ln1257"> </a>
<a name="ln1258">//---------------------------------------------------------</a>
<a name="ln1259">//   selectScoresDirectory</a>
<a name="ln1260">//---------------------------------------------------------</a>
<a name="ln1261"> </a>
<a name="ln1262">void PreferenceDialog::selectScoresDirectory()</a>
<a name="ln1263">      {</a>
<a name="ln1264">      QString s = QFileDialog::getExistingDirectory(</a>
<a name="ln1265">         this,</a>
<a name="ln1266">         tr(&quot;Choose Score Folder&quot;),</a>
<a name="ln1267">         myScores-&gt;text(),</a>
<a name="ln1268">         QFileDialog::ShowDirsOnly | (preferences.getBool(PREF_UI_APP_USENATIVEDIALOGS) ? QFileDialog::Options() : QFileDialog::DontUseNativeDialog)</a>
<a name="ln1269">         );</a>
<a name="ln1270">      if (!s.isNull())</a>
<a name="ln1271">            myScores-&gt;setText(s);</a>
<a name="ln1272">      }</a>
<a name="ln1273"> </a>
<a name="ln1274">//---------------------------------------------------------</a>
<a name="ln1275">//   selectStylesDirectory</a>
<a name="ln1276">//---------------------------------------------------------</a>
<a name="ln1277"> </a>
<a name="ln1278">void PreferenceDialog::selectStylesDirectory()</a>
<a name="ln1279">      {</a>
<a name="ln1280">      QString s = QFileDialog::getExistingDirectory(</a>
<a name="ln1281">         this,</a>
<a name="ln1282">         tr(&quot;Choose Style Folder&quot;),</a>
<a name="ln1283">         myStyles-&gt;text(),</a>
<a name="ln1284">         QFileDialog::ShowDirsOnly | (preferences.getBool(PREF_UI_APP_USENATIVEDIALOGS) ? QFileDialog::Options() : QFileDialog::DontUseNativeDialog)</a>
<a name="ln1285">         );</a>
<a name="ln1286">      if (!s.isNull())</a>
<a name="ln1287">            myStyles-&gt;setText(s);</a>
<a name="ln1288">      }</a>
<a name="ln1289"> </a>
<a name="ln1290">//---------------------------------------------------------</a>
<a name="ln1291">//   selectTemplatesDirectory</a>
<a name="ln1292">//---------------------------------------------------------</a>
<a name="ln1293"> </a>
<a name="ln1294">void PreferenceDialog::selectTemplatesDirectory()</a>
<a name="ln1295">      {</a>
<a name="ln1296">      QString s = QFileDialog::getExistingDirectory(</a>
<a name="ln1297">         this,</a>
<a name="ln1298">         tr(&quot;Choose Template Folder&quot;),</a>
<a name="ln1299">         myTemplates-&gt;text(),</a>
<a name="ln1300">         QFileDialog::ShowDirsOnly | (preferences.getBool(PREF_UI_APP_USENATIVEDIALOGS) ? QFileDialog::Options() : QFileDialog::DontUseNativeDialog)</a>
<a name="ln1301">         );</a>
<a name="ln1302">      if (!s.isNull())</a>
<a name="ln1303">            myTemplates-&gt;setText(s);</a>
<a name="ln1304">      }</a>
<a name="ln1305"> </a>
<a name="ln1306">//---------------------------------------------------------</a>
<a name="ln1307">//   selectPluginsDirectory</a>
<a name="ln1308">//---------------------------------------------------------</a>
<a name="ln1309"> </a>
<a name="ln1310">void PreferenceDialog::selectPluginsDirectory()</a>
<a name="ln1311">      {</a>
<a name="ln1312">      QString s = QFileDialog::getExistingDirectory(</a>
<a name="ln1313">         this,</a>
<a name="ln1314">         tr(&quot;Choose Plugin Folder&quot;),</a>
<a name="ln1315">         myPlugins-&gt;text(),</a>
<a name="ln1316">         QFileDialog::ShowDirsOnly | (preferences.getBool(PREF_UI_APP_USENATIVEDIALOGS) ? QFileDialog::Options() : QFileDialog::DontUseNativeDialog)</a>
<a name="ln1317">         );</a>
<a name="ln1318">      if (!s.isNull())</a>
<a name="ln1319">            myPlugins-&gt;setText(s);</a>
<a name="ln1320">      }</a>
<a name="ln1321"> </a>
<a name="ln1322">//---------------------------------------------------------</a>
<a name="ln1323">//   selectImagesDirectory</a>
<a name="ln1324">//---------------------------------------------------------</a>
<a name="ln1325"> </a>
<a name="ln1326">void PreferenceDialog::selectImagesDirectory()</a>
<a name="ln1327">      {</a>
<a name="ln1328">      QString s = QFileDialog::getExistingDirectory(</a>
<a name="ln1329">         this,</a>
<a name="ln1330">         tr(&quot;Choose Image Folder&quot;),</a>
<a name="ln1331">         myImages-&gt;text(),</a>
<a name="ln1332">         QFileDialog::ShowDirsOnly | (preferences.getBool(PREF_UI_APP_USENATIVEDIALOGS) ? QFileDialog::Options() : QFileDialog::DontUseNativeDialog)</a>
<a name="ln1333">         );</a>
<a name="ln1334">      if (!s.isNull())</a>
<a name="ln1335">            myImages-&gt;setText(s);</a>
<a name="ln1336">      }</a>
<a name="ln1337"> </a>
<a name="ln1338">//---------------------------------------------------------</a>
<a name="ln1339">//   changeSoundfontPaths</a>
<a name="ln1340">//---------------------------------------------------------</a>
<a name="ln1341"> </a>
<a name="ln1342">void PreferenceDialog::changeSoundfontPaths()</a>
<a name="ln1343">      {</a>
<a name="ln1344">      PathListDialog pld(this);</a>
<a name="ln1345">      pld.setWindowTitle(tr(&quot;SoundFont Folders&quot;));</a>
<a name="ln1346">      pld.setPath(mySoundfonts-&gt;text());</a>
<a name="ln1347">      if(pld.exec())</a>
<a name="ln1348">            mySoundfonts-&gt;setText(pld.path());</a>
<a name="ln1349">      }</a>
<a name="ln1350"> </a>
<a name="ln1351">//---------------------------------------------------------</a>
<a name="ln1352">//   selectExtensionsDirectory</a>
<a name="ln1353">//---------------------------------------------------------</a>
<a name="ln1354"> </a>
<a name="ln1355">void PreferenceDialog::selectExtensionsDirectory()</a>
<a name="ln1356">      {</a>
<a name="ln1357">      QString s = QFileDialog::getExistingDirectory(</a>
<a name="ln1358">         this,</a>
<a name="ln1359">         tr(&quot;Choose Extensions Folder&quot;),</a>
<a name="ln1360">         myExtensions-&gt;text(),</a>
<a name="ln1361">         QFileDialog::ShowDirsOnly | (preferences.getBool(PREF_UI_APP_USENATIVEDIALOGS) ? QFileDialog::Options() : QFileDialog::DontUseNativeDialog)</a>
<a name="ln1362">         );</a>
<a name="ln1363">      if (!s.isNull())</a>
<a name="ln1364">            myExtensions-&gt;setText(s);</a>
<a name="ln1365">      }</a>
<a name="ln1366"> </a>
<a name="ln1367">//---------------------------------------------------------</a>
<a name="ln1368">//   updateLanguagesClicked</a>
<a name="ln1369">//---------------------------------------------------------</a>
<a name="ln1370"> </a>
<a name="ln1371">void PreferenceDialog::updateTranslationClicked()</a>
<a name="ln1372">      {</a>
<a name="ln1373">      ResourceManager r(0);</a>
<a name="ln1374">      r.selectLanguagesTab();</a>
<a name="ln1375">      r.exec();</a>
<a name="ln1376">      }</a>
<a name="ln1377"> </a>
<a name="ln1378">//---------------------------------------------------------</a>
<a name="ln1379">//   defineShortcutClicked</a>
<a name="ln1380">//---------------------------------------------------------</a>
<a name="ln1381"> </a>
<a name="ln1382">void PreferenceDialog::defineShortcutClicked()</a>
<a name="ln1383">      {</a>
<a name="ln1384">      QTreeWidgetItem* active = shortcutList-&gt;currentItem();</a>
<a name="ln1385">      if (!active)</a>
<a name="ln1386">            return;</a>
<a name="ln1387">      QString str = active-&gt;data(0, Qt::UserRole).toString();</a>
<a name="ln1388">      if (str.isEmpty())</a>
<a name="ln1389">            return;</a>
<a name="ln1390">      Shortcut* s = localShortcuts[str.toLatin1().data()];</a>
<a name="ln1391">      ShortcutCaptureDialog sc(s, localShortcuts, this);</a>
<a name="ln1392">      int rv = sc.exec();</a>
<a name="ln1393">      if (rv == 0)</a>
<a name="ln1394">            return;</a>
<a name="ln1395">      if (rv == 2)</a>
<a name="ln1396">            s-&gt;clear();</a>
<a name="ln1397">      s-&gt;addShortcut(sc.getKey());</a>
<a name="ln1398">      active-&gt;setText(1, s-&gt;keysToString());</a>
<a name="ln1399">      shortcutsChanged = true;</a>
<a name="ln1400">      }</a>
<a name="ln1401"> </a>
<a name="ln1402"> </a>
<a name="ln1403">//---------------------------------------------------------</a>
<a name="ln1404">//   printShortcutsClicked</a>
<a name="ln1405">//---------------------------------------------------------</a>
<a name="ln1406"> </a>
<a name="ln1407">void PreferenceDialog::printShortcutsClicked()</a>
<a name="ln1408">      {</a>
<a name="ln1409">#ifndef QT_NO_PRINTER</a>
<a name="ln1410">      QPrinter printer(QPrinter::HighResolution);</a>
<a name="ln1411">      const MStyle&amp; s = MScore::defaultStyle();</a>
<a name="ln1412">      qreal pageW = s.value(Sid::pageWidth).toReal();</a>
<a name="ln1413">      qreal pageH = s.value(Sid::pageHeight).toReal();</a>
<a name="ln1414">      printer.setPaperSize(QSizeF(pageW, pageH), QPrinter::Inch);</a>
<a name="ln1415"> </a>
<a name="ln1416">      printer.setCreator(&quot;MuseScore Version: &quot; VERSION);</a>
<a name="ln1417">      printer.setFullPage(true);</a>
<a name="ln1418">      printer.setColorMode(QPrinter::Color);</a>
<a name="ln1419">      printer.setDocName(tr(&quot;MuseScore Shortcuts&quot;));</a>
<a name="ln1420">      printer.setOutputFormat(QPrinter::NativeFormat);</a>
<a name="ln1421"> </a>
<a name="ln1422">      QPrintDialog pd(&amp;printer, 0);</a>
<a name="ln1423">      pd.setWindowTitle(tr(&quot;Print Shortcuts&quot;));</a>
<a name="ln1424">      if (!pd.exec())</a>
<a name="ln1425">            return;</a>
<a name="ln1426">      qreal dpmm = printer.logicalDpiY() / 25.4;</a>
<a name="ln1427">      qreal ph   = printer.height();</a>
<a name="ln1428">      qreal tm   = dpmm * 15;</a>
<a name="ln1429">      qreal bm   = dpmm * 15;</a>
<a name="ln1430">      qreal lm   = dpmm * 20;</a>
<a name="ln1431"> </a>
<a name="ln1432">      QPainter p;</a>
<a name="ln1433">      p.begin(&amp;printer);</a>
<a name="ln1434">      qreal y = 0.0;</a>
<a name="ln1435">      qreal lh = QFontMetricsF(p.font()).lineSpacing();</a>
<a name="ln1436"> </a>
<a name="ln1437">      // get max width for description</a>
<a name="ln1438">      QMapIterator&lt;QString, Shortcut*&gt; isc(localShortcuts);</a>
<a name="ln1439">      qreal col1Width = 0.0;</a>
<a name="ln1440">      while (isc.hasNext()) {</a>
<a name="ln1441">            isc.next();</a>
<a name="ln1442">            Shortcut* sc = isc.value();</a>
<a name="ln1443">            col1Width = qMax(col1Width, QFontMetricsF(p.font()).width(sc-&gt;descr()));</a>
<a name="ln1444">            }</a>
<a name="ln1445"> </a>
<a name="ln1446">      int idx = 0;</a>
<a name="ln1447">      QTreeWidgetItem* item = shortcutList-&gt;topLevelItem(0);</a>
<a name="ln1448">      while (item) {</a>
<a name="ln1449">            if (idx == 0 || y &gt;= (ph - bm)) {</a>
<a name="ln1450">                  y = tm;</a>
<a name="ln1451">                  if (idx)</a>
<a name="ln1452">                        printer.newPage();</a>
<a name="ln1453">                  else {</a>
<a name="ln1454">                        p.save();</a>
<a name="ln1455">                        QFont font(p.font());</a>
<a name="ln1456">                        font.setPointSizeF(14.0);</a>
<a name="ln1457">                        font.setBold(true);</a>
<a name="ln1458">                        p.setFont(font);</a>
<a name="ln1459">                        p.drawText(lm, y, tr(&quot;MuseScore Shortcuts&quot;));</a>
<a name="ln1460">                        p.restore();</a>
<a name="ln1461">                        y += QFontMetricsF(font).lineSpacing();</a>
<a name="ln1462">                        y += 5 * dpmm;</a>
<a name="ln1463">                        }</a>
<a name="ln1464">                  }</a>
<a name="ln1465">            p.drawText(lm, y, item-&gt;text(0));</a>
<a name="ln1466">            p.drawText(col1Width + lm + 5 * dpmm, y, item-&gt;text(1));</a>
<a name="ln1467">            y += lh;</a>
<a name="ln1468">            ++idx;</a>
<a name="ln1469">            item = shortcutList-&gt;itemBelow(item);</a>
<a name="ln1470">            }</a>
<a name="ln1471">      p.end();</a>
<a name="ln1472">#endif</a>
<a name="ln1473">}</a>
<a name="ln1474"> </a>
<a name="ln1475">//---------------------------------------------------------</a>
<a name="ln1476">//   rebuildAudioDrivers</a>
<a name="ln1477">//---------------------------------------------------------</a>
<a name="ln1478"> </a>
<a name="ln1479">void PreferenceDialog::restartAudioEngine()</a>
<a name="ln1480">      {</a>
<a name="ln1481">      mscore-&gt;restartAudioEngine();</a>
<a name="ln1482">      }</a>
<a name="ln1483"> </a>
<a name="ln1484"> </a>
<a name="ln1485">} // namespace Ms</a>

</code></pre>
<div class="balloon" rel="8"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1042/" target="_blank">V1042</a> This file is marked with copyleft license, which requires you to open the derived source code.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
