
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>scoreElement.h</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">//=============================================================================</a>
<a name="ln2">//  MuseScore</a>
<a name="ln3">//  Music Composition &amp; Notation</a>
<a name="ln4">//</a>
<a name="ln5">//  Copyright (C) 2017 Werner Schweer</a>
<a name="ln6">//</a>
<a name="ln7">//  This program is free software; you can redistribute it and/or modify</a>
<a name="ln8">//  it under the terms of the GNU General Public License version 2</a>
<a name="ln9">//  as published by the Free Software Foundation and appearing in</a>
<a name="ln10">//  the file LICENCE.GPL</a>
<a name="ln11">//=============================================================================</a>
<a name="ln12"> </a>
<a name="ln13">#ifndef __SCORE_ELEMENT_H__</a>
<a name="ln14">#define __SCORE_ELEMENT_H__</a>
<a name="ln15"> </a>
<a name="ln16">#include &quot;types.h&quot;</a>
<a name="ln17">#include &quot;style.h&quot;</a>
<a name="ln18"> </a>
<a name="ln19">namespace Ms {</a>
<a name="ln20"> </a>
<a name="ln21">class ScoreElement;</a>
<a name="ln22">class MasterScore;</a>
<a name="ln23">class XmlWriter;</a>
<a name="ln24">class ConnectorInfoReader;</a>
<a name="ln25">class Measure;</a>
<a name="ln26">class Staff;</a>
<a name="ln27">class Part;</a>
<a name="ln28">class Score;</a>
<a name="ln29">class Sym;</a>
<a name="ln30">class MuseScoreView;</a>
<a name="ln31">class Segment;</a>
<a name="ln32">class Element;</a>
<a name="ln33">class BarLine;</a>
<a name="ln34">class Articulation;</a>
<a name="ln35">class Marker;</a>
<a name="ln36">class Clef;</a>
<a name="ln37">class KeySig;</a>
<a name="ln38">class TimeSig;</a>
<a name="ln39">class TempoText;</a>
<a name="ln40">class Breath;</a>
<a name="ln41">class Box;</a>
<a name="ln42">class HBox;</a>
<a name="ln43">class VBox;</a>
<a name="ln44">class TBox;</a>
<a name="ln45">class FBox;</a>
<a name="ln46">class ChordRest;</a>
<a name="ln47">class Slur;</a>
<a name="ln48">class Tie;</a>
<a name="ln49">class Glissando;</a>
<a name="ln50">class GlissandoSegment;</a>
<a name="ln51">class SystemDivider;</a>
<a name="ln52">class RehearsalMark;</a>
<a name="ln53">class Harmony;</a>
<a name="ln54">class Volta;</a>
<a name="ln55">class Jump;</a>
<a name="ln56">class StaffText;</a>
<a name="ln57">class Ottava;</a>
<a name="ln58">class Note;</a>
<a name="ln59">class Chord;</a>
<a name="ln60">class Rest;</a>
<a name="ln61">class LayoutBreak;</a>
<a name="ln62">class Tremolo;</a>
<a name="ln63">class System;</a>
<a name="ln64">class Sticking;</a>
<a name="ln65">class Lyrics;</a>
<a name="ln66">class LyricsLine;</a>
<a name="ln67">class LyricsLineSegment;</a>
<a name="ln68">class Stem;</a>
<a name="ln69">class SlurSegment;</a>
<a name="ln70">class TieSegment;</a>
<a name="ln71">class OttavaSegment;</a>
<a name="ln72">class Beam;</a>
<a name="ln73">class Hook;</a>
<a name="ln74">class StemSlash;</a>
<a name="ln75">class Spacer;</a>
<a name="ln76">class StaffLines;</a>
<a name="ln77">class Ambitus;</a>
<a name="ln78">class Bracket;</a>
<a name="ln79">class InstrumentChange;</a>
<a name="ln80">class Text;</a>
<a name="ln81">class TextBase;</a>
<a name="ln82">class Hairpin;</a>
<a name="ln83">class HairpinSegment;</a>
<a name="ln84">class Bend;</a>
<a name="ln85">class TremoloBar;</a>
<a name="ln86">class RepeatMeasure;</a>
<a name="ln87">class Tuplet;</a>
<a name="ln88">class NoteDot;</a>
<a name="ln89">class Dynamic;</a>
<a name="ln90">class InstrumentName;</a>
<a name="ln91">class DurationElement;</a>
<a name="ln92">class Accidental;</a>
<a name="ln93">class TextLine;</a>
<a name="ln94">class TextLineSegment;</a>
<a name="ln95">class Pedal;</a>
<a name="ln96">class PedalSegment;</a>
<a name="ln97">class LedgerLine;</a>
<a name="ln98">class Icon;</a>
<a name="ln99">class VoltaSegment;</a>
<a name="ln100">class NoteLine;</a>
<a name="ln101">class Trill;</a>
<a name="ln102">class TrillSegment;</a>
<a name="ln103">class Symbol;</a>
<a name="ln104">class FSymbol;</a>
<a name="ln105">class Fingering;</a>
<a name="ln106">class NoteHead;</a>
<a name="ln107">class FiguredBass;</a>
<a name="ln108">class StaffState;</a>
<a name="ln109">class Arpeggio;</a>
<a name="ln110">class Image;</a>
<a name="ln111">class ChordLine;</a>
<a name="ln112">class SlurTieSegment;</a>
<a name="ln113">class FretDiagram;</a>
<a name="ln114">class StaffTypeChange;</a>
<a name="ln115">class MeasureBase;</a>
<a name="ln116">class Page;</a>
<a name="ln117">class SystemText;</a>
<a name="ln118">class BracketItem;</a>
<a name="ln119">class Spanner;</a>
<a name="ln120">class SpannerSegment;</a>
<a name="ln121">class Lasso;</a>
<a name="ln122">class BagpipeEmbellishment;</a>
<a name="ln123">class LineSegment;</a>
<a name="ln124">class BSymbol;</a>
<a name="ln125">class TextLineBase;</a>
<a name="ln126">class Fermata;</a>
<a name="ln127"> </a>
<a name="ln128">class LetRing;</a>
<a name="ln129">class LetRingSegment;</a>
<a name="ln130">class Vibrato;</a>
<a name="ln131">class VibratoSegment;</a>
<a name="ln132">class PalmMute;</a>
<a name="ln133">class PalmMuteSegment;</a>
<a name="ln134">class MeasureNumber;</a>
<a name="ln135"> </a>
<a name="ln136">class StaffTextBase;</a>
<a name="ln137"> </a>
<a name="ln138">enum class Pid : int;</a>
<a name="ln139">enum class PropertyFlags : char;</a>
<a name="ln140">enum class Sid : int;</a>
<a name="ln141"> </a>
<a name="ln142">//---------------------------------------------------------</a>
<a name="ln143">//   LinkedElements</a>
<a name="ln144">//---------------------------------------------------------</a>
<a name="ln145"> </a>
<a name="ln146">class LinkedElements : public QList&lt;ScoreElement*&gt; {</a>
<a name="ln147">      int _lid;         // unique id for every linked list</a>
<a name="ln148"> </a>
<a name="ln149">   public:</a>
<a name="ln150">      LinkedElements(Score*);</a>
<a name="ln151">      LinkedElements(Score*, int id);</a>
<a name="ln152"> </a>
<a name="ln153">      void setLid(Score*, int val);</a>
<a name="ln154">      int lid() const   { return _lid;    }</a>
<a name="ln155"> </a>
<a name="ln156">      ScoreElement* mainElement();</a>
<a name="ln157">      };</a>
<a name="ln158"> </a>
<a name="ln159">//---------------------------------------------------------</a>
<a name="ln160">//   ElementName</a>
<a name="ln161">//---------------------------------------------------------</a>
<a name="ln162"> </a>
<a name="ln163">struct ElementName {</a>
<a name="ln164">      ElementType type;</a>
<a name="ln165">      const char* name;</a>
<a name="ln166">      const char* userName;</a>
<a name="ln167">      };</a>
<a name="ln168"> </a>
<a name="ln169">//---------------------------------------------------------</a>
<a name="ln170">//   ScoreElement</a>
<a name="ln171">//---------------------------------------------------------</a>
<a name="ln172"> </a>
<a name="ln173">class ScoreElement {</a>
<a name="ln174">      Score* _score;</a>
<a name="ln175">      static ElementStyle const emptyStyle;</a>
<a name="ln176"> </a>
<a name="ln177">   protected:</a>
<a name="ln178">      const ElementStyle* _elementStyle { &amp;emptyStyle };</a>
<a name="ln179">      PropertyFlags* _propertyFlagsList { 0 };</a>
<a name="ln180">      LinkedElements* _links            { 0 };</a>
<a name="ln181">      virtual int getPropertyFlagsIdx(Pid id) const;</a>
<a name="ln182"> </a>
<a name="ln183">   public:</a>
<a name="ln184">      ScoreElement(Score* s) : _score(s)   {}</a>
<a name="ln185">      ScoreElement(const ScoreElement&amp; se);</a>
<a name="ln186"> </a>
<a name="ln187">      virtual ~ScoreElement();</a>
<a name="ln188"> </a>
<a name="ln189">      Score* score() const                 { return _score;      }</a>
<a name="ln190">      MasterScore* masterScore() const;</a>
<a name="ln191">      virtual void setScore(Score* s)      { _score = s;         }</a>
<a name="ln192">      const char* name() const;</a>
<a name="ln193">      virtual QString userName() const;</a>
<a name="ln194">      virtual ElementType type() const = 0;</a>
<a name="ln195"> </a>
<a name="ln196">      static ElementType name2type(const QStringRef&amp;, bool silent = false);</a>
<a name="ln197">      static ElementType name2type(const QString&amp; s) { return name2type(QStringRef(&amp;s)); }</a>
<a name="ln198">      static const char* name(ElementType);</a>
<a name="ln199"> </a>
<a name="ln200">      virtual QVariant getProperty(Pid) const = 0;</a>
<a name="ln201">      virtual bool setProperty(Pid, const QVariant&amp;) = 0;</a>
<a name="ln202">      virtual QVariant propertyDefault(Pid) const;</a>
<a name="ln203">      virtual void resetProperty(Pid id);</a>
<a name="ln204">      QVariant propertyDefault(Pid pid, Tid tid) const;</a>
<a name="ln205">      virtual bool sizeIsSpatiumDependent() const { return true; }</a>
<a name="ln206"> </a>
<a name="ln207">      virtual void reset();                     // reset all properties &amp; position to default</a>
<a name="ln208"> </a>
<a name="ln209">      virtual Pid propertyId(const QStringRef&amp; xmlName) const;</a>
<a name="ln210">      virtual QString propertyUserValue(Pid) const;</a>
<a name="ln211"> </a>
<a name="ln212">      virtual void initElementStyle(const ElementStyle*);</a>
<a name="ln213">      virtual const ElementStyle* styledProperties() const   { return _elementStyle; }</a>
<a name="ln214"> </a>
<a name="ln215">      virtual PropertyFlags* propertyFlagsList() const   { return _propertyFlagsList; }</a>
<a name="ln216">      virtual PropertyFlags propertyFlags(Pid) const;</a>
<a name="ln217">      bool isStyled(Pid pid) const;</a>
<a name="ln218">      QVariant styleValue(Pid, Sid) const;</a>
<a name="ln219"> </a>
<a name="ln220">      void setPropertyFlags(Pid, PropertyFlags);</a>
<a name="ln221"> </a>
<a name="ln222">      virtual Sid getPropertyStyle(Pid) const;</a>
<a name="ln223">      bool readProperty(const QStringRef&amp;, XmlReader&amp;, Pid);</a>
<a name="ln224">      void readProperty(XmlReader&amp;, Pid);</a>
<a name="ln225">      bool readStyledProperty(XmlReader&amp; e, const QStringRef&amp; tag);</a>
<a name="ln226"> </a>
<a name="ln227">      virtual void readAddConnector(ConnectorInfoReader* info, bool pasteMode);</a>
<a name="ln228"> </a>
<a name="ln229">      virtual void styleChanged();</a>
<a name="ln230"> </a>
<a name="ln231">      virtual void undoChangeProperty(Pid id, const QVariant&amp;, PropertyFlags ps);</a>
<a name="ln232">      void undoChangeProperty(Pid id, const QVariant&amp;);</a>
<a name="ln233">      void undoResetProperty(Pid id);</a>
<a name="ln234"> </a>
<a name="ln235">      void undoPushProperty(Pid);</a>
<a name="ln236">      void writeProperty(XmlWriter&amp; xml, Pid id) const;</a>
<a name="ln237">      void writeStyledProperties(XmlWriter&amp;) const;</a>
<a name="ln238"> </a>
<a name="ln239">      QList&lt;ScoreElement*&gt; linkList() const;</a>
<a name="ln240"> </a>
<a name="ln241">      void linkTo(ScoreElement*);</a>
<a name="ln242">      void unlink();</a>
<a name="ln243">      bool isLinked(ScoreElement*);</a>
<a name="ln244"> </a>
<a name="ln245">      virtual void undoUnlink();</a>
<a name="ln246">      int lid() const                         { return _links ? _links-&gt;lid() : 0; }</a>
<a name="ln247">      LinkedElements* links() const           { return _links;      }</a>
<a name="ln248">      void setLinks(LinkedElements* le)       { _links = le;        }</a>
<a name="ln249"> </a>
<a name="ln250">      //---------------------------------------------------</a>
<a name="ln251">      // check type</a>
<a name="ln252">      //</a>
<a name="ln253">      // Example for ChordRest:</a>
<a name="ln254">      //</a>
<a name="ln255">      //    bool             isChordRest()</a>
<a name="ln256">      //---------------------------------------------------</a>
<a name="ln257"> </a>
<a name="ln258"> </a>
<a name="ln259">#define CONVERT(a,b) \</a>
<a name="ln260">      bool is##a() const { return type() == ElementType::b; }</a>
<a name="ln261"> </a>
<a name="ln262">      CONVERT(Note,          NOTE)</a>
<a name="ln263">      CONVERT(Rest,          REST)</a>
<a name="ln264">      CONVERT(Chord,         CHORD)</a>
<a name="ln265">      CONVERT(BarLine,       BAR_LINE)</a>
<a name="ln266">      CONVERT(Articulation,  ARTICULATION)</a>
<a name="ln267">      CONVERT(Fermata,       FERMATA)</a>
<a name="ln268">      CONVERT(Marker,        MARKER)</a>
<a name="ln269">      CONVERT(Clef,          CLEF)</a>
<a name="ln270">      CONVERT(KeySig,        KEYSIG)</a>
<a name="ln271">      CONVERT(TimeSig,       TIMESIG)</a>
<a name="ln272">      CONVERT(Measure,       MEASURE)</a>
<a name="ln273">      CONVERT(TempoText,     TEMPO_TEXT)</a>
<a name="ln274">      CONVERT(Breath,        BREATH)</a>
<a name="ln275">      CONVERT(HBox,          HBOX)</a>
<a name="ln276">      CONVERT(VBox,          VBOX)</a>
<a name="ln277">      CONVERT(TBox,          TBOX)</a>
<a name="ln278">      CONVERT(FBox,          FBOX)</a>
<a name="ln279">      CONVERT(Tie,           TIE)</a>
<a name="ln280">      CONVERT(Slur,          SLUR)</a>
<a name="ln281">      CONVERT(Glissando,     GLISSANDO)</a>
<a name="ln282">      CONVERT(GlissandoSegment,     GLISSANDO_SEGMENT)</a>
<a name="ln283">      CONVERT(SystemDivider, SYSTEM_DIVIDER)</a>
<a name="ln284">      CONVERT(RehearsalMark, REHEARSAL_MARK)</a>
<a name="ln285">      CONVERT(Harmony,       HARMONY)</a>
<a name="ln286">      CONVERT(Volta,         VOLTA)</a>
<a name="ln287">      CONVERT(Jump,          JUMP)</a>
<a name="ln288">      CONVERT(Ottava,        OTTAVA)</a>
<a name="ln289">      CONVERT(LayoutBreak,   LAYOUT_BREAK)</a>
<a name="ln290">      CONVERT(Segment,       SEGMENT)</a>
<a name="ln291">      CONVERT(Tremolo,       TREMOLO)</a>
<a name="ln292">      CONVERT(System,        SYSTEM)</a>
<a name="ln293">      CONVERT(Lyrics,        LYRICS)</a>
<a name="ln294">      CONVERT(Stem,          STEM)</a>
<a name="ln295">      CONVERT(Beam,          BEAM)</a>
<a name="ln296">      CONVERT(Hook,          HOOK)</a>
<a name="ln297">      CONVERT(StemSlash,     STEM_SLASH)</a>
<a name="ln298">      CONVERT(SlurSegment,   SLUR_SEGMENT)</a>
<a name="ln299">      CONVERT(TieSegment,    TIE_SEGMENT)</a>
<a name="ln300">      CONVERT(Spacer,        SPACER)</a>
<a name="ln301">      CONVERT(StaffLines,    STAFF_LINES)</a>
<a name="ln302">      CONVERT(Ambitus,       AMBITUS)</a>
<a name="ln303">      CONVERT(Bracket,       BRACKET)</a>
<a name="ln304">      CONVERT(InstrumentChange, INSTRUMENT_CHANGE)</a>
<a name="ln305">      CONVERT(StaffTypeChange, STAFFTYPE_CHANGE)</a>
<a name="ln306">      CONVERT(Hairpin,       HAIRPIN)</a>
<a name="ln307">      CONVERT(HairpinSegment,HAIRPIN_SEGMENT)</a>
<a name="ln308">      CONVERT(Bend,          BEND)</a>
<a name="ln309">      CONVERT(TremoloBar,    TREMOLOBAR)</a>
<a name="ln310">      CONVERT(RepeatMeasure, REPEAT_MEASURE)</a>
<a name="ln311">      CONVERT(Tuplet,        TUPLET)</a>
<a name="ln312">      CONVERT(NoteDot,       NOTEDOT)</a>
<a name="ln313">      CONVERT(Dynamic,       DYNAMIC)</a>
<a name="ln314">      CONVERT(InstrumentName, INSTRUMENT_NAME)</a>
<a name="ln315">      CONVERT(Accidental,    ACCIDENTAL)</a>
<a name="ln316">      CONVERT(TextLine,      TEXTLINE)</a>
<a name="ln317">      CONVERT(TextLineSegment,      TEXTLINE_SEGMENT)</a>
<a name="ln318">      CONVERT(Pedal,         PEDAL)</a>
<a name="ln319">      CONVERT(PedalSegment,  PEDAL_SEGMENT)</a>
<a name="ln320">      CONVERT(OttavaSegment, OTTAVA_SEGMENT)</a>
<a name="ln321">      CONVERT(LedgerLine,    LEDGER_LINE)</a>
<a name="ln322">      CONVERT(Icon,          ICON)</a>
<a name="ln323">      CONVERT(VoltaSegment,  VOLTA_SEGMENT)</a>
<a name="ln324">      CONVERT(NoteLine,      NOTELINE)</a>
<a name="ln325">      CONVERT(Trill,         TRILL)</a>
<a name="ln326">      CONVERT(TrillSegment,  TRILL_SEGMENT)</a>
<a name="ln327">      CONVERT(LetRing,       LET_RING)</a>
<a name="ln328">      CONVERT(LetRingSegment, LET_RING_SEGMENT)</a>
<a name="ln329">      CONVERT(Vibrato,       VIBRATO)</a>
<a name="ln330">      CONVERT(PalmMute,      PALM_MUTE)</a>
<a name="ln331">      CONVERT(PalmMuteSegment, PALM_MUTE_SEGMENT)</a>
<a name="ln332">      CONVERT(VibratoSegment,  VIBRATO_SEGMENT)</a>
<a name="ln333">      CONVERT(Symbol,        SYMBOL)</a>
<a name="ln334">      CONVERT(FSymbol,       FSYMBOL)</a>
<a name="ln335">      CONVERT(Fingering,     FINGERING)</a>
<a name="ln336">      CONVERT(NoteHead,      NOTEHEAD)</a>
<a name="ln337">      CONVERT(LyricsLine,    LYRICSLINE)</a>
<a name="ln338">      CONVERT(LyricsLineSegment, LYRICSLINE_SEGMENT)</a>
<a name="ln339">      CONVERT(FiguredBass,   FIGURED_BASS)</a>
<a name="ln340">      CONVERT(StaffState,    STAFF_STATE)</a>
<a name="ln341">      CONVERT(Arpeggio,      ARPEGGIO)</a>
<a name="ln342">      CONVERT(Image,         IMAGE)</a>
<a name="ln343">      CONVERT(ChordLine,     CHORDLINE)</a>
<a name="ln344">      CONVERT(FretDiagram,   FRET_DIAGRAM)</a>
<a name="ln345">      CONVERT(Page,          PAGE)</a>
<a name="ln346">      CONVERT(Text,          TEXT)</a>
<a name="ln347">      CONVERT(MeasureNumber, MEASURE_NUMBER)</a>
<a name="ln348">      CONVERT(StaffText,     STAFF_TEXT)</a>
<a name="ln349">      CONVERT(SystemText,    SYSTEM_TEXT)</a>
<a name="ln350">      CONVERT(BracketItem,   BRACKET_ITEM)</a>
<a name="ln351">      CONVERT(Score,         SCORE)</a>
<a name="ln352">      CONVERT(Staff,         STAFF)</a>
<a name="ln353">      CONVERT(Part,          PART)</a>
<a name="ln354">      CONVERT(BagpipeEmbellishment, BAGPIPE_EMBELLISHMENT)</a>
<a name="ln355">      CONVERT(Lasso,         LASSO)</a>
<a name="ln356">      CONVERT(Sticking,      STICKING)</a>
<a name="ln357">#undef CONVERT</a>
<a name="ln358"> </a>
<a name="ln359">      virtual bool isElement() const { return false; } // overridden in element.h</a>
<a name="ln360">      bool isChordRest() const       { return isRest() || isChord() || isRepeatMeasure(); }</a>
<a name="ln361">      bool isDurationElement() const { return isChordRest() || isTuplet(); }</a>
<a name="ln362">      bool isSlurTieSegment() const  { return isSlurSegment() || isTieSegment(); }</a>
<a name="ln363">      bool isSLineSegment() const;</a>
<a name="ln364">      bool isBox() const { return isVBox() || isHBox() || isTBox() || isFBox(); }</a>
<a name="ln365">      bool isVBoxBase() const { return isVBox() || isTBox() || isFBox(); }</a>
<a name="ln366">      bool isMeasureBase() const { return isMeasure() || isBox(); }</a>
<a name="ln367">      bool isTextBase() const;</a>
<a name="ln368">      bool isTextLineBaseSegment() const {</a>
<a name="ln369">         return isHairpinSegment()</a>
<a name="ln370">         || isLetRingSegment()</a>
<a name="ln371">         || isTextLineSegment()</a>
<a name="ln372">         || isOttavaSegment()</a>
<a name="ln373">         || isPalmMuteSegment()</a>
<a name="ln374">         || isPedalSegment()</a>
<a name="ln375">         || isVoltaSegment()</a>
<a name="ln376">         ;</a>
<a name="ln377">         }</a>
<a name="ln378">      bool isLineSegment() const {</a>
<a name="ln379">         return isGlissandoSegment()</a>
<a name="ln380">         || isLyricsLineSegment()</a>
<a name="ln381">         || isTextLineBaseSegment()</a>
<a name="ln382">         || isTrillSegment()</a>
<a name="ln383">         || isVibratoSegment()</a>
<a name="ln384">         ;</a>
<a name="ln385">         }</a>
<a name="ln386">      bool isSpannerSegment() const { return isLineSegment() || isTextLineBaseSegment() || isSlurSegment() || isTieSegment(); }</a>
<a name="ln387">      bool isBSymbol() const { return isImage() || isSymbol(); }</a>
<a name="ln388">      bool isTextLineBase() const {</a>
<a name="ln389">            return isHairpin()</a>
<a name="ln390">            || isLetRing()</a>
<a name="ln391">            || isNoteLine()</a>
<a name="ln392">            || isOttava()</a>
<a name="ln393">            || isPalmMute()</a>
<a name="ln394">            || isPedal()</a>
<a name="ln395">            || isTextLine()</a>
<a name="ln396">            || isVolta()</a>
<a name="ln397">            ;</a>
<a name="ln398">            }</a>
<a name="ln399">      bool isSLine() const {</a>
<a name="ln400">            return isTextLineBase() || isTrill() || isGlissando() || isVibrato();</a>
<a name="ln401">            }</a>
<a name="ln402"> </a>
<a name="ln403">      bool isSpanner() const {</a>
<a name="ln404">         return isSlur()</a>
<a name="ln405">         || isTie()</a>
<a name="ln406">         || isGlissando()</a>
<a name="ln407">         || isLyricsLine()</a>
<a name="ln408">         || isTextLineBase()</a>
<a name="ln409">         || isSLine()</a>
<a name="ln410">         ;</a>
<a name="ln411">         }</a>
<a name="ln412">      bool isStaffTextBase() const {</a>
<a name="ln413">            return isStaffText() || isSystemText();</a>
<a name="ln414">            }</a>
<a name="ln415">      };</a>
<a name="ln416"> </a>
<a name="ln417">//---------------------------------------------------</a>
<a name="ln418">// safe casting of ScoreElement</a>
<a name="ln419">//</a>
<a name="ln420">// Example for ChordRest:</a>
<a name="ln421">//</a>
<a name="ln422">//    ChordRest* toChordRest(Element* e)</a>
<a name="ln423">//---------------------------------------------------</a>
<a name="ln424"> </a>
<a name="ln425">static inline ChordRest* toChordRest(ScoreElement* e) {</a>
<a name="ln426">      Q_ASSERT(e == 0 || e-&gt;type() == ElementType::CHORD || e-&gt;type() == ElementType::REST</a>
<a name="ln427">         || e-&gt;type() == ElementType::REPEAT_MEASURE);</a>
<a name="ln428">      return (ChordRest*)e;</a>
<a name="ln429">      }</a>
<a name="ln430">static inline const ChordRest* toChordRest(const ScoreElement* e) {</a>
<a name="ln431">      Q_ASSERT(e == 0 || e-&gt;type() == ElementType::CHORD || e-&gt;type() == ElementType::REST</a>
<a name="ln432">         || e-&gt;type() == ElementType::REPEAT_MEASURE);</a>
<a name="ln433">      return (const ChordRest*)e;</a>
<a name="ln434">      }</a>
<a name="ln435">static inline DurationElement* toDurationElement(ScoreElement* e) {</a>
<a name="ln436">      Q_ASSERT(e == 0 || e-&gt;type() == ElementType::CHORD || e-&gt;type() == ElementType::REST</a>
<a name="ln437">         || e-&gt;type() == ElementType::REPEAT_MEASURE || e-&gt;type() == ElementType::TUPLET);</a>
<a name="ln438">      return (DurationElement*)e;</a>
<a name="ln439">      }</a>
<a name="ln440">static inline const DurationElement* toDurationElement(const ScoreElement* e) {</a>
<a name="ln441">      Q_ASSERT(e == 0 || e-&gt;type() == ElementType::CHORD || e-&gt;type() == ElementType::REST</a>
<a name="ln442">         || e-&gt;type() == ElementType::REPEAT_MEASURE || e-&gt;type() == ElementType::TUPLET);</a>
<a name="ln443">      return (const DurationElement*)e;</a>
<a name="ln444">      }</a>
<a name="ln445">static inline Rest* toRest(ScoreElement* e) {</a>
<a name="ln446">      Q_ASSERT(!e || e-&gt;isRest() || e-&gt;isRepeatMeasure());</a>
<a name="ln447">      return (Rest*)e;</a>
<a name="ln448">      }</a>
<a name="ln449">static inline const Rest* toRest(const ScoreElement* e) {</a>
<a name="ln450">      Q_ASSERT(!e || e-&gt;isRest() || e-&gt;isRepeatMeasure());</a>
<a name="ln451">      return (const Rest*)e;</a>
<a name="ln452">      }</a>
<a name="ln453">static inline SlurTieSegment* toSlurTieSegment(ScoreElement* e) {</a>
<a name="ln454">      Q_ASSERT(e == 0 || e-&gt;type() == ElementType::SLUR_SEGMENT || e-&gt;type() == ElementType::TIE_SEGMENT);</a>
<a name="ln455">      return (SlurTieSegment*)e;</a>
<a name="ln456">      }</a>
<a name="ln457">static inline const SlurTieSegment* toSlurTieSegment(const ScoreElement* e) {</a>
<a name="ln458">      Q_ASSERT(e == 0 || e-&gt;type() == ElementType::SLUR_SEGMENT || e-&gt;type() == ElementType::TIE_SEGMENT);</a>
<a name="ln459">      return (const SlurTieSegment*)e;</a>
<a name="ln460">      }</a>
<a name="ln461">static inline const MeasureBase* toMeasureBase(const ScoreElement* e) {</a>
<a name="ln462">     Q_ASSERT(e == 0 || e-&gt;isMeasure() || e-&gt;isVBox() || e-&gt;isHBox() || e-&gt;isTBox() || e-&gt;isFBox());</a>
<a name="ln463">      return (const MeasureBase*)e;</a>
<a name="ln464">      }</a>
<a name="ln465">static inline MeasureBase* toMeasureBase(ScoreElement* e) {</a>
<a name="ln466">     Q_ASSERT(e == 0 || e-&gt;isMeasureBase());</a>
<a name="ln467">      return (MeasureBase*)e;</a>
<a name="ln468">      }</a>
<a name="ln469">static inline Box* toBox(ScoreElement* e) {</a>
<a name="ln470">     Q_ASSERT(e == 0 || e-&gt;isBox());</a>
<a name="ln471">      return (Box*)e;</a>
<a name="ln472">      }</a>
<a name="ln473">static inline SpannerSegment* toSpannerSegment(ScoreElement* e) {</a>
<a name="ln474">      Q_ASSERT(e == 0 || e-&gt;isSpannerSegment());</a>
<a name="ln475">      return (SpannerSegment*)e;</a>
<a name="ln476">      }</a>
<a name="ln477">static inline const SpannerSegment* toSpannerSegment(const ScoreElement* e) {</a>
<a name="ln478">      Q_ASSERT(e == 0 || e-&gt;isSpannerSegment());</a>
<a name="ln479">      return (const SpannerSegment*)e;</a>
<a name="ln480">      }</a>
<a name="ln481">static inline BSymbol* toBSymbol(ScoreElement* e) {</a>
<a name="ln482">      Q_ASSERT(e == 0 || e-&gt;isBSymbol());</a>
<a name="ln483">      return (BSymbol*)e;</a>
<a name="ln484">      }</a>
<a name="ln485">static inline TextLineBase* toTextLineBase(ScoreElement* e) {</a>
<a name="ln486">      Q_ASSERT(e == 0 || e-&gt;isTextLineBase());</a>
<a name="ln487">      return (TextLineBase*)e;</a>
<a name="ln488">      }</a>
<a name="ln489">static inline TextBase* toTextBase(ScoreElement* e) {</a>
<a name="ln490">      Q_ASSERT(e == 0 || e-&gt;isTextBase());</a>
<a name="ln491">      return (TextBase*)e;</a>
<a name="ln492">      }</a>
<a name="ln493">static inline const TextBase* toTextBase(const ScoreElement* e) {</a>
<a name="ln494">      Q_ASSERT(e == 0 || e-&gt;isTextBase());</a>
<a name="ln495">      return (const TextBase*)e;</a>
<a name="ln496">      }</a>
<a name="ln497">static inline StaffTextBase* toStaffTextBase(ScoreElement* e) {</a>
<a name="ln498">      Q_ASSERT(e == 0 || e-&gt;isStaffTextBase());</a>
<a name="ln499">      return (StaffTextBase*)e;</a>
<a name="ln500">      }</a>
<a name="ln501">static inline const StaffTextBase* toStaffTextBase(const ScoreElement* e) {</a>
<a name="ln502">      Q_ASSERT(e == 0 || e-&gt;isStaffTextBase());</a>
<a name="ln503">      return (const StaffTextBase*)e;</a>
<a name="ln504">      }</a>
<a name="ln505"> </a>
<a name="ln506">#define CONVERT(a)  \</a>
<a name="ln507">static inline a* to##a(ScoreElement* e)             { Q_ASSERT(e == 0 || e-&gt;is##a()); return (a*)e; } \</a>
<a name="ln508">static inline const a* to##a(const ScoreElement* e) { Q_ASSERT(e == 0 || e-&gt;is##a()); return (const a*)e; }</a>
<a name="ln509"> </a>
<a name="ln510">      CONVERT(Element)</a>
<a name="ln511">      CONVERT(Note)</a>
<a name="ln512">      CONVERT(Chord)</a>
<a name="ln513">      CONVERT(BarLine)</a>
<a name="ln514">      CONVERT(Articulation)</a>
<a name="ln515">      CONVERT(Fermata)</a>
<a name="ln516">      CONVERT(Marker)</a>
<a name="ln517">      CONVERT(Clef)</a>
<a name="ln518">      CONVERT(KeySig)</a>
<a name="ln519">      CONVERT(TimeSig)</a>
<a name="ln520">      CONVERT(Measure)</a>
<a name="ln521">      CONVERT(TempoText)</a>
<a name="ln522">      CONVERT(Breath)</a>
<a name="ln523">      CONVERT(HBox)</a>
<a name="ln524">      CONVERT(VBox)</a>
<a name="ln525">      CONVERT(TBox)</a>
<a name="ln526">      CONVERT(FBox)</a>
<a name="ln527">      CONVERT(Spanner)</a>
<a name="ln528">      CONVERT(Tie)</a>
<a name="ln529">      CONVERT(Slur)</a>
<a name="ln530">      CONVERT(Glissando)</a>
<a name="ln531">      CONVERT(GlissandoSegment)</a>
<a name="ln532">      CONVERT(SystemDivider)</a>
<a name="ln533">      CONVERT(RehearsalMark)</a>
<a name="ln534">      CONVERT(Harmony)</a>
<a name="ln535">      CONVERT(Volta)</a>
<a name="ln536">      CONVERT(Jump)</a>
<a name="ln537">      CONVERT(StaffText)</a>
<a name="ln538">      CONVERT(Ottava)</a>
<a name="ln539">      CONVERT(LayoutBreak)</a>
<a name="ln540">      CONVERT(Segment)</a>
<a name="ln541">      CONVERT(Tremolo)</a>
<a name="ln542">      CONVERT(System)</a>
<a name="ln543">      CONVERT(Lyrics)</a>
<a name="ln544">      CONVERT(Stem)</a>
<a name="ln545">      CONVERT(Beam)</a>
<a name="ln546">      CONVERT(Hook)</a>
<a name="ln547">      CONVERT(StemSlash)</a>
<a name="ln548">      CONVERT(LineSegment)</a>
<a name="ln549">      CONVERT(SlurSegment)</a>
<a name="ln550">      CONVERT(TieSegment)</a>
<a name="ln551">      CONVERT(Spacer)</a>
<a name="ln552">      CONVERT(StaffLines)</a>
<a name="ln553">      CONVERT(Ambitus)</a>
<a name="ln554">      CONVERT(Bracket)</a>
<a name="ln555">      CONVERT(InstrumentChange)</a>
<a name="ln556">      CONVERT(StaffTypeChange)</a>
<a name="ln557">      CONVERT(Text)</a>
<a name="ln558">      CONVERT(MeasureNumber)</a>
<a name="ln559">      CONVERT(Hairpin)</a>
<a name="ln560">      CONVERT(HairpinSegment)</a>
<a name="ln561">      CONVERT(Bend)</a>
<a name="ln562">      CONVERT(TremoloBar)</a>
<a name="ln563">      CONVERT(RepeatMeasure)</a>
<a name="ln564">      CONVERT(Tuplet)</a>
<a name="ln565">      CONVERT(NoteDot)</a>
<a name="ln566">      CONVERT(Dynamic)</a>
<a name="ln567">      CONVERT(InstrumentName)</a>
<a name="ln568">      CONVERT(Accidental)</a>
<a name="ln569">      CONVERT(TextLine)</a>
<a name="ln570">      CONVERT(TextLineSegment)</a>
<a name="ln571">      CONVERT(Pedal)</a>
<a name="ln572">      CONVERT(PedalSegment)</a>
<a name="ln573">      CONVERT(OttavaSegment)</a>
<a name="ln574">      CONVERT(LedgerLine)</a>
<a name="ln575">      CONVERT(Icon)</a>
<a name="ln576">      CONVERT(VoltaSegment)</a>
<a name="ln577">      CONVERT(NoteLine)</a>
<a name="ln578">      CONVERT(Trill)</a>
<a name="ln579">      CONVERT(TrillSegment)</a>
<a name="ln580">      CONVERT(LetRing)</a>
<a name="ln581">      CONVERT(LetRingSegment)</a>
<a name="ln582">      CONVERT(Vibrato)</a>
<a name="ln583">      CONVERT(VibratoSegment)</a>
<a name="ln584">      CONVERT(PalmMute)</a>
<a name="ln585">      CONVERT(PalmMuteSegment)</a>
<a name="ln586">      CONVERT(Symbol)</a>
<a name="ln587">      CONVERT(FSymbol)</a>
<a name="ln588">      CONVERT(Fingering)</a>
<a name="ln589">      CONVERT(NoteHead)</a>
<a name="ln590">      CONVERT(LyricsLine)</a>
<a name="ln591">      CONVERT(LyricsLineSegment)</a>
<a name="ln592">      CONVERT(FiguredBass)</a>
<a name="ln593">      CONVERT(StaffState)</a>
<a name="ln594">      CONVERT(Arpeggio)</a>
<a name="ln595">      CONVERT(Image)</a>
<a name="ln596">      CONVERT(ChordLine)</a>
<a name="ln597">      CONVERT(FretDiagram)</a>
<a name="ln598">      CONVERT(Page)</a>
<a name="ln599">      CONVERT(SystemText)</a>
<a name="ln600">      CONVERT(BracketItem)</a>
<a name="ln601">      CONVERT(Staff)</a>
<a name="ln602">      CONVERT(Part)</a>
<a name="ln603">      CONVERT(Lasso)</a>
<a name="ln604">      CONVERT(BagpipeEmbellishment)</a>
<a name="ln605">      CONVERT(Sticking)</a>
<a name="ln606">#undef CONVERT</a>
<a name="ln607"> </a>
<a name="ln608">}</a>
<a name="ln609"> </a>
<a name="ln610">#endif</a>
<a name="ln611"> </a>

</code></pre>
<div class="balloon" rel="173"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v690/" target="_blank">V690</a> The 'ScoreElement' class implements a copy constructor, but lacks the copy assignment operator. It is dangerous to use such a class.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
